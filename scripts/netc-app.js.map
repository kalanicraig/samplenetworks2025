{"version":3,"sources":["app-config/netcreate-config.js","app/init-appshell.jsx","app/init.jsx","app/settings.js","app/system/datastore.js","app/system/util/constant.js","app/system/util/enum.js","app/system/util/hdate.js","app/system/util/jscli.js","app/system/util/path.js","app/system/util/prompts.js","app/system/util/reflection.js","app/test.js","app/unisys/client-datalink-class.js","app/unisys/client-lifecycle.js","app/unisys/client-messager-class.js","app/unisys/client-module-class.js","app/unisys/client-network.js","app/unisys/client-react-component.jsx","app/unisys/client-state.js","app/unisys/client.js","app/unisys/common-defs.js","app/unisys/common-netmessage-class.js","app/unisys/common-session.js","app/unisys/component/SessionShell.jsx","app/unisys/server-database.js","app/unisys/server-logger.js","app/unisys/server-network.js","app/unisys/server.js","app/view/default/AppDefault.jsx","app/view/html-frame/HTMLFrame.jsx","app/view/netcreate/NetCreate.jsx","app/view/netcreate/comment-mgr.js","app/view/netcreate/components/MURPropertyGroup.jsx","app/view/netcreate/components/MURSettingsEditor.jsx","app/view/netcreate/components/MURTextInput.jsx","app/view/netcreate/components/MarkdownNote.jsx","app/view/netcreate/components/NCAdvancedPanel.jsx","app/view/netcreate/components/NCAutoSuggest.jsx","app/view/netcreate/components/NCDialog.jsx","app/view/netcreate/components/NCDialogCitation.jsx","app/view/netcreate/components/NCDialogInsertImageURL.jsx","app/view/netcreate/components/NCEdge.jsx","app/view/netcreate/components/NCEdgeTable.jsx","app/view/netcreate/components/NCFiltersSummary.jsx","app/view/netcreate/components/NCGraph.jsx","app/view/netcreate/components/NCGraphRenderer.js","app/view/netcreate/components/NCHelpPanel.jsx","app/view/netcreate/components/NCHelpText.jsx","app/view/netcreate/components/NCHelpVocabulary.jsx","app/view/netcreate/components/NCImportExport.jsx","app/view/netcreate/components/NCInfoPanel.jsx","app/view/netcreate/components/NCNode.jsx","app/view/netcreate/components/NCNodeTable.jsx","app/view/netcreate/components/NCSearch.jsx","app/view/netcreate/components/NCTemplate.jsx","app/view/netcreate/components/NCUserTokens.jsx","app/view/netcreate/components/PopupPicker.jsx","app/view/netcreate/components/SwatchesPicker.jsx","app/view/netcreate/components/URButtonToggle.jsx","app/view/netcreate/components/URComment.jsx","app/view/netcreate/components/URCommentCollectionMgr.jsx","app/view/netcreate/components/URCommentPrompt.jsx","app/view/netcreate/components/URCommentSVGBtn.jsx","app/view/netcreate/components/URCommentStatus.jsx","app/view/netcreate/components/URCommentThread.jsx","app/view/netcreate/components/URCommentVBtn.jsx","app/view/netcreate/components/URDateField.jsx","app/view/netcreate/components/URDialog.jsx","app/view/netcreate/components/URPopover.jsx","app/view/netcreate/components/URTable.jsx","app/view/netcreate/components/filter/FilterEnums.js","app/view/netcreate/components/filter/NCFilterGroup.jsx","app/view/netcreate/components/filter/NCFilterGroupProperties.jsx","app/view/netcreate/components/filter/NCFiltersPanel.jsx","app/view/netcreate/components/filter/NCFocusFilter.jsx","app/view/netcreate/components/filter/NCHDateFilter.jsx","app/view/netcreate/components/filter/NCNumberFilter.js","app/view/netcreate/components/filter/NCSelectFilter.js","app/view/netcreate/components/filter/NCStringFilter.jsx","app/view/netcreate/components/react-settings-bridge.js","app/view/netcreate/components/useeffects-library.js","app/view/netcreate/edge-mgr.js","app/view/netcreate/filter-mgr.js","app/view/netcreate/hilite-mgr.js","app/view/netcreate/importexport-mgr.js","app/view/netcreate/lock-mgr.js","app/view/netcreate/nc-logic.js","app/view/netcreate/nc-ui.js","app/view/netcreate/nc-utils.js","app/view/netcreate/panel-mgr.js","app/view/netcreate/render-mgr.js","app/view/netcreate/selection-mgr.js","app/view/netcreate/template-editor-mgr.js","app/view/netcreate/template-mgr.js","app/view/netcreate/template-schema.js","app/view/netcreate/ui-mgr.js"],"names":["NC_CONFIG","dataset","port","googlea","process","module","exports","window","React","require","UNISYS","SETTINGS","NetCreate","AppShell","props","toggle","bind","state","isOpen","redirect","HandleMessage","setState","data","history","push","GetRouteInfoFromURL","location","href","route","routeProps","isLocalHost","IsLocalHost","display","flexFlow","width","height","Component","NC_DBG","console","log","id","DBG","ReactDOM","MUR","document","addEventListener","groupCollapsed","m_SetLifecycleScope","NCI","InteropConnect","JoinNet","EnterApp","m_RenderApp","SetupDOM","SetupRun","groupEnd","Log","event","UDATA","NewDataLink","LocalCall","ServerDisconnect","url","scope","SetScope","warn","ViewLib","DeclareComponents","Promise","resolve","reject","render","querySelector","e","alert","EJSPROPS","NC_UNISYS","S","DATE","Date","RELOAD_CHECK","RELOAD_TIMER","MOD","a","b","undefined","ROUTES_PARAMS","plist","fn","hrefParts","split","hrefString","length","stringParts","routeString","queryString","Error","routeParameters","params","key","routeInfo","settings","vars","i","setting","value","dict","pkey","result","queryVars","Set","val","Get","IsReloadRequired","clearTimeout","setTimeout","reload","CurrentTime","toDateString","EJSProp","propName","ServerHostName","server","hostname","ServerHostIP","ip","ServerAppURL","ubits","URL","hash","protocol","host","suburl","endsWith","IsAdmin","rinfo","urlHasAdmin","admin","TOML","PROMPTS","PR","Pad","NetMessage","load","DSTOR","NewModule","NCDATA","Hook","UpdateDataPromise","UpdateServerDB","BatchUpdateServerDB","InsertServerDB","MergeServerDB","OnAppStateChange","decodedData","isValid","SetSessionGroupID","token","GlobalSetGroupID","Data","IsStandaloneMode","Call","then","res","OK","PromiseCalculateMaxNodeId","NetCall","maxNodeID","JSON","stringify","PromiseNewNodeID","nodeID","PromiseNewNodeIDs","count","nodeIDs","PromiseCalculateMaxEdgeId","maxEdgeID","PromiseNewEdgeID","edgeID","PromiseNewEdgeIDs","edgeIDs","PromiseNewCommentID","comment_id","PromiseJSONFile","jsonFile","promise","xobj","XMLHttpRequest","target","status","responseText","Object","assign","parse","open","send","PromiseTOMLFile","tomlFile","tomlData","PromiseD3Data","SaveTemplateFile","template","GetTemplateTOMLFileName","d3data","mergeData","OverwriteDataPromise","CONSTANT","SEARCH_PLACEHOLDER","EDGE_NOT_SET_LABEL","ARROW_DOWN","ARROW_UPDOWN","ARROW_RIGHT","ICON_PENCIL","ICON_VIEW","ENUM","EDITORTYPE","TEMPLATE","IMPORTER","NODE","EDGE","COMMENT","BUILTIN_FIELDS_NODE","BUILTIN_FIELDS_EDGE","chrono","HDATE","erasChrono","casual","clone","parsers","pattern","extract","context","match","year","parseInt","era","toUpperCase","adjustedYear","refiners","refine","results","ERAS","pre","post","CALENDAR","ISO","GREGORIAN","JULIAN","ISLAMIC","HEBREW","CHINESE","DATEFORMAT","AS_ENTERED","MONTH_ABBR","MONTH_FULL","MONTH_NUM","MONTH_PAD","MONTHDAY_ABBR","MONTHDAY_FULL","MONTHDAY_NUM","MONTHDAY_PAD","MONTHDAYYEAR_ABBR","MONTHDAYYEAR_FULL","MONTHDAYYEAR_NUM","MONTHDAYYEAR_PAD","YEARMONTHDAY_ABBR","YEARMONTHDAY_FULL","YEARMONTHDAY_NUM","YEARMONTHDAY_PAD","HISTORICAL_MONTHDAYYEAR_ABBR","HISTORICAL_MONTHDAYYEAR_FULL","HISTORICAL_MONTHDAYYEAR_NUM","HISTORICAL_MONTHDAYYEAR_PAD","HISTORICAL_YEARMONTHDAY_ABBR","HISTORICAL_YEARMONTHDAY_FULL","HISTORICAL_YEARMONTHDAY_NUM","HISTORICAL_YEARMONTHDAY_PAD","MONTHYEAR_ABBR","MONTHYEAR_FULL","MONTHYEAR_NUM","MONTHYEAR_PAD","YEARMONTH_ABBR","YEARMONTH_FULL","YEARMONTH_NUM","YEARMONTH_PAD","HISTORICAL_MONTHYEAR_ABBR","HISTORICAL_MONTHYEAR_FULL","HISTORICAL_MONTHYEAR_NUM","HISTORICAL_MONTHYEAR_PAD","HISTORICAL_YEARMONTH_ABBR","HISTORICAL_YEARMONTH_FULL","HISTORICAL_YEARMONTH_NUM","HISTORICAL_YEARMONTH_PAD","YEAR","HISTORICALYEAR","u_pad","num","toString","padStart","u_monthAbbr","date","toLocaleDateString","month","u_monthName","Parse","dateInputStr","ShowValidationResults","ParsedResult","knownValues","start","dateValidationStr","keys","map","k","ShowMatchingFormats","dateFormat","allowFormatSelection","options","preview","matchingTypes","additionalOptions","knownTypes","text","GetPreviewStr","includes","type","format","day","Math","abs","SHOW_DOM","JSCLI","CMD","AddFunction","f","HelpString","out","forEach","name","ncHelp","DOM_ShowInstructions","E_SHELL","getElementById","E_OUT","createElement","E_HEADER","appendChild","innerHTML","PATH","rx_dir","rx_file","str","exec","Dirname","Basename","StripExt","substr","lastIndexOf","REFLECT","IS_NODE","release","PAD_SIZE","prompt","psize","len","padEnd","Stars","FunctionName","STACKTRACE","ExtractClassName","obj","funcNameRegex","constructor","depth","stack","getSync","frame","functionName","fileName","lineNumber","columnNumber","bits","InspectModule","InspectObject","label","indent","m_DumpObj","proto","Reflect","getPrototypeOf","prop","regexp","args","DBG_Out","msg","selector","Out","DBG_OutClean","TESTS","call","hook","remote","net","PASSED","TEST_GO","ARR_MATCH","m_meta_info","m_failed","m_skipped","m_passed","TM","testname","flag","error","m_ConfigureTestFlags","SetTitle","innerText","SetMeta","meta","MetaString","o","entries","v","Pass","subtest","m_InitShell","Fail","Passed","passed","Assess","m_PreTest","m_TestResults","AssessArrayMatch","arr1","arr2","AllPassed","subtests","stateChange","stateMerge","stateConcat","hookInit1","hookInit2","hookInitDeferred","hookStart","callHndlrReg","callHndlrData","callHndlrDataProp","callDataReturn","callDataAdd","callDataMulti","remoteCall","remoteData","remoteData2","remoteDataReturn","remoteDataAdd","remoteDataMulti","serverCall","serverCallOrder","serverReturn","serverData","serverDataAdd","netMessageReg","netCallHndlr","netSendHndlr","netSendNoEcho","netSignal","netSignalEcho","netData","netDataReturn","netDataAdd","netDataMulti","pair","pass","m_ShowShell","pEntries","padding","testTitle","group","concat","join","tnotes","summary","STATE","Messager","return","register","BAD_OWNER","BAD_NAME","BAD_UID","NO_DATAOBJ","BAD_EJSPROPS","UNODE","Map","UNODE_COUNTER","MESSAGER","UnisysDataLink","owner","optName","msgr_type","msgr_name","uid","has","set","namespace","State","newState","SetState","UID","MergeState","ConcatState","listener","OnStateChange","OffStateChange","mesgName","receiverUID","UnhandleMessage","inData","toNet","toLocal","srcUID","promises","all","resArray","resObj","Send","Signal","MessageNames","ValidateMessageNames","msgs","valid","HasMessageName","lifecycle","BAD_PATH","PHASE_HOOKS","PHASES","PHASE","m_ExecuteScopedPhase","phase","indexOf","info","CurrentPhase","Function","get","Execute","hooks","icount","retval","filter","values","catch","err","module_path","Scope","TEST","MSGR_IDCOUNT","handlerMap","messager_id","handlerFunc","handlerUID","syntax","udata_id","handlers","umesg","add","arguments","clear","delete","pkt","SocketSend","p","f_MakeResolverFunction","QueueTransaction","LIFECYCLE","NOT_UNIQUE","MODULES","MODULES_COUNTER","UnisysModule","module_id","AutoName","subnameCounter","ModuleID","DEFS","connect","handle","WARN","ERR_NM_REQ","ERR_NO_SOCKET","ERR_BAD_UDATA","NETSOCK","NETCLIENT","NETSERVER","M0_INIT","M1_CONNECTING","M2_CONNECTED","M3_REGISTERED","M4_READY","M_STANDALONE","M_NOCONNECT","m_status","m_options","m_hearbeat_timer","NETWORK","Connect","datalink","opt","GlobalOfflineMode","success","wsURI","uaddr","uport","ws","WebSocket","AddListener","appCache","applicationCache","UNCACHED","IDLE","CHECKING","DOWNLOADING","UPDATEREADY","OBSOLETE","m_HandleRegistrationMessage","msgEvent","regData","HELLO","UADDR","RemoveListener","DefaultServerUADDR","GlobalSetup","netsocket","m_HandleMessage","m_ResetHearbeatTimer","m_RespondToHeartbeat","readyState","OPEN","heartbeatStopped","message","SERVER_HEARTBEAT_INTERVAL","Message","IsOwnResponse","CompleteTransaction","Type","dbgout","startsWith","SocketUADDR","SourceAddress","LocalSignal","ReturnTransaction","LocalSend","SetData","json","SeqNum","Close","code","reason","close","handlerFunction","removeEventListener","LocalInfo","ServerInfo","ServerSocketInfo","UMODULE","UnisysComponent","m","lis","f_deprecated","d","NetSend","NetSignal","ns","AppState","so","SetAppState","AppStateChangeOff","f_unimplemented","f_unsupported","repl","REACT","TYPEOF","BAD_NSPACE","BAD_LISTENR","NO_UID_FLTR","WARN_PROP_MISMATCH","USTATE","STATES","STATES_LISTEN","m_ConformNamespace","m_ConformState","merge","entry","nprop","t_old","t_new","m_GetStateMessager","nspace","msgr","src_uid","namespaceMessager","UniData","UniModule","UniComponent","uniqueName","RegisterMessagesPromise","messages","SystemInitialize","ForceReloadSingleApp","root_module_id","InScope","currentScope","failure","Run","BeforePause","Paused","PostPause","CleanupRun","ExitApp","items","transact","m_id_counter","m_id_prefix","m_transactions","m_netsocket","m_group_id","M_INIT","M_ONLINE","M_CLOSED","m_mode","ERR","ERR_NOT_NETMESG","ERR_BAD_PROP","ERR_ERR_BAD_CSTR","ERR_BAD_SOCKET","ERR_DUPE_TRANS","ERR_UNKNOWN_TYPE","ERR_NOT_PACKET","ERR_UNKNOWN_RMODE","KNOWN_TYPES","ROUTING_MODE","m_SeqIncrement","m_CheckType","MakeNewID","rmode","memo","seqnum","seqlog","s_uaddr","s_group","s_uid","msgstr","propOrVal","IsTransaction","SourceGroupID","idStr","socket","GlobalGroupID","dst","dbg","IsServerMessage","m_GetHashKey","m_CheckRMode","resolverFunc","deleteProperty","config","GlobalCleanup","CustomEvent","detail","dispatchEvent","mode","HashIds","SESUTIL","HASH_ABET","HASH_MINLEN","m_current_groupid","DecodeToken","templateSalt","DELIMITER","tokenBits","classId","projId","hashedId","groupId","subId","salt","hashids","decode","Number","isInteger","test","substring","userId","decoded","IsValidToken","MakeToken","MAX_SAFE_INTEGER","encode","SetGroupID","good","GroupID","SESSION","INPUT_STYLE","border","borderLeft","borderRadius","fontFamily","fontWeight","fontSize","lineHeight","textAlign","textTransform","GROUP_STYLE","backgroundColor","color","marginTop","LABEL_STYLE","verticalAlign","marginBottom","LOGIN_BTN_STYLE","NAV_LOGIN_STYLE","zIndex","NAV_LOGIN_FEEDBACK_STYLE","paddingRight","VALID","borderColor","outlineColor","VALIDBTN","INVALID","SessionShell","renderLogin","renderLoggedIn","handleChange","onSubmit","previousIsValid","classproj","gid","subid","formFeedback","tip","loginbtn","input","secretKey","prevProps","preventDefault","replace","standalone","timestamp","TOMLPath","m_GetTemplateTOMLFilePath","FS","ensureDirSync","dirname","existsSync","m_LoadTOMLTemplate","copySync","m_DefaultTemplatePath","m_LoadTemplate","Loki","LOGGER","FILTER","RUNTIMEPATH","TEMPLATEPATH","TEMPLATE_EXT","BACKUPPATH","db_file","m_db","m_max_edgeID","m_max_nodeID","m_max_commentID","m_dupe_set","NODES","EDGES","COMMENTS","READBY","m_locked_nodes","m_locked_edges","m_locked_comments","m_open_editors","BL","s","RD","YL","DB","m_BackupDatabase","toISOString","backupDBFilePath","m_GetValidDBFilePath","InitializeDatabase","getCollection","addCollection","dupeNodes","mapReduce","m_CleanObjID","max","arr","WriteRLog","m_CleanEdgeEndpoints","saveDatabase","m_MigrateTemplate","m_ValidateTemplate","f_DatabaseInitialize","ropt","autoload","autoloadCallback","autosave","autosaveCallback","f_AutosaveStatus","autosaveInterval","nodeCount","edgeCount","commentCount","readbyCount","templateFilePath","templateFile","readFile","Loaded","T","EDF","edgeDefs","NDF","nodeDefs","nset","duplicationWarning","nodeIsLockedMessage","edgeIsLockedMessage","templateIsLockedMessage","importIsLockedMessage","searchColor","sourceColor","filterFade","filterReduce","filterFocus","filterFadeHelp","filterReduceHelp","filterFocusHelp","nodeSizeDefault","nodeSizeMax","edgeSizeDefault","edgeSizeMax","weight","default","exportLabel","help","description","includeInGraphTooltip","isRequired","isProvenance","hidden","_schemaVersion","source","version","Array","isArray","notes","provenance","comments","citation","category","templateFileName","PKT_GetDatabase","nodes","chain","removeMeta","edges","readby","Info","m_MigrateNodes","m_MigrateEdges","InfoObj","PKT_SetDatabase","insert","PKT_InsertDatabase","PKT_MergeDatabase","node","n","PKT_Update","edge","c","comment","r","PKT_UpdateDatabase","update","PKT_ReplaceDatabase","m_CalculateMaxNodeID","PKT_CalculateMaxNodeID","m_GetNewNodeID","PKT_GetNewNodeID","PKT_GetNewNodeIDs","firstId","m_CalculateMaxEdgeID","PKT_CalculateMaxEdgeID","m_GetNewEdgeID","PKT_GetNewEdgeID","PKT_GetNewEdgeIDs","m_GetNewCommentID","PKT_GetNewCommentID","m_CalculateMaxCommentID","PKT_RequestLockNode","errcode","m_IsInvalidNode","m_MakeLockError","locked","PKT_RequestUnlockNode","unlocked","PKT_IsNodeLocked","isLocked","isNaN","matches","find","NOP","INFO","PKT_RequestLockEdge","m_IsInvalidEdge","PKT_RequestUnlockEdge","PKT_IsEdgeLocked","PKT_RequestLockComment","commentID","PKT_RequestUnlockComment","PKT_IsCommentLocked","PKT_RequestUnlockAllNodes","PKT_RequestUnlockAllEdges","PKT_RequestUnlockAllComments","PKT_RequestUnlockAll","RequestUnlock","replacementNodeID","readbys","AppendNodeLog","updatedNode","findOne","op","findAndUpdate","AppendEdgeLog","updatedEdge","m_CleanID","edgesToProcess","where","sourceEdges","findAndRemove","targetEdges","AppendCommentLog","updatedComment","retvals","AppendReadbyLog","updatedReadby","PKT_BatchUpdate","item","collection_ref","m_CommentUpdate","m_CommentRemove","_nlog","el","FilterNodeLog","newNode","_elog","FilterEdgeLog","newEdge","FilterCommentLog","newComment","FilterReadbyLog","newReadby","WriteDbJSON","filePath","db","writeFileSync","m_GetTemplateTOMLFileName","filename","WriteTemplateTOML","path","backupFilePath","toml","outputFile","CloneTemplateTOML","RegenerateDefaultTemplate","TEMPLATE_SCHEMA","ParseTemplateSchema","GetEditStatus","my_uaddr","templateBeingEdited","importActive","nodeOrEdgeBeingEdited","lockedNodes","lockedEdges","lockedComments","RequestEditLock","editor","ReleaseEditLock","findIndex","splice","propertyName","property","defaultValue","int","regex","FSE","LOG_DIR","Tracer","LOG_DELIMITER","LOG_CONFIG","dateformat","preprocess","line","zeroPad","colorConsole","fs_log","e_weekday","dir","__dirname","ensureDir","logname","str_TimeDatedFilename","pathname","createWriteStream","fieldnames","fields","write","LogResearchLine","str_DateStamp","str_TimeStamp","LogLine","str_ShortDateStamp","hh","getHours","slice","mm","getMinutes","ss","getSeconds","getMonth","dd","getDate","getDay","yyyy","getFullYear","hms","LOG","PKT_LogEvent","Write","m_PromiseServerHandlers","m_PromiseRemoteHandlers","IsType","notsrv","pktArray","reduce","pdata","STAT","WSS","Server","ERR_SS_EXISTS","DBG_SOCK_BADCLOSE","DEFAULT_NET_PORT","mu_wss","mu_options","mu_sockets","mu_sid_counter","m_server_handlers","m_message_map","m_socket_msgs_list","m_heartbeat_interval","m_pong_timer","UNET","SERVER_UADDR","InitializeNetwork","StartNetwork","on","m_NewSocketConnected","RegisterRemoteHandlers","regd","existing","registered","m_SocketAdd","m_SocketClientAck","m_SocketMessage","m_SocketDelete","m_StartHeartbeat","setInterval","sendHeartbeat","m_ResetPongTimer","pongTimedOut","m_HandleState","f_make_resolver_func","srcPkt","f_make_remote_resolver_func","d_uaddr","verbose","d_sock","newpkt","CopySourceAddress","sid","m_GetNewUADDR","m_ListSockets","prefix","cstr","rmesgs","addressSet","change","UDB","ROOT","TEST_TEMPL_DIR","SettingMgr","LoadSettings","WriteDefaultSettings","override","RegisterHandlers","serverSays","sprint_message","editStatus","src","lockResult","pktData","unlockResult","AppDefault","flex","HTMLFrame","loc","UR","NCSearch","NCNode","NCGraph","NCLOGIC","FILTERMGR","EDGEMGR","SELECTIONMGR","HILITEMGR","CMTMGR","SM","StateMgr","_initializeState","prop_1","Init","isConnected","isLoggedIn","requireLogin","disconnectMsg","layoutNodesOpen","layoutFiltersOpen","commentStatusMessage","OnDOMReady","OnReset","OnStart","OnAppReady","OnRun","OnDisconnect","onStateChange_SESSION","onStateChange_PANELSTATE","onDisconnect","onFilterBtnClick","time","toLocaleTimeString","dragger","onmousedown","handleMouseDown","handleMessageUpdate","hideGraph","DISCONNECTED_MSG","NAVBAR","flexGrow","NAVBTNS","PANELMGR","HelpIsOpen","ToggleHelp","AdvancedIsOpen","ToggleAdvanced","visibility","PANEL_LABEL","UMOD","LOCKMGR","DATASTORE","NCUI","NCDialog","CMTBTNOFFSET","dialogContainerId","LoadDB","m_urstate_LOCKSTATE","HandleCOMMENTS_UPDATE","HandleCOMMENT_UPDATE","HandleREADBY_UPDATE","LoadTemplate","commentTypes","GetCurrentUserId","DeriveAllThreadedViewObjects","COMMENTCOLLECTION","GetCommentCollections","COMMENTICON","m_SetAppStateCommentCollections","m_SetAppStateCommentVObjs","COMMENTVOBJS","GetCOMMENTVOBJS","m_UpdateComment","cobj","comment_id_parent","comment_id_previous","comment_type","comment_createtime","comment_modifytime","comment_isMarkedDeleted","commenter_id","commenter_text","UpdateComment","LOCKSTATE","VIEWMODE","GetNodeCREF","nodeId","GetEdgeCREF","edgeId","GetProjectCREF","projectId","DeconstructCREF","cref","GetCREFSourceLabel","typeLabel","sourceNode","targetNode","sourceLabel","GetCommentBtnPosition","btn","bbox","getBoundingClientRect","x","left","y","top","GetCommentCollectionPosition","isExpanded","windowWidth","min","screen","innerWidth","windowHeight","innerHeight","newX","newY","scrollY","OpenReferent","OpenComment","cid","commentEl","scrollIntoView","behavior","SetCurrentUserId","GetUserName","GetCommentTypes","GetCommentType","slug","GetDefaultCommentType","MarkAllRead","crefs","GetCrefs","m_DBUpdateReadBy","MarkRead","GetCommentCollection","uiref","OpenCommentCollection","position","openComments","GetOpenComments","CloseCommentCollection","commentThreadWindowIsExpanded","GetCommentCollectionCount","collectionPosition","UpdateCommentUIState","OpenCommentCollectionByCref","cmtPosition","OpenCommentStatusComment","parms","GetCommentsAreBeingEdited","CMTSTATUS","dialog","okmessage","onOK","m_CloseRemoveCommentDialog","cancelmessage","onCancel","CloseAllCommentCollectionsWithoutMarkingRead","OKtoClose","CloseCommentCollectionAndMarkRead","CloseAllCommentCollections","ccol","GetCommentStats","GetCommentThreadPosition","commentButtonId","cmtbtnx","GetCommentUIState","openState","RegisterCommentBeingEdited","DeRegisterCommentBeingEdited","cvobjs","GetThreadedViewObjects","isBeingEdited","GetCommentBeingEdited","cvobj","GetCommentVObj","GetComment","GetUnreadRepliesToMe","GetUnreadComments","AddComment","newCommentID","UIEditComment","LockComment","UICancelComment","UnlockComment","UISaveComment","m_DBUpdateComment","RemoveComment","confirmMessage","showCancelDialog","isAdmin","skipDialog","m_ExecuteRemoveComment","cb","queuedActions","m_DBRemoveComment","RemoveAllCommentsForCref","dataArray","updatedComments","removedComments","updatedCrefs","HandleRemovedComments","HandleUpdatedComments","DeriveThreadedViewObjects","incomingComment","editingCommentId","GetCommentsBeingEdited","next","editingComment","commenter_ids","GetReadby","RSB","DerefGroupDef","GroupHeader","PropertyGroup","groupDef","metaDef","gdata","groupName","properties","propList","_groupMeta","title","margin","fontStyle","ConsoleStyler","diff","SettingsContext","GetSettingsContext","MURSettingsEditor","api","useSettings","useState","lastSettingsUpdate","oldState","saveOldState","showToDo","setShowToDo","saveChanges","revertChanges","propDefs","GetPropertyDefs","metaDefs","GetMetaDefs","GetStyles","opBtnStyle","modColor","mod","btnStyle","toDoList","gn","Settings","itemGrid","labelStyle","inputStyle","popupStyle","TextInput","propDef","defValue","tooltip","placeholder","labelColor","setLabelColor","tooltipStyle","setTooltipStyle","oldStyle","setOldStyle","oldValue","inputValue","setInputValue","useContext","assert_is_modified","submitToSettings","handleTyping","handleEnterKey","handleTooltip","offset","EventTargetOffsetStyle","content","showOldValue","bgColor","pad","opacity","MDReactComponent","mdEmoji","MarkdownNote","markdownIterate","Tag","children","np","bReturn","typographer","linkify","UDATAOwner","VIEWS","importexport","usertokens","NCAdvancedPanel","setIsOpen","openTab","setOpenTab","password","setPassword","hasAdminPermissions","setHasAdminPermissions","PERMISSIONS","evt_ToggleAdvanced","assessAdminPrivileges","PANELSTATE","advancedIsOpen","adminPassword","ui_CloseAdvanced","ui_SelectTab","tab","ui_PasswordChange","ui_PasswordClear","TABS","export","jsx","adminStatus","NCAutoSuggest","higlightedLine","isValidNode","uShowMatchlist","uNodeOrEdgeBeingEdited","urstate_LOCKSTATE","m_UIInputFocus","m_UIInputClick","m_UIUpdate","m_UISelectByLabel","m_UISelectById","m_UIKeyDown","m_UIMouseHighlightLine","m_UIMouseUnhighlightLine","m_UIHighlightLine","m_UIClickOutside","select","stopPropagation","onChange","selstart","selectionStart","inputEl","AppCall","searchString","selectionEnd","parentKey","onSelect","matchedNodeViaID","keystroke","lastLine","newHighlightedLine","activeElement","blur","highlightedNode","defaultPrevented","matchList","Draggable","OKBtn","CancelBtn","NCDialogCitation","copiedMessage","m_UIOnCopy","onClose","messageEl","execCommand","copymessage","CopyBtn","background","NCDialogInsertImageURL","m_UIOpenDialog","m_UIInputChange","m_UIOnOK","m_UIOnCancel","ATTRIBUTES","PROVENANCE","NCEdge","animateHeight","ResetState","urstate_SESSION","urstate_NCDATA","urstate_PERMISSIONS","IsLoggedIn","DerivePermissions","CheckUnload","DoUnload","ClearSelection","urstate_SELECTION","ReqLoadEdge","LoadEdge","DeleteEdge","LoadAttributes","LoadProvenance","UnlockEdge","EditEdge","ValidateSourceTarget","OfferToCreateNewNode","CreateNode","BackToEditing","SetSourceTarget","ThenSaveSourceTarget","SaveEdge","LookupBackgroundColor","LookupSourceTargetNodeColor","SwapSourceAndTarget","EdgeDisplayName","EnableEditMode","UIEnableEditMode","UISelectTab","UIRequestEditEdge","UIDeselectEdge","UICancelEditMode","UIDisableEditMode","UIDeleteEdge","UIInputUpdate","UIProvenanceInputUpdate","UIEnableSourceTargetSelect","UISourceTargetInputUpdate","UISourceTargetInputSelect","UICitationShow","UICitationClose","RenderView","RenderEdit","RenderSourceTargetButton","DropMessage","sourceId","targetId","attributes","size","created","updated","revision","uEditBtnDisable","uEditBtnHide","uViewMode","VIEW","uSelectedTab","uSelectSourceTarget","uBackgroundColor","uIsLockedByDB","uIsLockedByTemplate","uIsLockedByImport","uEditLockMessage","uNewNodeKey","uNewNodeLabel","uShowCitationDialog","dSourceNode","dSourceNodeColor","dTargetNode","dTargetNodeColor","EDIT","returnValue","RequestUnlockEdge","permissionsState","sourceTargetSelect","selectedNode","toLocaleString","createdBy","updatedBy","EDGEDEFS","attr_def","provenance_def","RequestLockEdge","lockSuccess","keyType","COLORMAP","edgeColorMap","nodeColorMap","swappedTargetId","swappedSourceId","swappedTargetNode","swappedSourceNode","swappedTargetNodeColor","swappedSourceNodeColor","previousState","COLORFIELDS","updatedState","bgcolor","defs","uShowCitationButton","disableSourceTargetInView","DateFormatted","RenderLabel","displayLabel","RenderStringValue","RenderTabSelectors","RenderAttributesTabView","RenderProvenanceTabView","marginLeft","parentNodeId","AskNodeDialog","saveIsDisabled","RenderOptionsInput","RenderAttributesTabEdit","RenderProvenanceTabEdit","justifyContent","disabled","SELECTION","isSecondarySelection","selectedSecondary","selected","NCEdgeTable","isOpenRef","disableEdit","urstate_FILTEREDNCDATA","urstate_TEMPLATE","current","FILTERDEFS","filterAction","ACTION","FADE","prevState","selectedEdgeColor","DeriveColumnDefs","incomingEdgeDefs","attributeDefs","provenanceDefs","ui_ClickViewEdge","ui_ClickEditEdge","ui_ClickViewNode","col_RenderViewOrEdit","tdata","coldef","col_RenderNode","col_RenderCommentBtn","col_RenderWeight","col_SortNodes","order","sortedData","sort","String","toLowerCase","col_SortCommentsByCount","col_SortWeight","ATTRIBUTE_COLUMNDEFS","PROVENANCE_COLUMNDEFS","COLUMNDEFS","renderer","sortDisabled","tipDisabled","sorter","DeriveTableData","targetLabel","sourceDef","targetDef","weightDef","html","Markdownify","raw","formattedDateString","UTILS","DeriveInfoOriginString","hasUnreadComments","commentVBtnDef","filteredTransparency","TABLEDATA","NCFiltersSummary","filtersSummary","graphStats","urmsg_UpdateFilterSummary","stats","evt_ClearFilters","NCGraphRenderer","RENDERMGR","ncGraphRenderer","nodeTypes","edgeTypes","updateVData","updateTemplate","updateColorMap","updateSelection","onZoomReset","onZoomIn","onZoomOut","constructGraph","ProcessNCData","forceUpdate","UpdateGraph","UpdateSelection","skipForceUpdate","ZoomReset","ZoomIn","ZoomOut","netgraph","remove","Deregister","dom","d3","m_width","m_height","M_FORCEPROPERTIES","center","charge","enabled","strength","distanceMin","distanceMax","collide","iterations","radius","forceX","forceY","link","distance","rootElement","d3svg","zoom","zoomWrapper","simulation","clickFn","m_HandleZoom","append","attr","nodeLabels","selectAll","transition","duration","style","svg","clientWidth","clientHeight","forceSimulation","ClearSVG","m_Initialize","m_UpdateForces","m_Tick","ZoomPanReset","m_Transition","m_Dragstarted","m_Dragged","m_Dragended","newData","svgNodes","oldNodes","alpha","restart","force","forceLink","forceManyBody","forceCollide","forceCenter","nodeElements","linkElements","elementG","enter","classed","drag","strokeColor","strokeWidth","textColor","exit","links","selectorArrows","scaleTo","transform","zoomIdentity","translate","scale","zoomLevel","scaleBy","self","active","alphaTarget","fx","fy","vocabulary","NCHelpPanel","evt_ToggleHelp","helpIsOpen","ui_CloseHelp","NCHelpText","NCVocabulary","IMPORTEXPORT","NODEFILESTATUS_DEFAULT","EDGEFILESTATUS_DEFAULT","IMPORTTYPE","MERGE","REPLACE","NCImportExport","preventImport","importIsActive","nodefileStatus","nodeValidationMsgs","nodeOkToImport","edgefileStatus","edgeValidationMsgs","edgeOkToImport","okToImport","importMsgs","allowLoggedInUserToImport","checkUnload","doUnload","updateEditState","onNodesExportSelect","onEdgesExportSelect","onNodeImportFileSelect","onEdgeImportFileSelect","clearNodefileSelect","clearEdgefileSelect","clearFileSelect","onDoImport","unlockAll","nextNodeId","nextEdgeId","ExportNodes","ExportEdges","nodefile","files","NodefileValidate","messageTitle","messageJsx","edgefile","EdgefileValidate","ResetNodeImportData","ResetEdgeImportData","ResetImportData","checked","Import","importDisabled","importBtnDisabled","exportjsx","importjsx","unlockAlljsx","GRAPH","icon","NODESTABLE","EDGESTABLE","defaultClosedTabPanelHeight","defaultOpenTabPanelHeight","NCInfoPanel","activeTab","infoPanelTop","tabpanelHeight","prevNodeTableHeight","prevEdgeTableHeight","draggerIsHidden","ref_InfoPanel","ref_Dragger","offsetTop","evt_SelectTab","tabkey","UpdateMaxTableHeight","maxTableHeight","offsetHeight","ui_MouseDown","draggerClickOffset","clientY","startY","draggerTop","onmousemove","ui_MouseMove","onmouseup","ui_MouseUp","SelectEdgeAndEdit","SelectEdge","DeselectEdge","LoadNode","FindLinkedEdges","UnlockNode","SaveNode","DeleteNode","FindMatchingList","UIRequestEditNode","UIReplacementNodeIdUpdate","UIAddEdge","UILabelInputUpdate","UIViewEdge","UIEditEdge","RenderEdgesTab","degrees","selectedEdgeId","uHideDeleteNodeButton","hideDeleteNodeButton","uReplacementNodeId","uIsValidReplacementNodeID","RequestUnlockNode","matchingNodes","linkedEdges","NODEDEFS","foundNodes","FindMatchingNodesByLabel","RequestLockNode","replacementNodeId","editableTab","isDuplicate","duplicateWarning","RenderStringInput","me","LookupEdgeColor","NCNodeTable","selectedNodeColor","hilitedNodeColor","incomingNodeDefs","ui_ClickEditNode","uIsLockedByComment","UpdateSession","UIOnChange","UIOnSelect","UINewNode","newNodeBtnHidden","newNodeBtnDisabled","TEMPLATE_MGR","SCHEMA","NCTemplate","editScope","tomlfile","tomlfileStatus","tomlfileErrors","tomlfilename","loadEditor","disableOrigLabelFields","releaseOpenEditor","onNewTemplate","onCurrentTemplateLoad","onEditNodeTypes","onEditEdgeTypes","onTOMLfileSelect","onDownloadTemplate","onSaveChanges","onCancelEdit","origLabelFields","getElementsByClassName","setAttribute","RequestEditUnlock","startval","schemaNodeTypeOptions","NODETYPEOPTIONS","nodeTypeEditorSchema","GetTypeEditorSchema","schema","EDITOR","schemaEdgeTypeOptions","EDGETYPEOPTIONS","edgeTypeEditorSchema","ValidateTOMLFile","templateJSON","errorMsg","DownloadTemplate","SaveTemplateToFile","editorjsx","gridTemplateColumns","columnGap","rowGap","NCUserTokens","DATASET","tokens","isShareable","ref_classId","ref_projId","ref_count","validate","evt_ClassIdInputChange","newClassId","evt_ProjIdInputChange","newProjId","evt_SetShareable","isChecked","evt_MakeTokens","clsId","numGroups","MakeTokens","gridColumn","PRESET_COLORS","PopupPicker","popover","SwatchesPicker","presetColors","presetColor","URButtonToggle","onClick","tabindex","URComment","element","setElement","commenter","createtime_string","modifytime_string","selected_comment_type","comment_error","uIsSelected","uIsBeingEdited","uIsEditable","uIsDisabled","uAllowReply","c_LoadCommentVObj","urstate_CMT_LOCKSTATE","c_IsDisabled","urstate_UpdateCommentVObjs","c_ValidateCommentType","isSelected","isEditable","allowReply","defaultCommentTypeObject","evt_EditBtn","evt_SaveBtn","evt_ReplyBtn","evt_DeleteBtn","evt_CancelBtn","previouslyHadText","t","evt_TypeSelector","selection","evt_CommentText","index","isAllowedToEditOwnComment","EditBtn","DeleteBtn","SaveBtn","ReplyBtn","TypeSelector","SelectedType","SelectedTypeLabel","CommentComponent","isMarkedRead","level","URCommentCollectionMgr","cmtBtns","setCmtBtns","dummy","setDummy","redraw","urmsg_COLLECTION_SHOW","urmsg_COLLECTION_HIDE","urmsg_COLLECTION_HIDE_ALL","prevBtns","CHECKBOX_DELIMITER","URCommentPrompt","commentType","commenterText","isMarkedDeleted","viewMode","errorMessage","foundIndex","prompts","promptIndex","foundTextArea","u_TextareaId","focus","u_IsEmpty","commenterTextStr","u_SplitCheckboxCommentText","u_SelectedIndex2CommentText","evt_OnCheck","optionIndex","selectedCheckboxes","RenderEditMode","inputJSX","option","feedback","RenderViewMode","NOTHING_SELECTED","displayJSX","URCommentSVGBtn","hasReadComments","small","ariaLabel","svgRef","css","svgClass","c_DrawCommentIcon","commentCountLabel","SVGClass","AppearTimer","DisappearTimer","ResetTimer","URCommentStatus","setCMTSTATUS","setMessage","setMessages","activeCSS","setActiveCSS","uiIsExpanded","setUiIsExpanded","ref_commentstatus_close","state_CMTSTATUS","urmsg_COMMENT_UPDATE","isNotMe","status_comment","c_GetCommentItemJSX","prevMessages","evt_ExpandPanel","evt_KeyDownExpandPanel","evt_Close","evt_MarkAllRead","evt_OpenReferent","evt_OpenComment","trim","countRepliesToMe","countUnread","unreadRepliesToMe","unreadRepliesToMeItems","unreadComments","unreadCommentItems","UnreadRepliesToMeButtonJSX","UnreadButtonJSX","URCommentThread","forceRender","setForceRender","urmsg_ForceRender","evt_OnAddComment","commentVObjs","numComments","lastComment","reverse","evt_OnKeyDown","evt_OnClose","evt_OnReferentClick","isDisabled","CloseBtn","commentMaxHeight","showAddCommentClickTarget","maxHeight","URCommentVBtn","btnRef","c_Update","urstate_UpdateCollection","urstate_UpdateVObj","uistate","evt_OnClick","URDateField","readOnly","helpText","isFilter","inputRef","cursorPos","hdate","setHDate","setValidationStr","formatMenuOptions","setFormatMenuOptions","ParsingResult","dateValidationResults","c_HandleChange","eventWithFormat","evt_OnInputUpdate","evt_OnFormatSelect","READONLY","NORMAL","URDialog","BTN_OK","BTN_CANCEL","URPopover","BTN_CLOSE","SORTORDER","HumanDateCache","HumanDateShortCache","URTable","columns","_tabledata","setTableData","_columndefs","setColumnDefs","_columnWidths","setColumnWidths","_sortColumnIdx","setSortColumnIdx","_sortOrder","setSortOrder","_previousColSortOrder","setPreviousColSortOrder","ref_Table","ref_Resize","defaultSortOrders","idx","u_CalculateColumnWidths","m_ExecuteSorter","u_HumanDate","timestring","hour","minute","second","datestring","u_HumanDateShort","definedColWidths","col","definedColWidthSum","remainingWidth","colWidths","startX","clientX","startWidth","nextStartWidth","maxCombinedWidth","delta","newWidths","ui_SetSelectedColumn","newSortOrder","m_SortByText","m_SortCaseInsensitive","m_SortByMarkdown","m_SortByNumber","akey","bkey","m_SortByHDate","da","dateorder","m_ExecuteRenderer","customRenderer","customSorter","jsx_SortBtn","columndef","REDUCE","FOCUS","TYPES","STRING","NUMBER","SELECT","MARKDOWN","TIMESTAMP","INFOORIGIN","HIDDEN","KEY","SOURCE","TARGET","OPERATORS","NO_OP","CONTAINS","NOT_CONTAINS","IS_EMPTY","IS_NOT_EMPTY","EQ","NOT_EQ","GT","GT_EQ","LT","LT_EQ","NCFilterGroup","filters","transparency","NCFilterGroupProperties","inputval","BroadcastChange","ui_OnChangeValue","ui_OnSubmit","NCFiltersPanel","action","filterActionHelp","focusSourceLabel","focusRange","statsSummary","FILTEREDNCDATA","urstate_UpdateFilteredNCData","urstate_UpdateFilterDefs","range","evt_LookupFilterHelp","ui_OnClearBtnClick","ui_SelectFilterAction","FilterControlPanel","def","NCFocusFilter","focusInputLabel","ui_NodeInputUpdate","ui_NodeSelect","foundNode","ui_DeselectNode","deselectNode","selectedNodeJsx","selectedNodeHelp","NCHDateFilter","keylabel","operator","urmsg_ClearFilters","ui_OnChangeOperator","newstate","inputString","filterDef","NCNumberFilter","NCSelectFilter","NCStringFilter","dotProp","UpdateProperty","opResult","propObj","UpdateGroup","Subscribe","changeHandler","Unsubscribe","GetSingularKey","groupList","groupObj","deref","DerefSingularMetaDef","metaObj","FlattenPropertyDefs","flat","alignItems","maxWidth","cursor","rect","scrollX","initialSettings","_updateSettings","updateProperty","changed","updateGroup","useClickOutside","ref","handler","startedInside","startedWhenMounted","contains","validateEventStart","m_RenderEdges","typeOption","DEFAULT_SIZE","VDATA","colorsAreDefined","edgeMap","cumulativeSize","edgeColorWeightMap","edgeKey","m_GetEdgeKey","eWeight","sum","colorWeightMap","colorWeight","m_GetWeightiestColor","skey","tkey","colors","FILTERDEFS_RESTORE","NODE_DEFAULT_TRANSPARENCY","EDGE_DEFAULT_TRANSPARENCY","RemovedNodes","TEMPLATE_URL","m_FiltersApply","m_FilterDefine","m_ClearFilters","m_ImportFilters","m_SetFocus","nodeDefaultTransparency","edgeDefaultTransparency","fdefs","m_ImportPrompts","m_ReplaceSourceTargetIdsWithStrings","counter","reorderedFilters","sourceIndex","sourceLabelIndex","targetIndex","targetLabelIndex","nodeFilters","edgeFilters","m_FiltersApplyToNodes","m_FiltersApplyToEdges","RecalculateAllEdgeSizes","RecalculateAllNodeDegrees","m_UpdateFilterStats","filterSummary","m_UpdateFilterSummary","transparencyNode","transparencyEdge","filteredNodeCount","filteredEdgeCount","typeSummary","nodeSummary","m_FiltersToString","edgeSummary","m_OperatorToString","clean","EscapeRegexChars","m_MatchString","needle","haystack","ANDNeedles","ORNeedleArrs","ands","ResultsOR","m_MatchStringSnippet","ResultsAND","RemoveDiacriticMarks","RegExp","m_MatchNumber","filterVal","objVal","m_MatchHDate","formattedString","dakeys","dbkeys","commonKeys","m_MatchTimestamp","hdateValue","filterTimestamp","objValDate","objValTimestamp","getTime","m_FocusPrep","m_NodeIsFiltered","keepNode","m_IsNodeMatchedByFilter","bacon_value","nodeValue","m_EdgeIsFiltered","keepEdge","m_IsEdgeMatchedByFilter","edgeValue","m_FindConnectedNodeIds","puredata","returnMatches","m_SetBaconValue","max_bacon_value","sourceNodes","newNodes","connectedNodeIds","selectedNodeId","selectedNodeLabel","m_UserHighlightNode","m_AutoSuggestHiliteNode","m_TableHiliteNode","HILITE","userHighlightNodeId","autosuggestHiliteNodeId","tableHiliteNodeId","missingKeys","NODEKEYS","fileKeys","lines","REGEXMatchLFNotInQuotes","headers","shift","nodeKeys","m_flattenKeys","m_NodefileCheckHeaders","EDGEKEYS","edgeKeys","m_EdgefileCheckHeaders","NEW_ID_KEYWORD","REGEXMatchCommasNotInQuotes","m_formatDate","toUTCString","m_encode","m_decode","flattenedKeys","m_renderNodeValues","RESULT","prototype","subKeys","nodeDef","hasOwnProperty","m_GenerateNodesArray","nodekeys","nodesArr","m_renderEdgeValues","m_GenerateEdgesArray","edgekeys","edgeArr","DATA","EXPORT","nodeHeadersArr","nodeHeaders","unshift","commaDelimitedNodes","blob","Blob","createObjectURL","download","body","click","removeChild","edgeHeadersArr","edgeHeaders","edgesArr","commaDelimitedEdges","nodeFile","edgeFile","nodesToImport","edgesToImport","IMPORT_NCDATA","m_hasValidSourceTarget","edgeImportErrors","row","m_NodefileLoadNodes","INTERNAL_FIELDS_MAP","l","subcategories","importFields","field","keysplit","subcategory","subkey","internalLabel","NaN","m_NodefileValidateNodes","nodesAdded","nodesReplaced","nodeImportErrors","existingNodeIdx","nodeFileName","headerResults","importResults","nodeResults","m_EdgefileLoadEdges","m_EdgefileValidateEdges","edgesAdded","edgesReplaced","existingEdgeIdx","edgeFileName","edgeResults","importedFiles","importedFileNames","m_Init","m_UpdateLockState","editorType","D3","DESELECTED_COLOR","DEFAULT_SEARCH_COLOR","DEFAULT_SOURCE_COLOR","TARGET_COLOR","m_PromiseLoadDB","m_MigrateData","USE_CACHE","lstore","localStorage","ld3","getItem","tem","urlParams","URLSearchParams","search","p1","p2","m_UpdateColorMap","setItem","session","ga","hitType","eventCategory","eventAction","eventLabel","searchLabel","activeAutoCompleteId","m_UnStrokeAllNodes","m_SetStrokeColorThatMatch","m_sourceSelect","nodeLabel","newSelection","newHilite","m_FindNodeById","m_FindMatchingNodesByLabel","suggestedNodes","updatedNodes","m_SetMatchingNodesByProp","newNodeID","replacementNode","m_DeleteMatchingNodesByProp","nodeTypesChanges","changeMap","replacement","searchParameters","m_FindMatchingNodeByProp","DEFAULT_EDGE_WEIGHT","newEdgeID","edgeTypesChanges","updatedEdges","m_SetMatchingEdgesByProp","m_DeleteMatchingEdgeByProp","m_HandleAutoCompleteSelect","timeout","m_FindMatchingObjsByProp","obj_list","match_me","m_SetMatchingObjsByProp","yes","no","matched","m_SetAllObjs","SetAllObjs","defaultEdgeColor","del_me","u_EscapeRegexChars","m_SetMatchingNodesByLabel","REGEX_REGEXCHARS","string","Node_Type","Notes","Relationship","Citations","Category","m_UnMarkAllNodes","m_MarkNodesThatMatch","deselect","notmatched","m_MarkSelectedEdges","ncRegenerateDefaultTemplate","ncPushDatabase","ncEmptyDatabase","ncUnlockAll","ncUnlockAllNodes","ncUnlockAllEdges","ncNodeColorMap","ncDumpData","ncMakeSharedTokens","ncMakeTokens","MD","MDEMOJI","use","MDPARSE","today","toTimeString","dateTime","htmlString","hackedHtmlString","m_UIMarkdownInputUpdate","m_UIStringInputUpdate","m_UINumberInputUpdate","m_UISelectInputUpdate","m_UIDateInputUpdate","m_UIInsertImageURL","parentId","currentValue","m_UICancelInsertImageURL","onclick","columnsDef","icn","BUILTIN_FIELDS","attributeDefKeys","GetAttributeDefKeys","RenderMarkdownValue","RenderDateValue","RenderInfoOriginValue","onchange","RenderMarkdownInput","RenderDateInput","RenderInfoOriginInput","m_RenderNumberInput","RenderProvenanceItemsView","provenanceDefKeys","GetProvenanceDefKeys","RenderProvenanceItemsEdit","RenderProvenanceByline","author","defAuthor","by","newValue","rows","onFocus","onBlur","GenerateUUID","random","inc","getKey","w","ms","stringToProcess","normalize","vocabIsOpen","VocabIsOpen","ToggleVocabulary","m_UpdateNodes","m_UpdateEdges","SetNCData","SEARCH","selectedNodes","highlightStrokeColor","foundStrokeColor","isAutosuggestHilited","isTabletHilited","isSecondarySelected","isFound","m_GetHelp","titleText","m_GetUpdatedDateText","nodeEdge","SELECTION_MODE","EDGE_EDIT","SOURCETARGET","COMMENT_EDIT","m_SelectionMode","m_SetMode","m_D3SelectNode","m_SelectSecondary","m_DeselectSecondary","newmode","m_GetNode","m_SendSelectionUpdate","m_SendSourceTargetSelectionUpdate","searchdata","nid","tomlText","UpdateTemplate","templateSnippet","numOfEmptyLabels","disable_collapse","disable_array_add","disable_array_delete","disable_array_delete_all_rows","disable_array_delete_last_row","disable_array_reorder","inputAttributes","typeOptions","schemaTypeOptions","class","disable_properties","currNodeOrEdge","u_ParseOptions","optionsDefinition","u_ParseProperty","u_ParseProperties","currJson","templatePropertyKey"],"mappings":"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","file":"public/scripts/netc-app.js","sourcesContent":["\n// this file generated by NC command\nconst NC_CONFIG = {\n  dataset: \"HIST_GreekVoting_S2024_P5\",\n  port: \"3000\",\n  googlea: \"0\"\n};\nif (typeof process === \"object\") module.exports = NC_CONFIG;\nif (typeof window === \"object\") window.NC_CONFIG = NC_CONFIG;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    init-appshell.jsx\n    application shell loaded and rendered in init.jsx\n\n    These are the top-level React components (\"view\").\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// REACT LIBRARIES ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst UNISYS = require('unisys/client');\n\n/// 1. MAIN VIEWS /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SETTINGS = require('settings');\nconst NetCreate = require('view/netcreate/NetCreate');\n// const AppDefault = require('view/default/AppDefault');\n// const HTMLFrame = require('view/html-frame/HTMLFrame');\n\n/// APPLICATION NAVBAR + ROUTER VIEW //////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** The application shell consists of a navbar implemented with Reactstrap\n *  components.\n */\nclass AppShell extends UNISYS.Component {\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  constructor(props) {\n    super(props);\n    this.toggle = this.toggle.bind(this);\n    this.state = {\n      isOpen: false\n    };\n    // bind handler\n    this.redirect = this.redirect.bind(this);\n    // add UNISYS message for redirects\n    this.HandleMessage('SHELL_REDIRECT', this.redirect);\n  }\n  /** Handle changes in state of his toggle switch */\n  toggle() {\n    this.setState({\n      isOpen: !this.state.isOpen\n    });\n  }\n  /** Called by SHELL_REDIRECT unisys message */\n  redirect(data) {\n    let { redirect } = data;\n    this.props.history.push(redirect);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Draw top navbar w/ menus and the <NetCreate> view\n   */\n  render(props) {\n    const { route, routeProps } = SETTINGS.GetRouteInfoFromURL(window.location.href);\n    const isLocalHost = SETTINGS.IsLocalHost();\n    return (\n      <div\n        className=\"--AppShell\"\n        style={{\n          display: 'flex',\n          flexFlow: 'column nowrap',\n          width: '100%',\n          height: '100vh'\n        }}\n      >\n        <NetCreate />\n      </div>\n    );\n  } // render()\n} // AppShell()\n\n/// EXPORT REACT CLASS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = AppShell;\n","/* eslint-disable no-debugger */\nif (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    init.jsx\n    system startup, loaded by app/assets/index.html at end of body.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst DBG = false;\n\n/// SYSTEM-WIDE LANGUAGE EXTENSIONS ///////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// These are loaded in init to make sure they are available globally!\n/// You do not need to copy these extensions to your own module files\nrequire('babel-polyfill'); // enables regenerators for async/await\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst ReactDOM = require('react-dom');\n\n/// SYSTEM MODULES ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// demo: require system modules; this will likely be removed\nconst SETTINGS = require('settings');\nconst UNISYS = require('unisys/client');\nconst AppShell = require('init-appshell');\nconst MUR = require('ursys-min');\n\n/// UNISYS LIFECYCLE LOADER ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// When the DOM is loaded, initialize UNISYS\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.groupCollapsed('init.jsx bootstrap');\n  console.log(\n    '%cINIT %cDOMContentLoaded. Starting UNISYS Lifecycle!',\n    'color:blue',\n    'color:auto'\n  );\n  m_SetLifecycleScope();\n  (async () => {\n    MUR.NCI.InteropConnect(UNISYS); // MUR INTEROP\n    await UNISYS.JoinNet(); // UNISYS socket connection (that is all)\n    await UNISYS.EnterApp(); // TEST_CONF, INITIALIZE, LOADASSETS, CONFIGURE\n    await m_RenderApp(); // compose React view\n    await UNISYS.SetupDOM(); // DOM_READY\n    await UNISYS.SetupRun(); // RESET, START, APP_READY, RUN\n    console.log(\n      '%cINIT %cUNISYS Lifecycle Initialization Complete',\n      'color:blue',\n      'color:auto'\n    );\n    console.groupEnd();\n  })();\n});\n\n/// UNISYS LIFECYCLE CLOSE EVENT //////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** this custom event accesses post-run lifecycles defined for 'DOMContentLoaded'\n *  `event` is originated by `comment-netmessage-class.GlobalOfflineMode\n *  with a custom event message coming from client-network.m_ResetHearbeatTimer\n *  This is so we can display an error to the user explaining the disconnect\n */\ndocument.addEventListener('UNISYSDisconnect', event => {\n  console.log(\n    '%cDISCONNECT %cUNISYSDisconnect. Closing UNISYS Lifecycle!',\n    'color:blue',\n    'color:auto'\n  );\n  // This call will fail if the server is disconnected.\n  UNISYS.Log('Server disconnected with error', event);\n  // hack a local module for now\n  let UDATA = UNISYS.NewDataLink({});\n  UDATA.LocalCall('DISCONNECT', event);\n  (async () => {\n    await UNISYS.ServerDisconnect(); // UNISYS has dropped server\n    console.log(\n      '%cDISCONNECT %cUNISYSDisconnect Complete',\n      'color:blue',\n      'color:auto'\n    );\n  })();\n});\n\n/// LIFECYCLE HELPERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** DEPRECATED? This may no longer actually be needed as it\n *  helper to infer view module scope before module is routed lated (!)\n *  scope is really the 'path' of the current route (e.g. #)\n */\nfunction m_SetLifecycleScope() {\n  // set scope for UNISYS execution\n  const url = window.location.href;\n  const { scope } = SETTINGS.GetRouteInfoFromURL(url);\n  if (scope) {\n    if (DBG) console.log(`Lifecycle Module Scope is ${scope}`);\n    UNISYS.SetScope(scope);\n  } else {\n    console.warn(`m_SetLifecycleScope() could not match scope ${url}`);\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Wraps ReactDOM.render() in a Promise. Execution continues in <AppShell>\n */\nfunction m_RenderApp() {\n  if (DBG)\n    console.log('%cINIT %cReactDOM.render() begin', 'color:blue', 'color:auto');\n\n  // declare web components for MUR\n  MUR.ViewLib.DeclareComponents();\n  //\n\n  return new Promise((resolve, reject) => {\n    try {\n      ReactDOM.render(<AppShell />, document.querySelector('#app-container'), () => {\n        console.log(\n          '%cINIT %cReactDOM.render() complete',\n          'color:blue',\n          'color:auto'\n        );\n        resolve();\n      });\n    } catch (e) {\n      // eslint-disable-next-line no-alert\n      alert(\n        `m_RenderApp() Lifecycle Error.\\nOpen Javascript Console, then press \"OK\" for for debugging details.`\n      );\n      // debugger;\n    }\n  }); // promise\n}\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  LOCAL SETTINGS\n  utility function for managing local\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// GLOBAL NETWORK INFO (INJECTED ON INDEX) ///////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// NOTE: server-embedded properties are not defined for simple html apps\nvar EJSPROPS = window.NC_UNISYS || {};\n\n/// STORAGE ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet S = {};\nlet DATE = new Date();\nlet RELOAD_CHECK = 0;\nlet RELOAD_TIMER = null;\n\n/// MAIN GETTER SETTER FUNCTION  //////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** settings.js returns a function as its module.exports value so\n    syntax like let a = SETTINGS['key'] can be used.\n */\nlet MOD = (a, b) => {\n  if (a === undefined) throw 'SETTINGS requires key or key,value parms';\n  if (typeof a !== 'string') throw 'SETTINGS parm1 must be key string';\n\n  if (b === undefined) {\n    return S[a];\n  } else {\n    S[a] = b;\n    return b;\n  }\n};\n\n/// ROUTE UTILITIES ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst ROUTES_PARAMS = {\n  '/': { scope: 'NetCreate' },\n  '/edit': { scope: 'NetCreate', plist: ['token'] },\n  '/simple': { scope: 'HTMLFrame' }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return matching routed information. Looks part after /#/ as route\n *  information and returns the routing information for UNISYS routing\n *  of components and setting UNISYS module scope (used for client exec)\n */\nMOD.GetRouteInfoFromURL = (url = window.location.href) => {\n  const fn = 'GetRouteInfoFromURL:';\n  // routestring is everything after the leading /#/ (not same as URL.hash)\n  const hrefParts = url.split('/#/');\n  const hrefString = hrefParts.length === 1 ? '' : hrefParts[1];\n  // pluck querystring (e.g. ?admin=true) off the end\n  const stringParts = hrefString.split('?');\n  let routeString = '';\n  let queryString = '';\n  if (stringParts.length === 1) {\n    routeString = stringParts[0];\n  } else if (stringParts.length === 2) {\n    routeString = stringParts[0];\n    queryString = stringParts[1];\n  } else throw Error(`${fn} unexpected url format ${url}`);\n\n  // handle route\n  const routeParameters = routeString.split('/');\n  const [route, ...params] = routeParameters;\n  const key = `/${route}`;\n  const routeInfo = ROUTES_PARAMS[key];\n  const { scope, plist = [] } = routeInfo || {};\n\n  // build the queryVars dictionary\n  const settings = queryString.split('&');\n  const vars = {};\n  for (let i = 0; i < settings.length; i++) {\n    const setting = settings[i];\n    const [key, value] = setting.split('=');\n    vars[key] = value;\n  }\n  // build the routeProps dictionary\n  const dict = {};\n  for (let i = 0; i < plist.length; i++) {\n    const pkey = plist[i];\n    dict[pkey] = params[i];\n  }\n  // return RouteInfo\n  const result = {\n    route: key,\n    scope,\n    routeProps: dict,\n    queryVars: vars\n  };\n  return result;\n};\n\n/// API ///////////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** alternate call to set a key value pair\n */\nMOD.Set = (key, val) => {\n  MOD(key, val);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** alternate call to retrieve a key\n */\nMOD.Get = key => {\n  return MOD(key);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Force Reload if another module was navigated to and we want to ensure the\n    entire browser was refreshed so only one set of app modules is loaded\n */\nMOD.IsReloadRequired = () => {\n  RELOAD_CHECK++;\n  if (RELOAD_CHECK > 1) {\n    console.warn(`IsReloadRequired ${RELOAD_CHECK} - refreshing settings`);\n    if (RELOAD_TIMER) clearTimeout(RELOAD_TIMER);\n    RELOAD_TIMER = setTimeout(() => {\n      location.reload();\n    }, 500);\n  } else {\n    console.log(`IsReloadRequired ${RELOAD_CHECK} - no refresh needed`);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** test time function\n */\nMOD.CurrentTime = () => {\n  return DATE.toDateString();\n};\n\n/// SERVER-PROVIDED PROPERTIES ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** searches through the window.NC_UNISYS object that is injected by web page\n    app/static/index.ejs, which contains interesting values from server\n */\nMOD.EJSProp = propName => {\n  if (propName === undefined) return EJSPROPS;\n  return EJSPROPS[propName];\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.ServerHostName = () => {\n  return EJSPROPS.server.hostname || 'ERROR';\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.ServerHostIP = () => {\n  return EJSPROPS.server.ip || 'ERROR';\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.ServerAppURL = suburl => {\n  let ubits = new URL(window.location);\n  let hash = ubits.hash.split('/')[0];\n  // let serverip = MOD.ServerHostIP();\n  let url = `${ubits.protocol}//${ubits.host}/${hash}`;\n  if (typeof suburl === 'string') url += suburl;\n  return url;\n};\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Joshua added to disable Extras in init-appshell.jsx */\nMOD.IsLocalHost = () => {\n  const ip = MOD.EJSProp('client').ip;\n  return ip.endsWith('127.0.0.1');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns true is the NetCreate app should assume that an administrator is\n *  logged in. Administrators can edit templates. The check is very weak,\n *  relying on browsers running on localhost with the URL parameter.\n *  TODO: will be replacing with \"real\" login system for NetCreate 2.0.\n */\nMOD.IsAdmin = () => {\n  const isLocalHost = MOD.IsLocalHost();\n  const rinfo = MOD.GetRouteInfoFromURL().queryVars || {};\n  const urlHasAdmin = rinfo.admin === 'true';\n  //\n  return isLocalHost && urlHasAdmin;\n};\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  DATASTORE\n  stub for testing module loading\n  eventually will load data from database\n  data.json is { nodes: [ {} ... {} ] }\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst TOML = require('@iarna/toml');\nconst UNISYS = require('unisys/client');\nconst PROMPTS = require('system/util/prompts');\nconst PR = PROMPTS.Pad('Datastore');\nconst NetMessage = require('unisys/common-netmessage-class');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = { load: true };\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet DSTOR = UNISYS.NewModule(module.id);\nlet UDATA = UNISYS.NewDataLink(DSTOR);\nlet NCDATA = {};\n\n/// LIFECYCLE /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** establish message handlers during INITIALIZE phase\n */\nDSTOR.Hook('INITIALIZE', () => {\n  // DBUPDATE_ALL is a local call originating from within the app\n  // Used to update the full NCDATA object during template updates\n  UDATA.HandleMessage('DBUPDATE_ALL', function (data) {\n    DSTOR.UpdateDataPromise(data);\n  });\n\n  // DB_UPDATE is a local call originating from within the app\n  // Generally used to update individual nodes and edges\n  UDATA.HandleMessage('DB_UPDATE', function (data) {\n    DSTOR.UpdateServerDB(data);\n  });\n\n  // DB_BATCHUPDATE is a local call originating from within the app\n  // Generally used to update mutliple comments\n  UDATA.HandleMessage('DB_BATCHUPDATE', function (data) {\n    DSTOR.BatchUpdateServerDB(data);\n  });\n\n  // DB_INSERT is a local call originating from within the app\n  // Generally used to add new nodes and edges after an import\n  UDATA.HandleMessage('DB_INSERT', function (data) {\n    DSTOR.InsertServerDB(data);\n  });\n\n  // DB_MERGE is a local call originating from within the app\n  // Generally used to update or add new nodes and edges after an import\n  // Unlike DB_INSERT, it'll update existing nodes/edges\n  UDATA.HandleMessage('DB_MERGE', DSTOR.MergeServerDB);\n\n  UDATA.OnAppStateChange('SESSION', function (decodedData) {\n    let { isValid } = decodedData;\n    // console.log(PR, 'Handling SESSION', isValid || '[NO LOGIN TOKEN]');\n    if (isValid) DSTOR.SetSessionGroupID(decodedData);\n  });\n});\n\n/// SESSION ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** datastore needs to set NetMessage GroupID property on behalf of SESSIONS\n    because SESSION can't include NetMessage (or vice versa)\n */\nDSTOR.SetSessionGroupID = function (decodedData) {\n  let { token, isValid } = decodedData;\n  if (isValid) {\n    NetMessage.GlobalSetGroupID(token);\n    console.log(`${PR} valid token %c${token}`, 'color:red');\n  } else {\n    console.warn(`${PR} bad token %c${token} ignored`, 'color:red');\n  }\n};\n\n/// DB INTERFACE //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Placeholder DATA access function\n */\nDSTOR.Data = function () {\n  return NCDATA;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Write update to database\n */\nDSTOR.UpdateServerDB = function (data) {\n  // check that network is online\n  if (UNISYS.IsStandaloneMode()) {\n    console.warn(PR, `STANDALONE MODE: UpdateServerDB() suppressed!`);\n    return;\n  }\n  // it is!\n  UDATA.Call('SRV_DBUPDATE', data).then(res => {\n    if (res.OK) {\n      console.log(PR, `server db transaction`, data, `success`);\n    } else {\n      console.log(PR, 'error updating server db', res);\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Write batch updates to database\n */\nDSTOR.BatchUpdateServerDB = function (data) {\n  // check that network is online\n  if (UNISYS.IsStandaloneMode()) {\n    console.warn(PR, `STANDALONE MODE: UpdateServerDB() suppressed!`);\n    return;\n  }\n  // it is!\n  UDATA.Call('SRV_DBBATCHUPDATE', data).then(res => {\n    if (res.OK) {\n      console.log(PR, `server db transaction`, data, `success`);\n    } else {\n      console.log(PR, 'error updating server db', res);\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** update max node id count for generating new ids\n */\nDSTOR.PromiseCalculateMaxNodeId = function () {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall('SRV_CALCULATE_MAXNODEID').then(data => {\n      if (data.maxNodeID !== undefined) {\n        if (DBG) console.log(PR, 'server calculated max_node_id', data.maxNodeID);\n        resolve(data.maxNodeID);\n      } else {\n        reject(new Error('unknown error' + JSON.stringify(data)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** get a unique NodeID\n */\nDSTOR.PromiseNewNodeID = function () {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall('SRV_DBGETNODEID').then(data => {\n      if (data.nodeID) {\n        if (DBG) console.log(PR, 'server allocated node_id', data.nodeID);\n        resolve(data.nodeID);\n      } else {\n        if (UNISYS.IsStandaloneMode()) {\n          reject(\n            new Error(\n              'STANDALONE MODE: UI should prevent PromiseNewNodeID() from running!'\n            )\n          );\n        } else {\n          reject(new Error('unknown error' + JSON.stringify(data)));\n        }\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** get multiple unique NodeIDs\n */\nDSTOR.PromiseNewNodeIDs = function (count) {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall('SRV_DBGETNODEIDS', { count }).then(data => {\n      if (data.nodeIDs) {\n        if (DBG) console.log(PR, 'server allocated node_id', data.nodeIDs);\n        resolve(data.nodeIDs);\n      } else {\n        reject(new Error('unknown error' + JSON.stringify(data)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** update max edge id count for generating new ids\n */\nDSTOR.PromiseCalculateMaxEdgeId = function () {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall('SRV_CALCULATE_MAXEDGEID').then(data => {\n      if (data.maxEdgeID !== undefined) {\n        if (DBG) console.log(PR, 'server calculated max_edge_id', data.maxEdgeID);\n        resolve(data.maxEdgeID);\n      } else {\n        reject(new Error('unknown error' + JSON.stringify(data)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** get a unique Edge\n */\nDSTOR.PromiseNewEdgeID = function () {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall('SRV_DBGETEDGEID').then(data => {\n      if (data.edgeID) {\n        if (DBG) console.log(PR, 'server allocated edge_id:', data.edgeID);\n        resolve(data.edgeID);\n      } else {\n        if (UNISYS.IsStandaloneMode()) {\n          reject(\n            new Error(\n              'STANDALONE MODE: UI should prevent PromiseNewEdgeID() from running!'\n            )\n          );\n        } else {\n          reject(new Error('unknown error' + JSON.stringify(data)));\n        }\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** get multiple unique EdgeIDs\n */\nDSTOR.PromiseNewEdgeIDs = function (count) {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall('SRV_DBGETEDGEIDS', { count }).then(data => {\n      if (data.edgeIDs) {\n        if (DBG) console.log(PR, 'server allocated edge_id:', data.edgeIDs);\n        resolve(data.edgeIDs);\n      } else {\n        reject(new Error('unknown error' + JSON.stringify(data)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** get a unique CommentID\n */\nDSTOR.PromiseNewCommentID = function () {\n  return new Promise((resolve, reject) => {\n    UDATA.NetCall('SRV_DBGETCOMMENTID').then(data => {\n      if (data.comment_id) {\n        if (DBG) console.log(PR, 'server allocated comment_id', data.comment_id);\n        resolve(data.comment_id);\n      } else {\n        if (UNISYS.IsStandaloneMode()) {\n          reject(\n            new Error(\n              'STANDALONE MODE: UI should prevent PromiseNewCommentID() from running!'\n            )\n          );\n        } else {\n          reject(new Error('unknown error' + JSON.stringify(data)));\n        }\n      }\n    });\n  });\n};\n\n/// DATABASE LOADER ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Load default data set from a JSON file in /assets/data\n */\nDSTOR.PromiseJSONFile = function (jsonFile) {\n  if (typeof jsonFile !== 'string') {\n    throw new Error('pass arg <filename_in_assets/data>');\n  }\n  let promise = new Promise((resolve, reject) => {\n    let xobj = new XMLHttpRequest();\n    xobj.addEventListener('load', event => {\n      if (event.target.status === 404) {\n        reject(new Error(`file not found`));\n        return;\n      }\n      let data = event.target.responseText;\n      NCDATA = Object.assign(NCDATA, JSON.parse(data));\n      resolve(NCDATA);\n    });\n    xobj.open('GET', `${jsonFile}`, true);\n    xobj.send();\n  });\n  return promise;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Load default data set from a TOML file in /assets/data\n */\nDSTOR.PromiseTOMLFile = function (tomlFile) {\n  if (typeof tomlFile !== 'string') {\n    throw new Error('pass arg <filename_in_assets/data>');\n  }\n  let promise = new Promise((resolve, reject) => {\n    let xobj = new XMLHttpRequest();\n    xobj.addEventListener('load', event => {\n      if (event.target.status === 404) {\n        reject(new Error(`file not found`));\n        return;\n      }\n      const data = event.target.responseText;\n      const tomlData = Object.assign(NCDATA, TOML.parse(data));\n      resolve(tomlData);\n    });\n    xobj.open('GET', `${tomlFile}`, true);\n    xobj.send();\n  });\n  return promise;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Load D3 Database\n */\nDSTOR.PromiseD3Data = function () {\n  // UDATA.Call() returns a promise\n  return UDATA.Call('SRV_DBGET', {}); // server.js\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Write Template file to Server\n */\nDSTOR.SaveTemplateFile = template => {\n  // UDATA.Call() returns a promise\n  return UDATA.Call('SRV_TEMPLATESAVE', { template }); // server.js\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Get Template File Path.\n    Called by template-editor-mgr when downloading template file.\n */\nDSTOR.GetTemplateTOMLFileName = () => {\n  return UDATA.Call('SRV_GET_TEMPLATETOML_FILENAME');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Update database from d3data-formatted object\n */\nDSTOR.UpdateDataPromise = function (d3data) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call('SRV_DBUPDATE_ALL', d3data).then(res => {\n      if (res.OK) {\n        console.log(PR, `database update OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Insert new records into database from d3data-formatted object\n */\nDSTOR.InsertServerDB = function (d3data) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call('SRV_DBINSERT', d3data).then(res => {\n      if (res.OK) {\n        console.log(PR, `database update OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * API: Add or Insert records into database from d3data-formatted object\n * @param {object} mergeData\n * @param {array} mergeData.nodes\n * @param {array} mergeData.edges\n * @returns\n */\nDSTOR.MergeServerDB = function (mergeData) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call('SRV_DBMERGE', mergeData).then(res => {\n      if (res.OK) {\n        console.log(PR, `database update OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: (WIP) write database from d3data-formatted object\n */\nDSTOR.OverwriteDataPromise = function (d3data) {\n  return new Promise((resolve, reject) => {\n    UDATA.Call('SRV_DBSET', d3data).then(res => {\n      if (res.OK) {\n        console.log(PR, `database set OK`);\n        resolve(res);\n      } else {\n        reject(new Error(JSON.stringify(res)));\n      }\n    });\n  });\n};\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DSTOR;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Constants\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst CONSTANT = {};\n\nCONSTANT.SEARCH_PLACEHOLDER = 'Type a node name...';\nCONSTANT.EDGE_NOT_SET_LABEL = '...';\nCONSTANT.ARROW_DOWN = `\\u2193`;\nCONSTANT.ARROW_UPDOWN = `\\u21F5`;\nCONSTANT.ARROW_RIGHT = `\\u2794`;\n\n// From Glyphicons\n// Update NetCreate.css to set size\nCONSTANT.ICON_PENCIL = (\n  <svg id=\"icon-pencil\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n    <path\n      id=\"pencil\"\n      d=\"M27.414,8.82812l-2.08588,2.08594L21.08588,6.67188l2.08587-2.08594a.99985.99985,0,0,1,1.41425,0l2.828,2.82812A.99986.99986,0,0,1,27.414,8.82812ZM8.08594,19.67188l4.24218,4.24218L23.91406,12.32812,19.67181,8.08594ZM4.27667,27.09863a.50005.50005,0,0,0,.62476.62476l5.92773-2.48023L6.75677,21.1709Z\"\n    />\n  </svg>\n);\nCONSTANT.ICON_VIEW = (\n  <svg id=\"icon-view\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n    <path\n      id=\"eye\"\n      d=\"M30.30762,14.36768C28.25488,12.002,22.751,6.5,16,6.5S3.74512,12.002,1.69336,14.36572a2.49922,2.49922,0,0,0-.001,3.2666C3.74512,19.99805,9.249,25.5,16,25.5s12.25488-5.502,14.30762-7.86768A2.49888,2.49888,0,0,0,30.30762,14.36768ZM9.24042,20.25977A25.33965,25.33965,0,0,1,4.25391,16a25.33613,25.33613,0,0,1,4.98657-4.25977,7.93436,7.93436,0,0,0-.00006,8.51954ZM16,22a6,6,0,1,1,6-6A6.00657,6.00657,0,0,1,16,22Zm6.75952-1.74023a7.93436,7.93436,0,0,0,.00006-8.51954A25.33965,25.33965,0,0,1,27.74609,16,25.33613,25.33613,0,0,1,22.75952,20.25977ZM19,16a3.00014,3.00014,0,1,1-5.80646-1.03174,1.49952,1.49952,0,0,0,1.77472-1.77466A2.97577,2.97577,0,0,1,19,16Z\"\n    />\n  </svg>\n);\n\n/// MODULE EXPORTS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = CONSTANT;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Enumerators\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst ENUM = {};\n// EDITORTYPE handles network edit locking messages\nENUM.EDITORTYPE = {\n  TEMPLATE: 'template',\n  IMPORTER: 'importer',\n  NODE: 'node', // parameter sent with packet, listed here for coverage\n  EDGE: 'edge', // parameter sent with packet, listed here for coverage\n  COMMENT: 'comment'\n};\n// BUILT-IN FIELDS\nENUM.BUILTIN_FIELDS_NODE = [\n  'id',\n  'label',\n  'type',\n  'degrees',\n  'created',\n  'createdBy',\n  'updated',\n  'updatedBy',\n  'revision'\n];\nENUM.BUILTIN_FIELDS_EDGE = [\n  'id',\n  'source',\n  'type',\n  'target',\n  'weight', // displayed in attributew tab\n  'degrees',\n  'created',\n  'createdBy',\n  'updated',\n  'updatedBy',\n  'revision',\n  'sourceLabel', // used internally for filters\n  'targetLabel' // used internally for filters\n];\n\n/// MODULE EXPORTS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = ENUM;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Historical Date Utilities\n\n  Used by the URDateField component to parse and format historical dates.\n  Also used in NodeTablea and EdgeTable for sorting and filtering.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\nimport * as chrono from 'chrono-node';\n\nconst HDATE = {};\n\n/// HISTORICAL CHRONO /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Create a custom parser for BCE/CE dates\n///   ex: erasChrono.parseDate(\"I'll arUrive at 2.30AM tomorrow\");\nHDATE.erasChrono = chrono.casual.clone();\nHDATE.erasChrono.parsers.push(\n  {\n    pattern: () => {\n      // match year if \"BC/AD/BCE/CE\" (case insensitive)\n      //   \"10bc\"  -- without space\n      //   \"10 bc\" -- with space\n      return /(\\d+)\\s*(BCE|CE|BC|AD)?/i;\n    },\n    extract: (context, match) => {\n      const year = parseInt(match[1], 10);\n      const era = match[2] ? match[2].toUpperCase() : 'CE'; // default to CE\n      // Adjust the year based on the era\n      const adjustedYear = era === 'BCE' || era === 'BC' ? -year : year;\n      return { year: adjustedYear };\n    }\n  }\n\n  // ALTERNATIVE APPROACH: Any 3 digits is a year\n  //\n  // NOTE: This only works with an UnlikelyFormatFilter override.\n  //       UnlikelyFormatFilter will remove raw numbers\n  //       so if we want to allow 3 digits, then\n  ///      UnlikelyFormatFilter needs to be overriden, otherwise\n  //       the ParsingResults are filtered out.\n  //       Remove lines 10-15 `if (result.text.replace(\" \", \"\").match(/^\\d*(\\.\\d*)?$/)) {`\n  // {\n  //   pattern: () => {\n  //     // match year if more than 3 digits assume CE\n  //     // NOTE: This assumes the string starts with the digits\n  //     return /(\\d{3,})/i;\n  //   },\n  //   extract: (context, match) => {\n  //     const year = parseInt(match[0], 10);\n  //     return { year: year };\n  //   }\n  // },\n);\nHDATE.erasChrono.refiners.push({\n  refine: (context, results) => {\n    // placeholder if we decide we want to add a refiner\n    return results;\n  }\n});\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// Use template to define other values, e.g. BC/AD\n// Other ERAS are not currently defined\nHDATE.ERAS = {\n  pre: 'BCE',\n  post: 'CE'\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// `CALENDAR` is not currently used.\nHDATE.CALENDAR = {\n  ISO: 'iso8601',\n  GREGORIAN: 'gregory',\n  JULIAN: 'julian',\n  ISLAMIC: 'islamic',\n  HEBREW: 'hebrew',\n  CHINESE: 'chinese'\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nHDATE.DATEFORMAT = {\n  AS_ENTERED: 'As Entered',\n\n  // MONTH\n  MONTH_ABBR: 'MMM',\n  MONTH_FULL: 'Month',\n  MONTH_NUM: 'M',\n  MONTH_PAD: 'MM',\n\n  // MONTHDAY\n  MONTHDAY_ABBR: 'MMM D',\n  MONTHDAY_FULL: 'Month D',\n  MONTHDAY_NUM: 'M/D',\n  MONTHDAY_PAD: 'MM/DD',\n\n  // YEARMONTHDAY\n  MONTHDAYYEAR_ABBR: 'MMM D, YYYY',\n  MONTHDAYYEAR_FULL: 'Month D, YYYY',\n  MONTHDAYYEAR_NUM: 'M/D/YYYY',\n  MONTHDAYYEAR_PAD: 'MM/DD/YYYY',\n  YEARMONTHDAY_ABBR: 'YYYY MMM D',\n  YEARMONTHDAY_FULL: 'YYYY Month D',\n  YEARMONTHDAY_NUM: 'YYYY/M/D',\n  YEARMONTHDAY_PAD: 'YYYY/MM/DD',\n  HISTORICAL_MONTHDAYYEAR_ABBR: 'MMM D, YYYY CE',\n  HISTORICAL_MONTHDAYYEAR_FULL: 'Month D, YYYY CE',\n  HISTORICAL_MONTHDAYYEAR_NUM: 'M/D/YYYY CE',\n  HISTORICAL_MONTHDAYYEAR_PAD: 'MM/DD/YYYY CE',\n  HISTORICAL_YEARMONTHDAY_ABBR: 'YYYY MMM D CE',\n  HISTORICAL_YEARMONTHDAY_FULL: 'YYYY Month D CE',\n  HISTORICAL_YEARMONTHDAY_NUM: 'YYYY/M/D CE',\n  HISTORICAL_YEARMONTHDAY_PAD: 'YYYY/MM/DD CE',\n\n  // YEARMONTH\n  MONTHYEAR_ABBR: 'MMM YYYY',\n  MONTHYEAR_FULL: 'Month YYYY',\n  MONTHYEAR_NUM: 'M/YYYY',\n  MONTHYEAR_PAD: 'MM/YYYY',\n  YEARMONTH_ABBR: 'YYYY MMM',\n  YEARMONTH_FULL: 'YYYY Month',\n  YEARMONTH_NUM: 'YYYY/M',\n  YEARMONTH_PAD: 'YYYY/MM',\n  HISTORICAL_MONTHYEAR_ABBR: 'MMM YYYY CE',\n  HISTORICAL_MONTHYEAR_FULL: 'Month YYYY CE',\n  HISTORICAL_MONTHYEAR_NUM: 'M/YYYY CE',\n  HISTORICAL_MONTHYEAR_PAD: 'MM/YYYY CE',\n  HISTORICAL_YEARMONTH_ABBR: 'YYYY MMM CE',\n  HISTORICAL_YEARMONTH_FULL: 'YYYY Month CE',\n  HISTORICAL_YEARMONTH_NUM: 'YYYY/M CE',\n  HISTORICAL_YEARMONTH_PAD: 'YYYY/MM CE',\n\n  // YEAR\n  YEAR: 'YYYY',\n  HISTORICALYEAR: 'YYYY CE'\n};\n\n/// UTILITIES //////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nHDATE.u_pad = num => {\n  if (!num) return '';\n  return num.toString().padStart(2, '0');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nHDATE.u_monthAbbr = num => {\n  const date = new Date(2000, num - 1, 1);\n  return date.toLocaleDateString('default', { month: 'short' });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nHDATE.u_monthName = num => {\n  const date = new Date(2000, num - 1, 1);\n  return date.toLocaleDateString('default', { month: 'long' });\n};\n\n/// HDATE METHODS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nHDATE.Parse = dateInputStr => {\n  return HDATE.erasChrono.parse(dateInputStr);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Show how the raw input string is parsed into date information by breaking\n *  down the known values (e.g. `day`, and `month`) into a human-readable string.\n *  @param {Array} ParsedResult - a chrono array of parsed date objects\n */\nHDATE.ShowValidationResults = ParsedResult => {\n  // Show interpreted values\n  if (ParsedResult.length > 0) {\n    const knownValues = ParsedResult[0].start.knownValues;\n    const dateValidationStr = knownValues\n      ? Object.keys(knownValues).map(k => `${k}:${knownValues[k]}`)\n      : [\"result: 'cannot interpret'\"];\n    // TODO show HDATE.ERAS TOO?\n    return dateValidationStr;\n  }\n  return undefined;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Show the list of available format types with previews based on the values\n *  parsed from the input string. e.g. `April 1, 2024` will show formats\n *  that include a month, day, and year.\n *  @param {Array} ParsedResult - a chrono array of parsed date objects\n *  @return {Array} formatMenuOptions - an array of format objects with `value` and `preview` keys\n */\nHDATE.ShowMatchingFormats = (ParsedResult, dateFormat, allowFormatSelection) => {\n  let options = [{ value: 'AS_ENTERED', preview: 'as entered' }];\n  if (ParsedResult.length < 1) {\n    if (allowFormatSelection) return options;\n    else return [{ value: dateFormat, preview: HDATE.DATEFORMAT[dateFormat] }];\n  }\n\n  let matchingTypes = [];\n  let additionalOptions = [];\n  const knownValues = ParsedResult[0].start.knownValues;\n  const knownTypes = Object.keys(ParsedResult[0].start.knownValues);\n  const dateInputStr = ParsedResult[0].text;\n\n  if (!allowFormatSelection) {\n    // force the format to use the defined format\n    const options = [\n      {\n        value: dateFormat,\n        preview: HDATE.GetPreviewStr(dateInputStr, knownValues, dateFormat)\n      }\n    ];\n    return options;\n  }\n\n  // Figure out which formats are eligible based on the known values\n  if (knownTypes.includes('year')) {\n    if (knownTypes.includes('month')) {\n      if (knownTypes.includes('day')) {\n        // year month day\n        matchingTypes = [\n          'MONTHDAYYEAR_ABBR',\n          'MONTHDAYYEAR_FULL',\n          'MONTHDAYYEAR_NUM',\n          'MONTHDAYYEAR_PAD',\n          'YEARMONTHDAY_ABBR',\n          'YEARMONTHDAY_FULL',\n          'YEARMONTHDAY_NUM',\n          'YEARMONTHDAY_PAD',\n          'HISTORICAL_MONTHDAYYEAR_ABBR',\n          'HISTORICAL_MONTHDAYYEAR_FULL',\n          'HISTORICAL_MONTHDAYYEAR_NUM',\n          'HISTORICAL_MONTHDAYYEAR_PAD',\n          'HISTORICAL_YEARMONTHDAY_ABBR',\n          'HISTORICAL_YEARMONTHDAY_FULL',\n          'HISTORICAL_YEARMONTHDAY_NUM',\n          'HISTORICAL_YEARMONTHDAY_PAD'\n        ];\n      } else {\n        // year month only\n        matchingTypes = [\n          'MONTHYEAR_ABBR',\n          'MONTHYEAR_FULL',\n          'MONTHYEAR_NUM',\n          'MONTHYEAR_PAD',\n          'YEARMONTH_ABBR',\n          'YEARMONTH_FULL',\n          'YEARMONTH_NUM',\n          'YEARMONTH_PAD',\n          'HISTORICAL_MONTHYEAR_ABBR',\n          'HISTORICAL_MONTHYEAR_FULL',\n          'HISTORICAL_MONTHYEAR_NUM',\n          'HISTORICAL_MONTHYEAR_PAD',\n          'HISTORICAL_YEARMONTH_ABBR',\n          'HISTORICAL_YEARMONTH_FULL',\n          'HISTORICAL_YEARMONTH_NUM',\n          'HISTORICAL_YEARMONTH_PAD'\n        ];\n      }\n    } else {\n      // year only\n      matchingTypes = ['YEAR', 'HISTORICALYEAR'];\n    }\n  } else if (knownTypes.includes('month')) {\n    if (knownTypes.includes('day')) {\n      matchingTypes = [\n        'MONTHDAY_ABBR',\n        'MONTHDAY_FULL',\n        'MONTHDAY_NUM',\n        'MONTHDAY_PAD'\n      ];\n    } else {\n      matchingTypes = ['MONTH_ABBR', 'MONTH_FULL', 'MONTH_NUM', 'MONTH_PAD'];\n    }\n  }\n\n  additionalOptions = matchingTypes.map(type => {\n    return {\n      value: type,\n      preview: HDATE.GetPreviewStr(dateInputStr, knownValues, type)\n    };\n  });\n  options = [...additionalOptions, ...options];\n  return options;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Show the formatted date string using the parsed result information\n *  @param {String} dateInputStr - the raw input string\n *  @param {Object} knownValues - the parsed date values\n *  @param {String} format - the selected format\n *  @returns {String} - the formatted date string\n */\nHDATE.GetPreviewStr = (dateInputStr, knownValues, format) => {\n  const month = knownValues.month || 'M?';\n  const day = knownValues.day || 'D?';\n  const year = knownValues.year || 'Y?';\n  switch (format) {\n    case 'MONTH_ABBR':\n      return `${HDATE.u_monthAbbr(month)}`;\n    case 'MONTH_FULL':\n      return `${HDATE.u_monthName(month)}`;\n    case 'MONTH_NUM':\n      return `${month}`;\n    case 'MONTH_PAD':\n      return `${HDATE.u_pad(month)}`;\n    case 'MONTHDAY_ABBR':\n      return `${HDATE.u_monthAbbr(month)} ${day}`;\n    case 'MONTHDAY_FULL':\n      return `${HDATE.u_monthName(month)} ${day}`;\n    case 'MONTHDAY_NUM':\n      return `${month}/${day}`;\n    case 'MONTHDAY_PAD':\n      return `${HDATE.u_pad(month)}/${HDATE.u_pad(day)}`;\n    case 'MONTHDAYYEAR_ABBR':\n      return `${HDATE.u_monthAbbr(month)} ${day}, ${year}`;\n    case 'MONTHDAYYEAR_FULL':\n      return `${HDATE.u_monthName(month)} ${day}, ${year}`;\n    case 'MONTHDAYYEAR_NUM':\n      return `${month}/${day}/${year}`;\n    case 'MONTHDAYYEAR_PAD':\n      return `${HDATE.u_pad(month)}/${HDATE.u_pad(day)}/${year}`;\n    case 'YEARMONTHDAY_ABBR':\n      return `${year} ${HDATE.u_monthAbbr(month)} ${day}`;\n    case 'YEARMONTHDAY_FULL':\n      return `${year} ${HDATE.u_monthName(month)} ${day}`;\n    case 'YEARMONTHDAY_NUM':\n      return `${year}/${month}/${day}`;\n    case 'YEARMONTHDAY_PAD':\n      return `${year}/${HDATE.u_pad(month)}/${HDATE.u_pad(day)}`;\n    case 'HISTORICAL_MONTHDAYYEAR_ABBR':\n      return year < 1\n        ? `${HDATE.u_monthAbbr(month)} ${day}, ${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${HDATE.u_monthAbbr(month)} ${day}, ${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_MONTHDAYYEAR_FULL':\n      return year < 1\n        ? `${HDATE.u_monthName(month)} ${day}, ${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${HDATE.u_monthName(month)} ${day}, ${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_MONTHDAYYEAR_NUM':\n      return year < 1\n        ? `${month}/${day}/${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${month}/${day}/${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_MONTHDAYYEAR_PAD':\n      return year < 1\n        ? `${HDATE.u_pad(month)}/${HDATE.u_pad(day)}/${Math.abs(year)} ${\n            HDATE.ERAS.pre\n          }`\n        : `${HDATE.u_pad(month)}/${HDATE.u_pad(day)}/${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_YEARMONTHDAY_ABBR':\n      return year < 1\n        ? `${Math.abs(year)} ${HDATE.u_monthAbbr(month)} ${day} ${HDATE.ERAS.pre}`\n        : `${year} ${HDATE.u_monthAbbr(month)} ${day} ${HDATE.ERAS.post} `;\n    case 'HISTORICAL_YEARMONTHDAY_FULL':\n      return year < 1\n        ? `${Math.abs(year)} ${HDATE.u_monthName(month)} ${day} ${HDATE.ERAS.pre}`\n        : `${year} ${HDATE.u_monthName(month)} ${day} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_YEARMONTHDAY_NUM':\n      return year < 1\n        ? `${Math.abs(year)}/${month}/${day} ${HDATE.ERAS.pre}`\n        : `${year}/${month}/${day} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_YEARMONTHDAY_PAD':\n      return year < 1\n        ? `${Math.abs(year)}/${HDATE.u_pad(month)}/${HDATE.u_pad(day)} ${\n            HDATE.ERAS.pre\n          }`\n        : `${year}/${HDATE.u_pad(month)}/${HDATE.u_pad(day)} ${HDATE.ERAS.post}`;\n    case 'MONTHYEAR_ABBR':\n      return `${HDATE.u_monthAbbr(month)} ${year}`;\n    case 'MONTHYEAR_FULL':\n      return `${HDATE.u_monthName(month)} ${year}`;\n    case 'MONTHYEAR_NUM':\n      return `${month}/${year}`;\n    case 'MONTHYEAR_PAD':\n      return `${HDATE.u_pad(month)}/${year}`;\n    case 'YEARMONTH_ABBR':\n      return `${year} ${HDATE.u_monthAbbr(month)}`;\n    case 'YEARMONTH_FULL':\n      return `${year} ${HDATE.u_monthName(month)}`;\n    case 'YEARMONTH_NUM':\n      return `${year}/${month}`;\n    case 'YEARMONTH_PAD':\n      return `${year}/${HDATE.u_pad(month)}`;\n    case 'HISTORICAL_MONTHYEAR_ABBR':\n      return year < 1\n        ? `${HDATE.u_monthAbbr(month)} ${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${HDATE.u_monthAbbr(month)} ${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_MONTHYEAR_FULL':\n      return year < 1\n        ? `${HDATE.u_monthName(month)} ${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${HDATE.u_monthName(month)} ${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_MONTHYEAR_NUM':\n      return year < 1\n        ? `${month}/${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${month}/${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_MONTHYEAR_PAD':\n      return year < 1\n        ? `${HDATE.u_pad(month)}/${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${HDATE.u_pad(month)}/${year} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_YEARMONTH_ABBR':\n      return year < 1\n        ? `${Math.abs(year)} ${HDATE.u_monthAbbr(month)} ${HDATE.ERAS.pre}`\n        : `${year} ${HDATE.u_monthAbbr(month)} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_YEARMONTH_FULL':\n      return year < 1\n        ? `${Math.abs(year)} ${HDATE.u_monthName(month)} ${HDATE.ERAS.pre}`\n        : `${year} ${HDATE.u_monthName(month)} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_YEARMONTH_NUM':\n      return year < 1\n        ? `${Math.abs(year)}/${month} ${HDATE.ERAS.pre}`\n        : `${year}/${month} ${HDATE.ERAS.post}`;\n    case 'HISTORICAL_YEARMONTH_PAD':\n      return year < 1\n        ? `${Math.abs(year)}/${HDATE.u_pad(month)} ${HDATE.ERAS.pre}`\n        : `${year}/${HDATE.u_pad(month)} ${HDATE.ERAS.post}`;\n    case 'YEAR':\n      return `${year}`;\n    case 'HISTORICALYEAR':\n      return year < 1\n        ? `${Math.abs(year)} ${HDATE.ERAS.pre}`\n        : `${year} ${HDATE.ERAS.post}`;\n    case 'AS_ENTERED':\n    default:\n      // console.log('showprevieow...showing as entered', dateInputStr);\n      return `${dateInputStr}` || '...';\n  }\n};\n\n/// MODULE EXPORTS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = HDATE;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  JS CLI\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\n// const PROMPTS = require('system/util/prompts');\n\n/// CONSTANTS & DECLARATIONS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SHOW_DOM = true;\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet JSCLI = UNISYS.NewModule(module.id);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet CMD = [];\n\n/// DEFINE CLI FUNCTIONS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nJSCLI.AddFunction = f => {\n  if (typeof f !== 'function') throw Error('AddFunction() arg is Function object');\n  CMD.push(f);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nJSCLI.HelpString = () => {\n  let out = 'The following CLI commands are available\\n\\n';\n  CMD.forEach(f => {\n    out += `  ${f.name}()\\n`;\n  });\n  out += '\\n';\n  out += 'Mac shortcuts to open console\\n';\n  out += '  Chrome  : cmd-option-j\\n';\n  out += '  Firefox : cmd-option-k\\n';\n  out += 'PC use ctrl-shift instead\\n';\n  return out;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** initialize registered functions\n */\nJSCLI.Hook('RESET', () => {\n  JSCLI.AddFunction(function ncHelp() {\n    return JSCLI.HelpString();\n  });\n  CMD.forEach(f => {\n    window[f.name] = f;\n  });\n  if (SHOW_DOM) JSCLI.DOM_ShowInstructions();\n});\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nJSCLI.DOM_ShowInstructions = () => {\n  var E_SHELL = document.getElementById('fdshell');\n  if (!E_SHELL) {\n    // console.warn(PR,\"DOM_ShowInstructions() found no id 'fdshell' to append instructions. Type 'ncHelp()' to list available JSCLI functions.\");\n    return;\n  }\n  var E_OUT = document.createElement('pre');\n  var E_HEADER = document.createElement('h4');\n  E_SHELL.appendChild(E_HEADER);\n  E_SHELL.appendChild(E_OUT);\n  E_HEADER.innerHTML = 'Command Information';\n  E_OUT.innerHTML = JSCLI.HelpString();\n};\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = JSCLI;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Path Strings\n  REGEX approach from https://stackoverflow.com/a/47212224\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// CONSTANTS & DECLARATIONS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar PATH = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst rx_dir = /(.*)\\/+([^/]*)$/;\nconst rx_file = /()(.*)$/;\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return the directory portion of a path\n */\nPATH.Parse = function (str) {\n  // [0] original string\n  // [1] dirname\n  // [2] filename\n  return rx_dir.exec(str) || rx_file.exec(str);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return the directory portion of a path\n */\nPATH.Dirname = function (str) {\n  // return str.substring(0,str.lastIndexOf(\"/\"));\n  return (rx_dir.exec(str) || rx_file.exec(str))[1];\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return the file portion of a path\n */\nPATH.Basename = function (str) {\n  // return str.substring(str.lastIndexOf(\"/\")+1);\n  return (rx_dir.exec(str) || rx_file.exec(str))[2];\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return the string stripped of extension\n */\nPATH.StripExt = function (str) {\n  return str.substr(0, str.lastIndexOf('.'));\n};\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = PATH;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  String Prompts for server\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst REFLECT = require('./reflection');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// detect node environment and set padsize accordingly\nconst IS_NODE =\n  typeof process !== 'undefined' &&\n  process.release &&\n  process.release.name === 'node';\nvar PAD_SIZE = IS_NODE\n  ? 9 // nodejs\n  : 0; // not nodejs\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// module declaration\nvar PROMPTS = {};\n\n/// PROMPT STRING HELPERS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** return a string padded to work as a prompt for either browser or node\n *  console output\n */\nPROMPTS.Pad = function (prompt = '', psize = PAD_SIZE) {\n  let len = prompt.length;\n  if (IS_NODE) return prompt.padEnd(psize, ' ') + '-';\n  // must be non-node environment, so do dynamic string adjust\n  if (!psize) return prompt + ':';\n  // if this far, then we're truncating\n  if (len >= psize) prompt = prompt.substr(0, psize - 1);\n  else prompt.padEnd(psize, ' ');\n  return prompt + ':';\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** returns PAD_SIZE stars\n */\nPROMPTS.Stars = function (count) {\n  if (count !== undefined) return ''.padEnd(count, '*');\n  return ''.padEnd(PAD_SIZE, '*');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** return string of calling object's name\n */\nPROMPTS.FunctionName = function () {\n  return REFLECT.FunctionName(2);\n};\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = PROMPTS;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Reflection and other Object Inspection Utilities\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst STACKTRACE = require('stacktrace-js');\nconst PATH = require('./path');\n\n/// MODULE DECLARATION ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar REFLECT = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns the name of the constructor for the current class\n *  https://stackoverflow.com/questions/22777181/typescript-get-to-get-class-name-at-runtime\n */\nREFLECT.ExtractClassName = function (obj) {\n  var funcNameRegex = /function (.{1,})\\(/;\n  var results = funcNameRegex.exec(obj.constructor.toString());\n  return results && results.length > 1 ? results[1] : '';\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns the name of the calling function\n */\nREFLECT.FunctionName = function (depth = 1) {\n  let stack = STACKTRACE.getSync();\n  let frame = stack[depth];\n  let fn = frame.functionName;\n  if (!fn) {\n    fn = PATH.Basename(frame.fileName);\n    fn += `:${frame.lineNumber}:${frame.columnNumber}`;\n    return fn;\n  } else {\n    let bits = fn.split('.');\n    return `method ${bits[1]}() called by module ${bits[0]}`;\n  }\n};\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** InspectModule() prints a list of public properties and methods for each\n *  require module that contains the passed string. It returns a string,\n *  so you will have to console.log() to see the output.\n */\nREFLECT.InspectModule = function (str) {\n  throw Error(\n    `REFLECT.InspectModule() needs to be rewritten for brunch-style modules. ${str}`\n  );\n};\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** InspectObject() accepts an object and a label, and prints a list of\n *  all the methods and properties in it. It returns a string, so you will\n *  have to console.log() to see the output.\n */\nREFLECT.InspectObject = function (obj, depth) {\n  if (!obj) return 'Must pass an object or 1401 watched object key string';\n  var out = '';\n  // handle command line calls\n  switch (typeof obj) {\n    case 'object':\n    case 'function':\n      break;\n    default:\n      return 'must pass object or function, not ' + typeof obj;\n  }\n  // handle recursive scan\n  depth = depth || 0;\n  var label = obj.constructor.name || '(anonymous object)';\n  var indent = '';\n  for (var i = 0; i <= depth; i++) indent += '\\t';\n  out += label + '\\n';\n  out += '\\n';\n  out += m_DumpObj(obj, depth + 1);\n  var proto = Reflect.getPrototypeOf(obj);\n  if (proto) {\n    out += '\\n' + indent + 'IN PROTO: ';\n    out += this.InspectObject(proto, depth + 1);\n    out += '\\n';\n  }\n  if (depth === 0) out = '\\n' + out;\n  console.log(out);\n  return obj;\n};\n\n/// SUPPORTING FUNCTIONS //////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Support function for InspectModule() and InspectObject()\n *  Also checks m_watching array\n */\nfunction m_DumpObj(obj, depth) {\n  var indent = '';\n  for (var i = 0; i < depth; i++) indent += '\\t';\n\n  var str = '';\n  Object.keys(obj).forEach(function (key) {\n    var prop = obj[key];\n    var type = typeof prop;\n    str += indent;\n    str += type + '\\t' + key;\n    switch (type) {\n      case 'function':\n        var regexp = /function.*\\(([^)]*)\\)/;\n        var args = regexp.exec(prop.toString());\n        str += ' (' + args[1] + ')';\n        break;\n      default:\n        break;\n    }\n    str += '\\n';\n  });\n  return str;\n}\n\n/// GLOBAL HOOKS //////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nif (typeof window === 'object') {\n  window.InspectModule = REFLECT.InspectModule;\n  window.InspectObject = REFLECT.InspectObject;\n  window.DBG_Out = function (msg, selector) {\n    REFLECT.Out(msg, false, selector);\n  };\n  window.DBG_OutClean = function (msg, selector) {\n    REFLECT.Out(msg, true, selector);\n  };\n}\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = REFLECT;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  TEST\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nlet DBG = false;\n\n/// DECLARATIONS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** list of tests that are allowed to run\n */\nlet TESTS = {\n  call: false, // unisys calls\n  state: false, // unisys state manager\n  hook: false, // unisys lifecycle hooks\n  remote: false, // unisys 'remote' calls to other module\n  net: false, // network connection to socket server\n  server: false // unisys 'server implemented' calls\n};\n/** groups of tests to run\n */\nlet PASSED = {};\nlet TEST_GO = false;\n/** pairs of arrays to match (array of arrays)\n */\nlet ARR_MATCH = [];\nlet PR = 'TEST:';\nlet m_meta_info = {};\n\nlet E_SHELL, E_OUT, E_HEADER;\nlet m_failed = [];\nlet m_skipped = [];\nlet m_passed = [];\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Main TEST ENABLE\n    pass the testname (as listed in TESTS) and either true or false)\n */\nlet TM = (testname, flag) => {\n  if (testname === undefined) {\n    console.warn(\n      `${PR} %cConfigured and Active`,\n      `color:red;background-color:yellow`\n    );\n    TEST_GO = true;\n    return true;\n  }\n  if (typeof testname !== 'string') throw 'arg1 must be a testname';\n  if (!TESTS[testname]) throw `\"${testname}\" is not a valid testname`;\n  if (DBG) console.log(PR, 'TM', testname, flag || '');\n  if (flag === undefined) {\n    if (!TEST_GO) console.error(`${PR} Test Switch read before testing started`);\n    let setting = TESTS[testname];\n    return setting;\n  } else {\n    TESTS[testname] = flag;\n    m_ConfigureTestFlags(testname, flag);\n    return flag;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nTM.SetTitle = function (text) {\n  E_HEADER.innerText = text;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nTM.SetMeta = function (meta, value) {\n  if (typeof meta === 'string') {\n    let obj = {};\n    obj[meta] = value;\n    meta = obj;\n  }\n  if (typeof meta === 'object') {\n    Object.assign(m_meta_info, meta);\n  } else {\n    throw Error('SetMeta() expected either object or string,value');\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nTM.MetaString = function () {\n  let o = '';\n  Object.entries(m_meta_info).forEach(([k, v]) => {\n    o += `${k}:${v} `;\n  });\n  return o;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: pass the particular subtest\n */\nTM.Pass = function (subtest) {\n  m_InitShell();\n  // initialize tests\n  if (DBG) console.log(`${PR} %cPass %c${subtest}`, 'color:green', 'color:black');\n  if (PASSED[subtest]) {\n    if (PASSED[subtest]) ++PASSED[subtest];\n    else PASSED[subtest] = 1;\n  } else {\n    throw Error(`Unknown subtest: ${subtest}`);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: fail the particular subtest\n */\nTM.Fail = function (subtest) {\n  m_InitShell();\n  if (DBG) console.error(`${PR} %cFail ${subtest}`, 'color:red;font-weight:bold');\n  if (PASSED[subtest]) {\n    // 'null' for 'condition succeed' tests\n    // '0' for 'no error detected' tests\n    let flag = PASSED[subtest];\n    if (typeof flag === 'string') {\n      // this has already failed with error\n      PASSED[subtest] = flag + '+';\n      return;\n    }\n    if (flag === null) return; // null flag are skipped\n    if (flag === 0) {\n      PASSED[subtest] = -1; // failed once\n      return;\n    }\n    if (flag <= 0) {\n      --PASSED[subtest]; // multiple failures\n      return;\n    }\n    // bizarre 'succeeded but now failed'\n    if (flag > 0) {\n      PASSED[subtest] = `succeeded ${flag} times, then failed`;\n      return;\n    }\n  }\n  throw Error(`Unknown subtest: ${subtest}`);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: check if the particular subtests passed have indeed passed\n */\nTM.Passed = function (...args) {\n  if (DBG) console.log(PR, 'Passed');\n  let passed = true;\n  args.forEach(subtest => {\n    if (!PASSED[subtest]) throw `\"${subtest}\" is not valid subtest`;\n    passed = passed && PASSED[subtest];\n  });\n  return passed;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: output test results\n */\nTM.Assess = function () {\n  if (DBG) console.log(PR, 'Assess');\n  m_failed = [];\n  m_skipped = [];\n  m_passed = [];\n  m_PreTest();\n  m_TestResults();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: assess whether passed arrays match during Assess function()\n */\nTM.AssessArrayMatch = function (subtest, arr1, arr2) {\n  if (DBG) console.log(PR, 'AssessArrayMatch');\n  ARR_MATCH.push([subtest, arr1, arr2]);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: return TRUE if there were no failing tests in the last test.\n    Call TM.Assess() again to retest\n */\nTM.AllPassed = function () {\n  return m_failed.length !== 0;\n};\n\n/// TEST FUNCTIONS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** sets the PASSED object keys to enable/disable tests prior to running\n */\nfunction m_ConfigureTestFlags(testname, flag) {\n  if (flag === undefined) throw 'arg2 flag must be true to enable, false to disable';\n  // the subtest value must be set to false first\n  // to skip tests, the subtest value is set to null\n  if (flag === false) flag = null;\n  if (flag === true) flag = false;\n  // set subtest flags\n  let subtests;\n  switch (testname) {\n    case 'state':\n      subtests = {\n        stateChange: flag,\n        stateMerge: flag,\n        stateConcat: flag\n      };\n      break;\n    case 'hook':\n      subtests = {\n        hookInit1: flag,\n        hookInit2: flag,\n        hookInitDeferred: flag,\n        hookStart: flag\n      };\n      break;\n    case 'call':\n      subtests = {\n        callHndlrReg: flag,\n        callHndlrData: flag,\n        callHndlrDataProp: flag,\n        callDataReturn: flag,\n        callDataAdd: flag,\n        callDataMulti: flag\n      };\n      break;\n    case 'remote':\n      subtests = {\n        remoteCall: flag,\n        remoteData: flag,\n        remoteData2: flag,\n        remoteDataReturn: flag,\n        remoteDataAdd: flag,\n        remoteDataMulti: flag\n      };\n      break;\n    case 'server':\n      subtests = {\n        serverCall: flag,\n        serverCallOrder: flag,\n        serverReturn: flag,\n        serverData: flag,\n        serverDataAdd: flag\n      };\n      break;\n    case 'net':\n      subtests = {\n        netMessageReg: flag,\n        netCallHndlr: flag,\n        netSendHndlr: flag,\n        netSendNoEcho: 0, // if this stays 0, then NOERR has passed\n        netSignal: flag,\n        netSignalEcho: flag,\n        netData: flag,\n        netDataReturn: flag,\n        netDataAdd: flag,\n        //          netDataGather     : flag,\n        netDataMulti: flag\n      };\n      break;\n    default:\n      throw `Unknown test \"${testname}\"`;\n  } // end switch\n  Object.assign(PASSED, subtests);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_PreTest() {\n  // test arrays\n  ARR_MATCH.forEach(function (pair) {\n    let pass = true;\n    let subtest = pair[0];\n    let arr1 = pair[1];\n    let arr2 = pair[2];\n    pass = pass && arr1.length === arr2.length;\n    for (let i = 0; i < arr1.length; i++) {\n      pass = pass && arr1[i] === arr2[i];\n    }\n    if (pass) TM.Pass(subtest);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** prints the test output to console\n */\nfunction m_TestResults() {\n  m_ShowShell();\n  // check all test results\n  let pEntries = Object.entries(PASSED);\n  let padding = 0;\n  // find longest string\n  pEntries.forEach(([key]) => {\n    if (key.length > padding) padding = key.length;\n  });\n  // scan test results\n  pEntries.forEach(([key, value]) => {\n    let res = '';\n    if (value === null) {\n      // res = `${(key).padEnd(padding)} [ ]\\n`;\n      m_skipped.push(res);\n    } else\n      switch (typeof value) {\n        case 'number':\n          if (value >= 1) {\n            if (value === 1) res = `${key.padEnd(padding)} [OK]\\n`;\n            if (value > 1) res = `${key.padEnd(padding)} [OK] x ${value}\\n`;\n            m_passed.push(res);\n          } else {\n            if (value === 0) {\n              res = `${key.padEnd(padding)} [NP]\\n`;\n              m_passed.push(res);\n            }\n            if (value === -1) {\n              res = `${key.padEnd(padding)} [!!] FAIL\\n`;\n              m_failed.push(res);\n            }\n            if (value < -1) {\n              res = `${key.padEnd(padding)} [!!] FAIL x ${-value}\\n`;\n              m_failed.push(res);\n            }\n          }\n          break;\n        case 'boolean':\n          if (value) {\n            res = `${key.padEnd(padding)} [OK]\\n`;\n            m_passed.push(res);\n          } else {\n            res = `${key.padEnd(padding)} [!!] FAIL\\n`;\n            m_failed.push(res);\n          }\n          break;\n        default:\n          m_passed.push(`${key.padEnd(padding)} [OK] '${value}'\\n`);\n          break;\n      } // switch typeof value\n  }); // pEntries.forEach\n\n  let testTitle = 'UNISYS LOGIC TEST RESULTS';\n  console.group(testTitle);\n  let out = m_passed.concat(m_failed, m_skipped).join('');\n\n  // additional help\n  let tnotes = '';\n  if (!TM.Passed('netCallHndlr'))\n    tnotes += `NOTE: 'netCallHndlr' requires a synched remote app to call-in\\n`;\n  if (!TM.Passed('netSendHndlr'))\n    tnotes += `NOTE: 'netSendHndlr' requires a synched remote app to call-in\\n`;\n  if (!TM.Passed('netData'))\n    tnotes += `NOTE: 'netData*' requires a synched remote app to respond to call-out\\n`;\n  if (tnotes) out += '\\n' + tnotes;\n\n  // summary\n  let summary = `${m_passed.length}=passed`;\n  if (m_failed.length) summary += ` ${m_failed.length}=failed`;\n  if (m_skipped.length) summary += ` ${m_skipped.length}=skipped`;\n  console.log(`${out}\\n${summary}`);\n  TM.SetTitle(`${testTitle} ${TM.MetaString()}`);\n  E_OUT.innerText = `${summary}\\n\\n`;\n  E_OUT.innerText += 'OPEN JAVASCRIPT CONSOLE TO SEE DETAILS\\n';\n  E_OUT.innerText += 'Mac shortcuts to open console\\n';\n  E_OUT.innerText += '  Chrome  : cmd-option-j\\n';\n  E_OUT.innerText += '  Firefox : cmd-option-k\\n';\n  E_OUT.innerText += 'PC use ctrl-shift instead\\n';\n  console.groupEnd();\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** initialize the shell user interface for test results as elements, but\n    don't yet link them because component may not have rendered yet\n */\nfunction m_InitShell() {\n  if (!E_OUT) {\n    E_OUT = document.createElement('pre');\n    E_HEADER = document.createElement('h4');\n    E_HEADER.innerText = 'RUNNING TESTS ';\n    E_OUT.innerText = '.';\n  } else {\n    E_OUT.innerText += '.';\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ show the shell elements by finding root div and appending them\n/*/ function m_ShowShell() {\n  E_SHELL = document.getElementById('fdshell');\n  E_SHELL.appendChild(E_HEADER);\n  E_SHELL.appendChild(E_OUT);\n}\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = TM;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  UNISYS DATALINK CLASS\n\n  The UNISYS DATALINK (UDATA) class represents a connection to the UNISYS\n  event messaging system. Instances are created with UNISYS.NewDataLink().\n\n  Each UNODE has a unique UNISYS_ID (the UID) which represents its\n  local address. Combined with the device UADDR, this makes every UNODE\n  on the network addressable.\n\n  * UNODES can get and set global state objects\n  * UNODES can subscribe to state change events\n  * UNODES can register listeners for a named message\n  * UNODES can send broadcast to all listeners\n  * UNODES can call listeners and receive data\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst SETTINGS = require('settings');\nconst STATE = require('unisys/client-state');\nconst Messager = require('unisys/client-messager-class');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = { send: false, return: false, register: false };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst BAD_OWNER =\n  \"must pass owner object of type React.Component or UniModule with optional 'name' parameter\";\nconst BAD_NAME = 'name parameter must be a string';\nconst BAD_UID = 'unexpected non-unique UID';\nconst NO_DATAOBJ = 'syntax error: missing data object';\nconst BAD_EJSPROPS =\n  'EJS props (window.NC_UNISYS) is undefined, so can not set datalink IP address';\nconst PR = 'UDATA:';\n\n/// NODE MANAGEMENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar UNODE = new Map(); // unisys connector node map (local)\nvar UNODE_COUNTER = 100; // unisys connector node id counter\n\n/// GLOBAL MESSAGES ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MESSAGER = new Messager();\n\n/// UNISYS NODE CLASS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Instances of this class can register/unregister message handlers and also\n    send messages. Constructor receives an owner, which is inspected for\n    properties to determine how to classify the created messager for debugging\n    purposes\n */\nclass UnisysDataLink {\n  /** CONSTRUCTOR\n      A messager creates a unique ID within the webapp instance. Since\n      messagers are \"owned\" by an object, we want the ID to reflect\n      the owner's identity too while also allowing multiple instances per\n      owner.\n   */\n  constructor(owner, optName) {\n    let msgr_type = '?TYPE';\n    let msgr_name = '?NAME';\n\n    if (optName !== undefined && typeof optName !== 'string') {\n      throw Error(BAD_NAME);\n    }\n\n    // require an owner that is an object of some kind\n    if (typeof owner !== 'object') throw Error(BAD_OWNER);\n\n    // react components or regular objects\n    if (owner.name) {\n      msgr_type = 'MOD';\n      msgr_name = owner.name || optName;\n    } else if (owner.constructor.name) {\n      msgr_type = 'RCT';\n      msgr_name = owner.constructor.name;\n    } else {\n      throw Error(BAD_OWNER);\n    }\n\n    // generate and save unique id\n    this.uid = `${msgr_type}_${UNODE_COUNTER++}`;\n    this.name = msgr_name;\n    if (UNODE.has(this.uid)) throw Error(BAD_UID + this.uid);\n\n    // save module in the global module list\n    UNODE.set(this.uid, this);\n  }\n\n  /// UNIQUE UNISYS ID for local application\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// this is used to differentiate sources of events so they don't echo\n  UID() {\n    return this.uid;\n  }\n  Name() {\n    return this.name;\n  }\n\n  /// GLOBAL STATE ACCESS\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// global STATE module calls are wrapped by unisys node so the unique\n  /// UnisysID address can be appended\n  AppState(namespace) {\n    return STATE.State(namespace);\n  }\n  SetAppState(namespace, newState) {\n    // uid is \"source uid\" designating who is making the change\n    STATE.SetState(namespace, newState, this.UID());\n  }\n  MergeAppState(namespace, newState) {\n    // uid is \"source uid\" designating who is making the change\n    STATE.MergeState(namespace, newState, this.UID());\n  }\n  ConcatAppState(namespace, newState) {\n    // uid is \"source uid\" designating who is making the change\n    STATE.ConcatState(namespace, newState, this.UID());\n  }\n  // uid is \"source uid\" of subscribing object, to avoid reflection\n  // if the subscribing object is also the originating state changer\n  OnAppStateChange(namespace, listener) {\n    STATE.OnStateChange(namespace, listener, this.UID());\n  }\n  AppStateChangeOff(namespace, listener) {\n    STATE.OffStateChange(namespace, listener);\n  }\n\n  /// MESSAGES ////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// mesgName is a string, and is an official event that's defined by the\n  /// subclasser of UnisysNode\n  HandleMessage(mesgName, listener) {\n    // uid is \"source uid\" of subscribing object, to avoid reflection\n    // if the subscribing object is also the originating state changer\n    if (DBG.register)\n      console.log(`${this.uid}_${PR}`, `${this.name} handler added [${mesgName}]`);\n    MESSAGER.HandleMessage(mesgName, listener, { receiverUID: this.UID() });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  UnhandleMessage(mesgName, listener) {\n    if (DBG.register)\n      console.log(`${this.uid}_${PR}`, `${this.name} handler removed [${mesgName}]`);\n    MESSAGER.UnhandleMessage(mesgName, listener);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** UDATA wraps Messager.Call(), which returns an array of promises.\n      The UDATA version of Call() manages the promises, and returns a\n   */\n  async Call(mesgName, inData = {}, options = {}) {\n    options = Object.assign(options, { type: 'mcall' });\n    if (DBG.send) {\n      let status = '';\n      if (!options.toNet) status += 'NO_NET ';\n      if (!options.toLocal) status += 'NO_LOCAL';\n      if (!(options.toLocal || options.toNet)) status = 'ERR NO LOCAL OR NET';\n      console.log(`${this.uid}_${PR}`, '** DATALINK CALL ASYNC', mesgName, status);\n    }\n    // uid is \"source uid\" of subscribing object, to avoid reflection\n    // if the subscribing object is also the originating state changer\n    options.srcUID = this.UID();\n    let promises = MESSAGER.Call(mesgName, inData, options);\n    /// MAGICAL ASYNC/AWAIT BLOCK ///////\n    if (DBG.send) console.log(`${this.uid}_${PR}`, '** awaiting...', promises);\n    let resArray = await Promise.all(promises);\n    if (DBG.send) console.log(`${this.uid}_${PR}`, '** promise fulfilled!', mesgName);\n    /// END MAGICAL ASYNC/AWAIT BLOCK ///\n    let resObj = Object.assign({}, ...resArray);\n    if (DBG.return)\n      console.log(\n        `${this.uid}_${PR}`,\n        `[${mesgName}] returned`,\n        JSON.stringify(resObj)\n      );\n    return resObj;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Sends the data to all message implementors UNLESS it is originating from\n      the same UDATA instance (avoid echoing back to self)\n   */\n  Send(mesgName, inData = {}, options = {}) {\n    if (DBG.send) console.log(`${this.uid}_${PR}`, '** DATALINK SEND', mesgName);\n    options = Object.assign(options, { type: 'msend' });\n    // uid is \"source uid\" of subscribing object, to avoid reflection\n    // if the subscribing object is also the originating state changer\n    options.srcUID = this.UID();\n    // uid is \"source uid\" of subscribing object, to avoid reflection\n    // if the subscribing object is also the originating state changer\n    MESSAGER.Send(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Sends the data to all message implementors, irregardless of origin.\n   */\n  Signal(mesgName, inData = {}, options = {}) {\n    options = Object.assign(options, { type: 'msig' });\n    MESSAGER.Signal(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** version of Call that forces local-only calls\n   */\n  LocalCall(mesgName, inData, options = {}) {\n    options = Object.assign(options, { type: 'mcall' });\n    options.toLocal = true;\n    options.toNet = false;\n    return this.Call(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** version of Send that force local-only calls\n   */\n  LocalSend(mesgName, inData, options = {}) {\n    options = Object.assign(options, { type: 'msend' });\n    options.toLocal = true;\n    options.toNet = false;\n    this.Send(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** version of Send that force local-only calls\n   */\n  LocalSignal(mesgName, inData, options = {}) {\n    options = Object.assign(options, { type: 'msig' });\n    options.toLocal = true;\n    options.toNet = false;\n    this.Signal(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** version of Call that forces network-only calls\n   */\n  NetCall(mesgName, inData, options = {}) {\n    options = Object.assign(options, { type: 'mcall' });\n    options.toLocal = false;\n    options.toNet = true;\n    return this.Call(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** version of Send that force network-only calls\n   */\n  NetSend(mesgName, inData, options = {}) {\n    options = Object.assign(options, { type: 'msend' });\n    options.toLocal = false;\n    options.toNet = true;\n    this.Send(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** version of Signal that forces network-only signal\n   */\n  NetSignal(mesgName, inData, options = {}) {\n    options.toLocal = false;\n    options.toNet = true;\n    this.Signal(mesgName, inData, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  NullCallback() {\n    if (DBG.send) console.log(`${this.uid}_${PR}`, 'null_callback', this.UID());\n  }\n} // class UnisysNode\n\n/// STATIC CLASS METHODS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** There's a single MESSAGER object that handles all registered messages for\n    UNISYS.\n */\nUnisysDataLink.MessageNames = function () {\n  return MESSAGER.MessageNames();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Filter any bad messages from the passed array of strings\n */\nUnisysDataLink.ValidateMessageNames = function (msgs = []) {\n  let valid = [];\n  msgs.forEach(name => {\n    if (MESSAGER.HasMessageName(name)) valid.push(name);\n    else throw new Error(`ValidateMessageNames() found invalid message '${name}'`);\n  });\n  return valid;\n};\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UnisysDataLink;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  LifeCycle - A system manager for application lifecycle events.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst PATH = require('system/util/path');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = window.NC_DBG && window.NC_DBG.lifecycle;\nconst BAD_PATH = \"module_path must be a string derived from the module's module.id\";\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar PHASE_HOOKS = new Map(); // functions that might right a Promise\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PHASES = [\n  'TEST_CONF', // setup tests\n  'INITIALIZE', // module data structure init\n  'LOADASSETS', // load any external data, make connections\n  'CONFIGURE', // configure runtime data structures\n  'DOM_READY', // when viewsystem has completely composed\n  'RESET', // reset runtime data structures\n  'START', // start normal execution run\n  'APP_READY', // synchronize to UNISYS network server\n  'RUN', // system starts running\n  'UPDATE', // system is running (periodic call w/ time)\n  'PREPAUSE', // system wants to pause run\n  'PAUSE', // system has paused (periodic call w/ time)\n  'POSTPAUSE', // system wants to resume running\n  'STOP', // system wants to stop current run\n  'DISCONNECT', // unisys server has gone offline\n  'RECONNECT', // unisys server has reconnected\n  'UNLOADASSETS', // system releases any connections\n  'SHUTDOWN' // system wants to shut down\n];\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar PHASE = PHASES[0] + '_PENDING'; // current phase\n\n/// MODULE DEFINITION /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = {\n  name: 'LifeCycle',\n  scope: 'system/booting' // overwritten by UNISYS.SystemInitialize()\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** UTILITY: compare the destination scope with the acceptable scope (the\n    module.id of the root JSX component in a view). Any module not in the\n    system directory will not get called\n */\nfunction m_ExecuteScopedPhase(phase, o) {\n  // check for special unisys or system directory\n  if (o.scope.indexOf('system') === 0) return o.f();\n  if (o.scope.indexOf('unisys') === 0) return o.f();\n  // check for subdirectory\n  if (o.scope.includes(MOD.scope, 0)) return o.f();\n  // else do nothing\n  if (DBG)\n    console.info(\n      `LIFECYCLE: skipping [${phase}] for ${o.scope} because scope is ${MOD.scope}`\n    );\n  return undefined;\n}\n\n/// STATUS REPORTING //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.CurrentPhase = () => {\n  return PHASE;\n};\n\n/// LIFECYCLE METHODS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: register a Phase Handler which is invoked by MOD.Execute()\n    phase is a string constant from PHASES array above\n    f is a function that does work immediately, or returns a Promise\n */\nMOD.Hook = (phase, f, scope) => {\n  // make sure scope is included\n  if (typeof scope !== 'string')\n    throw Error(`<arg3> scope is required (set to module.id)`);\n  // does this phase exist?\n  if (typeof phase !== 'string')\n    throw Error(\"<arg1> must be PHASENAME (e.g. 'LOADASSETS')\");\n  if (!PHASES.includes(phase))\n    throw Error(phase, 'is not a recognized lifecycle phase');\n  // did we also get a promise?\n  if (!(f instanceof Function))\n    throw Error('<arg2> must be a function optionally returning Promise');\n\n  // get the list of promises associated with this phase\n  // and add the new promise\n  if (!PHASE_HOOKS.has(phase)) PHASE_HOOKS.set(phase, []);\n  PHASE_HOOKS.get(phase).push({ f, scope });\n  if (DBG) console.log(`[${phase}] added handler`);\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Execute all Promises associated with a phase, completing when\n    all the callback functions complete. If the callback function returns\n    a Promise, this is added to a list of Promises to wait for before the\n    function returns control to the calling code.\n */\nMOD.Execute = async phase => {\n  // require scope to be set\n  if (MOD.scope === false)\n    throw Error(\n      `UNISYS.SetScope() must be set to RootJSX View's module.id. Aborting.`\n    );\n\n  // note: contents of PHASE_HOOKs are promise-generating functions\n  if (!PHASES.includes(phase))\n    throw Error(`${phase} is not a recognized lifecycle phase`);\n  let hooks = PHASE_HOOKS.get(phase);\n  if (hooks === undefined) {\n    if (DBG) console.log(`[${phase}] no subscribers`);\n    return;\n  }\n\n  // phase housekeeping\n  PHASE = phase + '_PENDING';\n\n  // now execute handlers and promises\n  let icount = 0;\n  if (DBG) console.group(phase);\n  // get an array of promises\n  // o contains f, scope pushed in Hook() above\n  let promises = hooks.map(o => {\n    let retval = m_ExecuteScopedPhase(phase, o);\n    if (retval instanceof Promise) {\n      icount++;\n      return retval;\n    }\n    // return undefined to signal no special handling\n    return undefined;\n  });\n  promises = promises.filter(e => {\n    return e !== undefined;\n  });\n  if (DBG && hooks.length)\n    console.log(`[${phase}] HANDLERS PROCESSED : ${hooks.length}`);\n  if (DBG && icount) console.log(`[${phase}] PROMISES QUEUED    : ${icount}`);\n\n  // wait for all promises to execute\n  await Promise.all(promises)\n    .then(values => {\n      if (DBG && values.length)\n        console.log(`[${phase}] PROMISES RETURNED  : ${values.length}`, values);\n      if (DBG) console.groupEnd();\n      return values;\n    })\n    .catch(err => {\n      if (DBG) console.log(`[${phase} EXECUTE ERROR ${err}`);\n      throw Error(`[${phase} EXECUTE ERROR ${err}`);\n    });\n\n  // phase housekeeping\n  PHASE = phase;\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: The scope is used to filter lifecycle events within a particular\n    application path, which are defined under the view directory.\n */\nMOD.SetScope = module_path => {\n  if (typeof module_path !== 'string') throw Error(BAD_PATH);\n  if (DBG) console.log(`setting lifecycle scope to ${module_path}`);\n  // strip out filename, if one exists\n  MOD.scope = PATH.Dirname(module_path);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: The scope\n */\nMOD.Scope = () => {\n  return MOD.scope;\n};\n\n/// STATIC METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// ...\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Messager - Handle a collection of named events and their handlers\n  https://en.wikipedia.org/wiki/Event-driven_architecture#JavaScript\n\n  NOTE: This class is often WRAPPED by other UNISYS modules that manage\n  a unique ID (such as the unique unisys datalink id) that hide that\n  implementation detail from local users (e.g. unisys-data-class)\n\n  HandleMessasge('MESG_NAME',handlerFunc,options)\n    Add a handlerFunc. Specify options.handlerUID to enable echo rejection\n    (same udata module will not invoke own handler when sending same message)\n  UnhandleMessage('MESG_NAME',handlerFunc)\n    Remove a handlerFunc associated with the handlerFuncFunction\n  Send('MESG_NAME',data,options)\n    Trigger an message+data to all handlers from a particular UDATA id\n    If options.srcUID is specified, echo suppression is enabled\n  Signal('MESG_NAME',data)\n    Similar to Send(), but will ALWAYS broadcast to all implementors\n  Call('MESG_NAME',data,options)\n    Similar to Send(), but can return a value to a callback function\n    options.srcUID is the UDATA id; set for echo supression to that uid\n    options.dataReturnFunc is the callback function.\n\n  NOTE: CallerReturnFunctions receive data object AND control object.\n  The control object has the \"return\" function that closes a transaction;\n  this is useful for async operations without Promises.\n\n  NOTE: HandlerFunctions and CallerReturnFunctions are anotated with the\n  udata_id property, which can be set to avoid echoing a message back to\n  the same originating udata source.\n\n  NOTE: When providing a handlerFunc, you might want to bind it to a\n  specific object context (i.e. 'this') value using bind().\n  e.g. handlerFunction = handlerFunction.bind(this);\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst TEST = require('test');\nconst NetMessage = require('unisys/common-netmessage-class');\n\n/// MODULE VARS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MSGR_IDCOUNT = 0;\nvar DBG = false;\n\n/// UNISYS MESSAGER CLASS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass Messager {\n  /** Instances of this class can be used to implement a UNISYS-style message\n    passing scheme with shared semantics. It maintains a Map keyed by mesgName\n    strings, containing a Set object filled with handlers for that mesgName.\n */\n  constructor() {\n    this.handlerMap = new Map(); // message map storing sets of functions\n    this.messager_id = ++MSGR_IDCOUNT;\n  }\n\n  /// FIRE ONCE EVENTS //////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** API: subscribe a handlerFunc function with a particular unisys id\n    to receive a particular message. The handlerFunc receives a data obj\n    and should return one as well. If there is an error, return a string.\n */\n  HandleMessage(mesgName, handlerFunc, options = {}) {\n    let { handlerUID } = options;\n    let { syntax } = options;\n    if (typeof handlerFunc !== 'function') {\n      throw 'arg2 must be a function';\n    }\n    if (typeof handlerUID === 'string') {\n      // bind the udata uid to the handlerFunc function for convenient access\n      // by the message dispatcher\n      handlerFunc.udata_id = handlerUID;\n    }\n    let handlers = this.handlerMap.get(mesgName);\n    if (!handlers) {\n      handlers = new Set();\n      this.handlerMap.set(mesgName, handlers);\n    }\n    // syntax annotation\n    if (syntax) handlerFunc.umesg = { syntax };\n    // saved function to handler\n    handlers.add(handlerFunc);\n    return this;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** API: unsubscribe a handlerFunc function from a particular event\n   */\n  UnhandleMessage(mesgName, handlerFunc) {\n    if (!arguments.length) {\n      this.handlerMap.clear();\n    } else if (arguments.length === 1) {\n      this.handlerMap.delete(mesgName);\n    } else {\n      const handlers = this.handlerMap.get(mesgName);\n      if (handlers) {\n        handlers.delete(handlerFunc);\n      }\n    }\n    return this;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** API: trigger a message with the data object payload, sending to all handlers\n    that implement that event. Includer sender's unisys id to prevent the sender\n    to receiving its own message back if it happens to implement the message as\n    well. dstScope is 'net' or 'local' to limit where to send, or 'all'\n    for everyone on net or local\n */\n  Send(mesgName, inData, options = {}) {\n    let { srcUID, type } = options;\n    let { toLocal = true, toNet = true } = options;\n    const handlers = this.handlerMap.get(mesgName);\n    /// toLocal\n    if (handlers && toLocal)\n      for (let handlerFunc of handlers) {\n        // handlerFunc signature: (data,dataReturn) => {}\n        // handlerFunc has udata_id property to note originating UDATA object\n        // skip \"same origin\" calls\n        if (srcUID && handlerFunc.udata_id === srcUID) {\n          if (DBG)\n            console.warn(\n              `MessagerSend: [${mesgName}] skip call since origin = destination; use Broadcast() if intended`\n            );\n          continue;\n        }\n        // trigger the handler (no return expected)\n        handlerFunc(inData, {\n          /*control functions go here*/\n        });\n      } // end toLocal\n    /// toNetwork\n    if (toNet) {\n      let pkt = new NetMessage(mesgName, inData, type);\n      pkt.SocketSend();\n    } // end toNetwork\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** API: wrapper for Send() used when you want every handlerFunc, including\n    the sender, to receive the event even if it is the one who sent it.\n */\n  Signal(mesgName, data, options = {}) {\n    if (options.srcUID) {\n      console.warn(\n        `overriding srcUID ${options.srcUID} with NULL because Signal() doesn't use it`\n      );\n      options.srcUID = null;\n    }\n    this.Send(mesgName, data, options);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** API: Return an array of Promises. Called by UDATA.Call().\n   */\n  Call(mesgName, inData, options = {}) {\n    let { srcUID, type } = options;\n    let { toLocal = true, toNet = true } = options;\n    const handlers = this.handlerMap.get(mesgName);\n    let promises = [];\n    /// toLocal\n    if (handlers && toLocal) {\n      for (let handlerFunc of handlers) {\n        // handlerFunc signature: (data,dataReturn) => {}\n        // handlerFunc has udata_id property to note originating UDATA object\n        // skip \"same origin\" calls\n        if (srcUID && handlerFunc.udata_id === srcUID) {\n          if (DBG)\n            console.warn(\n              `MessagerCall: [${mesgName}] skip call since origin = destination; use Broadcast() if intended`\n            );\n          continue;\n        }\n        // Create a promise. if handlerFunc returns a promise, it follows\n        let p = f_MakeResolverFunction(handlerFunc, inData);\n        promises.push(p);\n      } // end toLocal\n    }\n    /// resolver function\n    /// remember MESSAGER class is used for more than just Network Calls\n    /// the state manager also uses it, so the resolved value may be of any type\n    function f_MakeResolverFunction(handlerFunc) {\n      return new Promise((resolve, reject) => {\n        let retval = handlerFunc(inData, {\n          /*control functions go here*/\n        });\n        resolve(retval);\n      });\n    }\n    /// toNetwork\n    if (toNet) {\n      type = type || 'mcall';\n      let pkt = new NetMessage(mesgName, inData, type);\n      let p = pkt.QueueTransaction();\n      promises.push(p);\n    } // end toNetwork\n\n    /// return all queued promises\n    return promises;\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** API: Return a list of messages handled by this Messager instance\n   */\n  MessageNames() {\n    let handlers = [];\n    this.handlerMap.forEach((value, key) => {\n      handlers.push(key);\n      if (DBG) console.log('handler: ' + key);\n    });\n    return handlers;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** API: Verify that message exists\n   */\n  HasMessageName(msg = '') {\n    return this.handlerMap.has(msg);\n  }\n} // class Messager\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = Messager;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    UNISYS MODULE SHELL\n\n    A simple shell with a unique id and unique name. Currently this is just\n    a utility class for maintaining naming convention for modules, and\n    serves as the interface for module management within the UNISYS universe\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst LIFECYCLE = require('unisys/client-lifecycle');\nconst PATH = require('system/util/path');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst BAD_NAME = 'name parameter must be a string or unisys module';\nconst NOT_UNIQUE = 'name must be unique';\n\n/// MODULE DECLARATIONS ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MODULES = new Map(); // unisys modules map\nvar MODULES_COUNTER = 1; // unisys modules counter\n\n/// UNISYS MODULE CLASS ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Instances of this class are used to participate in the UNISYS lifecycle.\n    Constructor receives the value of module.id, which is used to help scope\n    what lifecycle hooks are distributed to which module\n */\nclass UnisysModule {\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** initializer is the value module.id or another instance of UnisysModule,\n      which is used to create a derivative name of form 'initializer name:0'\n   */\n  constructor(module) {\n    if (module === undefined) throw Error(BAD_NAME);\n    // can pass another unisys modules to create derived name\n    if (module instanceof UnisysModule) {\n      this.module_id = module.AutoName();\n    } else if (typeof module === 'string') {\n      // otherwise, copy the initializer\n      this.module_id = module;\n    }\n    if (MODULES.has(this.name)) throw Error(NOT_UNIQUE);\n\n    // save unique information\n    this.uid = `UMOD_${MODULES_COUNTER++}`;\n\n    // save derivative subname counter\n    this.subnameCounter = 0;\n\n    // save module in the global module list\n    MODULES.set(this.module_id, this);\n  }\n\n  /// PROPERTIES //////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** this is used for identifying the module. It must be unique across all\n   */\n  ModuleID() {\n    return this.module_id;\n  }\n  /** utility method to return a short name\n   */\n  ModuleName() {\n    return PATH.Basename(this.module_id);\n  }\n\n  /// UTILITIES ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** used to create a derivative name\n   */\n  AutoName() {\n    return `${this.module_id}:${this.subnameCounter++}`;\n  }\n  /** check if the name already exists in the MODULES collection\n   */\n  HasModule(name) {\n    return MODULES.has(name);\n  }\n\n  /// LIFECYCLE /////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** wrap Hook function to include the ModuleID\n   */\n  Hook(phase, f) {\n    LIFECYCLE.Hook(phase, f, this.ModuleID());\n  }\n} // end UnisysModule\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UnisysModule;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  UNISYS NETWORK implements network controls and synchronization.\n  It initializes a network connection on the CONNECT lifecycle.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst SETTINGS = require('settings');\nconst NetMessage = require('unisys/common-netmessage-class');\nconst DEFS = require('./common-defs');\nconst PROMPTS = require('system/util/prompts');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = { connect: true, handle: false };\nconst PR = PROMPTS.Pad('NETWORK');\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst WARN = PROMPTS.Pad('!!!');\nconst ERR_NM_REQ = 'arg1 must be NetMessage instance';\nconst ERR_NO_SOCKET = 'Network socket has not been established yet';\nconst ERR_BAD_UDATA = \"An instance of 'client-datalink-class' is required\";\n\n/// GLOBAL NETWORK INFO (INJECTED ON INDEX) ///////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar NETSOCK = SETTINGS.EJSProp('socket');\nvar NETCLIENT = SETTINGS.EJSProp('client');\nvar NETSERVER = SETTINGS.EJSProp('server');\n\n/// NETWORK ID VALUES /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst M0_INIT = 0;\nconst M1_CONNECTING = 1;\nconst M2_CONNECTED = 2;\nconst M3_REGISTERED = 3;\nconst M4_READY = 4;\nconst M_STANDALONE = 5;\nconst M_NOCONNECT = 6;\nvar m_status = M0_INIT;\nvar m_options = {};\n\n// heartbeat\nvar m_hearbeat_timer;\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar NETWORK = {};\nvar UDATA = null; // assigned during NETWORK.Connect()\n\n/// CONNECT ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Establish connection to UNISYS server. This is called by client.js during\n    NetworkInitialize(), which itself fires after the application has rendered\n    completely.\n */\nNETWORK.Connect = function (datalink, opt) {\n  // special case: STANDALONE mode is set by a different set of magical\n  // window.NC_UNISYS properties\n  if (window.NC_UNISYS.server.ip === 'standalone') {\n    m_status = M_STANDALONE;\n    console.warn(PR, 'STANDALONE MODE: NETWORK.Connect() suppressed!');\n    NetMessage.GlobalOfflineMode();\n    if (typeof opt.success === 'function') opt.success();\n    return;\n  }\n  // if multiple network connections occur, emit warning\n  // warning: don't modify this unless you have a deep knowledge of how\n  // the webapp system works or you might break something\n  if (m_status > 0) {\n    let err = 'called twice...other views may be calling UNISYS outside of lifecycle';\n    console.error(WARN, err);\n    return;\n  }\n  m_status = M1_CONNECTING;\n\n  // check and save parms\n  if (datalink.constructor.name !== 'UnisysDataLink') {\n    throw Error(ERR_BAD_UDATA);\n  }\n  if (!UDATA) UDATA = datalink;\n  m_options = opt || {};\n\n  // create websocket\n  // uses values that were embedded in index.ejs on load\n  let wsURI = `ws://${NETSOCK.uaddr}:${NETSOCK.uport}`;\n  NETSOCK.ws = new WebSocket(wsURI);\n\n  // create listeners\n  NETWORK.AddListener('open', function (event) {\n    if (DBG.connect) console.log(PR, 'connecting to', event.target.url);\n    m_status = M2_CONNECTED;\n    // message handling continues in 'message' handler\n    // the first message is assumed to be registration data\n  });\n  NETWORK.AddListener('close', function (event) {\n    if (DBG.connect) console.log(PR, 'closed', event.target.url);\n    NetMessage.GlobalOfflineMode();\n    m_status = M_STANDALONE;\n  });\n  // handle socket errors\n  NETWORK.AddListener('error', function (event) {\n    /** DSHACK: For Spring 2019, adding manifest support to try to\n        avoid rewriting the app with service workers\n     */\n    let appCache = window.applicationCache;\n    switch (appCache.status) {\n      case appCache.UNCACHED:\n        // this occurs if there is not a cached page\n        console.warn(WARN, 'ERROR opening command socket', event);\n        throw Error('error with command socket');\n      case appCache.IDLE: /* falls-through */\n      case appCache.CHECKING: /* falls-through */\n      case appCache.DOWNLOADING: /* falls-through */\n      case appCache.UPDATEREADY: /* falls-through */\n      case appCache.OBSOLETE:\n        // this occurs\n        console.info(WARN, 'STANDALONE MODE. USING CACHED DATA');\n        m_status = M_STANDALONE;\n        NetMessage.GlobalOfflineMode(); // deregister socket\n        // force promise to succeed\n        if (typeof m_options.success === 'function') m_options.success();\n        break;\n      default:\n        m_status = M_NOCONNECT;\n        throw Error('unknown appcache status. dumping', appCache);\n    }\n  });\n  // handle incoming messages\n  NETWORK.AddListener('message', m_HandleRegistrationMessage);\n}; // Connect()\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** After 'open' event, we expect the first message on the socket to contain\n    network session-related messages\n */\nfunction m_HandleRegistrationMessage(msgEvent) {\n  let regData = JSON.parse(msgEvent.data);\n  let { HELLO, UADDR } = regData;\n  // (1) after receiving the initial message, switch over to regular\n  // message handler\n  NETWORK.RemoveListener('message', m_HandleRegistrationMessage);\n  m_status = M3_REGISTERED;\n  // (2) initialize global settings for netmessage\n  if (DBG.connect) console.log(`${PR} connected as %c${UADDR}`, 'color:red');\n  NETSOCK.ws.UADDR = NetMessage.DefaultServerUADDR();\n  NetMessage.GlobalSetup({ uaddr: UADDR, netsocket: NETSOCK.ws });\n  // (3) connect regular message handler\n  NETWORK.AddListener('message', m_HandleMessage);\n  m_status = M4_READY;\n  // (4) network is initialized\n  if (typeof m_options.success === 'function') m_options.success();\n  // (5) initialize heartbeat timer\n  m_ResetHearbeatTimer();\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** When a heartbeat ping is received, respond with a pong to let the server\n    know that we're still alive.\n */\nfunction m_RespondToHeartbeat() {\n  if (NETSOCK.ws.readyState === NETSOCK.ws.OPEN) {\n    NETSOCK.ws.send('pong', err => {\n      if (err) console.log(PR, 'error \"', err, '\" while sending response pong');\n    });\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** If a 'hearbeat' message is not received from the server every 5 seconds\n    we assume the network connection has gone down.  The timeout should be\n    greater than the server heartbeat interval set in\n    server-network.js:m_StartHeartbeat()\n\n    The UNISYSDisconnect handler only goes down when the server closes the\n    connection.  In order to detect the internet connection going down\n    (e.g. wifi) we need to check to see if we are peridically receiving\n    a heartbeat message from the server.\n */\nfunction m_ResetHearbeatTimer() {\n  clearTimeout(m_hearbeat_timer);\n  m_hearbeat_timer = setTimeout(function heartbeatStopped() {\n    if (DBG.handle)\n      console.log(\n        PR,\n        'ping heartbeat not received from server before time ran out -- YOURE DEAD!'\n      );\n    NetMessage.GlobalOfflineMode({ message: 'Client Disconnected' });\n  }, DEFS.SERVER_HEARTBEAT_INTERVAL * 2);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_HandleMessage(msgEvent) {\n  // Check Hearbeat\n  if (msgEvent.data === 'ping') {\n    if (DBG.handle) console.log(PR, '...got hearbeat!  Reset timer');\n    m_RespondToHeartbeat();\n    m_ResetHearbeatTimer();\n    return;\n  }\n\n  // Handle Regular Message\n  let pkt = new NetMessage(msgEvent.data);\n  let msg = pkt.Message();\n  if (pkt.IsOwnResponse()) {\n    if (DBG.handle) console.log(PR, 'completing transaction', msg);\n    pkt.CompleteTransaction();\n    return;\n  }\n  let data = pkt.Data();\n  let type = pkt.Type();\n  let dbgout = DBG.handle && !msg.startsWith('SRV_');\n  /// otherwise, incoming invocation from network\n  switch (type) {\n    case 'state':\n      if (dbgout) console.log(PR, 'received state change', msg);\n      break;\n    case 'msig':\n      if (dbgout) {\n        console.warn(\n          PR,\n          `ME_${NetMessage.SocketUADDR()} received msig '${msg}' from ${pkt.SourceAddress()}`,\n          data\n        );\n      }\n      UDATA.LocalSignal(msg, data);\n      pkt.ReturnTransaction();\n      break;\n    case 'msend':\n      if (dbgout) {\n        console.warn(\n          PR,\n          `ME_${NetMessage.SocketUADDR()} received msend '${msg}' from ${pkt.SourceAddress()}`,\n          data\n        );\n      }\n      UDATA.LocalSend(msg, data);\n      pkt.ReturnTransaction();\n      break;\n    case 'mcall':\n      if (dbgout) {\n        console.warn(\n          PR,\n          `ME_${NetMessage.SocketUADDR()} received mcall '${msg}' from ${pkt.SourceAddress()}`\n        );\n      }\n      UDATA.LocalCall(msg, data).then(result => {\n        if (dbgout) {\n          console.log(\n            `ME_${NetMessage.SocketUADDR()} forwarded '${msg}', returning ${JSON.stringify(\n              result\n            )}`\n          );\n        }\n        // now return the packet\n        pkt.SetData(result);\n        pkt.ReturnTransaction();\n      });\n      break;\n    default:\n      throw Error('unknown packet type', type);\n  }\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Send a packet on socket connection, assuming it is valid\n */\nNETWORK.Send = function (pkt) {\n  if (!(pkt instanceof NetMessage)) throw Error(ERR_NM_REQ);\n  if (NETSOCK.ws.readyState === 1) {\n    let json = pkt.JSON();\n    if (DBG) console.log('SENDING', pkt.Message(), pkt.Data(), pkt.SeqNum());\n    NETSOCK.ws.send(json);\n  } else {\n    console.log('Socket not ReadyState 1, is', NETSOCK.ws.readyState);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Send a packet on socket connection, return Promise\n */\nNETWORK.Call = function (pkt) {\n  if (!(pkt instanceof NetMessage)) throw Error(ERR_NM_REQ);\n  if (NETSOCK.ws.readyState === 1) {\n    let json = pkt.JSON();\n    if (DBG) console.log('CALLING', pkt.Message(), json);\n    NETSOCK.ws.send(json);\n  } else {\n    console.log('Socket not ReadyState 1, is', NETSOCK.ws.readyState);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Force close of connection, for example if UNISYS.AppReady() fails\n */\nNETWORK.Close = function (code, reason) {\n  code = code || 1000;\n  reason = reason || 'unisys forced close';\n  NETSOCK.ws.close(code, reason);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.AddListener = function (event, handlerFunction) {\n  if (NETSOCK.ws instanceof WebSocket) {\n    NETSOCK.ws.addEventListener(event, handlerFunction);\n  } else {\n    throw Error(ERR_NO_SOCKET);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.RemoveListener = function (event, handlerFunction) {\n  if (NETSOCK.ws instanceof WebSocket) {\n    NETSOCK.ws.removeEventListener(event, handlerFunction);\n  } else {\n    throw Error(ERR_NO_SOCKET);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.LocalInfo = function () {\n  return NETCLIENT;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.ServerInfo = function () {\n  return NETSERVER;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.ServerSocketInfo = function () {\n  return NETSOCK;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.SocketUADDR = function () {\n  return NetMessage.SocketUADDR();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNETWORK.IsStandaloneMode = function () {\n  return m_status === M_STANDALONE;\n};\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NETWORK;\n","/* eslint-disable no-debugger */\n/* eslint-disable no-alert */\nif (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Add UNISYS functions to REACT component to hide UDATA and UMODULE details\n  To use, extend components from UNISYS.Component instead of REACT.Component\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UDATA = require('unisys/client-datalink-class');\nconst UMODULE = require('unisys/client-module-class');\nconst REFLECT = require('system/util/reflection');\n\n/// CLASS DECLARATION /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass UnisysComponent extends React.Component {\n  constructor() {\n    super();\n    this.UMODULE = new UMODULE(module.id);\n    this.UDATA = new UDATA(this.UMODULE);\n  }\n\n  /// MESSAGE HANDLING API METHODS\n  HandleMessage(m, lis) {\n    this.UDATA.HandleMessage(m, lis);\n  }\n  UnhandleMessage(m, lis) {\n    f_deprecated('DropMessage');\n    this.UDATA.UnhandleMessage(m, lis);\n  }\n  DropMessage(m, lis) {\n    this.UDATA.UnhandleMessage(m, lis);\n  }\n\n  /// SPECIAL EVENTS\n  OnDOMReady(lis) {\n    this.UMODULE.Hook('DOM_READY', lis);\n  }\n  OnReset(lis) {\n    this.UMODULE.Hook('RESET', lis);\n  }\n  OnStart(lis) {\n    this.UMODULE.Hook('START', lis);\n  }\n  OnAppReady(lis) {\n    this.UMODULE.Hook('APP_READY', lis);\n  }\n  OnRun(lis) {\n    this.UMODULE.Hook('RUN', lis);\n  }\n  OnDisconnect(lis) {\n    this.UMODULE.Hook('DISCONNECT', lis);\n  }\n\n  /// MESSAGE INVOCATION API METHODS\n  Call(m, d, o) {\n    return this.UDATA.Call(m, d, o);\n  }\n  Send(m, d, o) {\n    this.UDATA.Send(m, d, o);\n  }\n  Signal(m, d, o) {\n    this.UDATA.Signal(m, d, o);\n  }\n  AppCall(m, d, o) {\n    return this.UDATA.LocalCall(m, d, o);\n  }\n  AppSend(m, d, o) {\n    this.UDATA.LocalSend(m, d, o);\n  }\n  AppSignal(m, d, o) {\n    this.UDATA.LocalSignal(m, d, o);\n  }\n  NetSend(m, d, o) {\n    this.UDATA.NetSend(m, d, o);\n  }\n  NetCall(m, d, o) {\n    return this.UDATA.NetCall(m, d, o);\n  }\n  NetSignal(m, d, o) {\n    this.UDATA.NetSignal(m, d, o);\n  }\n  LocalCall(m, d, o) {\n    f_deprecated('AppCall');\n    return this.UDATA.LocalCall(m, d, o);\n  }\n  LocalSend(m, d, o) {\n    f_deprecated('AppSend');\n    this.UDATA.LocalSend(m, d, o);\n  }\n  LocalSignal(m, d, o) {\n    f_deprecated('AppSignal');\n    this.UDATA.LocalSignal(m, d, o);\n  }\n  /// STATE API METHODS\n  State(ns) {\n    f_deprecated('AppState');\n    return this.AppState(ns);\n  }\n  SetState(ns, so) {\n    f_deprecated('SetAppState');\n    this.SetAppState(ns, so);\n  }\n  OnStateChange(ns, lis) {\n    f_deprecated('OnAppStateChange');\n    this.OnAppStateChange(ns, lis);\n  }\n  OffStateChange(ns, lis) {\n    f_deprecated('AppStateChangeOff');\n    this.AppStateChangeOff(ns, lis);\n  }\n  /// NEW STATE API METHODS\n  AppState(ns) {\n    return this.UDATA.AppState(ns);\n  }\n  SetAppState(ns, so) {\n    this.UDATA.SetAppState(ns, so);\n  }\n  OnAppStateChange(ns, lis) {\n    this.UDATA.OnAppStateChange(ns, lis);\n  }\n  AppStateChangeOff(ns, lis) {\n    this.UDATA.AppStateChangeOff(ns, lis);\n  }\n  NetState(ns) {\n    f_unimplemented();\n  }\n  SetNetState(ns, so) {\n    f_unimplemented();\n  }\n  OnNetStateChange(ns, lis) {\n    f_unimplemented();\n  }\n  NetStateChangeOff(ns, lis) {\n    f_unimplemented();\n  }\n  /// LIFECYCLE API\n  Hook(p, f) {\n    f_unsupported('is not available for UNISYS.Component');\n  }\n} // UnisysComponent\n\nfunction f_deprecated(repl) {\n  let out = `${REFLECT.FunctionName(2)} is deprecated.`;\n  if (typeof repl === 'string') out += ` Use ${repl}() instead.`;\n  console.warn(out);\n}\n\nfunction f_unimplemented() {\n  let out = `${REFLECT.FunctionName(2)} is not yet implemented.`;\n  alert(`${out}\\n\\nCrashing now! Use javascript console to debug`);\n  console.error(out);\n  debugger;\n}\n\nfunction f_unsupported(reason) {\n  let out = `${REFLECT.FunctionName(2)} ${reason}`;\n  alert(`${out}\\n\\nCrashing now! Use javascript console to debug`);\n  console.error(out);\n  debugger;\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UnisysComponent;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  UNISYS STATE CLASS\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst REACT = require('react');\nconst TYPEOF = require('type-detect');\nconst Messager = require('unisys/client-messager-class');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst BAD_NSPACE = 'namespace must be string without _ chars';\nconst BAD_LISTENR = 'listener must be function';\nconst NO_UID_FLTR =\n  'UNISYS.OnStateChange: pass DST_UID parameter to enable echo cancellation';\nconst WARN_PROP_MISMATCH = 'MergeState is changing a property type';\n\n/// MODULE DECLARATIONS ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar USTATE = {};\nvar STATES = new Map(); // namespace str => shallow state object\nvar STATES_LISTEN = new Map(); // namespace str => emitter\n\n/// STATE /////////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** UNISYS namespaces are transformed to uppercase.\n    A namespace must be a string that does not contain reserved char '_'\n */\nfunction m_ConformNamespace(namespace) {\n  // must be a string\n  if (typeof namespace !== 'string') return undefined;\n  // disallow empty string\n  if (!namespace) return undefined;\n  // always uppercase\n  namespace = namespace.toUpperCase();\n  // expand * shortcut to _ROOT\n  if (namespace === '*') return '_ROOT';\n  // disallow _ reserved names\n  if (namespace.indexOf('_') > -1) return undefined;\n  // ok we're good\n  return namespace;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Used for merging and concatenating state, when a simple copy-overwrite\n    simply will not do.\n */\nfunction m_ConformState(namespace, newState, opt) {\n  opt = opt || { merge: true };\n  // make a copy of the old state\n  let state = Object.assign({}, STATES.get(namespace));\n  if (DBG) console.log(`merging state namespace '${namespace}' with`, newState);\n\n  // iterate over all properties in newState and merge them\n  // accordingly. This is *NOT* a deep merge.\n  Object.entries(newState).forEach(entry => {\n    let k = entry[0]; // current prop name in newstate\n    let v = entry[1]; // current prop value in newstate\n    let prop = state[k], // old prop value\n      nprop = v, // new prop value\n      t_old, // type to be filled-in\n      t_new;\n\n    // use type-detect library to get type\n    t_old = TYPEOF(prop);\n    t_new = TYPEOF(nprop);\n\n    // A BUNCH OF SPECIAL CASE CHECKS //\n    if (t_old === 'undefined' || t_old === 'null') {\n      // if the value doesn't exist in current state\n      // just update with new prop\n      prop = nprop;\n    } else if (t_old === t_new) {\n      // if there is a type match, then figure\n      // out how to merge based on type\n      switch (t_old) {\n        case 'Object':\n          if (DBG) console.log(`merge objects`);\n          // merge object props\n          prop = Object.assign(prop, nprop);\n          break;\n        case 'Array': // note uppercase (type-detect)\n          if (DBG) console.log(`merge arrays`);\n          // merge arrays no dupes (https://stackoverflow.com/a/36469404)\n          // ES6 fanciness using destructuring (...) and Sets\n          if (opt.merge) prop = [...new Set([...prop, ...nprop])];\n          else if (opt.concat) prop = prop.concat(nprop);\n          break;\n        default:\n          if (DBG) console.log(`copy values`);\n          // just overwrite otherwise\n          prop = nprop;\n      } // end switch t_old\n    } else {\n      // if there is a type mismatch, write\n      console.warn(\n        `${WARN_PROP_MISMATCH} key:${k}\\n type '${t_new}' overwriting '${t_old}'`\n      );\n      prop = nprop;\n    }\n    // update state place\n    state[k] = prop;\n  }); // end Object.entries\n\n  return state;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Retrieve the emitter associated with a namespace, which contains handles\n    all the listeners associated with a namespace. Always returns a valid\n    emitter, creating it if the passed namespace is valid.\n */\nfunction m_GetStateMessager(nspace) {\n  nspace = m_ConformNamespace(nspace);\n  if (!nspace) throw Error(BAD_NSPACE);\n  let msgr = STATES_LISTEN.get(nspace);\n  if (!msgr) {\n    msgr = new Messager();\n    STATES_LISTEN.set(nspace, msgr);\n  }\n  return msgr;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: update the selected namespace state with new state\n */\nUSTATE.SetState = (namespace, newState, src_uid) => {\n  namespace = m_ConformNamespace(namespace);\n  if (!namespace) throw Error(BAD_NSPACE);\n  // update old state by partially overwrite of state\n  if (!STATES.has(namespace)) STATES.set(namespace, {});\n  // NOTE Because we're using Object.assign:\n  // * Objects already in the state will remain in the state\n  //   if not overwritten by newState.  This can result in\n  //   the mysterious re-appearance of old paramters.\n  // * No deep clones\n  Object.assign(STATES.get(namespace), newState);\n  // forward new state to namespace listeners\n  let msgr = m_GetStateMessager(namespace);\n  // don't pass with source_id because state should go everywhere\n  // a register exists, even if it's the originating module\n  msgr.Send(namespace, newState, { type: 'state', toLocal: true, toNet: false });\n  // future: forward also to network\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: merge objects and arrays in state\n */\nUSTATE.MergeState = (namespace, newState, src_uid) => {\n  namespace = m_ConformNamespace(namespace);\n  if (!namespace) throw Error(BAD_NSPACE);\n  // update old state by partially overwrite of state\n  if (!STATES.has(namespace)) STATES.set(namespace, {});\n\n  // merge the states with no duplicates in arrays\n  let state = m_ConformState(namespace, newState, { merge: true });\n\n  // update the namespace\n  STATES.set(namespace, state);\n\n  // forward new state to namespace listeners\n  let msgr = m_GetStateMessager(namespace);\n  // don't pass with source_id because state should go everywhere\n  // a register exists, even if it's the originating module\n  msgr.Send(namespace, newState, { type: 'state', toLocal: true, toNet: false });\n  // future: forward also to network\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: merge objects and concat arrays in state\n */\nUSTATE.ConcatState = (namespace, newState, src_uid) => {\n  namespace = m_ConformNamespace(namespace);\n  if (!namespace) throw Error(BAD_NSPACE);\n  // update old state by partially overwrite of state\n  if (!STATES.has(namespace)) STATES.set(namespace, {});\n\n  // merge the states with no duplicates in arrays\n  let state = m_ConformState(namespace, newState, { concat: true });\n\n  // update the namespace\n  STATES.set(namespace, state);\n\n  // forward new state to namespace listeners\n  let msgr = m_GetStateMessager(namespace);\n  // don't pass with source_id because state should go everywhere\n  // a register exists, even if it's the originating module\n  msgr.Send(namespace, newState, { type: 'state', toLocal: true, toNet: false });\n  // future: forward also to network\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: retrieve a COPY of state object of namespace\n */\nUSTATE.State = namespace => {\n  namespace = m_ConformNamespace(namespace);\n  if (!namespace) throw Error(BAD_NSPACE);\n  return Object.assign({}, STATES.get(namespace));\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: subscribe to namestate updates\n */\nUSTATE.OnStateChange = (namespace, listener, src_uid) => {\n  namespace = m_ConformNamespace(namespace);\n  if (!namespace) throw Error(BAD_NSPACE);\n  if (typeof listener !== 'function') throw Error(BAD_LISTENR);\n  if (src_uid === undefined) console.warn(NO_UID_FLTR);\n  let namespaceMessager = m_GetStateMessager(namespace);\n  namespaceMessager.HandleMessage(namespace, listener, { handlerUID: src_uid });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: unsubscribe to namestate updates\n */\nUSTATE.OffStateChange = (namespace, listener) => {\n  namespace = m_ConformNamespace(namespace);\n  if (!namespace) throw Error(BAD_NSPACE);\n  if (typeof listener !== 'function') throw Error(BAD_LISTENR);\n  let namespaceMessager = m_GetStateMessager(namespace);\n  namespaceMessager.UnhandleMessage(namespace, listener);\n};\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = USTATE;\n","/* eslint-disable no-debugger */\nif (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  This is the main browser client UNISYS module, which implements:\n\n    LIFECYCLE - a promise-based hooked run order system\n    MESSAGING - a networked remote procedure call/event system\n    STATE     - a networked global application state system\n\n  UNISYS is designed to work with React or our own module system:\n  for modules:\n    UMOD = UNISYS.NewModule()\n    UDATA = UNISYS.NewDataLink(UMOD)\n  for React:\n    COMPONENT = class MyComponent extends UNISYS.Component\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\n/// CLASSES ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UniData = require('unisys/client-datalink-class');\nconst UniModule = require('unisys/client-module-class');\nconst UniComponent = require('unisys/client-react-component');\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SETTINGS = require('settings');\nconst LIFECYCLE = require('unisys/client-lifecycle');\nconst STATE = require('unisys/client-state');\nconst NETWORK = require('unisys/client-network');\nconst PROMPTS = require('system/util/prompts');\nconst PR = PROMPTS.Pad('UNISYS');\n\n/// INITIALIZE MAIN MODULE ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar UNISYS = new UniModule(module.id);\nvar UDATA = new UniData(UNISYS);\n\n/// UNISYS MODULE MAKING //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Make new module with UNISYS convenience methods */\nUNISYS.NewModule = uniqueName => {\n  return new UniModule(uniqueName);\n};\n\n/// UNISYS CONNECTOR //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Make new module with UNISYS convenience methods */\nUNISYS.NewDataLink = (module, optName) => {\n  return new UniData(module, optName);\n};\n\n/// UNISYS MESSAGE REGISTRATION ///////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nUNISYS.RegisterMessagesPromise = (messages = []) => {\n  if (NETWORK.IsStandaloneMode()) {\n    console.warn(PR, 'STANDALONE MODE: RegisterMessagesPromise() suppressed!');\n    return Promise.resolve();\n  }\n  if (messages.length) {\n    try {\n      messages = UniData.ValidateMessageNames(messages);\n    } catch (e) {\n      console.error(e);\n    }\n  } else {\n    messages = UniData.MessageNames();\n  }\n  return new Promise((resolve, reject) => {\n    UDATA.Call('SRV_REG_HANDLERS', { messages }).then(data => {\n      resolve(data);\n    });\n  });\n};\n\n/// LIFECYCLE METHODS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: LIFECYCLE Hook() functions */\nUNISYS.Hook = (phase, f) => {\n  if (typeof phase !== 'string') throw Error('arg1 is phase as string');\n  if (typeof f !== 'function') throw Error('arg2 is function callback');\n  LIFECYCLE.Hook(phase, f, UNISYS.ModuleID()); // pass phase and hook function\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: return the current phase (useful for debugging internals) */\nUNISYS.CurrentPhase = () => {\n  return LIFECYCLE.CurrentPhase();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: System Initialize */\nUNISYS.SystemInitialize = module_id => {\n  UNISYS.SetScope(module_id);\n  SETTINGS.ForceReloadSingleApp();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API HELPER: LIFECYCLE Scope() functions\n    The 'scope' is used by LIFECYCLE to determine what modules implementing\n    various HOOKS will be called. The root_module_id is a path that will\n    be considered the umbrella of \"allowed to hook\" modules. For REACT apps,\n    this is the root directory of the root view component. Additionally,\n    the unisys and system directories are allowed to run their hooks\n */\nUNISYS.SetScope = root_module_id => {\n  LIFECYCLE.SetScope(root_module_id); // pass phase and hook function\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API HELPER: SETTINGS ForceReloadSingleApp\n    checks to see if settings flag is \"dirty\"; if it is, then reload the\n    location to ensure no lingering apps are running in the background. Yes\n    this is a bit of a hack.\n */\nUNISYS.IsReloadRequired = () => {\n  SETTINGS.IsReloadRequired();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API HELPER: return TRUE if passed module.id is within the current set\n    scope\n */\nUNISYS.InScope = module_id => {\n  let currentScope = LIFECYCLE.Scope();\n  return module_id.includes(currentScope);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: application startup\n */\nUNISYS.EnterApp = async () => {\n  try {\n    await LIFECYCLE.Execute('TEST_CONF'); // TESTCONFIG hook\n    await LIFECYCLE.Execute('INITIALIZE'); // INITIALIZE hook\n    await LIFECYCLE.Execute('LOADASSETS'); // LOADASSETS hook\n    await LIFECYCLE.Execute('CONFIGURE'); // CONFIGURE support modules\n  } catch (e) {\n    console.error(\n      'EnterApp() Lifecycle Error. Check phase execution order effect on data validity.\\n',\n      e\n    );\n    debugger;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: call this when the view system's DOM has stabilized and is ready\n    for manipulation by other code\n */\nUNISYS.SetupDOM = async () => {\n  try {\n    await LIFECYCLE.Execute('DOM_READY'); // GUI layout has finished composing\n  } catch (e) {\n    console.error(\n      'SetupDOM() Lifecycle Error. Check phase execution order effect on data validity.\\n',\n      e\n    );\n    debugger;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: network startup\n */\nUNISYS.JoinNet = () => {\n  return new Promise((resolve, reject) => {\n    try {\n      NETWORK.Connect(UDATA, { success: resolve, failure: reject });\n    } catch (e) {\n      console.error(\n        'EnterNet() Lifecycle Error. Check phase execution order effect on data validity.\\n',\n        e\n      );\n      debugger;\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: configure system before run\n */\nUNISYS.SetupRun = async () => {\n  try {\n    await LIFECYCLE.Execute('RESET'); // RESET runtime datastructures\n    await LIFECYCLE.Execute('START'); // START running\n    await LIFECYCLE.Execute('APP_READY'); // tell network APP_READY\n    await LIFECYCLE.Execute('RUN'); // tell network APP_READY\n  } catch (e) {\n    console.error(\n      'SetupRun() Lifecycle Error. Check phase execution order effect on data validity.\\n',\n      e\n    );\n    // debugger;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: handle periodic updates for a simulation-driven timestep\n */\nUNISYS.Run = async () => {\n  try {\n    await LIFECYCLE.Execute('UPDATE');\n  } catch (e) {\n    console.error(e);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n */\nUNISYS.BeforePause = async () => {\n  await LIFECYCLE.Execute('PREPAUSE');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n */\nUNISYS.Paused = async () => {\n  await LIFECYCLE.Execute('PAUSE');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n */\n\nUNISYS.PostPause = async () => {\n  await LIFECYCLE.Execute('POSTPAUSE');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: do the Shutdown lifecycle\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n */\nUNISYS.CleanupRun = async () => {\n  await LIFECYCLE.Execute('STOP');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: application offline\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n */\nUNISYS.ServerDisconnect = async () => {\n  await LIFECYCLE.Execute('DISCONNECT');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: application shutdown\n    NOTE ASYNC ARROW FUNCTION (necessary?)\n */\nUNISYS.ExitApp = async () => {\n  await LIFECYCLE.Execute('UNLOADASSETS');\n  await LIFECYCLE.Execute('SHUTDOWN');\n};\n\n/// NETWORK INFORMATION ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** return the current connected Socket Address (e.g. UADDR_12)\n */\n\nUNISYS.SocketUADDR = () => {\n  return NETWORK.SocketUADDR();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nUNISYS.IsStandaloneMode = () => {\n  return NETWORK.IsStandaloneMode();\n};\n\n/// DATA LOGGING //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** send a logging message\n */\nUNISYS.Log = (event, ...items) => {\n  if (typeof event !== 'string') {\n    console.error(\"UNISYS.Log( 'eventString', value, value, value... )\");\n  }\n  UDATA.NetSignal('SRV_LOG_EVENT', { event, items });\n};\n\n/// REACT INTEGRATION /////////////////////////////////////////////////////////\n/** return the referene to the UNISYS extension of React.Component\n */\nUNISYS.Component = UniComponent;\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UNISYS;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Store common system definitions here between client and server modules.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar DEFS = {};\nDEFS.SERVER_HEARTBEAT_INTERVAL = 5000; // ms\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = DEFS;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  NetMessage objects are sent between the browser and server as part of the\n  UNISYS messaging system. Unlike NetMessages of the previous version of STEP,\n  a NetMessage does not require addressing since the SERVER distributes\n  messages to UNISYS addresses that have registered for them.\n\n  The NetMessage declaration is SHARED in both node and browser javascript\n  codebases.\n\n  NetMessages also provide the data context for \"transactions\" of calls.\n  The netmessage_id and data packet are used by the originating webapp\n  to remember a sequence of callback functions. When a NetMessage is\n  received with a seq_num > 0, it's assumed to be a return transaction,\n  and its callback chain can be invoked. The data is forwarded to the\n  callback. For more details, see the CallSequence class that manages\n  the passing of data.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = { send: false, transact: false };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar m_id_counter = 0;\nvar m_id_prefix = 'PKT';\nvar m_transactions = {};\nvar m_netsocket = null;\nvar m_group_id = null;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst M_INIT = 'init';\nconst M_ONLINE = 'online';\nconst M_STANDALONE = 'offline';\nconst M_CLOSED = 'closed';\n// const M_ERROR = 'error';\nvar m_mode = M_INIT;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PROMPTS = require('../system/util/prompts');\nconst PR = PROMPTS.Pad('PKT');\nconst ERR = ':ERR:';\nconst ERR_NOT_NETMESG = ERR + PR + 'obj does not seem to be a NetMessage';\nconst ERR_BAD_PROP = ERR + PR + 'property argument must be a string';\nconst ERR_ERR_BAD_CSTR = ERR + PR + 'constructor args are string, object';\nconst ERR_BAD_SOCKET = ERR + PR + 'sender object must implement send()';\nconst ERR_DUPE_TRANS = ERR + PR + 'this packet transaction is already registered!';\n// const ERR_NO_GLOB_UADDR = ERR + PR + 'packet sending attempted before UADDR is set!';\nconst ERR_UNKNOWN_TYPE = ERR + PR + 'packet type is unknown:';\nconst ERR_NOT_PACKET = ERR + PR + 'passed object is not a NetMessage';\nconst ERR_UNKNOWN_RMODE = ERR + PR + 'packet routine mode is unknown:';\nconst KNOWN_TYPES = ['msend', 'msig', 'mcall', 'state'];\nconst ROUTING_MODE = ['req', 'res'];\n\n/// UNISYS NETMESSAGE CLASS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** A UNetMessage encapsulates a specific message and data payload for sending\n    across the network.\n */\nclass NetMessage {\n  constructor(msg, data, type) {\n    // OPTION 1\n    // create NetMessage from (generic object)\n    if (typeof msg === 'object' && data === undefined) {\n      // make sure it has a msg and data obj\n      if (typeof msg.msg !== 'string' || typeof msg.data !== 'object') {\n        console.log('bad message object', JSON.stringify(msg));\n        throw ERR_NOT_NETMESG;\n      }\n      // merge properties into this new class instance and return it\n      Object.assign(this, msg);\n      m_SeqIncrement(this);\n      return this;\n    }\n    // OPTION 2\n    // create NetMessage from JSON-encoded string\n    if (typeof msg === 'string' && data === undefined) {\n      let obj = JSON.parse(msg);\n      Object.assign(this, obj);\n      m_SeqIncrement(this);\n      return this;\n    }\n    // OPTION 3\n    // create new NetMessage from scratch (mesg,data)\n    // unique id for every NetMessage\n    if (typeof type === 'string') m_CheckType(type);\n    if (typeof msg !== 'string' || typeof data !== 'object') {\n      throw ERR_ERR_BAD_CSTR;\n    }\n    // allow calls with null data by setting to empty object\n    this.data = data || {};\n    this.msg = msg;\n    // id and debugging memo support\n    this.id = this.MakeNewID();\n    this.rmode = ROUTING_MODE[0]; // is default 't_req' (trans request)\n    this.type = type || KNOWN_TYPES[0]; // is default 'msend' (no return)\n    this.memo = '';\n    // transaction support\n    this.seqnum = 0; // positive when part of transaction\n    this.seqlog = []; // transaction log\n    // addressing support\n    this.s_uaddr = NetMessage.SocketUADDR() || null; // first originating uaddr set by SocketSend()\n    this.s_group = null; // session groupid is set by external module once validated\n    this.s_uid = null; // first originating UDATA srcUID\n    // filtering support\n  } // constructor\n\n  /// ACCESSSOR METHODS ///////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** returns the type\n   */\n  Type() {\n    return this.type;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** returns true if type matches\n   */\n  IsType(type) {\n    return this.type === type;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** returns the type\n   */\n  SetType(type) {\n    this.type = m_CheckType(type);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** returns the message\n   */\n  Message() {\n    return this.msg;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** sets the message field\n   */\n  SetMessage(msgstr) {\n    this.msg = msgstr;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** returns the entire data payload or the property within the data payload\n      (can return undefined if property doesn't exist)\n   */\n  Data(prop) {\n    if (!prop) return this.data;\n    if (typeof prop === 'string') return this.data[prop];\n    throw ERR_BAD_PROP;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** convenience method to set data object entirely\n   */\n  SetData(propOrVal, val) {\n    if (typeof propOrVal === 'object') {\n      this.data = propOrVal;\n      return;\n    }\n    if (typeof propOrVal === 'string') {\n      this.data[propOrVal] = val;\n      return;\n    }\n    throw ERR_BAD_PROP;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** returns truthy value (this.data) if the passed msgstr matches the\n      message associated with this NetMessage\n   */\n  Is(msgstr) {\n    return msgstr === this.msg ? this.data : undefined;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** convenience function return true if server message\n   */\n  IsServerMessage() {\n    return this.msg.startsWith('SRV_');\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** getter/setter for the memo description field\n   */\n  Memo() {\n    return this.memo;\n  }\n  SetMemo(memo) {\n    this.memo = memo;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** convenience function to return JSON version of this object\n   */\n  JSON() {\n    return JSON.stringify(this);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** return the session groupid (CLASS-PROJ-HASH) that's been set globally\n   */\n  SourceGroupID() {\n    return this.s_group;\n  }\n\n  /// TRANSACTION SUPPORT /////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** The sequence number is positive if this packet is reused\n   */\n  SeqNum() {\n    return this.seqnum;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Return the originating address of this netmessage packet. It is valid\n      only after the packet has been sent at least once.\n   */\n  SourceAddress() {\n    // is this packet originating from server to a remote?\n    if (\n      this.s_uaddr === NetMessage.DefaultServerUADDR() &&\n      !this.msg.startsWith('SVR_')\n    ) {\n      return this.s_uaddr;\n    }\n    // this is a regular message forward to remote handlers\n    return this.IsTransaction() ? this.seqlog[0] : this.s_uaddr;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  CopySourceAddress(pkt) {\n    if (pkt.constructor.name !== 'NetMessage') throw Error(ERR_NOT_PACKET);\n    this.s_uaddr = pkt.SourceAddress();\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** return an informational string about the packet useful for logging\n   */\n  Info(key) {\n    switch (key) {\n      case 'src': /* falls-through */\n      default:\n        return this.SourceGroupID()\n          ? `${this.SourceAddress()} [${this.SourceGroupID()}]`\n          : `${this.SourceAddress()}`;\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** return an informational Object about the packet useful for logging\n   *  Used to provide a predictable format for Research Logging\n   */\n  InfoObj(key) {\n    switch (key) {\n      case 'src': /* falls-through */\n      default:\n        return this.SourceGroupID()\n          ? { uaddr: this.SourceAddress(), group: this.SourceGroupID() }\n          : { uaddr: this.SourceAddress(), group: undefined };\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  MakeNewID() {\n    let idStr = (++m_id_counter).toString();\n    this.id = m_id_prefix + idStr.padStart(5, '0');\n    return this.id;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Send packet on either provided socket or default socket. Servers provide\n      the socket because it's handling multiple sockets from different clients.\n   */\n  SocketSend(socket = m_netsocket) {\n    if (m_mode === M_ONLINE || m_mode === M_INIT) {\n      this.s_group = NetMessage.GlobalGroupID();\n      let dst = socket.UADDR || 'unregistered socket';\n      if (!socket) throw Error('SocketSend(sock) requires a valid socket');\n      if (DBG.send) {\n        let status = `sending '${this.Message()}' to ${dst}`;\n        console.log(PR, status);\n      }\n      // for server-side ws library, send supports a function callback\n      // for WebSocket, this is ignored\n      socket.send(this.JSON(), err => {\n        if (err) console.error(`\\nsocket ${socket.UADDR} reports error ${err}\\n`);\n      });\n    } else if (m_mode !== M_STANDALONE) {\n      console.log(PR, \"SocketSend: Can't send because NetMessage mode is\", m_mode);\n    } else {\n      console.warn(PR, 'STANDALONE MODE: SocketSend() suppressed!');\n    }\n    // FYI: global m_netsocket is not defined on server, since packets arrive on multiple sockets\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Create a promise to resolve when packet returns\n   */\n  QueueTransaction(socket = m_netsocket) {\n    if (m_mode === M_STANDALONE) {\n      console.warn(PR, 'STANDALONE MODE: QueueTransaction() suppressed!');\n      return Promise.resolve();\n    }\n    // global m_netsocket is not defined on server, since packets arrive on multiple sockets\n    if (!socket) throw Error('QueueTransaction(sock) requires a valid socket');\n    // save our current UADDR\n    this.seqlog.push(NetMessage.UADDR);\n    let dbg = DBG.transact && !this.IsServerMessage();\n    let p = new Promise((resolve, reject) => {\n      var hash = m_GetHashKey(this);\n      if (m_transactions[hash]) {\n        reject(Error(ERR_DUPE_TRANS + ':' + hash));\n      } else {\n        // save the resolve function in transactions table;\n        // promise will resolve on remote invocation with data\n        m_transactions[hash] = function (data) {\n          if (dbg) {\n            console.log(PR, 'resolving promise with', JSON.stringify(data));\n          }\n          resolve(data);\n        };\n        this.SocketSend(socket);\n      }\n    });\n    return p;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** return the 'routing mode':\n        req/res is request/reply (message requests and optional response)\n        f_req/f_res is forwarded request/reply (forwarded messages and optional return)\n        the f_res is converted to res and sent back to original requester\n   */\n  RoutingMode() {\n    return this.rmode;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  IsRequest() {\n    return this.rmode === 'req';\n  }\n  IsOwnResponse() {\n    return this.rmode === 'res';\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  /** If this packet is a returned transaction, then return true\n   */\n  IsTransaction() {\n    return (\n      this.rmode !== ROUTING_MODE[0] &&\n      this.seqnum > 0 &&\n      this.seqlog[0] === NetMessage.UADDR\n    );\n  }\n  ///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\tupdate the sequence metadata and return on same socket\n   */\n  ReturnTransaction(socket = m_netsocket) {\n    // global m_netsocket is not defined on server, since packets arrive on multiple sockets\n    if (!socket) throw Error('ReturnTransaction(sock) requires a valid socket');\n    // note: seqnum is already incremented by the constructor if this was\n    // a received packet\n    // add this to the sequence log\n    this.seqlog.push(NetMessage.UADDR);\n    this.rmode = m_CheckRMode('res');\n    this.SocketSend(socket);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** If this is a transaction packet that is returned, then execute the stored\n      resolver function from the promise stored in m_transactions, which will\n      then trigger .then() following any calls\n   */\n  CompleteTransaction() {\n    let dbg = DBG.transact && !this.IsServerMessage();\n    var hash = m_GetHashKey(this);\n    var resolverFunc = m_transactions[hash];\n    if (dbg) console.log(PR, 'CompleteTransaction', hash);\n    if (typeof resolverFunc !== 'function') {\n      throw Error(\n        `transaction [${hash}] resolverFunction is type ${typeof resolverFunc}`\n      );\n    } else {\n      resolverFunc(this.data);\n      Reflect.deleteProperty(m_transactions[hash]);\n    }\n  }\n} // class NetMessage\n\n/// STATIC CLASS METHODS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** set the NETWORK interface object that implements Send()\n    This class operates both under the server and the client.\n    This is a client feature.\n */\nNetMessage.GlobalSetup = function (config) {\n  let { netsocket, uaddr } = config;\n  if (uaddr) NetMessage.UADDR = uaddr;\n  // NOTE: m_netsocket is set only on clients since on server, there are multiple sockets\n  if (netsocket) {\n    if (typeof netsocket.send !== 'function') throw ERR_BAD_SOCKET;\n    console.log(`NETWORK-PACKET: mode %cONLINE`, 'color:red');\n    m_netsocket = netsocket;\n    m_mode = M_ONLINE;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** cleanup any allocated storage. This class operates both under the\n    server and the client. This is a client feature.\n */\nNetMessage.GlobalCleanup = function () {\n  if (m_netsocket) {\n    console.log(PR, 'GlobalCleanup: deallocating netsocket, mode closed');\n    m_netsocket = null;\n    m_mode = M_CLOSED;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** cleanup any allocated storage internally. This class operates both under the\n    server and the client. This is a client feature.\n */\nNetMessage.GlobalOfflineMode = function (data) {\n  m_mode = M_STANDALONE;\n  if (m_netsocket) {\n    console.warn(PR, 'STANDALONE MODE: NetMessage disabling network');\n    m_netsocket = null;\n    // The disconnect is detected by client-network.js.\n    // If the disconnect is due to a missing ping heartbeat from the server\n    // (usually as a result of wifi/internet connection going down)\n    // it will include a data.message explaining 'Client Disconnect'.\n    // If there's no data.message, then this request came from\n    // either a standalone connect, a server \"close\" event,\n    // or a server \"error\" event.\n    let event = new CustomEvent('UNISYSDisconnect', {\n      detail: {\n        message: data ? data.message : 'Server Disconnected'\n      }\n    });\n    console.log('dispatching event to', document, event);\n    document.dispatchEvent(event);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** return the address (socket_id) assigned to this app instance\n */\nNetMessage.SocketUADDR = function () {\n  return NetMessage.UADDR;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return a default server UADDR\n */\nNetMessage.DefaultServerUADDR = function () {\n  return 'SVR_01';\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return current SessionID string\n */\nNetMessage.GlobalGroupID = function () {\n  return m_group_id;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNetMessage.GlobalSetGroupID = function (token) {\n  m_group_id = token;\n};\n\n/// PRIVATE CLASS HELPERS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** when a packet is reconstructed from an existing object or json string,\n    its sequence number is incremented, and the old source uaddr is pushed\n    onto the seqlog stack.\n */\nfunction m_SeqIncrement(pkt) {\n  pkt.seqnum++;\n  return pkt;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\treturn the hash used for storing transaction callbacks\n */\nfunction m_GetHashKey(pkt) {\n  let hash = `${pkt.SourceAddress()}:${pkt.id}`;\n  return hash;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** is this an allowed type? throw error if not\n */\nfunction m_CheckType(type) {\n  if (type === undefined) {\n    throw new Error('must pass a type string, not ' + type);\n  }\n  if (!KNOWN_TYPES.includes(type)) throw `${ERR_UNKNOWN_TYPE} '${type}'`;\n  return type;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** is this an allowed mode? throw error if not\n */\nfunction m_CheckRMode(mode) {\n  if (mode === undefined) {\n    throw new Error('must pass a mode string, not ' + mode);\n  }\n  if (!ROUTING_MODE.includes(mode)) throw `${ERR_UNKNOWN_RMODE} '${mode}'`;\n  return mode;\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NetMessage;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Session Utilities\n  collection of session-related data structures\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\n/// DEBUGGING /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n//\n\n/// SYSTEM LIBRARIES //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst HashIds = require('hashids');\n\n/// MODULE DEFS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet SESUTIL = {};\nconst HASH_ABET = 'ABCDEFGHIJKLMNPQRSTVWXYZ23456789';\nconst HASH_MINLEN = 3;\nvar m_current_groupid = null;\n\n/// SESSION ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Given a token of form CLASS-PROJECT-HASHEDID, return an object\n    containing as many decoded values as possible. Check isValid for\n    complete decode succes. groupId is also set if successful\n\n    `dataset` is not currently being used, but is retained for future use.\n */\nSESUTIL.DecodeToken = function (token, templateSalt) {\n  const DELIMITER = '-';\n  if (token === undefined) return {};\n  // 2024/08 Allow optional `dataset` so tokens can be shared across graphs\n  // if (dataset === undefined) {\n  //   console.error('SESUTIL.DecodeToken called without \"dataset\" parameter.');\n  //   return {};\n  // }\n  let tokenBits = token.split(DELIMITER);\n  let classId, projId, hashedId, groupId, subId, isValid;\n  // optimistically set valid flag to be negated on failure\n  isValid = true;\n  // check for superficial issues\n  if (token.substr(-1) === DELIMITER) {\n    isValid = false;\n  }\n  // token is of form CLS-PRJ-HASHEDID\n  // classId, etc will be partially set and returned\n  if (tokenBits[0]) classId = tokenBits[0].toUpperCase();\n  if (tokenBits[1]) projId = tokenBits[1].toUpperCase();\n  if (tokenBits[2]) hashedId = tokenBits[2].toUpperCase();\n  if (tokenBits[3]) subId = tokenBits[3].toUpperCase();\n  // initialize hashid structure\n\n  // Allow shareable tokens by setting `dataset` to undefined\n  let salt;\n  if (templateSalt !== undefined) {\n    salt = `${classId}${projId}${templateSalt}`;\n  } else {\n    salt = `${classId}${projId}`; // skips `dataset`\n    console.warn('\"salt\" is not defined.  Using only classId and projId.');\n  }\n\n  if (DBG)\n    console.warn(\n      'commen-session ignoring \"dataset\" to allow decoding of shared tokens'\n    );\n  try {\n    let hashids = new HashIds(salt, HASH_MINLEN, HASH_ABET);\n    // try to decode the groupId\n    groupId = hashids.decode(hashedId)[0];\n  } catch (err) {\n    console.log('SESUTIL.DecodeToken: invalid token');\n  }\n  // invalidate if groupId isn't an integer\n  if (!Number.isInteger(groupId)) {\n    if (DBG) console.error('invalid token');\n    isValid = false;\n    groupId = 0;\n  }\n  // invalidate if groupId isn't non-negative integer\n  if (groupId < 0) {\n    if (DBG) console.error('decoded token, but value out of range <0');\n    isValid = false;\n    groupId = 0;\n  }\n\n  // at this point groupId is valid (begins with ID, all numeric)\n  // check for valid subgroupId\n  if (subId) {\n    if (\n      subId.length > 2 &&\n      subId.indexOf('ID') === 0 &&\n      /^\\d+$/.test(subId.substring(2))\n    ) {\n      if (DBG) console.log('detected subid', subId.substring(2));\n      // subId contains a string \"ID<N>\" where <N> is an integer\n    } else {\n      // subId exists but didn't match subid format\n      if (DBG) console.log('invalid subId string', subId);\n      isValid = false; // groupId is still valid,\n      subId = 0;\n    }\n  }\n\n  // reconstruct user id for use with author data for nodes, edges, comments\n  const userId = [classId, projId, hashedId].join(DELIMITER);\n  // if isValid is false, check groupId is 0 or subId is 0, indicating error\n  let decoded = { token, isValid, classId, projId, hashedId, groupId, subId, userId };\n  return decoded;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return TRUE if the token decodes into an expected range of values\n */\nSESUTIL.IsValidToken = function (token, templateSalt) {\n  let decoded = SESUTIL.DecodeToken(token, templateSalt);\n  return decoded && Number.isInteger(decoded.groupId);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns a token string of form CLASS-PROJECT-HASHEDID\n    classId and projId should be short and are case-insensitive.\n    groupId must be a non-negative integer\n\n    `dataset` is not currently being used, but is retained for future use.\n*/\nSESUTIL.MakeToken = function (classId, projId, groupId, templateSalt) {\n  // type checking\n  if (typeof classId !== 'string')\n    throw Error(`classId arg1 '${classId}' must be string`);\n  if (typeof projId !== 'string')\n    throw Error(`projId arg2 '${projId}' must be string`);\n  if (classId.length < 1) throw Error(`classId arg1 length should be 1 or more`);\n  if (projId.length < 1) throw Error(`projId arg2 length should be 1 or more`);\n  if (!Number.isInteger(groupId))\n    throw Error(`groupId arg3 '${groupId}' must be integer`);\n  if (groupId < 0) throw Error(`groupId arg3 must be non-negative integer`);\n  if (groupId > Number.MAX_SAFE_INTEGER)\n    throw Error(`groupId arg3 value exceeds MAX_SAFE_INTEGER`);\n  // initialize hashid structure\n  classId = classId.toUpperCase();\n  projId = projId.toUpperCase();\n\n  // Allow shareable tokens by setting `dataset` to undefined\n  let salt;\n  if (templateSalt !== undefined) salt = `${classId}${projId}${templateSalt}`;\n  else salt = `${classId}${projId}`; // skips `dataset`\n\n  if (DBG)\n    console.warn(\n      'commen-session ignoring \"dataset\" to allow creation of shared tokens'\n    );\n  let hashids = new HashIds(salt, HASH_MINLEN, HASH_ABET);\n  let hashedId = hashids.encode(groupId);\n  return `${classId}-${projId}-${hashedId}`;\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Set the global GROUPID, which is included in all NetMessage\n    packets that are sent to server.\n */\n// REVIEW/FIXME\n// `SetGroupID` isn't being called by anyone?\n// If it is, the DecodeToken call needs to add a 'dataset' parameter or it will\n// fail.\nSESUTIL.SetGroupID = function (token) {\n  console.error('SetGroupID calling decodeToken NC_CONFIG IS', window.NC_CONFIG);\n  let good = SESUTIL.DecodeToken(token).isValid;\n  if (good) m_current_groupid = token;\n  return good;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSESUTIL.GroupID = function () {\n  return m_current_groupid;\n};\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = SESUTIL;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    SessionShell handles route-based parameters, updating the SESSION manager\n    with pertinent information\n\n    The component stores the credentials\n      classId  : null,\n      projId   : null,\n      hashedId : null,\n      groupId  : null,\n      isValid  : false\n\n    render() calls one of the following depending on the state of\n    SESSION.DecodeToken( token ). It returns an object is isValid prop set.\n    The token is by decoding the URL in location.href.\n\n      renderLoggedIn( decoded ) contains an object with the decoded properties\n      from the original string, and displays the login state\n\n      renderLogin() shows the login text field.\n\n    When text is changing in Login Field, this.handleChange() is called.\n    It gets the value and runs SESSION.DecodeToken() on it.\n    It then uses Unisys.SetAppState to set \"SESSION\" to the decoded value.\n    if a groupId is detected, then it forces a redirect.\n\n\n    A change in logged in status can come from four places:\n\n    1. User has typed in login field.\n       => This is handled by `handleChange()`\n    2. User has hit the \"Login\" submit button.\n       => This is handled by `onSubmit()`\n    3. User has entered a full URL for the first time\n       => This is handled by `componentWillMount()`\n    4. User has changed an existing URL\n       => This does not trigger `compomentWillMount()`\n          so it needs special handling.\n       Changing the url does trigger:\n       * render()\n          render is triggered because the props for the token\n          passed by the route change.\n          And render does detect the correct login state.\n          However, if this represents a change in login state,\n          the change in state needs to be broadcast.\n       * componentDidUpdate()\n          componentDidUpdate checks for the change in loggedinIn\n          status and sends an AppStateChanged event as needed.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst SETTINGS = require('settings');\nconst React = require('react');\nconst PROMPTS = require('system/util/prompts');\nconst SESSION = require('unisys/common-session');\nconst PR = PROMPTS.Pad('SessionShell');\nconst UNISYS = require('unisys/client');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// these styles are copied from AutoComplete.css\nconst INPUT_STYLE = {\n  border: '1px solid #c35400',\n  borderLeft: '0',\n  borderRadius: '0 5px 5px 0',\n  padding: '4px 8px 3px 8px',\n  fontFamily: 'Helvetica, sans-serif',\n  fontWeight: 400,\n  fontSize: '10px',\n  lineHeight: '13px',\n  textAlign: 'right',\n  textTransform: 'uppercase'\n};\nconst GROUP_STYLE = {\n  backgroundColor: '#777',\n  color: 'white',\n  marginTop: '-10px'\n};\nconst LABEL_STYLE = {\n  display: 'inline-block',\n  verticalAlign: 'top',\n  marginBottom: '0.15rem',\n  marginTop: '0.15rem',\n  color: '#355869'\n};\nconst LOGIN_BTN_STYLE = {\n  padding: '4px 8px 3px 8px',\n  fontSize: '10px',\n  lineHeight: '13px',\n  border: '1px solid #c35400',\n  borderRadius: '5px 0 0 5px',\n  color: 'white',\n  backgroundColor: '#c35400'\n};\n/// Move login to navbar\nconst NAV_LOGIN_STYLE = {\n  fontSize: '0.8rem',\n  zIndex: '2000'\n};\nconst NAV_LOGIN_FEEDBACK_STYLE = {\n  paddingRight: '0.5rem'\n};\nconst VALID = {\n  color: 'green',\n  borderColor: 'green',\n  outlineColor: 'green'\n};\nconst VALIDBTN = {\n  backgroundColor: 'green',\n  borderColor: 'green',\n  outlineColor: 'green'\n};\nconst INVALID = {\n  color: '#a20000',\n  borderColor: '#a20000',\n  outlineColor: '#a20000'\n};\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass SessionShell extends UNISYS.Component {\n  constructor() {\n    super();\n    this.renderLogin = this.renderLogin.bind(this);\n    this.renderLoggedIn = this.renderLoggedIn.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.onSubmit = this.onSubmit.bind(this);\n    this.state = {\n      // `state` tracks the login input field\n      token: null,\n      classId: null,\n      projId: null,\n      hashedId: null,\n      subId: null,\n      groupId: null,\n      isValid: false,\n      templateSalt: undefined // this is set in componentDidMount()\n    };\n    this.previousIsValid = false; // to track changes in loggedIn status\n\n    // This will invalidate the token when the server is disconnected\n    // but this can be a problem for projects that require login\n    // to view the graph.\n    // this.OnDisconnect(() => {\n    //   const token = this.props.match.params.token;\n    //   const decoded = SESSION.DecodeToken(token, window.NC_CONFIG.dataset);\n    //   // invalidate the token and announce it\n    //   decoded.isValid = false;\n    //   this.SetAppState(\"SESSION\", decoded);\n    // });\n  }\n\n  /// ROUTE RENDER FUNCTIONS ////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** render successful logged-in\n   */\n  renderLoggedIn(decoded) {\n    if (decoded) {\n      let classproj = `${decoded.classId}-${decoded.projId}`;\n      // prefix with unicode non-breaking space\n      let gid = `\\u00A0${decoded.groupId}`;\n      let subid = decoded.subId ? `USER\\u00A0${decoded.subId}` : '';\n      return (\n        <div style={NAV_LOGIN_STYLE}>\n          <label style={LABEL_STYLE} className=\"small\">\n            GROUP{gid}:&nbsp;\n            <br />\n            {subid}\n          </label>\n          <label style={LABEL_STYLE} className=\"small\">\n            {classproj}-<strong>{decoded.hashedId}</strong>\n          </label>\n        </div>\n      );\n\n      // Old Form above NodeSelector\n      // return (\n      //   <FormGroup row style={GROUP_STYLE} style={{position:'fixed',top:'5px',right:'5px',zIndex:'2000'}}>\n      //     <Col sm={3}>\n      //       <Label style={LABEL_STYLE} className=\"small\">\n      //         GROUP{gid}\n      //         <br />\n      //         {subid}\n      //       </Label>\n      //     </Col>\n      //     <Col sm={9} className=\"text-right\">\n      //       <Label style={LABEL_STYLE} className=\"small\">\n      //         {classproj}-<strong>{decoded.hashedId}</strong>\n      //       </Label>\n      //     </Col>\n      //   </FormGroup>\n      // );\n    } else {\n      return <p>ERROR:renderLoggedIn didn&apos;t get valid decoded object</p>;\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** render must login (readonly)\n   *  see common-session.DecodeToken() for details on:\n   *    classId, projId, and hashedId are provided by the token\n   *    groupId is _calculated_ when all three parts are valid\n   *    subId is a string ID<NNN> where <NNN> are digits\n   */\n  renderLogin() {\n    let { token, classId, projId, groupId, subId, hashedId, isValid } = this.state;\n    if (token) token = token.toUpperCase();\n    let formFeedback, tip, loginbtn, input;\n    tip = 'type your login token';\n    if (classId) tip = 'token part [1/3]...';\n    if (projId) tip = 'token part [2/3]...';\n    // groupId isn't part of the token\n    // if (groupId) tip = 'Waiting for extra ID...';\n    if (hashedId) tip = 'token part [3/3]...';\n    // if groupId is defined, then the token is valid\n    if (groupId) {\n      //\n      if (subId === 0) {\n        tip = `...optional ID number`;\n        loginbtn = (\n          <button\n            style={LOGIN_BTN_STYLE}\n            disabled={!isValid}\n            onSubmit={this.onSubmit}\n            type=\"submit\"\n          >\n            LOGIN\n          </button>\n        );\n        input = (\n          <input\n            name=\"sessionToken\"\n            id=\"sessionToken\"\n            style={{ ...INPUT_STYLE, ...INVALID }}\n            placeholder=\"CLASSID-PROJID-CODE\"\n            onChange={this.handleChange}\n          />\n        );\n        formFeedback = (\n          <label\n            htmlFor=\"sessionToken\"\n            style={{ ...NAV_LOGIN_FEEDBACK_STYLE, ...INVALID }}\n          >\n            <small>{tip}</small>\n          </label>\n        );\n      } /* if subId!==0 */ else {\n        tip = 'CLICK LOGIN BUTTON';\n        loginbtn = (\n          <button\n            style={{ ...LOGIN_BTN_STYLE, ...VALIDBTN }}\n            disabled={!isValid}\n            onSubmit={this.onSubmit}\n            type=\"submit\"\n          >\n            LOGIN\n          </button>\n        );\n        input = (\n          <input\n            name=\"sessionToken\"\n            id=\"sessionToken\"\n            style={{ ...INPUT_STYLE, ...VALID }}\n            placeholder=\"CLASSID-PROJID-CODE\"\n            onChange={this.handleChange}\n          />\n        );\n        formFeedback = (\n          <label\n            htmlFor=\"sessionToken\"\n            style={{ ...NAV_LOGIN_FEEDBACK_STYLE, ...VALID }}\n          >\n            <small>{tip}</small>\n          </label>\n        );\n      }\n    } /* if not groupId*/ else {\n      loginbtn = (\n        <button\n          style={LOGIN_BTN_STYLE}\n          disabled={!isValid}\n          onSubmit={this.onSubmit}\n          type=\"submit\"\n        >\n          LOGIN\n        </button>\n      );\n      input = (\n        <input\n          name=\"sessionToken\"\n          id=\"sessionToken\"\n          style={{ ...INPUT_STYLE, ...INVALID }}\n          placeholder=\"CLASSID-PROJID-CODE\"\n          onChange={this.handleChange}\n        />\n      );\n      formFeedback = (\n        <label\n          htmlFor=\"sessionToken\"\n          style={{ ...NAV_LOGIN_FEEDBACK_STYLE, ...INVALID }}\n        >\n          <small>{tip}</small>\n        </label>\n      );\n    }\n\n    return (\n      <form\n        className=\"--SessionShell_Login\"\n        onSubmit={this.onSubmit}\n        style={NAV_LOGIN_STYLE}\n      >\n        {formFeedback}\n        {loginbtn}\n        {input}\n      </form>\n    );\n\n    // Old Form above NodeSelector\n    // return (\n    //   <Form onSubmit={this.onSubmit} style={{position:'fixed',top:'5px',right:'5px',zIndex:'2000'}}>\n    //   <FormGroup row>\n    //     <Col>\n    //       <InputGroup>\n    //         {formFeedback}\n    //         <InputGroupAddon addonType=\"prepend\"><Button style={{fontSize:'10px'}} color=\"secondary\" size=\"sm\" disabled={!isValid} onSubmit={this.onSubmit}>LOGIN</Button></InputGroupAddon>\n    //         {input}\n    //       </InputGroup>\n    //     </Col>\n    //   </FormGroup>\n    //   </Form>\n    // );\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  componentDidMount() {\n    // the code below reads a pre-existing matching path, which may be set\n    // to a valid token string AFTER the changeHandler() detected a valid\n    // login after a ForceReload. This is a bit hacky and the app would benefit\n    // from not relying on forced reloads. See handleChange().\n    //\n    // This is only called with the initial page load.\n    // Subsequent changes to the URL (e.g. changing token directly in the url)\n    // do not result in a second componentWillMount call.  These are handled\n    // by the componentDidUpdate() call.\n\n    const { routeProps } = SETTINGS.GetRouteInfoFromURL();\n    let { token } = routeProps;\n    const TEMPLATE = this.AppState('TEMPLATE');\n    const templateSalt = TEMPLATE && TEMPLATE.secretKey;\n    this.setState({ templateSalt });\n    const decoded = SESSION.DecodeToken(token, templateSalt) || {};\n    this.SetAppState('SESSION', decoded);\n    this.previousIsValid = decoded.isValid;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  componentDidUpdate(prevProps) {\n    // SIDE EFFECT\n    // Check for changes in logged in status and\n    // trigger AppStateChange if necessary\n    const { routeProps } = SETTINGS.GetRouteInfoFromURL();\n    let { token } = routeProps;\n\n    if (!token) return; // don't bother to check if this was a result of changes from the form\n    let decoded = SESSION.DecodeToken(token, this.state.templateSalt);\n    if (decoded.isValid !== this.previousIsValid) {\n      this.SetAppState('SESSION', decoded);\n      this.previousIsValid = decoded.isValid;\n    }\n  }\n\n  /// EVENT HANDLERS ////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  handleChange(event) {\n    let token = event.target.value;\n    let decoded = SESSION.DecodeToken(token, this.state.templateSalt);\n    let { classId, projId, hashedId, subId, groupId } = decoded;\n    this.setState(decoded);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  onSubmit(event) {\n    event.preventDefault();\n    if (this.state.isValid) {\n      // force a page URL change\n      const redirect = `./#/edit/${this.state.token}`;\n      window.location.replace(redirect);\n      window.location.reload();\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Main Render Function\n   */\n  render() {\n    // FUN FACTS\n    // this.state set in constructor\n    // this.props.history, location, match added by withRouter(AppShell)\n    // way back in init-appshell.jsx\n\n    // if standalone mode, no login possible\n    if (UNISYS.IsStandaloneMode()) {\n      const { prompt, timestamp } = window.NC_UNISYS.standalone;\n      return (\n        <div style={NAV_LOGIN_STYLE}>\n          <label style={LABEL_STYLE}>{prompt}</label>\n        </div>\n      );\n    }\n\n    const { routeProps } = SETTINGS.GetRouteInfoFromURL();\n    let { token } = routeProps;\n    // no token so just render login\n    if (!token) return this.renderLogin();\n\n    // try to decode token\n    let decoded = SESSION.DecodeToken(token, this.state.templateSalt);\n    if (decoded.isValid) {\n      return this.renderLoggedIn(decoded);\n    } else {\n      return this.renderLogin(token);\n    }\n  }\n} // UNISYS.Component SessionShell\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = SessionShell;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  DATABASE SERVER\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* eslint-disable newline-per-chained-call */\n/* eslint-disable nonblock-statement-body-position */\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst DBG = false;\n\n/// LOAD LIBRARIES ////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nconst Loki = require('lokijs');\nconst PATH = require('path');\nconst FS = require('fs-extra');\nconst TOML = require('@iarna/toml');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nconst SESSION = require('./common-session');\nconst LOGGER = require('./server-logger');\nconst PROMPTS = require('../system/util/prompts');\nconst FILTER = require('../view/netcreate/components/filter/FilterEnums');\nconst { EDITORTYPE } = require('../system/util/enum');\n\nconst PR = PROMPTS.Pad('ServerDB');\nconst RUNTIMEPATH = './runtime/';\nconst TEMPLATEPATH = './app-templates/';\nconst TEMPLATE_EXT = '.template.toml';\nconst BACKUPPATH = 'backups/'; // combined with RUNTIMEPATH, so no leading './'\nconst NC_CONFIG = require('../../app-config/netcreate-config');\n\n/// MODULE-WIDE VARS //////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nlet db_file;\nlet m_options; // saved initialization options\nlet m_db; // loki database\nlet m_max_edgeID;\nlet m_max_nodeID;\nlet m_max_commentID;\nlet m_dupe_set; // set of nodeIDs for determine whether there are duplicates\nlet NODES; // loki \"nodes\" collection\nlet EDGES; // loki \"edges\" collection\nlet COMMENTS; // loki \"comments\" collection\nlet READBY; // loki \"readby\" collection\nlet m_locked_nodes; // map key = nodeID, value = uaddr initiating the lock\nlet m_locked_edges; // map key = edgeID, value = uaddr initiating the lock\nlet m_locked_comments; // map key = commentID, value = uaddr initiating the lock\nlet TEMPLATE;\nlet m_open_editors = []; // array of template, node, or edge editors\n/// formatting\nconst BL = s => `\\x1b[1;34m${s}\\x1b[0m`;\nconst RD = s => `\\x1b[1;31m${s}\\x1b[0m`;\nconst YL = s => `\\x1b[1;33m${s}\\x1b[0m`;\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nlet DB = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Backup Database File Utility\n    Used by PKT_MergeDatabase to clone the db before importing.\n    Saves the db in the runtime folder with a timestamp suffix. */\nfunction m_BackupDatabase() {\n  FS.ensureDirSync(PATH.dirname(db_file));\n  if (FS.existsSync(db_file)) {\n    const timestamp = new Date().toISOString().replace(/:/g, '.');\n    const backupDBFilePath = m_GetValidDBFilePath(\n      BACKUPPATH + NC_CONFIG.dataset + '_' + timestamp\n    );\n    console.log(PR, 'Saving database backup to', backupDBFilePath);\n    FS.copySync(db_file, backupDBFilePath);\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Default Template Path */\nfunction m_DefaultTemplatePath() {\n  return TEMPLATEPATH + '_default' + TEMPLATE_EXT;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Initialize the database */\nDB.InitializeDatabase = function (options = {}) {\n  let dataset = NC_CONFIG.dataset;\n  db_file = m_GetValidDBFilePath(dataset);\n  FS.ensureDirSync(PATH.dirname(db_file));\n  if (!FS.existsSync(db_file)) {\n    console.log(\n      PR,\n      YL(`NOTICE: NO EXISTING DATABASE ${db_file}, so creating BLANK DATABASE...`)\n    );\n  }\n  // console.log(PR, YL(`loading dataset`), `${BL(db_file)}...`);\n  let ropt = {\n    autoload: true,\n    autoloadCallback: f_DatabaseInitialize,\n    autosave: true,\n    autosaveCallback: f_AutosaveStatus,\n    autosaveInterval: 4000 // save every four seconds\n  };\n  ropt = Object.assign(ropt, options);\n  m_db = new Loki(db_file, ropt);\n  m_options = ropt;\n  m_options.db_file = db_file; // store for use by DB.WriteJSON\n\n  /*/ !!! HACK NOTED !!!\n      CALLBACK ON LOKI LOAD\n      also has side-effect of initializing template, which has\n      nothing to do with the database :|\n  /*/\n\n  async function f_DatabaseInitialize() {\n    // on the first load of (non-existent database), we will have no\n    // collections so we can detect the absence of our collections and\n    // add (and configure) them now.\n    NODES = m_db.getCollection('nodes');\n    if (NODES === null) NODES = m_db.addCollection('nodes');\n    m_locked_nodes = new Map();\n    EDGES = m_db.getCollection('edges');\n    if (EDGES === null) EDGES = m_db.addCollection('edges');\n    m_locked_edges = new Map();\n    COMMENTS = m_db.getCollection('comments');\n    if (COMMENTS === null) COMMENTS = m_db.addCollection('comments');\n    READBY = m_db.getCollection('readby');\n    if (READBY === null) READBY = m_db.addCollection('readby');\n    m_locked_comments = new Map();\n\n    // initialize unique set manager\n    m_dupe_set = new Set();\n    let dupeNodes = [];\n\n    // find highest NODE ID\n    if (NODES.count() > 0) {\n      m_max_nodeID = NODES.mapReduce(\n        obj => {\n          // side-effect: make sure ids are numbers\n          m_CleanObjID('node.id', obj);\n          // side-effect: check for duplicate ids\n          if (m_dupe_set.has(obj.id)) {\n            dupeNodes.push(obj);\n          } else {\n            m_dupe_set.add(obj.id);\n          }\n          // return value\n          return obj.id;\n        },\n        arr => {\n          return Math.max(...arr);\n        }\n      );\n    } else {\n      m_max_nodeID = 0;\n    }\n    // remap duplicate NODE IDs\n    dupeNodes.forEach(obj => {\n      m_max_nodeID += 1;\n      LOGGER.WriteRLog(\n        {},\n        PR,\n        `# rewriting duplicate nodeID ${obj.id} to ${m_max_nodeID}`\n      );\n      obj.id = m_max_nodeID;\n    });\n\n    // find highest EDGE ID\n    if (EDGES.count() > 0) {\n      m_max_edgeID = EDGES.mapReduce(\n        obj => {\n          m_CleanObjID('edge.id', obj);\n          m_CleanEdgeEndpoints(obj.id, obj);\n          return obj.id;\n        },\n        arr => {\n          return Math.max(...arr);\n        }\n      ); // end mapReduce edge ids\n    } else {\n      m_max_edgeID = 0;\n    }\n    console.log(\n      PR,\n      'dataset loaded',\n      BL(db_file),\n      `m_max_nodeID '${m_max_nodeID}', m_max_edgeID '${m_max_edgeID}'`\n    );\n\n    // find highest COMMENT ID\n    if (COMMENTS.count() > 0) {\n      m_max_commentID = COMMENTS.mapReduce(\n        obj => {\n          // side-effect: make sure ids are numbers\n          m_CleanObjID('comment.id', obj);\n          return obj.comment_id;\n        },\n        arr => {\n          return Math.max(...arr);\n        }\n      );\n    } else {\n      m_max_commentID = 0;\n    }\n\n    m_db.saveDatabase();\n\n    await m_LoadTemplate();\n    m_MigrateTemplate();\n    m_ValidateTemplate();\n  } // end f_DatabaseInitialize\n\n  // UTILITY FUNCTION\n  function f_AutosaveStatus() {\n    let nodeCount = NODES.count();\n    let edgeCount = EDGES.count();\n    let commentCount = COMMENTS.count();\n    let readbyCount = READBY.count();\n    console.log(\n      PR,\n      `AUTOSAVING! ${nodeCount} NODES / ${edgeCount} EDGES / ${commentCount} COMMENTS / ${readbyCount} READBY <3`\n    );\n  }\n}; // InitializeDatabase()\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Loads a *.template.toml file from the server. */\nfunction m_LoadTOMLTemplate(templateFilePath) {\n  return new Promise((resolve, reject) => {\n    const templateFile = FS.readFile(templateFilePath, 'utf8', (err, data) => {\n      if (err) throw err;\n      const json = TOML.parse(data);\n      TEMPLATE = json;\n      console.log(PR, 'template loaded', BL(templateFilePath));\n      resolve({ Loaded: true });\n    });\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Load Template\n    1. Tries to load a TOML template\n    2. If it can't be found, tries to load the JSON template and convert it\n    3. If that fails, clone the default TOML template and load it\n    Called by\n    * DB.InitializeDatabase\n    * DB.WriteTemplateTOML\n */\nasync function m_LoadTemplate() {\n  const TOMLPath = m_GetTemplateTOMLFilePath();\n  FS.ensureDirSync(PATH.dirname(TOMLPath));\n  /*/ SRI NOTE\n      ripping out the json template conversion to simplify loading and\n      avoid wasting time validating this poorly structured code\n  /*/\n  // Does the TOML template exist?\n  if (FS.existsSync(TOMLPath)) {\n    // 1. If TOML exists, load it\n    await m_LoadTOMLTemplate(TOMLPath);\n  } else {\n    // clone _default.template.toml\n    console.log(PR, `NO EXISTING TEMPLATE ${TOMLPath}`);\n    FS.copySync(m_DefaultTemplatePath(), TOMLPath);\n    // then load it\n    await m_LoadTOMLTemplate(TOMLPath);\n  }\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Updated Migrate Template - WARNING\n *  The original m_MigrateTemplate() uses a lot of indirection and references\n *  an \"unused\" module called \"template-schema.js\" that wass very much used */\nfunction m_MigrateTemplate() {\n  //\n  const T = TEMPLATE; // mirroring original hacky approach\n  const EDF = T.edgeDefs;\n  const NDF = T.nodeDefs;\n  const nset = prop => prop === undefined;\n\n  /*/ SRI NOTE:\n      using short messages because these get overwritten anyway\n  /*/\n\n  // Migrate 1.0 to 1.1\n  if (nset(T.duplicationWarning)) T.duplicationWarning = 'Duplicate node detected';\n  if (nset(T.nodeIsLockedMessage)) T.nodeIsLockedMessage = 'Node is locked';\n  if (nset.edgeIsLockedMessage) T.edgeIsLockedMessage = 'Edge is locked';\n  if (nset(T.templateIsLockedMessage))\n    T.templateIsLockedMessage = 'Template is locked';\n  if (nset(T.importIsLockedMessage)) T.importIsLockedMessage = 'Import is locked';\n\n  // Migrate 1.4 to 1.5 Core Preferences\n  // -- v1.5 core defaults -- added 2023-0628 #31\n  if (nset(T.searchColor)) T.searchColor = '#008800';\n  if (nset(T.sourceColor)) T.sourceColor = '#FFa500';\n\n  // -- v1.5 Filter Labels -- added 2023-0602 #117\n  // See branch `dev-bl/template-filter-labels`, and fb28fa6\n  if (nset(T.filterFade)) T.filterFade = 'Fade';\n  if (nset(T.filterReduce)) T.filterReduce = 'Reduce';\n  if (nset(T.filterFocus)) T.filterFocus = 'Focus';\n  if (nset(T.filterFadeHelp)) T.filterFadeHelp = 'Fade Filters';\n  if (nset(T.filterReduceHelp)) T.filterReduceHelp = 'Reduce Filters';\n  if (nset(T.filterFocusHelp)) T.filterFocusHelp = 'Focus Filters';\n\n  // -- v1.5 max sizes -- added 2023-0605 #117\n  // See branch `dev-bl/max-size\n  if (nset(T.nodeSizeDefault)) T.nodeSizeDefault = 5;\n  if (nset(T.nodeSizeMax)) T.nodeSizeMax = 50;\n  if (nset(T.edgeSizeDefault)) T.edgeSizeDefault = 1;\n  if (nset(T.edgeSizeMax)) T.edgeSizeMax = 25;\n\n  /*/ SRI NOTE:\n      EDF is T.edgeDefs\n      NDF is T.nodeDefs\n  /*/\n\n  // Migrate v1.4 to v1.5 Nodes and Edges\n  // hides them by default if they were not previously added\n  // SRI NOTE: these related to JSONEditor so needs rework since\n  // a lot of this is just used by dead code that hasn't been pruned.\n  // I've pruned some of it, but this is an outlier that needs to be handled\n  // by a different mechanism in an updated prop editor\n  if (nset(EDF.weight))\n    EDF.weight = {\n      type: 'number',\n      default: 1,\n      label: 'Weight',\n      exportLabel: 'Weight',\n      help: 'Weight of edge',\n      description: 'Weight of this edge',\n      includeInGraphTooltip: true,\n      isRequired: true,\n      isProvenance: false,\n      hidden: false\n    };\n\n  // v1.5 added `provenance` and `comments` so we add the template definitions\n  // Sri notes: this doesn't exist in the template-schema.js output at all, so\n  // there is nothing to migrate\n  // if (ndef(NDEF?.provenance)) {}\n  // if (ndef(NDEF?.comments)) {}\n  // if (ndef(EDF?.provenance)) {}\n  // if (ndef(EDF?.comments)) {}\n\n  // Migrate 1.5 to 2.0 Template Version\n  T._schemaVersion = '2.0';\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Validate Template File\n    Lazy check of template object definitions to make sure they are of\n    expected types and values so the UI doesn't choke and die. Throws an error\n    if property is missing.\n */\n// eslint-disable-next-line complexity\nfunction m_ValidateTemplate() {\n  try {\n    // 1. Validate built-in fields\n    // nodeDefs\n    let nodeDefs = TEMPLATE.nodeDefs;\n    if (nodeDefs === undefined) {\n      throw 'Missing `nodeDefs` nodeDefs=' + nodeDefs;\n    }\n    if (nodeDefs.label === undefined)\n      throw 'Missing `nodeDefs.label` label=' + nodeDefs.label;\n    // edgeDefs\n    let edgeDefs = TEMPLATE.edgeDefs;\n    if (edgeDefs === undefined) throw 'Missing `edgeDefs` edgeDefs=' + edgeDefs;\n    if (edgeDefs.source === undefined)\n      throw 'Missing `edgeDefs.source` source=' + edgeDefs.source;\n    if (edgeDefs.target === undefined)\n      throw 'Missing `edgeDefs.target` label=' + edgeDefs.target;\n\n    // 2. Validate deprecated fields\n    //    `TEMPLATE.version` was added after 2.0.\n    if (!TEMPLATE.version) {\n      // nodeDefs\n      if (nodeDefs.type === undefined)\n        throw 'Missing `nodeDefs.type` type= ' + nodeDefs.type;\n      if (\n        nodeDefs.type.options === undefined ||\n        !Array.isArray(nodeDefs.type.options)\n      ) {\n        throw (\n          'Missing or bad `nodeDefs.type.options` options=' + nodeDefs.type.options\n        );\n      }\n      if (nodeDefs.notes === undefined)\n        throw 'Missing `nodeDefs.notes` notes=' + nodeDefs.notes;\n      if (nodeDefs.info === undefined)\n        throw 'Missing `nodeDefs.info` info=' + nodeDefs.info;\n      // Version 1.5+ Fields\n      // if (nodeDefs.provenance === undefined) // v2 provenance removed\n      //   throw 'Missing `nodeDefs.provenance` provenance=' + nodeDefs.provenance;\n      if (nodeDefs.provenance)\n        // v2 provenance removed\n        console.log(\n          RD(\n            'Template is using deprecated node definition `provenance` which might result in errors when saving a node. Update the template and convert the data.'\n          ),\n          JSON.stringify(nodeDefs.provenance, null, 2)\n        );\n      if (nodeDefs.comments === undefined)\n        throw 'Missing `nodeDefs.comments` comments=' + nodeDefs.comments;\n\n      // edgeDefs\n      if (edgeDefs.type === undefined)\n        throw 'Missing `edgeDefs.type` type= ' + edgeDefs.type;\n      if (\n        edgeDefs.type.options === undefined ||\n        !Array.isArray(edgeDefs.type.options)\n      ) {\n        throw (\n          'Missing or bad `edgeDefs.type.options` options=' + edgeDefs.type.options\n        );\n      }\n      if (edgeDefs.notes === undefined)\n        throw 'Missing `edgeDefs.notes` notes=' + edgeDefs.notes;\n      if (edgeDefs.info === undefined)\n        throw 'Missing `edgeDefs.info` info=' + edgeDefs.info;\n      // Version 1.5+ Fields\n      // if (edgeDefs.provenance === undefined) // v2 provenance removed\n      //   throw 'Missing `edgeDefs.provenance` provenance=' + edgeDefs.provenance;\n      if (edgeDefs.provenance)\n        // v2 provenance removed\n        console.log(\n          RD(\n            'Template is using deprecated edge definition `provenance` which might result in errors when saving a node. Update the template and convert the data.'\n          ),\n          JSON.stringify(edgeDefs.provenance, null, 2)\n        );\n      if (edgeDefs.comments === undefined)\n        throw 'Missing `edgeDefs.comments` comments=' + edgeDefs.comments;\n      // -- End 1.5+\n      if (edgeDefs.citation === undefined)\n        throw 'Missing `edgeDefs.citation` info=' + edgeDefs.citation;\n      if (edgeDefs.category === undefined)\n        throw 'Missing `edgeDefs.category` info=' + edgeDefs.category;\n    } else {\n      // Placeholder for future version checks\n      // if (TEMPLATE.version <= \"2.0\") {\n      //   // do something\n      // }\n    }\n  } catch (error) {\n    const templateFileName = m_GetTemplateTOMLFilePath();\n    console.error('Error loading template `', templateFileName, '`::::', error);\n  }\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: load database\n *  note: InitializeDatabase() was already called on system initialization\n *  to populate the NODES and EDGES structures */\nDB.PKT_GetDatabase = function (pkt) {\n  let nodes = NODES.chain().data({ removeMeta: false });\n  let edges = EDGES.chain().data({ removeMeta: false });\n  let comments = COMMENTS.chain().data();\n  let readby = READBY.chain().data();\n  if (DBG)\n    console.log(\n      PR,\n      `PKT_GetDatabase ${pkt.Info()} (loaded ${nodes.length} nodes, ${\n        edges.length\n      } edges)`\n    );\n  m_MigrateNodes(nodes);\n  m_MigrateEdges(edges);\n  LOGGER.WriteRLog(pkt.InfoObj(), `getdatabase`);\n  return { d3data: { nodes, edges }, template: TEMPLATE, comments, readby };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: reset database from scratch */\nDB.PKT_SetDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_SetDatabase`);\n  let { nodes = [], edges = [], comments = [], readby = [] } = pkt.Data();\n  if (!nodes.length) console.log(PR, 'WARNING: empty nodes array');\n  else console.log(PR, `setting ${nodes.length} nodes...`);\n  if (!edges.length) console.log(PR, 'WARNING: empty edges array');\n  else console.log(PR, `setting ${edges.length} edges...`);\n  if (!comments.length) console.log(PR, 'WARNING: empty comments array');\n  else console.log(PR, `setting ${comments.length} comments...`);\n  if (!readby.length) console.log(PR, 'WARNING: empty readby array');\n  else console.log(PR, `setting ${readby.length} readby...`);\n  NODES.clear();\n  NODES.insert(nodes);\n  EDGES.clear();\n  EDGES.insert(edges);\n  COMMENTS.clear();\n  COMMENTS.insert(comments);\n  READBY.clear();\n  READBY.insert(readby);\n  console.log(PR, `PKT_SetDatabase complete. Data available on next get.`);\n  m_db.close();\n  DB.InitializeDatabase();\n  LOGGER.WriteRLog(pkt.InfoObj(), `setdatabase`);\n  return { OK: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Add nodes/edges to an existing db */\nDB.PKT_InsertDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_InsertDatabase`);\n  let { nodes = [], edges = [], comments = [], readby = [] } = pkt.Data();\n  if (!nodes.length) console.log(PR, 'WARNING: empty nodes array');\n  else console.log(PR, `setting ${nodes.length} nodes...`);\n  if (!edges.length) console.log(PR, 'WARNING: empty edges array');\n  else console.log(PR, `setting ${edges.length} edges...`);\n  if (!comments.length) console.log(PR, 'WARNING: empty comments array');\n  else console.log(PR, `setting ${comments.length} comments...`);\n  if (!readby.length) console.log(PR, 'WARNING: empty readby array');\n  else console.log(PR, `setting ${readby.length} readby...`);\n  NODES.insert(nodes);\n  EDGES.insert(edges);\n  COMMENTS.insert(comments);\n  READBY.insert(readby);\n  console.log(PR, `PKT_InsertDatabase complete. Data available on next get.`);\n  m_db.close();\n  DB.InitializeDatabase();\n  LOGGER.WriteRLog(pkt.InfoObj(), `setdatabase`);\n  return { OK: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Update or add nodes/edges to an existing db\n *  If the node/edge exists, update it.\n *  Otherwise, insert it.\n *  This walks down the node and edge arrays one by one,\n *  using PKT_Update to decide whether to insert or update the data.\n *  REVIEW: Consider batch operations ala `NODES.insert(nodes)`?\n */\nDB.PKT_MergeDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_MergeDatabase`);\n  let { nodes = [], edges = [], comments = [], readby = [] } = pkt.Data();\n\n  // Save Backup First!\n  m_BackupDatabase();\n\n  // insert nodes one by one\n  nodes.forEach(n => {\n    pkt.data.node = n;\n    DB.PKT_Update(pkt);\n  });\n  pkt.data.node = undefined; // clear, no longer needed\n\n  edges.forEach(e => {\n    pkt.data.edge = e;\n    DB.PKT_Update(pkt);\n  });\n  pkt.data.edge = undefined; // clear, no longer needed\n\n  comments.forEach(c => {\n    pkt.data.comments = c;\n    DB.PKT_Update(pkt);\n  });\n  pkt.data.comment = undefined; // clear, no longer needed\n\n  readby.forEach(r => {\n    pkt.data.readby = r;\n    DB.PKT_Update(pkt);\n  });\n  pkt.data.readby = undefined; // clear, no longer needed\n\n  return new Promise((resolve, reject) =>\n    m_db.saveDatabase(err => {\n      if (err) reject(new Error('rejected'));\n      DB.InitializeDatabase();\n      LOGGER.WriteRLog(pkt.InfoObj(), `mergedatabase`);\n      resolve({ OK: true });\n    })\n  );\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Update all data in existing database.\n *  Used to update node/edge types after template edit */\nDB.PKT_UpdateDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_UpdateDatabase`);\n  let { nodes = [], edges = [], comments = [], readby = [] } = pkt.Data();\n  if (!nodes.length) console.log(PR, 'WARNING: empty nodes array');\n  else console.log(PR, `updating ${nodes.length} nodes...`);\n  if (!edges.length) console.log(PR, 'WARNING: empty edges array');\n  else console.log(PR, `updating ${edges.length} edges...`);\n  if (!comments.length) console.log(PR, 'WARNING: empty comments array');\n  else console.log(PR, `updating ${comments.length} comments...`);\n  if (!readby.length) console.log(PR, 'WARNING: empty readby array');\n  else console.log(PR, `updating ${readby.length} readby...`);\n  NODES.update(nodes);\n  EDGES.update(edges);\n  COMMENTS.update(comments);\n  READBY.update(readby);\n  console.log(PR, `PKT_UpdateDatabase complete. Disk db file updated.`);\n  m_db.saveDatabase();\n  LOGGER.WriteRLog(pkt.InfoObj(), `updatedatabase`);\n  return { OK: true };\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: reset database from scratch\n *  Used to clear the existing database and load new nodes and edges\n *  The equivalent of loading a project -- used to faciliate loading\n *  a project with Turbo360.\n */\nDB.PKT_ReplaceDatabase = function (pkt) {\n  if (DBG) console.log(PR, `PKT_ReplaceDatabase`);\n  let { nodes = [], edges = [], comments = [], readby = [] } = pkt.Data();\n  if (!nodes.length) console.log(PR, 'WARNING: empty nodes array');\n  else console.log(PR, `setting ${nodes.length} nodes...`);\n  if (!edges.length) console.log(PR, 'WARNING: empty edges array');\n  else console.log(PR, `setting ${edges.length} edges...`);\n  if (!comments.length) console.log(PR, 'WARNING: empty comments array');\n  else console.log(PR, `setting ${comments.length} comments...`);\n  if (!readby.length) console.log(PR, 'WARNING: empty readby array');\n  else console.log(PR, `setting ${readby.length} readby...`);\n\n  // Save Backup First!\n  m_BackupDatabase();\n\n  NODES.clear();\n  NODES.insert(nodes);\n  EDGES.clear();\n  EDGES.insert(edges);\n  COMMENTS.clear();\n  COMMENTS.insert(comments);\n  READBY.clear();\n  READBY.insert(readby);\n  m_db.saveDatabase();\n  LOGGER.WriteRLog(pkt.InfoObj(), `replacedatabase`);\n  return { OK: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// WARN: Side Effect: Changes `m_max_nodeID`\nfunction m_CalculateMaxNodeID() {\n  if (NODES.count() > 0) {\n    m_max_nodeID = NODES.mapReduce(\n      obj => obj.id,\n      arr => Math.max(...arr)\n    );\n  } else {\n    m_max_nodeID = 0;\n  }\n  return m_max_nodeID;\n}\nDB.PKT_CalculateMaxNodeID = function (pkt) {\n  if (DBG) console.log(PR, `PKT_CalculateMaxNodeID ${pkt.Info()}`);\n  return { maxNodeID: m_CalculateMaxNodeID() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_GetNewNodeID() {\n  m_max_nodeID += 1;\n  return m_max_nodeID;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_GetNewNodeID = function (pkt) {\n  if (DBG) console.log(PR, `PKT_GetNewNodeID ${pkt.Info()} nodeID ${m_max_nodeID}`);\n  return { nodeID: m_GetNewNodeID() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_GetNewNodeIDs = function (pkt) {\n  const count = Number(pkt.Data().count);\n  const firstId = m_max_nodeID + 1;\n  const nodeIDs = [];\n  for (let i = 0; i < count; i++) nodeIDs.push(firstId + i);\n  m_max_nodeID += count;\n  if (DBG) console.log(PR, `PKT_GetNewNodeIDS ${pkt.Info()} nodeIDs ${nodeIDs}`);\n  return { nodeIDs };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_CalculateMaxEdgeID() {\n  if (EDGES.count() > 0) {\n    m_max_edgeID = EDGES.mapReduce(\n      obj => obj.id,\n      arr => Math.max(...arr)\n    );\n  } else {\n    m_max_edgeID = 0;\n  }\n  return m_max_edgeID;\n}\nDB.PKT_CalculateMaxEdgeID = function (pkt) {\n  if (DBG) console.log(PR, `PKT_CalculateMaxEdgeID ${pkt.Info()}`);\n  return { maxEdgeID: m_CalculateMaxEdgeID() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_GetNewEdgeID() {\n  m_max_edgeID += 1;\n  return m_max_edgeID;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_GetNewEdgeID = function (pkt) {\n  if (DBG) console.log(PR, `PKT_GetNewEdgeID ${pkt.Info()} edgeID ${m_max_edgeID}`);\n  return { edgeID: m_GetNewEdgeID() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_GetNewEdgeIDs = function (pkt) {\n  const count = Number(pkt.Data().count);\n  const firstId = m_max_edgeID + 1;\n  const edgeIDs = [];\n  for (let i = 0; i < count; i++) edgeIDs.push(firstId + i);\n  m_max_edgeID += count;\n  if (DBG) console.log(PR, `PKT_GetNewEdgeIDs ${pkt.Info()} edgeIDs ${edgeIDs}`);\n  return { edgeIDs };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_GetNewCommentID() {\n  m_max_commentID += 1;\n  return m_max_commentID;\n}\nDB.PKT_GetNewCommentID = function (pkt) {\n  if (DBG)\n    console.log(PR, `PKT_GetNewCommentID ${pkt.Info()} commentID ${m_max_commentID}`);\n  return { comment_id: m_GetNewCommentID() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// WARN: Side Effect: Changes `m_max_nodeID`\nfunction m_CalculateMaxCommentID() {\n  if (COMMENTS.count() > 0) {\n    m_max_commentID = COMMENTS.mapReduce(\n      obj => obj.comment_id,\n      arr => Math.max(...arr)\n    );\n  } else {\n    m_max_commentID = 0;\n  }\n  return m_max_commentID;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestLockNode = function (pkt) {\n  let { nodeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidNode(nodeID);\n  if (errcode) return errcode;\n  // check if node is already locked\n  if (m_locked_nodes.has(nodeID))\n    return m_MakeLockError(`nodeID ${nodeID} is already locked`);\n  // SUCCESS\n  // single matching node exists and is not yet locked, so lock it\n  m_locked_nodes.set(nodeID, uaddr);\n  return { nodeID, locked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockNode = function (pkt) {\n  let { nodeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidNode(nodeID);\n  if (errcode) return errcode;\n  // check that node is already locked\n  if (m_locked_nodes.has(nodeID)) {\n    m_locked_nodes.delete(nodeID);\n    return { nodeID, unlocked: true };\n  }\n  // this is an error because nodeID wasn't in the lock table\n  return m_MakeLockError(`nodeID ${nodeID} was not locked so can't unlock`);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_IsNodeLocked = function (pkt) {\n  let { nodeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidNode(nodeID);\n  if (errcode) return errcode;\n  const isLocked = m_locked_nodes.has(nodeID);\n  return { nodeID, locked: isLocked };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_IsInvalidNode(nodeID) {\n  if (!nodeID) return m_MakeLockError(`undefined nodeID`);\n  nodeID = Number.parseInt(nodeID, 10);\n  if (isNaN(nodeID)) return m_MakeLockError(`nodeID was not a number`);\n  if (nodeID < 0) return m_MakeLockError(`nodeID ${nodeID} must be positive integer`);\n  if (nodeID > m_max_nodeID)\n    return m_MakeLockError(`nodeID ${nodeID} is out of range`);\n  // find if the node exists\n  let matches = NODES.find({ id: nodeID });\n  if (matches.length === 0) return m_MakeLockError(`nodeID ${nodeID} not found`);\n  if (matches.length > 1)\n    return m_MakeLockError(\n      `nodeID ${nodeID} matches multiple entries...critical error!`\n    );\n  // no retval is no error!\n  return undefined;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_MakeLockError(info) {\n  return { NOP: `ERR`, INFO: info };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestLockEdge = function (pkt) {\n  let { edgeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidEdge(edgeID);\n  if (errcode) return errcode;\n  // check if edge is already locked\n  if (m_locked_edges.has(edgeID))\n    return m_MakeLockError(`edgeID ${edgeID} is already locked`);\n  // SUCCESS\n  // single matching edge exists and is not yet locked, so lock it\n  m_locked_edges.set(edgeID, uaddr);\n  return { edgeID, locked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockEdge = function (pkt) {\n  let { edgeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidEdge(edgeID);\n  if (errcode) return errcode;\n  // check that edge is already locked\n  if (m_locked_edges.has(edgeID)) {\n    m_locked_edges.delete(edgeID);\n    return { edgeID, unlocked: true };\n  }\n  // this is an error because nodeID wasn't in the lock table\n  return m_MakeLockError(`edgeID ${edgeID} was not locked so can't unlock`);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_IsEdgeLocked = function (pkt) {\n  let { edgeID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  let errcode = m_IsInvalidEdge(edgeID);\n  if (errcode) return errcode;\n  const isLocked = m_locked_edges.has(edgeID);\n  return { edgeID, locked: isLocked };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_IsInvalidEdge(edgeID) {\n  if (!edgeID) return m_MakeLockError(`undefined edgeID`);\n  edgeID = Number.parseInt(edgeID, 10);\n  if (isNaN(edgeID)) return m_MakeLockError(`edgeID was not a number`);\n  if (edgeID < 0) return m_MakeLockError(`edgeID ${edgeID} must be positive integer`);\n  if (edgeID > m_max_edgeID)\n    return m_MakeLockError(`edgeID ${edgeID} is out of range`);\n  // find if the node exists\n  let matches = EDGES.find({ id: edgeID });\n  if (matches.length === 0) return m_MakeLockError(`edgeID ${edgeID} not found`);\n  if (matches.length > 1)\n    return m_MakeLockError(\n      `edgeID ${edgeID} matches multiple entries...critical error!`\n    );\n  // no retval is no error!\n  return undefined;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestLockComment = function (pkt) {\n  let { commentID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  // check if comment is already locked\n  if (m_locked_comments.has(commentID))\n    return m_MakeLockError(`commentID ${commentID} is already locked`);\n  // SUCCESS\n  // single matching comment exists and is not yet locked, so lock it\n  m_locked_comments.set(commentID, uaddr);\n  return { commentID, locked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockComment = function (pkt) {\n  let { commentID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  // check that comment is already locked\n  if (m_locked_comments.has(commentID)) {\n    m_locked_comments.delete(commentID);\n    return { commentID, unlocked: true };\n  }\n  // this is an error because commentID wasn't in the lock table\n  return m_MakeLockError(`commentID ${commentID} was not locked so can't unlock`);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_IsCommentLocked = function (pkt) {\n  let { commentID } = pkt.Data();\n  const uaddr = pkt.s_uaddr;\n  const isLocked = m_locked_comments.has(commentID);\n  return { commentID, locked: isLocked };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockAllNodes = function (pkt) {\n  m_locked_nodes = new Map();\n  return { unlocked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockAllEdges = function (pkt) {\n  m_locked_edges = new Map();\n  return { unlocked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockAllComments = function (pkt) {\n  m_locked_comments = new Map();\n  return { unlocked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.PKT_RequestUnlockAll = function (pkt) {\n  m_locked_nodes = new Map();\n  m_locked_edges = new Map();\n  m_locked_comments = new Map();\n  m_open_editors = [];\n  return { unlocked: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** called by server-network when a client disconnects we want to unlock any\n *  nodes and edges they had locked. */\nDB.RequestUnlock = function (uaddr) {\n  m_locked_nodes.forEach((value, key) => {\n    if (value === uaddr) m_locked_nodes.delete(key);\n  });\n  m_locked_edges.forEach((value, key) => {\n    if (value === uaddr) m_locked_edges.delete(key);\n  });\n  m_locked_comments.forEach((value, key) => {\n    if (value === uaddr) m_locked_comments.delete(key);\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// eslint-disable-next-line complexity\nDB.PKT_Update = function (pkt) {\n  let { node, edge, nodeID, replacementNodeID, edgeID, comment, readbys } =\n    pkt.Data();\n  let retval = {};\n  // PROCESS NODE INSERT/UPDATE\n  if (node) {\n    m_CleanObjID(`${pkt.Info()} node.id`, node);\n    let matches = NODES.find({ id: node.id });\n    if (matches.length === 0) {\n      // if there was no node, then this is an insert new operation\n      if (DBG)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} INSERT nodeID ${JSON.stringify(node)}`\n        );\n\n      // Handle different id types\n      if (isNaN(node.id)) {\n        // If the node id has NOT been defined, generate a new node id\n        node.id = m_GetNewNodeID();\n      }\n\n      LOGGER.WriteRLog(pkt.InfoObj(), `insert node`, node.id, JSON.stringify(node));\n      DB.AppendNodeLog(node, pkt); // log GroupId to node stored in database\n      NODES.insert(node);\n      // Return the updated record -- needed to update metadata\n      let updatedNode = NODES.findOne({ id: node.id });\n      if (!updatedNode)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} could not find node after update!  This should not happen! ${\n            node.id\n          } ${JSON.stringify(node)}`\n        );\n      retval = { op: 'insert', node: updatedNode };\n    } else if (matches.length === 1) {\n      // there was one match to update\n      NODES.findAndUpdate({ id: node.id }, n => {\n        if (DBG)\n          console.log(\n            PR,\n            `PKT_Update ${pkt.Info()} UPDATE nodeID ${node.id} ${JSON.stringify(\n              node\n            )}`\n          );\n        LOGGER.WriteRLog(pkt.InfoObj(), `update node`, node.id, JSON.stringify(node));\n        DB.AppendNodeLog(n, pkt); // log GroupId to node stored in database\n        Object.assign(n, node);\n      });\n      // Return the updated record -- needed to update metadata\n      let updatedNode = NODES.findOne({ id: node.id });\n      if (!updatedNode)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} could not find node after update!  This should not happen! ${\n            node.id\n          } ${JSON.stringify(node)}`\n        );\n      retval = { op: 'update', node: updatedNode };\n    } else {\n      if (DBG)\n        console.log(PR, `WARNING: multiple nodeID ${node.id} x${matches.length}`);\n      LOGGER.WriteRLog(pkt.InfoObj(), `ERROR`, node.id, 'duplicate node id');\n      retval = { op: 'error-multinodeid' };\n    }\n    // Always update m_max_nodeID\n    m_CalculateMaxNodeID();\n    return retval;\n  } // if node\n\n  // PROCESS EDGE INSERT/UPDATE\n  if (edge) {\n    m_CleanObjID(`${pkt.Info()} edge.id`, edge);\n    let matches = EDGES.find({ id: edge.id });\n    if (matches.length === 0) {\n      // this is a new edge\n      if (DBG)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} INSERT edgeID ${edge.id} ${JSON.stringify(edge)}`\n        );\n\n      // Handle different id types\n      if (isNaN(edge.id)) {\n        // If the edge id has NOT been defined, generate a new edge id\n        edge.id = m_GetNewEdgeID();\n      }\n\n      LOGGER.WriteRLog(pkt.InfoObj(), `insert edge`, edge.id, JSON.stringify(edge));\n      DB.AppendEdgeLog(edge, pkt); // log GroupId to edge stored in database\n      EDGES.insert(edge);\n      // Return the updated record -- needed to update metadata\n      let updatedEdge = EDGES.findOne({ id: edge.id });\n      if (!updatedEdge)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} could not find edge after update!  This should not happen! ${\n            edge.id\n          } ${JSON.stringify(edge)}`\n        );\n      retval = { op: 'insert', edge: updatedEdge };\n    } else if (matches.length === 1) {\n      // update this edge\n      EDGES.findAndUpdate({ id: edge.id }, e => {\n        if (DBG)\n          console.log(\n            PR,\n            `PKT_Update ${pkt.SourceGroupID()} UPDATE edgeID ${\n              edge.id\n            } ${JSON.stringify(edge)}`\n          );\n        LOGGER.WriteRLog(pkt.InfoObj(), `update edge`, edge.id, JSON.stringify(edge));\n        DB.AppendEdgeLog(e, pkt); // log GroupId to edge stored in database\n        Object.assign(e, edge);\n      });\n      // Return the updated record -- needed to update metadata\n      let updatedEdge = EDGES.findOne({ id: edge.id });\n      if (!updatedEdge)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} could not find edge after update!  This should not happen! ${\n            edge.id\n          } ${JSON.stringify(edge)}`\n        );\n      retval = { op: 'update', edge: updatedEdge };\n    } else {\n      console.log(PR, `WARNING: multiple edgeID ${edge.id} x${matches.length}`);\n      LOGGER.WriteRLog(pkt.InfoObj(), `ERROR`, node.id, 'duplicate edge id');\n      retval = { op: 'error-multiedgeid' };\n    }\n    // Always update m_max_edgeID\n    m_CalculateMaxEdgeID();\n    return retval;\n  } // if edge\n\n  // DELETE NODE\n  if (nodeID !== undefined) {\n    nodeID = m_CleanID(`${pkt.Info()} nodeID`, nodeID);\n    if (DBG) console.log(PR, `PKT_Update ${pkt.Info()} DELETE nodeID ${nodeID}`);\n    // Log first so it's apparent what is triggering the edge changes\n    LOGGER.WriteRLog(pkt.InfoObj(), `delete node`, nodeID);\n\n    // handle edges\n    let edgesToProcess = EDGES.where(e => {\n      return e.source === nodeID || e.target === nodeID;\n    });\n\n    // handle linked nodes\n    replacementNodeID = m_CleanID(\n      `${pkt.Info()} replacementNodeID`,\n      replacementNodeID\n    );\n    if (replacementNodeID !== -1) {\n      // re-link edges to replacementNodeID...\n      EDGES.findAndUpdate({ source: nodeID }, e => {\n        LOGGER.WriteRLog(\n          pkt.InfoObj(),\n          `relinking edge`,\n          e.id,\n          `to`,\n          replacementNodeID\n        );\n        e.source = replacementNodeID;\n      });\n      EDGES.findAndUpdate({ target: nodeID }, e => {\n        LOGGER.WriteRLog(\n          pkt.InfoObj(),\n          `relinking edge`,\n          e.id,\n          `to`,\n          replacementNodeID\n        );\n        e.target = replacementNodeID;\n      });\n    } else {\n      // ... or delete edges completely\n      let sourceEdges = EDGES.find({ source: nodeID });\n      EDGES.findAndRemove({ source: nodeID });\n      if (sourceEdges.length)\n        LOGGER.WriteRLog(\n          pkt.InfoObj(),\n          `deleting ${sourceEdges.length} sources matching ${nodeID}`\n        );\n      let targetEdges = EDGES.find({ target: nodeID });\n      EDGES.findAndRemove({ target: nodeID });\n      if (targetEdges.length)\n        LOGGER.WriteRLog(\n          pkt.InfoObj(),\n          `deleting ${targetEdges.length} targets matching ${nodeID}`\n        );\n    }\n    // ...finally remove the node itself\n    NODES.findAndRemove({ id: nodeID });\n    return { op: 'delete', nodeID, replacementNodeID };\n  }\n\n  // DELETE EDGES\n  if (edgeID !== undefined) {\n    edgeID = m_CleanID(`${pkt.Info()} edgeID`, edgeID);\n    if (DBG) console.log(PR, `PKT_Update ${pkt.Info()} DELETE edgeID ${edgeID}`);\n    LOGGER.WriteRLog(pkt.InfoObj(), `delete edge`, edgeID);\n    EDGES.findAndRemove({ id: edgeID });\n    return { op: 'delete', edgeID };\n  }\n\n  // PROCESS COMMENT INSERT/UPDATE\n  if (comment) {\n    m_CleanObjID(`${pkt.Info()} comment.id`, comment);\n    let matches = COMMENTS.find({ comment_id: comment.comment_id });\n    if (matches.length === 0) {\n      // if there was no comment, then this is an insert new operation\n      if (DBG)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} INSERT comment_id ${JSON.stringify(comment)}`\n        );\n\n      // Handle different id types\n      if (isNaN(comment.comment_id)) {\n        // If the node id has NOT been defined, generate a new node id\n        comment.comment_id = m_GetNewCommentID();\n      }\n\n      LOGGER.WriteRLog(\n        pkt.InfoObj(),\n        `insert comment`,\n        comment.comment_id,\n        JSON.stringify(comment)\n      );\n      DB.AppendCommentLog(comment, pkt); // log GroupId to node stored in database\n      COMMENTS.insert(comment);\n      // Return the updated record -- needed to update metadata\n      let updatedComment = COMMENTS.findOne({ comment_id: comment.comment_id });\n      if (!updatedComment)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} could not find new comment after update!  This should not happen! ${\n            comment.comment_id\n          } ${JSON.stringify(comment)}`\n        );\n      retval = { op: 'insert', comment: updatedComment };\n    } else if (matches.length === 1) {\n      // there was one match to, so update the comment\n      COMMENTS.findAndUpdate({ comment_id: comment.comment_id }, c => {\n        if (DBG)\n          console.log(\n            PR,\n            `PKT_Update ${pkt.Info()} UPDATE comment_id ${\n              comment.comment_id\n            } ${JSON.stringify(comment)}`\n          );\n        LOGGER.WriteRLog(\n          pkt.InfoObj(),\n          `update comment`,\n          comment.comment_id,\n          JSON.stringify(comment)\n        );\n        DB.AppendCommentLog(c, pkt); // log GroupId to node stored in database\n        Object.assign(c, comment);\n      });\n      // Return the updated record -- needed to update metadata\n\n      let updatedComment = COMMENTS.findOne({ comment_id: comment.comment_id });\n      if (!updatedComment)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} could not find updated comment after update!  This should not happen! ${\n            comment.comment_id\n          } ${JSON.stringify(comment)}`\n        );\n      retval = { op: 'update', comment: updatedComment };\n    } else {\n      if (DBG)\n        console.log(\n          PR,\n          `WARNING: multiple comment_id ${comment.comment_id} x${matches.length}`\n        );\n      LOGGER.WriteRLog(\n        pkt.InfoObj(),\n        `ERROR`,\n        comment.comment_id,\n        'duplicate comment id'\n      );\n      retval = { op: 'error-multinodeid' };\n    }\n    return retval;\n  } // if comment\n\n  // PROCESS READBY INSERT/UPDATE\n  // NOTE this is a little different than the others because `readbys` is an array of readby objects.\n  if (readbys) {\n    const retvals = [];\n    readbys.forEach(readby => {\n      m_CleanObjID(`${pkt.Info()} readby.id`, readby);\n      let matches = READBY.find({ comment_id: readby.comment_id });\n      if (matches.length === 0) {\n        // if there was no readby, then this is an insert new operation\n        if (DBG)\n          console.log(\n            PR,\n            `PKT_Update ${pkt.Info()} INSERT comment_id ${JSON.stringify(readby)}`\n          );\n\n        // Handle different id types\n        if (isNaN(readby.comment_id)) {\n          // If the node id has NOT been defined, generate a new node id\n          throw new Error(\n            `server-database.PKT_Update called with invalid comment_id ${JSON.stringify(\n              readby\n            )}. This should not happen.`\n          );\n        }\n\n        LOGGER.WriteRLog(\n          pkt.InfoObj(),\n          `insert readby`,\n          readby.comment_id,\n          JSON.stringify(readby)\n        );\n        DB.AppendReadbyLog(readby, pkt); // log GroupId to node stored in database\n        READBY.insert(readby);\n        // Return the updated record -- needed to update metadata\n        let updatedReadby = READBY.findOne({ comment_id: readby.comment_id });\n        if (!updatedReadby)\n          console.log(\n            PR,\n            `PKT_Update ${pkt.Info()} could not find new readby after update!  This should not happen! ${\n              readby.comment_id\n            } ${JSON.stringify(readby)}`\n          );\n        retval = { op: 'insert', readby: updatedReadby };\n      } else if (matches.length === 1) {\n        // there was one match to, so update the comment\n        READBY.findAndUpdate({ comment_id: readby.comment_id }, r => {\n          if (DBG)\n            console.log(\n              PR,\n              `PKT_Update ${pkt.Info()} UPDATE comment_id ${\n                readby.comment_id\n              } ${JSON.stringify(readby)}`\n            );\n          LOGGER.WriteRLog(\n            pkt.InfoObj(),\n            `update readby`,\n            readby.comment_id,\n            JSON.stringify(readby)\n          );\n          DB.AppendReadbyLog(r, pkt); // log GroupId to node stored in database\n          Object.assign(r, readby);\n        });\n        // Return the updated record -- needed to update metadata\n\n        let updatedReadby = READBY.findOne({ comment_id: readby.comment_id });\n        if (!updatedReadby)\n          console.log(\n            PR,\n            `PKT_Update ${pkt.Info()} could not find updated readby after update!  This should not happen! ${\n              readby.comment_id\n            } ${JSON.stringify(readby)}`\n          );\n        retval = { op: 'update', readby: updatedReadby };\n      } else {\n        if (DBG)\n          console.log(\n            PR,\n            `WARNING: multiple comment_id ${readby.comment_id} x${matches.length}`\n          );\n        LOGGER.WriteRLog(\n          pkt.InfoObj(),\n          `ERROR`,\n          readby.comment_id,\n          'duplicate comment id'\n        );\n        retval = { op: 'error-multinodeid' };\n      }\n      // NOTE returns an array of retvals for multiple replies\n      retvals.push(retval);\n    });\n    return retvals;\n  } // if readby\n\n  // return update value\n  return { op: 'error-noaction' };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** NOTE: Unlike PKT_Update, the return value is an array with multiple\n *  results */\nDB.PKT_BatchUpdate = function (pkt) {\n  let { items } = pkt.Data();\n  let retvals = [];\n  items.forEach(item => {\n    const { comment, commentID, collection_ref } = item;\n    // PROCESS COMMENT INSERT/UPDATE\n    if (comment) retvals.push(m_CommentUpdate(comment, pkt));\n    // DELETE SINGLE COMMENT\n    if (commentID !== undefined) retvals.push(m_CommentRemove(commentID, pkt));\n    // Trigger derived value update after removal\n    if (collection_ref) retvals.push({ op: 'refresh', collection_ref });\n  });\n  return retvals;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_CommentUpdate(comment, pkt) {\n  m_CleanObjID(`${pkt.Info()} comment.id`, comment);\n  let matches = COMMENTS.find({ comment_id: comment.comment_id });\n  if (matches.length === 0) {\n    // if there was no comment, then this is an insert new operation\n    if (DBG)\n      console.log(\n        PR,\n        `PKT_Update ${pkt.Info()} INSERT comment_id ${JSON.stringify(comment)}`\n      );\n    // Handle different id types\n    if (isNaN(comment.comment_id)) {\n      // If the comment id has NOT been defined, generate a new comment id\n      comment.comment_id = m_GetNewCommentID();\n    }\n    LOGGER.WriteRLog(\n      pkt.InfoObj(),\n      `insert comment`,\n      comment.comment_id,\n      JSON.stringify(comment)\n    );\n    DB.AppendCommentLog(comment, pkt); // log GroupId to node stored in database\n    COMMENTS.insert(comment);\n    // Return the updated record -- needed to update metadata\n    let updatedComment = COMMENTS.findOne({ comment_id: comment.comment_id });\n    if (!updatedComment)\n      console.log(\n        PR,\n        `PKT_Update ${pkt.Info()} could not find new comment after update!  This should not happen! ${\n          comment.comment_id\n        } ${JSON.stringify(comment)}`\n      );\n    retval = { op: 'insert', comment: updatedComment };\n  } else if (matches.length === 1) {\n    // there was one match to, so update the comment\n    COMMENTS.findAndUpdate({ comment_id: comment.comment_id }, c => {\n      if (DBG)\n        console.log(\n          PR,\n          `PKT_Update ${pkt.Info()} UPDATE comment_id ${\n            comment.comment_id\n          } ${JSON.stringify(comment)}`\n        );\n      LOGGER.WriteRLog(\n        pkt.InfoObj(),\n        `update comment`,\n        comment.comment_id,\n        JSON.stringify(comment)\n      );\n      DB.AppendCommentLog(c, pkt); // log GroupId to node stored in database\n      Object.assign(c, comment);\n    });\n    // Return the updated record -- needed to update metadata\n\n    let updatedComment = COMMENTS.findOne({ comment_id: comment.comment_id });\n    if (!updatedComment)\n      console.log(\n        PR,\n        `PKT_Update ${pkt.Info()} could not find updated comment after update!  This should not happen! ${\n          comment.comment_id\n        } ${JSON.stringify(comment)}`\n      );\n    retval = { op: 'update', comment: updatedComment };\n  } else {\n    if (DBG)\n      console.log(\n        PR,\n        `WARNING: multiple comment_id ${comment.comment_id} x${matches.length}`\n      );\n    LOGGER.WriteRLog(\n      pkt.InfoObj(),\n      `ERROR`,\n      comment.comment_id,\n      'duplicate comment id'\n    );\n    retval = { op: 'error-multinodeid' };\n  }\n  return retval;\n} // if comment\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_CommentRemove(commentID, pkt) {\n  if (DBG) console.log(PR, `PKT_Update ${pkt.Info()} DELETE commentID ${commentID}`);\n  // Log first so it's apparent what is triggering the changes\n  LOGGER.WriteRLog(pkt.InfoObj(), `delete comment`, commentID);\n  COMMENTS.findAndRemove({ comment_id: commentID });\n  return { op: 'delete', commentID };\n}\n\n/// NODE ANNOTATION ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** write/remove packet SourceGroupID() information into the node before writing\n *  the first entry is the insert, subsequent operations are updates */\nDB.AppendNodeLog = function (node, pkt) {\n  if (!node._nlog) node._nlog = [];\n  let gid = pkt.SourceGroupID() || pkt.SourceAddress();\n  node._nlog.push(gid);\n  if (DBG) {\n    let out = '';\n    node._nlog.forEach(el => {\n      out += `[${el}] `;\n    });\n    console.log(PR, 'nodelog', out);\n  }\n};\nDB.FilterNodeLog = function (node) {\n  let newNode = Object.assign({}, node);\n  Reflect.deleteProperty(newNode, '_nlog');\n  return newNode;\n};\n\n/// EDGE ANNOTATION ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** write/remove packet SourceGroupID() information into the node before writing\n *  the first entry is the insert, subsequent operations are updates */\nDB.AppendEdgeLog = function (edge, pkt) {\n  if (!edge._elog) edge._elog = [];\n  let gid = pkt.SourceGroupID() || pkt.SourceAddress();\n  edge._elog.push(gid);\n  if (DBG) {\n    let out = '';\n    edge._elog.forEach(el => {\n      out += `[${el}] `;\n    });\n    console.log(PR, 'edgelog', out);\n  }\n};\nDB.FilterEdgeLog = function (edge) {\n  let newEdge = Object.assign({}, edge);\n  Reflect.deleteProperty(newEdge, '_elog');\n  return newEdge;\n};\n/// COMMENT ANNOTATION ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** write/remove packet SourceGroupID() information into the comment before writing\n *  the first entry is the insert, subsequent operations are updates */\nDB.AppendCommentLog = function (comment, pkt) {\n  if (!comment._nlog) comment._nlog = [];\n  let gid = pkt.SourceGroupID() || pkt.SourceAddress();\n  comment._nlog.push(gid);\n  if (DBG) {\n    let out = '';\n    comment._nlog.forEach(el => {\n      out += `[${el}] `;\n    });\n    console.log(PR, 'commentlog', out);\n  }\n};\nDB.FilterCommentLog = function (comment) {\n  let newComment = Object.assign({}, comment);\n  Reflect.deleteProperty(newComment, '_nlog');\n  return newComment;\n};\n/// READBY ANNOTATION ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** write/remove packet SourceGroupID() information into the readby before writing\n *  the first entry is the insert, subsequent operations are updates */\nDB.AppendReadbyLog = function (readby, pkt) {\n  if (!readby._nlog) readby._nlog = [];\n  let gid = pkt.SourceGroupID() || pkt.SourceAddress();\n  readby._nlog.push(gid);\n  if (DBG) {\n    let out = '';\n    readby._nlog.forEach(el => {\n      out += `[${el}] `;\n    });\n    console.log(PR, 'readbylog', out);\n  }\n};\nDB.FilterReadbyLog = function (readby) {\n  let newReadby = Object.assign({}, readby);\n  Reflect.deleteProperty(newReadby, '_nlog');\n  return newReadby;\n};\n\n/// JSON EXPORT ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** called by brunch to generate an up-to-date JSON file to path.\n *  creates the path if it doesn't exist */\nDB.WriteDbJSON = function (filePath) {\n  let dataset = NC_CONFIG.dataset;\n\n  // Ideally we should use m_otions value, but in standlone mode,\n  // m_options might not be defined.\n  db_file = m_options ? m_options.db_file : m_GetValidDBFilePath(dataset);\n  let db = new Loki(db_file, {\n    autoload: true,\n    autoloadCallback: () => {\n      if (typeof filePath === 'string') {\n        if (DBG) console.log(PR, `writing { nodes, edges } to '${filePath}'`);\n        let nodes = db.getCollection('nodes').chain().data({ removeMeta: false });\n        let edges = db.getCollection('edges').chain().data({ removeMeta: false });\n        const comments = db\n          .getCollection('comments')\n          .chain()\n          .data({ removeMeta: false });\n        const readby = db.getCollection('readby').chain().data({ removeMeta: false });\n        let data = { nodes, edges, comments, readby };\n        let json = JSON.stringify(data);\n        if (DBG) console.log(PR, `ensuring DIR ${PATH.dirname(filePath)}`);\n        FS.ensureDirSync(PATH.dirname(filePath));\n        if (DBG) console.log(PR, `writing file ${filePath}`);\n        FS.writeFileSync(filePath, json);\n        console.log(PR, `*** WROTE JSON DATABASE ${filePath}`);\n      } else {\n        console.log(PR, `ERR path ${filePath} must be a pathname`);\n      }\n    }\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** called by Template Editor and DB.WriteTemplateTOML\n */\nfunction m_GetTemplateTOMLFileName() {\n  return NC_CONFIG.dataset + TEMPLATE_EXT;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_GetTemplateTOMLFilePath() {\n  return RUNTIMEPATH + m_GetTemplateTOMLFileName();\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nDB.GetTemplateTOMLFileName = () => {\n  return { filename: m_GetTemplateTOMLFileName() };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** called by Template Editor to save TOML template changes to disk.\n *  @param {object} pkt.data.template\n *  @param pkt.data.path  Will override the current template path in NC_CONFIG.dataset\n *                        Use this to write to the _default template or\n *                        other specific template.\n *  WARN: Loads the template after saving!\n */\nDB.WriteTemplateTOML = pkt => {\n  if (pkt.data === undefined)\n    throw 'DB.WriteTemplateTOML pkt received with no `data`';\n  const templateFilePath = pkt.data.path || m_GetTemplateTOMLFilePath();\n  FS.ensureDirSync(PATH.dirname(templateFilePath));\n  // Does the template exist?  If so, rename the old version with curren timestamp.\n  if (FS.existsSync(templateFilePath)) {\n    const timestamp = new Date().toISOString().replace(/:/g, '.');\n    const backupFilePath =\n      RUNTIMEPATH + NC_CONFIG.dataset + '_' + timestamp + TEMPLATE_EXT;\n    FS.copySync(templateFilePath, backupFilePath);\n    console.log(PR, 'Backed up template to', backupFilePath);\n  }\n  const toml = TOML.stringify(pkt.data.template);\n  return FS.outputFile(templateFilePath, toml)\n    .then(data => {\n      console.log(PR, 'Saved template to', templateFilePath);\n      // reload template\n      m_LoadTemplate();\n      return { OK: true, info: templateFilePath };\n    })\n    .catch(err => {\n      console.log(PR, 'Failed trying to save', templateFilePath, err);\n      return { OK: false, info: 'Failed trying to save', templateFilePath };\n    });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Clones the existing toml template\n    called by brunch to generate an up-to-date Template file to path\n    for standalone mode.\n    creates the path if it doesn't exist\n */\nDB.CloneTemplateTOML = function (filePath) {\n  const TOMLPath = m_GetTemplateTOMLFilePath();\n  FS.ensureDirSync(PATH.dirname(TOMLPath));\n  // Does the template exist?\n  if (!FS.existsSync(TOMLPath)) {\n    console.error(PR, `ERR could not find template ${TOMLPath}`);\n  } else {\n    FS.copySync(TOMLPath, filePath);\n    console.log(PR, `*** COPIED TEMPLATE ${TOMLPath} to ${filePath}`);\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Regenerate Default Template from Template Schema\n    Call this when `template-schema.js` changes so that _default.template.toml will\n    match the schema defined in `template-schema.js`.\n    Use JSCLI `ncRegenerateDefaultTemplate` in the dev console to call this.\n */\nDB.RegenerateDefaultTemplate = () => {\n  const pkt = {\n    data: {\n      template: TEMPLATE_SCHEMA.ParseTemplateSchema(),\n      path: m_DefaultTemplatePath()\n    }\n  };\n  const toml = TOML.stringify(pkt.data.template);\n  return DB.WriteTemplateTOML(pkt);\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ OPENEDITORS\n\n    Used to coordinate Template editing, Importing, and Node/Edge editing.\n    They are mutually exclusive: if one is active, the others should be disabled\n    to prevent overwriting data.\n\n    Since Nodes and Edges should not be edited while the Template is being\n    edited or data is being imported, any editor that is opened registers\n    as an OPENEDITOR.  The UI will also pre-emptively disable edit buttons\n    whenever the open editors have been updated via a broacast of the\n    `EDIT_PERMISSIONS_UPDATE` message by server.js.\n\n    * When a Template editor is open, \"Import\", \"Node Edit\", \"Edge Edit\",\n      \"Add New Node\", and \"Add New Edge\" buttons are all disabled.\n    * When an Import file has been successfully selected and validated,\n      \"Template\", \"Node Edit\", \"Edge Edit\", \"Add New Node\", and\n      \"Add New Edge\" buttons are disabled.\n    * When \"Node Edit\", \"Edge Edit\", \"Add New Node\" or \"Add New Edge\" has\n      been triggered, the Template buttons on the Template panel and the\n      \"Import\" pane on the \"More\" panel are disabled.\n\n    m_open_editors is an array of all the editors (node, edge, template,\n    importer) that are currently open.\n\n    Whenever a template is being edited, import is requested, or a node or\n    edge is being edited:\n    1. They will register with `RequestEditLock`.\n    2. When they are finished, they will deregister using `ReleaseEditLock`.\n    3. `GetEditStatus` returns the current state of `m_open_editors`.\n\n    UI elements query `GetEditStatus` to figure out what they should\n    enable or disable.\n\n    UI elements should also listen to `EDIT_PERMISSIONS_UPDATE` to\n    enable or disable elements.\n\n    Note that multiple `node` and `edge` editors can be open at the same\n    time and ALL must be closed before the lock is released.  We support\n    this because each node or edge will have its own entry in m_open_editors,\n    though we do not distinguish between the individual nodes/edges.\n\n    Note that this is a different system from the instance-specific Node/Edge\n    lock that locks out individual node/edge objects for editing used with\n    `PKT_RequestLockNode` and `PKT_RequestLockEdge`.  m_open_editors focuses\n    on categories of editor types rather than locking out individual nodes\n    and edges to prevent others from editing the same node or edge.\n\n/*/\n/**\n * Returns object with flags indicating whether the template is being edited,\n * data is being imported, or node or edge are being edited\n * @returns {templateBeingEdited:boolean, importActive:boolean, nodeOrEdgeBeingEdited:boolean,\n *           lockedNodes:array, lockedEdges:array }\n */\nDB.GetEditStatus = pkt => {\n  const my_uaddr = pkt.s_uaddr;\n  // If there are any 'template' open editors, then templateBeingEdited is true\n  const templateBeingEdited = m_open_editors.includes(EDITORTYPE.TEMPLATE);\n  // If there are any 'importers' open editors, then importActive is true\n  const importActive = m_open_editors.includes(EDITORTYPE.IMPORTER);\n  // If there are any 'node' or 'edge' open editors, then nodeOrEdgeBeingEdited is true\n  const nodeOrEdgeBeingEdited =\n    m_open_editors.length > 0 &&\n    (m_open_editors.includes(EDITORTYPE.NODE) ||\n      m_open_editors.includes(EDITORTYPE.EDGE));\n  // NOT IMPLEMENTED\n  // -- This is now problematic with the new optimized state management because\n  //    editStatus is being broadcast to ALL clients, not just the one editing\n  // Was Used to disable local editing if a comment is being edited, but ignores network comment edits\n  // const commentBeingEditedByMe =\n  //   [...m_locked_comments.values()].find(\n  //     comment_uaddr => comment_uaddr === my_uaddr\n  //   ) || false; // returns `false` if not found -- necessary otherwise `commentBeingEditedByMe` is removed and not updated\n  return {\n    templateBeingEdited,\n    importActive,\n    nodeOrEdgeBeingEdited,\n    // commentBeingEditedByMe, // NOT IMPLEMENTED\n    lockedNodes: [...m_locked_nodes.keys()],\n    lockedEdges: [...m_locked_edges.keys()],\n    lockedComments: [...m_locked_comments.keys()]\n  };\n};\n/**\n * Register a template, import, node or edge as being actively edited.\n * @param {Object} pkt\n * @param {string} pkt.editor - 'template', 'importer', 'node', 'edge', or 'comment'\n * @returns { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean, commentBeingEdited: boolean }\n */\nDB.RequestEditLock = pkt => {\n  m_open_editors.push(pkt.Data().editor);\n  return DB.GetEditStatus(pkt);\n};\n/**\n * Deregister a template, import, node or edge as being actively edited.\n * @param {Object} pkt\n * @param {string} pkt.editor - 'template', 'importer', 'node', 'edge', or 'comment'\n * @returns { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean, commentBeingEdited: boolean }\n */\nDB.ReleaseEditLock = pkt => {\n  const i = m_open_editors.findIndex(e => e === pkt.Data().editor);\n  if (i > -1) m_open_editors.splice(i, 1);\n  return DB.GetEditStatus(pkt);\n};\n\n/// UTILITIES FOR LOADING DATA ///\n\n/** Migrates old network data to new formats based on the template defintion.\n *  This will automatically migrate any field/property that is marked `isRequired`\n *  and has a `defaultValue` defined.\n *\n *  The basic check is this:\n *  1. If the TEMPLATE property `isRequired`\n *  2. ...and the TEMPLATE propert has `defaultValue` defined\n *  2. ...and the node/edge property is currently undefined or ``\n *  3. ...then we set the property to the defaultValue\n *\n *  The key parameters:\n *    property.isRequired\n *    property.defaultValue\n *\n *  If `isRequired` or `defaultValue` is not defined on the property, we skip migration.\n *\n *  REVIEW: We might consider also adding type coercion. */\nfunction m_MigrateNodes(nodes) {\n  // modifies `nodes` by reference\n  // Migrate v1.4 to v2.0\n  for (const [propertyName, property] of Object.entries(TEMPLATE.nodeDefs)) {\n    if (property.isRequired && property.defaultValue !== undefined) {\n      nodes.forEach(n => {\n        if (n[propertyName] === undefined || n[propertyName] === '')\n          n[propertyName] = property.defaultValue;\n      });\n    }\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_MigrateEdges(edges) {\n  // modifies `edges` by reference\n  // Migrate v1.4 to v2.0\n  for (const [propertyName, property] of Object.entries(TEMPLATE.edgeDefs)) {\n    if (property.isRequired && property.defaultValue !== undefined) {\n      edges.forEach(e => {\n        if (e[propertyName] === undefined || e[propertyName] === '')\n          e[propertyName] = property.defaultValue;\n      });\n    }\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// utility function for cleaning nodes with numeric id property\nfunction m_CleanObjID(prompt, obj) {\n  if (typeof obj.id === 'string') {\n    let int = parseInt(obj.id, 10);\n    LOGGER.WriteRLog(\n      {},\n      PR,\n      `! ${prompt} \"${obj.id}\" is string; converting to ${int}`\n    );\n    obj.id = int;\n  }\n  return obj;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_CleanEdgeEndpoints(prompt, edge) {\n  if (typeof edge.source === 'string') {\n    let int = parseInt(edge.source, 10);\n    LOGGER.WriteRLog(\n      {},\n      PR,\n      `  edge ${prompt} source \"${edge.source}\" is string; converting to ${int}`\n    );\n    edge.source = int;\n  }\n  if (typeof edge.target === 'string') {\n    let int = parseInt(edge.target, 10);\n    LOGGER.WriteRLog(\n      {},\n      PR,\n      `  edge ${prompt} target \"${edge.target}\" is string; converting to ${int}`\n    );\n    edge.target = int;\n  }\n  return edge;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_CleanID(prompt, id) {\n  if (typeof id === 'string') {\n    let int = parseInt(id, 10);\n    LOGGER.WriteRLog(\n      {},\n      PR,\n      `! ${prompt} \"${id}\" is string; converting to number ${int}`\n    );\n    id = int;\n  }\n  return id;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// utility function for getting a valid file path\nfunction m_GetValidDBFilePath(dataset) {\n  // validate dataset name\n  let regex = /^([A-z0-9-_+./])*$/; // Allow _ - + . /, so nested pathways are allowed\n  if (!regex.test(dataset)) {\n    console.error(\n      PR,\n      `Trying to initialize database with bad dataset name: ${dataset}`\n    );\n  }\n\n  return RUNTIMEPATH + dataset + '.loki';\n}\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nmodule.exports = DB;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  LOGGER - WIP\n  porting PLAE logger for now to get it minimally working\n\n  SUPER UGLY PORT WILL CLEAN UP LATER AVERT YOUR EYES OMG\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* eslint-disable newline-per-chained-call */\n/* eslint-disable nonblock-statement-body-position */\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst PATH = require('path');\nconst FSE = require('fs-extra');\n///\nconst NC_CONFIG = require('../../app-config/netcreate-config');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PROMPTS = require('../system/util/prompts');\nconst PR = PROMPTS.Pad('SRV-LOG');\n\n/// MODULE-WIDE VARS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst LOG_DIR = '../../runtime/logs';\nconst Tracer = require('tracer');\nconst LOG_DELIMITER = '\\t';\nconst LOG_CONFIG = {\n  format: '{{line}}  {{message}}',\n  dateformat: 'HH:MM:ss.L',\n  preprocess: function (data) {\n    data.line = 'C ' + Number(data.line).zeroPad(4);\n  }\n};\nconst LOGGER = Tracer.colorConsole(LOG_CONFIG);\nlet fs_log = null;\n// enums for outputing dates\nconst e_weekday = [\n  'Sunday',\n  'Monday',\n  'Tuesday',\n  'Wednesday',\n  'Thursday',\n  'Friday',\n  'Saturday'\n];\n\n/// RUNTIME INITIALIZATION ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// initialize event logger\nvar dir = PATH.resolve(PATH.join(__dirname, LOG_DIR));\nFSE.ensureDir(dir, function (err) {\n  if (err) throw new Error('could not make ' + dir + ' directory');\n  var logname = str_TimeDatedFilename('log') + '.txt';\n  var pathname = dir + '/' + logname;\n  fs_log = FSE.createWriteStream(pathname);\n\n  // Show Research Log Field Names\n  const fieldnames = [\n    'Date', 'Time', 'NetName', 'Addr', 'Token', 'Action', 'DataID', 'DataDetail'\n  ];\n  let fields = fieldnames.join(LOG_DELIMITER);\n  fields += '\\n';\n  fs_log.write(fields);\n\n  LogResearchLine({},\n    `NETCREATE APPSERVER SESSION LOG for ${str_DateStamp()} ${str_TimeStamp()}`\n  );\n  LogResearchLine({}, '---');\n});\n\n/// LOGGING FUNCTIONS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Log a standard system log message\n */\nfunction LogLine(...args) {\n  if (!fs_log) return;\n\n  var out = str_ShortDateStamp() + LOG_DELIMITER;\n  out += str_TimeStamp() + LOG_DELIMITER;\n  out += NC_CONFIG.dataset + LOG_DELIMITER;\n  var c = args.length;\n  // arguments are delimited\n  if (c) {\n    for (let i = 0; i < c; i++) {\n      if (i > 0) out += LOG_DELIMITER;\n      out += args[i];\n    }\n  }\n  out += '\\n';\n  fs_log.write(out);\n}\n\n/** Log a standard structured log message for research\n *  Guarantees a predictable column order with\n *    date, time, network, uaddr, group\n */\nfunction LogResearchLine(info = { uaddr: '', group: '' }, ...args) {\n  if (!fs_log) return;\n\n  var out = str_ShortDateStamp() + LOG_DELIMITER;\n  out += str_TimeStamp() + LOG_DELIMITER;\n  out += NC_CONFIG.dataset + LOG_DELIMITER;\n  out += (info.uaddr || '-') + LOG_DELIMITER;\n  out += (info.group || '-') + LOG_DELIMITER;\n  var c = args.length;\n  // arguments are delimited\n  if (c) {\n    for (let i = 0; i < c; i++) {\n      if (i > 0) out += LOG_DELIMITER;\n      out += args[i];\n    }\n  }\n  out += '\\n';\n  fs_log.write(out);\n}\n\n/// UTILITY FUNCTIONS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction str_TimeStamp() {\n  var date = new Date();\n  var hh = ('0' + date.getHours()).slice(-2);\n  var mm = ('0' + date.getMinutes()).slice(-2);\n  var ss = ('0' + date.getSeconds()).slice(-2);\n  return hh + ':' + mm + ':' + ss;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction str_DateStamp() {\n  var date = new Date();\n  var mm = ('0' + (date.getMonth() + 1)).slice(-2);\n  var dd = ('0' + date.getDate()).slice(-2);\n  var day = e_weekday[date.getDay()];\n  var yyyy = date.getFullYear();\n  return yyyy + '/' + mm + '/' + dd + ' ' + day;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction str_ShortDateStamp() {\n  var date = new Date();\n  var mm = ('0' + (date.getMonth() + 1)).slice(-2);\n  var dd = ('0' + date.getDate()).slice(-2);\n  var day = e_weekday[date.getDay()];\n  var yyyy = date.getFullYear();\n  return yyyy + '/' + mm + '/' + dd;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction str_TimeDatedFilename(...args) {\n  // construct filename\n  var date = new Date();\n  var dd = ('0' + date.getDate()).slice(-2);\n  var mm = ('0' + (date.getMonth() + 1)).slice(-2);\n  var hms = ('0' + date.getHours()).slice(-2);\n  hms += ('0' + date.getMinutes()).slice(-2);\n  hms += ('0' + date.getSeconds()).slice(-2);\n  var filename;\n  filename = date.getFullYear().toString();\n  filename += '-' + mm + dd;\n  var c = arguments.length;\n  if (c) filename += filename.concat('-', ...args);\n  filename += '-' + hms;\n  return filename;\n}\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =\nlet LOG = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Handle incoming log events\n */\nLOG.PKT_LogEvent = function (pkt) {\n  let { event, items } = pkt.Data();\n  const uaddr = pkt.SourceAddress();\n  const group = pkt.SourceGroupID(); // leave blank if empty for network events\n  if (DBG) console.log(PR, pkt.Info(), event, ...items);\n  LogResearchLine({ uaddr, group }, event || '-', ...items);\n  return { OK: true };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Write to log as delimited arguments\n */\nLOG.Write = LogLine;\n/** API: Write to Researcher log as delimited arguments\n *  Research logs alway start with date, time, network, uaddr, group\n */\nLOG.WriteRLog = function (info = { uaddr: '', group: '' }, ...args) {\n  LogResearchLine(info, ...args);\n}\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = LOG;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  WebSocketServer and Network Management for UNISYS\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/* eslint-disable newline-per-chained-call */\n/* eslint-disable nonblock-statement-body-position */\n\n/* added for pull request #81 so 'npm run lint' test appears clean */\n/* eslint-disable no-unused-vars */\n\nconst DBG = false;\nconst STAT = true;\n\n///\tLOAD LIBRARIES ////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar WSS = require('ws').Server;\nvar NetMessage = require('./common-netmessage-class');\nconst LOGGER = require('./server-logger');\nvar DB = require('./server-database');\nvar DEFS = require('./common-defs');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PROMPTS = require('../system/util/prompts');\nconst PR = PROMPTS.Pad('SRV_NET');\nconst ERR_SS_EXISTS = 'socket server already created';\nconst DBG_SOCK_BADCLOSE = 'closing socket is not in mu_sockets';\nconst DEFAULT_NET_PORT = 2929;\n\n/// MODULE-WIDE VARS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// sockets\nvar mu_wss; // websocket server\nvar mu_options; // websocket options\nvar mu_sockets = new Map(); // sockets mapped by socket id\nvar mu_sid_counter = 0; // for generating  unique socket ids\n// storage\nvar m_server_handlers = new Map(); // message map storing sets of functions\nvar m_message_map = new Map(); // message map storing other handlers\nvar m_socket_msgs_list = new Map(); // message map by uaddr\n// heartbeat\nvar m_heartbeat_interval;\nvar m_pong_timer = [];\n\n/// API MEHTHODS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar UNET = {};\nconst SERVER_UADDR = NetMessage.DefaultServerUADDR(); // is 'SVR_01'\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Initialize() is called by brunch-server.js to define the default UNISYS\n *  network values, so it can embed them in the index.ejs file for webapps */\nUNET.InitializeNetwork = options => {\n  options = options || {};\n  options.port = options.port || DEFAULT_NET_PORT;\n  options.uaddr = options.uaddr || SERVER_UADDR;\n  if (mu_wss !== undefined) throw Error(ERR_SS_EXISTS);\n  NetMessage.GlobalSetup({ uaddr: options.uaddr });\n  mu_options = options;\n  return mu_options;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\tCreateNetwork() is called by brunch-server after the Express webserver\n *  has started listening, initializing the UNISYS NETWORK socket listener. */\nUNET.StartNetwork = () => {\n  // create listener\n  mu_wss = new WSS(mu_options);\n  mu_wss.on('listening', function () {\n    if (STAT) console.log(PR, `unisys network is active on port ${mu_options.port}`);\n    mu_wss.on('connection', m_NewSocketConnected);\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** HandleMessage() registers a server-implemented handler. The handlerFunc\n *  receives a NetMessage and should return one as well. It can also return a\n *  non-object if there is an error. Logic is similar to\n *  client-datalink-class.js equivalent */\nUNET.HandleMessage = function (mesgName, handlerFunc) {\n  if (typeof handlerFunc !== 'function') {\n    throw 'arg2 must be a function';\n  }\n  let handlers = m_server_handlers.get(mesgName);\n  if (!handlers) {\n    handlers = new Set();\n    m_server_handlers.set(mesgName, handlers);\n  }\n  handlers.add(handlerFunc);\n  return this;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** UnhandleMessage() de-registers a server-implemented handler, in case you\n *  ever want to do that. Logic is similar to client-datalink-class.js\n *  equivalent */\nUNET.UnhandleMessage = function (mesgName, handlerFunc) {\n  if (!arguments.length) {\n    m_server_handlers.clear();\n  } else if (arguments.length === 1) {\n    m_server_handlers.delete(mesgName);\n  } else {\n    const handlers = m_server_handlers.get(mesgName);\n    if (handlers) {\n      handlers.delete(handlerFunc);\n    }\n  }\n  return this;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Call remote handler, with possible return value */\nUNET.NetCall = async function (mesgName, data) {\n  let pkt = new NetMessage(mesgName, data);\n  let promises = m_PromiseRemoteHandlers(pkt);\n  if (DBG)\n    console.log(\n      PR,\n      `${pkt.Info()} NETCALL ${pkt.Message()} to ${promises.length} remotes`\n    );\n  /// MAGICAL ASYNC/AWAIT BLOCK ///\n  let resArray = await Promise.all(promises);\n  /// END MAGICAL ASYNC/AWAIT BLOCK ///\n  let resObj = Object.assign({}, ...resArray);\n  return resObj;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Send data to remote handler, no expected return value */\nUNET.NetSend = function (mesgName, data) {\n  let pkt = new NetMessage(mesgName, data);\n  let promises = m_PromiseRemoteHandlers(pkt);\n  // we don't care about waiting for the promise to complete\n  if (DBG)\n    console.log(\n      PR,\n      `${pkt.Info()} NETSEND ${pkt.Message()} to ${promises.length} remotes`\n    );\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Send signal to remote handler, no expected return value */\nUNET.NetSignal = function (mesgName, data) {\n  console.warn(\n    PR,\n    'NOTE: Use NetSend(), not NetSignal() since the server doesnt care.'\n  );\n  UNET.NetSend(mesgName, data);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** RegisterRemoteHandlers() accepts a RegistrationPacket with data = { messages }\n *  and writes to the two main maps for handling incoming messages */\nUNET.RegisterRemoteHandlers = function (pkt) {\n  if (pkt.Message() !== 'SRV_REG_HANDLERS') throw Error('not a registration packet');\n  let uaddr = pkt.SourceAddress();\n  let { messages = [] } = pkt.Data();\n  let regd = [];\n  // save message list, for later when having to delete\n  const existing = m_socket_msgs_list.get(uaddr) || [];\n  m_socket_msgs_list.set(uaddr, [...existing, ...messages]);\n  // add uaddr for each message in the list\n  // m_message_map[mesg] contains a Set\n  messages.forEach(msg => {\n    let entry = m_message_map.get(msg);\n    if (!entry) {\n      entry = new Set();\n      m_message_map.set(msg, entry);\n    }\n    if (DBG) console.log(PR, `adding '${msg}' reference to ${uaddr}`);\n    entry.add(uaddr);\n    regd.push(msg);\n  });\n  return { registered: regd };\n};\n\n/// SOCKET HELPER FUNCTIONS ///////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** The socket has connected, so let's save this to our connection list */\nfunction m_NewSocketConnected(socket) {\n  if (DBG) console.log(PR, 'socket connected');\n  m_SocketAdd(socket);\n  m_SocketClientAck(socket);\n  // subscribe socket to handlers\n  socket.on('message', json => {\n    m_SocketMessage(socket, json);\n  });\n  socket.on('close', () => {\n    // The socket wil not receive a close event immediately if the client\n    // loses their internet connection.  The close event WILL fire if the\n    // client comes back online and reconnects on a new UADDR.\n    // The socket will close eventually after about 4 minutes.\n    m_SocketDelete(socket);\n  });\n  // start heartbeat\n  m_StartHeartbeat();\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** When a new socket is connected, we send a periodic heartbeat to let them\n *  know we're still here, and so client can detect when network is lost.\n *  This will keep sending a heartbeat to the socket so long as it is open. */\nfunction m_StartHeartbeat() {\n  if (DBG) console.log(PR, 'starting heartbeat');\n  if (m_heartbeat_interval) return; // already started\n  m_heartbeat_interval = setInterval(function sendHeartbeat() {\n    mu_sockets.forEach((socket, key, map) => {\n      if (DBG) console.log(PR, 'sending heartbeat to', socket.UADDR);\n      if (socket.readyState === socket.OPEN) {\n        socket.send('ping', err => {\n          if (err)\n            console.log(\n              PR,\n              'error \"',\n              err,\n              '\" while sending heartbeat to',\n              socket.UADDR\n            );\n        });\n      }\n    });\n  }, DEFS.SERVER_HEARTBEAT_INTERVAL);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** If a 'pong' message is not received from the client 5 seconds after we send\n *  the client a ping message, we assume the network connection has gone down.\n *  The socket close handler is only triggered when the server closes the\n *  connection.  In order to detect the internet connection going down\n *  (e.g. loss of wifi) we need to check to see if we are peridically receiving\n *  a heartbeat message from the client. */\nfunction m_ResetPongTimer(uaddr) {\n  clearTimeout(m_pong_timer[uaddr]);\n  m_pong_timer[uaddr] = setTimeout(function pongTimedOut() {\n    if (DBG)\n      console.log(\n        PR,\n        uaddr,\n        'pong not received before time ran out -- CONNECTION DEAD!'\n      );\n    LOGGER.WriteRLog(\n      { uaddr },\n      PR,\n      'pong not received before time ran out -- CLIENT CONNECTION DEAD!'\n    );\n    DB.RequestUnlock(uaddr);\n  }, DEFS.SERVER_HEARTBEAT_INTERVAL * 2);\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** When a new socket connection happens, send back the special registration\n * packet (WIP) */\nfunction m_SocketClientAck(socket) {\n  let data = {\n    HELLO: 'Welcome to UNISYS',\n    UADDR: socket.UADDR\n  };\n  socket.send(JSON.stringify(data));\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Handle all incoming socket messages asynchronously through Promises */\nfunction m_SocketMessage(socket, json) {\n  // Check Heartbeat\n  if (json === 'pong') {\n    if (socket.UADDR === undefined) {\n      console.log(\n        PR,\n        '!!!!!!!!!!!!!!!!!! Bad socket.UADDR',\n        socket.UADDR,\n        '! Skipping pong timer reset.'\n      );\n      return; // Don't start the timer if we get a bad UADDR\n    }\n    m_ResetPongTimer(socket.UADDR);\n    return;\n  }\n  try {\n    let pkt = new NetMessage(json);\n    // todo: check authentication\n    // figure out what to do\n    switch (pkt.Type()) {\n      case 'state':\n        m_HandleState(socket, pkt);\n        break;\n      case 'msig':\n      case 'msend':\n      case 'mcall':\n        m_HandleMessage(socket, pkt);\n        break;\n      default:\n        throw new Error(`${PR} unknown packet type '${pkt.Type()}'`);\n    } // end switch\n  } catch (err) {\n    console.error(PR, 'm_SocketMessage try:', err);\n  }\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** handle messages that are a Send(), Signal(), or Call() */\nasync function m_HandleMessage(socket, pkt) {\n  // is this a returning packet that was forwarded?\n  if (pkt.IsOwnResponse()) {\n    // console.log(PR,`-- ${pkt.Message()} completing transaction ${pkt.seqlog.join(':')}`);\n    pkt.CompleteTransaction();\n    return;\n  }\n  // console.log(PR,`packet source incoming ${pkt.SourceAddress()}-${pkt.Message()}`);\n  // (1) first check if this is a server handler\n  let promises = m_PromiseServerHandlers(pkt);\n\n  // (2) if it wasn't, then see if we have remote handlers defined\n  if (promises.length === 0) promises = m_PromiseRemoteHandlers(pkt);\n\n  // (3) FAIL if no promises were returned, because there were no eligible\n  // UADDR targets, possibly because the sources are not allowed to call itself\n  // except in the case of the SIGNAL type\n  if (promises.length === 0) {\n    console.log(PR, `info: '${pkt.Message()}' no eligible UADDR targets`);\n    // return transaction to resolve callee\n    pkt.SetData({ NOP: `no handler found for '${pkt.Message()}'` });\n    if (pkt.IsType('mcall')) pkt.ReturnTransaction(socket);\n    return;\n  }\n  // got this far? let's skip all server messages for debugging purposes\n  let notsrv = !pkt.Message().startsWith('SRV_');\n  let json = JSON.stringify(pkt.Data());\n  /* MAGICAL ASYNC/AWAIT BLOCK *****************************/\n  if (DBG)\n    console.log(\n      PR,\n      `${pkt.Info()} FORWARD ${pkt.Message()} to ${promises.length} remotes`\n    );\n  // if (notsrv) console.log(PR,`>> '${pkt.Message()}' queuing ${promises.length} Promises w/ data ${json}'`);\n  let pktArray = await Promise.all(promises);\n  // if (notsrv) console.log(PR,`<< '${pkt.Message()}' resolved`);\n  if (DBG)\n    console.log(\n      PR,\n      `${pkt.Info()} RETURN ${pkt.Message()} from ${promises.length} remotes`\n    );\n  /* END MAGICAL ASYNC/AWAIT BLOCK *************************/\n\n  // (4) only mcall packets need to receive the data back return\n  if (!pkt.IsType('mcall')) return;\n\n  // (5) got this far? this is a call, so gather data and return it\n  let data = pktArray.reduce((d, p) => {\n    let pdata = p instanceof NetMessage ? p.Data() : p;\n    let retval = Object.assign(d, pdata);\n    // if (notsrv) console.log(PR,`'${pkt.Message()}' reduce`,JSON.stringify(retval));\n    return retval;\n  }, {});\n  // json = JSON.stringify(data);\n  // if (notsrv) console.log(PR,`'${pkt.Message()}' returning transaction data ${json}`);\n  pkt.SetData(data);\n  pkt.ReturnTransaction(socket);\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** m_PromiseServerHandlers() returns an array of promises, which should be used\n *  by Promises.all() inside an async/await function (m_SocketMessage above)\n *  Logic is similar to client-datalink-class.js Call() */\nfunction m_PromiseServerHandlers(pkt) {\n  let mesgName = pkt.Message();\n  const handlers = m_server_handlers.get(mesgName);\n  /// create promises for all registered handlers\n  let promises = [];\n  if (handlers)\n    for (let handlerFunc of handlers) {\n      // handlerFunc signature: (data,dataReturn) => {}\n      let p = f_make_resolver_func(pkt, handlerFunc);\n      promises.push(p);\n    }\n  /// return all queued promises\n  return promises;\n\n  /// inline utility function ///\n  function f_make_resolver_func(srcPkt, handlerFunc) {\n    return new Promise((resolve, reject) => {\n      let retval = handlerFunc(srcPkt);\n      if (retval === undefined)\n        throw `'${mesgName}' message handler MUST return object or error string`;\n      if (typeof retval !== 'object') reject(retval);\n      else resolve(retval);\n    });\n  }\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** If a handler is registered elsewhere on UNET, then dispatch to them for\n *  eventual reflection back through server aggregation of data. */\nfunction m_PromiseRemoteHandlers(pkt) {\n  // debugging values\n  let s_uaddr = pkt.SourceAddress();\n  // logic values\n  let promises = [];\n  let mesgName = pkt.Message();\n  let type = pkt.Type();\n  // iterate!\n  let handlers = m_message_map.get(mesgName);\n  if (handlers)\n    handlers.forEach(d_uaddr => {\n      // don't send packet to originating UADDR because it already has handled it\n      // locally\n      switch (type) {\n        case 'msig':\n          promises.push(f_make_remote_resolver_func(pkt, d_uaddr));\n          break;\n        case 'msend':\n        case 'mcall':\n          if (s_uaddr !== d_uaddr) {\n            promises.push(f_make_remote_resolver_func(pkt, d_uaddr));\n          } else {\n            // console.log(PR,`${type} '${pkt.Message()}' -NO ECHO- ${d_uaddr}`);\n          }\n          break;\n        default:\n          throw Error(`{ERR_UNKNOWN_PKT} ${type}`);\n      }\n    });\n  /// return all queued promises\n  return promises;\n  /// f_make_remote_resolver_function returns the promise created by QueueTransaction()\n  /// made on a new netmessage.\n  function f_make_remote_resolver_func(srcPkt, d_uaddr, opt = {}) {\n    let { verbose } = opt;\n    // get the address of the destination implementor of MESSAGE\n    let d_sock = mu_sockets.get(d_uaddr);\n    if (d_sock === undefined) {\n      // throw Error(ERR_INVALID_DEST + ` ${d_uaddr}`);\n      console.log(PR, `ERROR '${d_uaddr}' for '${pkt.Message()} doesn't exist`);\n      return Promise.resolve({ NOP: `no handler found for '${d_uaddr}'` });\n    }\n    // Queue transaction from server\n    // sends to destination socket d_sock\n    // console.log(PR,`++ '${pkt.Message()}' FWD from ${pkt.SourceAddress()} to ${d_uaddr}`);\n    let newpkt = new NetMessage(srcPkt);\n    newpkt.MakeNewID();\n    newpkt.CopySourceAddress(srcPkt);\n    if (verbose) {\n      console.log(\n        'make_resolver_func:',\n        `PKT: ${srcPkt.Type()} '${srcPkt.Message()}' from ${srcPkt.Info()} to d_uaddr:${d_uaddr} dispatch to d_sock.UADDR:${\n          d_sock.UADDR\n        }`\n      );\n    }\n    return newpkt.QueueTransaction(d_sock);\n  }\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** invoked when web socket server gets a new connection. See m_SocketDelete()\n *  for the mirror function */\nfunction m_SocketAdd(socket) {\n  // save socket by socket_id\n  let sid = m_GetNewUADDR();\n  // store additional props in socket\n  socket.UADDR = sid;\n  // save socket\n  mu_sockets.set(sid, socket);\n  if (STAT) console.log(PR, `socket ADD ${socket.UADDR} to network`);\n  LOGGER.WriteRLog({ uaddr: socket.UADDR }, 'joined network');\n  if (DBG) m_ListSockets(`add ${sid}`);\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** generate a new UADDR when a new soecket is created, used by m_SocketAdd */\nfunction m_GetNewUADDR(prefix = 'UADDR') {\n  ++mu_sid_counter;\n  let cstr = mu_sid_counter.toString(10).padStart(2, '0');\n  return `${prefix}_${cstr}`;\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** invoked when a client socket is disconnected. It has to do additional\n *  cleanup to remove any messages related to the socket address */\nfunction m_SocketDelete(socket) {\n  let uaddr = socket.UADDR;\n  if (!mu_sockets.has(uaddr)) throw Error(DBG_SOCK_BADCLOSE);\n  if (STAT) console.log(PR, `socket DEL ${uaddr} from network`);\n  LOGGER.WriteRLog({ uaddr: socket.UADDR }, 'left network');\n  mu_sockets.delete(uaddr);\n  // delete socket reference from previously registered handlers\n  let rmesgs = m_socket_msgs_list.get(uaddr);\n  if (Array.isArray(rmesgs)) {\n    rmesgs.forEach(msg => {\n      let addressSet = m_message_map.get(msg);\n      if (DBG) console.log('---', uaddr, addressSet);\n      if (addressSet) {\n        addressSet.delete(uaddr);\n        if (DBG) console.log(PR, `...${uaddr} unregister '${msg}'`);\n      }\n    });\n  }\n  // Unlock everything if the socket is being removed\n  DB.RequestUnlock(uaddr);\n  // console list\n  if (DBG) m_ListSockets(`del ${socket.UADDR}`);\n}\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** utility to list the current socket connections to the terminal window */\nfunction m_ListSockets(change) {\n  console.log(PR, '...SocketList change:', change);\n  // let's use iterators! for..of\n  let values = mu_sockets.values();\n  let count = 1;\n  for (let socket of values) {\n    console.log(PR, `   ${count} - ${socket.UADDR}`);\n  }\n}\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UNET;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  UNISYS server loader\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst PATH = require('path');\nconst UNET = require('./server-network');\nconst UDB = require('./server-database');\nconst LOGGER = require('./server-logger');\nconst PROMPTS = require('../system/util/prompts');\nconst { EDITORTYPE } = require('../system/util/enum');\nconst MUR = require('../../_mur/_dist/mur-node.cjs');\nconst NC_CONFIG = require('../../app-config/netcreate-config');\n\n/// CONSTANTS & DECLARATIONS ///////////////////////////////////////////////////\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = PROMPTS.Pad('MUR_SET');\n///\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst ROOT = PATH.resolve(__dirname, '../../');\nconst TEST_TEMPL_DIR = PATH.resolve(ROOT, 'app-templates');\n\n/// API CREATE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar UNISYS = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Initialize() is called by brunch-server.js to define the default UNISYS\n *  network values, so it can embed them in the index.ejs file for webapps\n *  override = { port } */\nUNISYS.InitializeNetwork = override => {\n  // MUR INTEROP: connect to MUR\n  MUR.NCI.InteropConnect(UNET, NC_CONFIG);\n  // MUR INTEROP: load settings and persist unified file\n  const settings = MUR.SettingMgr.LoadSettings(TEST_TEMPL_DIR);\n  MUR.SettingMgr.WriteDefaultSettings();\n  console.log(PR, `Loaded settings: [${Object.keys(settings).join(', ')}`);\n  // MUR INTEROP: end\n\n  // resume NetCreate server initialization\n  UDB.InitializeDatabase(override);\n  return UNET.InitializeNetwork(override);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** RegisterHandlers() is called before network is started, so they're\n *  ready to run. These are server-implemented reserved messages.\n */\nUNISYS.RegisterHandlers = () => {\n  //  define local handlers\n  UNET.HandleMessage('SRV_REFLECT', function (pkt) {\n    pkt.Data().serverSays = 'REFLECTING';\n    pkt.Data().stack.push('SRV_01');\n    if (DBG) console.log(PR, sprint_message(pkt));\n    // return the original packet\n    return pkt;\n  });\n  //\n  UNET.HandleMessage('SRV_REG_HANDLERS', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    // now need to store the handlers somehow.\n    let data = UNET.RegisterRemoteHandlers(pkt);\n    // or return a new data object that will replace pkt.data\n    return data;\n  });\n  //\n  UNET.HandleMessage('SRV_DBGET', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_GetDatabase(pkt);\n  });\n  //\n  UNET.HandleMessage('SRV_DBSET', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_SetDatabase(pkt);\n  });\n  //\n  /// Add new node/edges to db after an import\n  UNET.HandleMessage('SRV_DBINSERT', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_InsertDatabase(pkt);\n  });\n  // Update or add new node/edges to db after an import\n  UNET.HandleMessage('SRV_DBMERGE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_MergeDatabase(pkt);\n  });\n\n  // Emulate a project load for Turbo360\n  UNET.HandleMessage('SRV_DBREPLACE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_ReplaceDatabase(pkt);\n  });\n\n  /** TEMPLATE / IMPORT / NODE / EDGE EDITOR LOCKING **/\n\n  /** Reports on whether template, import, or node/edge are being edited\n   *  @return { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n   */\n  UNET.HandleMessage('SRV_GET_EDIT_STATUS', pkt => {\n    // server-database\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const data = UDB.GetEditStatus(pkt);\n    return data;\n  });\n  /** Requested by Node / Edge Editor when user wants to edit node / edge\n   * @return { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n   */\n  UNET.HandleMessage('SRV_REQ_EDIT_LOCK', pkt => {\n    // server-database\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const editStatus = UDB.RequestEditLock(pkt);\n    // Broadcast Lock State\n    UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    return editStatus;\n  });\n  /**\n   * @return { templateBeingEdited: boolean, importActive: boolean, nodeOrEdgeBeingEdited: boolean }\n   */\n  UNET.HandleMessage('SRV_RELEASE_EDIT_LOCK', pkt => {\n    // server-database\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const editStatus = UDB.ReleaseEditLock(pkt);\n    // Broadcast Lock State\n    UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    return editStatus;\n  });\n\n  /** TEMPLATE EDITING **/\n\n  UNET.HandleMessage('SRV_TEMPLATE_REGENERATE_DEFAULT', pkt => {\n    // server-database\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.RegenerateDefaultTemplate();\n  });\n  UNET.HandleMessage('SRV_TEMPLATESAVE', pkt => {\n    // server-database\n    if (DBG) console.log(PR, sprint_message(pkt));\n    UNET.NetSend('NET_TEMPLATE_UPDATE', pkt.data.template); // Broadcast template to other computers on the net\n    return UDB.WriteTemplateTOML(pkt);\n  });\n  UNET.HandleMessage('SRV_GET_TEMPLATETOML_FILENAME', () => {\n    return UDB.GetTemplateTOMLFileName();\n  });\n\n  /// Update all EXISTING nodes/edges after a Template edit\n  UNET.HandleMessage('SRV_DBUPDATE_ALL', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_UpdateDatabase(pkt);\n  });\n\n  /** NODE/EDGE EDITING **/\n\n  // receives a packet from a client\n  UNET.HandleMessage('SRV_DBUPDATE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    let data = UDB.PKT_Update(pkt);\n    // add src attribute for client SOURCE_UPDATE to know\n    // this is a remote update\n    data.src = 'remote';\n    // fire update messages\n    if (data.node) UNET.NetSend('SOURCE_UPDATE', data);\n    if (data.edge) UNET.NetSend('EDGE_UPDATE', data);\n    if (data.nodeID !== undefined) UNET.NetSend('NODE_DELETE', data);\n    if (data.edgeID !== undefined) UNET.NetSend('EDGE_DELETE', data);\n    if (data.comment) {\n      data.uaddr = pkt.s_uaddr; // used to differentiate local vs net updates\n      UNET.NetSend('COMMENT_UPDATE', data);\n    }\n    if (data.readbys) UNET.NetSend('READBY_UPDATE', data);\n    if (data.commentID !== undefined) UNET.NetSend('COMMENT_DELETE', data);\n    // return SRV_DBUPDATE value (required)\n    return { OK: true, info: 'SRC_DBUPDATE' };\n  });\n\n  // receives a batch of packets from a client\n  UNET.HandleMessage('SRV_DBBATCHUPDATE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    let retvals = UDB.PKT_BatchUpdate(pkt);\n    // fire update messages\n    // retvals is an array and contains multiple comments and commentIDs\n    UNET.NetSend('COMMENTS_UPDATE', retvals);\n    // return SRV_DBBATCHUPDATE value (required)\n    return { OK: true, info: 'SRV_DBBATCHUPDATE' };\n  });\n\n  UNET.HandleMessage('SRV_CALCULATE_MAXNODEID', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_CalculateMaxNodeID(pkt);\n  });\n  UNET.HandleMessage('SRV_DBGETNODEID', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_GetNewNodeID(pkt);\n  });\n  UNET.HandleMessage('SRV_DBGETNODEIDS', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_GetNewNodeIDs(pkt);\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// DB LOCKING\n  /**\n   * @param {object} pkt\n   * @param {string} pkt.data.nodeID\n   */\n  UNET.HandleMessage('SRV_DBLOCKNODE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const lockResult = UDB.PKT_RequestLockNode(pkt);\n    if (lockResult.locked) {\n      // successfully locked, broadcast edit state\n      //  - inject editor type into the pkt\n      const pktData = pkt.Data();\n      pktData.editor = EDITORTYPE.NODE;\n      pkt.SetData(pktData);\n      const editStatus = UDB.RequestEditLock(pkt);\n      // - broadcast lock state\n      UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    }\n    return lockResult; // handle callback\n  });\n  UNET.HandleMessage('SRV_DBUNLOCKNODE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const unlockResult = UDB.PKT_RequestUnlockNode(pkt);\n    if (unlockResult.unlocked) {\n      // successfully unlocked, broadcast edit state\n      // - inject editor type into the pkt\n      const pktData = pkt.Data();\n      pktData.editor = EDITORTYPE.NODE;\n      pkt.SetData(pktData);\n      const editStatus = UDB.ReleaseEditLock(pkt);\n      // - broadcast lock state\n      UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    }\n    return unlockResult; // handle callback\n  });\n  UNET.HandleMessage('SRV_DBLOCKEDGE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const lockResult = UDB.PKT_RequestLockEdge(pkt);\n    if (lockResult.locked) {\n      // successfully locked, broadcast edit state\n      // - inject editor type into the pkt\n      const pktData = pkt.Data();\n      pktData.editor = EDITORTYPE.EDGE;\n      pkt.SetData(pktData);\n      const editStatus = UDB.RequestEditLock(pkt);\n      // = broadcast lock state\n      UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    }\n    return lockResult; // handle callback\n  });\n  UNET.HandleMessage('SRV_DBUNLOCKEDGE', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const unlockResult = UDB.PKT_RequestUnlockEdge(pkt);\n    if (unlockResult.unlocked) {\n      // successfully unlocked, broadcast edit state\n      // - inject editor type into the pkt\n      const pktData = pkt.Data();\n      pktData.editor = EDITORTYPE.EDGE;\n      pkt.SetData(pktData);\n      const editStatus = UDB.ReleaseEditLock(pkt);\n      // - broadcast lock state\n      UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    }\n    return unlockResult; // handle callback\n  });\n\n  UNET.HandleMessage('SRV_DBISEDGELOCKED', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_IsEdgeLocked(pkt);\n  });\n\n  UNET.HandleMessage('SRV_DBLOCKCOMMENT', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const lockResult = UDB.PKT_RequestLockComment(pkt);\n    if (lockResult.locked) {\n      // successfully unlocked, broadcast edit state\n      // - inject editor type into the pkt\n      const pktData = pkt.Data();\n      pktData.editor = EDITORTYPE.COMMENT;\n      pkt.SetData(pktData);\n      const editStatus = UDB.ReleaseEditLock(pkt);\n      // - broadcast lock state\n      UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    }\n    return lockResult; // handle callback\n  });\n\n  UNET.HandleMessage('SRV_DBUNLOCKCOMMENT', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const unlockResult = UDB.PKT_RequestUnlockComment(pkt);\n    if (unlockResult.unlocked) {\n      // successfully unlocked, broadcast edit state\n      // - inject editor type into the pkt\n      const pktData = pkt.Data();\n      pktData.editor = EDITORTYPE.COMMENT;\n      pkt.SetData(pktData);\n      const editStatus = UDB.ReleaseEditLock(pkt);\n      // - broadcast lock state\n      UNET.NetSend('EDIT_PERMISSIONS_UPDATE', editStatus);\n    }\n    return unlockResult; // handle callback\n  });\n\n  UNET.HandleMessage('SRV_DBISCOMMENTLOCKED', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_IsCommentLocked(pkt);\n  });\n\n  UNET.HandleMessage('SRV_DBUNLOCKALLNODES', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_RequestUnlockAllNodes(pkt);\n  });\n  UNET.HandleMessage('SRV_DBUNLOCKALLEDGES', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_RequestUnlockAllEdges(pkt);\n  });\n  UNET.HandleMessage('SRV_DBUNLOCKALLCOMMENTS', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_RequestUnlockAllComments(pkt);\n  });\n  UNET.HandleMessage('SRV_DBUNLOCKALL', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    const res = UDB.PKT_RequestUnlockAll(pkt);\n    // Broadcast Lock State\n    const data = UDB.GetEditStatus(pkt);\n    UNET.NetSend('EDIT_PERMISSIONS_UPDATE', data);\n    return res;\n  });\n\n  UNET.HandleMessage('SRV_CALCULATE_MAXEDGEID', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_CalculateMaxEdgeID(pkt);\n  });\n  UNET.HandleMessage('SRV_DBGETEDGEID', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_GetNewEdgeID(pkt);\n  });\n  UNET.HandleMessage('SRV_DBGETEDGEIDS', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_GetNewEdgeIDs(pkt);\n  });\n\n  UNET.HandleMessage('SRV_DBGETCOMMENTID', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return UDB.PKT_GetNewCommentID(pkt);\n  });\n\n  UNET.HandleMessage('SRV_LOG_EVENT', function (pkt) {\n    if (DBG) console.log(PR, sprint_message(pkt));\n    return LOGGER.PKT_LogEvent(pkt);\n  });\n\n  // utility function //\n  function sprint_message(pkt) {\n    return `got '${pkt.Message()}' data=${JSON.stringify(pkt.Data())}`;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\tStartNetwork() is called by brunch-server after the Express webserver\n */\nUNISYS.StartNetwork = () => {\n  UNET.StartNetwork();\n};\n\n/// EXPORT MODULE DEFINITION //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = UNISYS;\n","if (window.NC_DBG) console.log(`inc ${module.id}`);\n/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Placeholder Root View\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nconst React = require('react');\n\n/// DEFAULT APPLICATION COMPONENT /////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass AppDefault extends React.Component {\n  constructor() {\n    super();\n  }\n  render() {\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexFlow: 'row nowrap',\n          width: '100%',\n          height: '100%'\n        }}\n      >\n        <div id=\"left\" style={{ flex: '1 0 auto' }}></div>\n        <div id=\"middle\" style={{ flex: '3 0 auto' }}>\n          <p>AppDefault.jsx</p>\n          <h4>NetCreate welcomes you</h4>\n          <p>This is a work in progress.</p>\n        </div>\n        <div id=\"right\" style={{ flex: '1 0 auto' }}></div>\n      </div>\n    );\n  }\n  componentDidMount() {\n    console.log('AppDefault mounted');\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = AppDefault;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Root View for an IFrame-based HTML page\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nconst React = require('react');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// COMPONENT DECLARATION /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction HTMLFrame(props) {\n  SETTINGS.IsReloadRequired();\n  let loc;\n  if (props && props.location && props.location.pathname) {\n    loc = props.location.pathname.substring(1);\n  }\n  loc = '/htmldemos/' + loc + '/' + loc + '.html';\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexFlow: 'column nowrap',\n        width: '100%',\n        height: '100%'\n      }}\n    >\n      <iframe style={{ flex: '1 0 auto', border: '0' }} src={loc} />\n    </div>\n  );\n}\n\n/// EXPORTS ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = HTMLFrame;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    NetCreate\n\n    The basic React Component structure of the app looks like this:\n\n        NetCreate\n        +- NodeSelector\n        |  +- NodeDetail\n        |  +- AutoComplete\n        |  |  +- AutoSuggest\n        |  +- EdgeEntry\n        |     +- *AutoComplete (for Target Node)*\n        +- NetGraph\n           +- D3SimpleNetGraph\n              +- D3\n\n    `NetCreate` is the root element. It is a wrapper for the key app\n    elements `NodeSelector` and `NetGraph`.\n\n    It does not do any data or event handling.  Those are handled individually\n    by the respective Components.\n\n  * All state is maintained in `nc-logic.js`\n  * It handles events from NodeSelector, EdgeEntry, and NetGraph components\n      and passes data and upates across them.\n\n    PROPS  ... (none)\n    STATE  ... (none)\n    EVENTS ... (none)\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// UNISYS INITIALIZE REQUIRES for REACT ROOT /////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst UNISYS = require('unisys/client');\nconst UR = require('ursys-min');\nconst SessionShell = require('unisys/component/SessionShell');\n\n/// SWITCHES //////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar DBG = false;\nconst PROMPTS = require('system/util/prompts');\nconst PR = PROMPTS.Pad('ACD');\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst React = require('react');\nconst NCSearch = require('./components/NCSearch');\nconst NCNode = require('./components/NCNode');\nconst NCGraph = require('./components/NCGraph');\nconst NCLOGIC = require('./nc-logic'); // require to bootstrap data loading\nconst FILTERMGR = require('./filter-mgr'); // handles filtering functions\nconst EDGEMGR = require('./edge-mgr'); // handles edge synthesis\nconst SELECTIONMGR = require('./selection-mgr'); // handles UI selection events\nconst HILITEMGR = require('./hilite-mgr'); // handles UI hilite events\nconst CMTMGR = require('./comment-mgr');\nconst FILTER = require('./components/filter/FilterEnums');\nimport PANELMGR from './panel-mgr';\nimport NCInfoPanel from './components/NCInfoPanel';\nimport NCHelpPanel from './components/NCHelpPanel';\nimport NCAdvancedPanel from './components/NCAdvancedPanel';\nimport NCFiltersPanel from './components/filter/NCFiltersPanel';\nimport URButtonToggle from './components/URButtonToggle';\nimport URCommentStatus from './components/URCommentStatus';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass NetCreate extends UNISYS.Component {\n  constructor() {\n    super();\n    UNISYS.IsReloadRequired();\n\n    // URSYS TEST CODE - not used by NetCreate\n    const SM = new UR.StateMgr('NETCREATE');\n    SM._initializeState({ prop_1: 1 });\n    // console.log('NetCreate: UR:', UR);\n    // console.log('SM:StateMgr contains:', SM.state());\n\n    // URSYS COMPONENT INIT - used by comment-mgr.js\n    UR.COMMENT.Init();\n\n    this.state = {\n      isConnected: true,\n      isLoggedIn: false,\n      requireLogin: this.AppState('TEMPLATE').requireLogin,\n      disconnectMsg: '',\n      layoutNodesOpen: true,\n      layoutFiltersOpen: false,\n      commentStatusMessage: 'waiting...'\n    };\n    this.OnDOMReady(() => {\n      if (DBG) console.log(PR, 'OnDOMReady');\n    });\n    this.OnReset(() => {\n      if (DBG) console.log(PR, 'OnReset');\n    });\n    this.OnStart(() => {\n      if (DBG) console.log(PR, 'OnStart');\n    });\n    this.OnAppReady(() => {\n      if (DBG) console.log(PR, 'OnAppReady');\n    });\n    this.OnRun(() => {\n      if (DBG) console.log(PR, 'OnRun');\n    });\n    this.OnDisconnect(e => {\n      if (DBG) console.log(PR, 'OnDisconnect');\n      // This is now handled by the UDATA \"DISCONNECT\" message.\n      // so that we can show a message explaining the cause of disconnect.\n      // this.setState({ isConnected: false });\n    });\n\n    this.onStateChange_SESSION = this.onStateChange_SESSION.bind(this);\n    this.onStateChange_PANELSTATE = this.onStateChange_PANELSTATE.bind(this);\n    this.onDisconnect = this.onDisconnect.bind(this);\n    this.onFilterBtnClick = this.onFilterBtnClick.bind(this);\n\n    this.OnAppStateChange('SESSION', this.onStateChange_SESSION);\n    this.OnAppStateChange('PANELSTATE', this.onStateChange_PANELSTATE);\n\n    this.HandleMessage('DISCONNECT', this.onDisconnect);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** SESSION is called by SessionShell when the ID changes\n      Show or hide netgraph depending on template settings.\n   */\n  onStateChange_SESSION(decoded) {\n    this.setState({ isLoggedIn: decoded.isValid });\n  }\n\n  onStateChange_PANELSTATE(data) {\n    this.setState({ render: true }); // REVIEW: force render?\n  }\n\n  onDisconnect(e) {\n    const time = new Date().toLocaleTimeString();\n    this.setState({\n      isConnected: false,\n      disconnectMsg: `${e.detail.message} ${time}`\n    });\n  }\n\n  /// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** This is the root component, so this fires after all subcomponents have\n      been fully rendered by render().\n   */\n  componentDidMount() {\n    // Init dragger\n    let dragger = document.getElementById('dragger');\n    dragger.onmousedown = this.handleMouseDown;\n  }\n\n  componentWillUnmount() {\n    this.AppStateChangeOff('SESSION', this.onStateChange_SESSION);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  onFilterBtnClick(e) {\n    this.setState(state => {\n      return { layoutFiltersOpen: !state.layoutFiltersOpen };\n    });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Define the component structure of the web application\n   */\n  render() {\n    const {\n      isLoggedIn,\n      disconnectMsg,\n      layoutNodesOpen,\n      layoutFiltersOpen,\n      commentStatusMessage,\n      handleMessageUpdate\n    } = this.state;\n\n    // show or hide graph\n    // Use 'visibiliity' css NOT React's 'hidden' so size is properly\n    // calculated on init\n    let hideGraph = 'visible';\n    if (this.state.requireLogin && !isLoggedIn) hideGraph = 'hidden';\n\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const DISCONNECTED_MSG = this.state.isConnected ? (\n      ''\n    ) : (\n      <div className=\"--NetCreate_Fixed_Top_SaveAlert nc-savealert\">\n        <div>\n          <b>{disconnectMsg}!</b> Your changes will not be saved! Please report &quot;\n          {disconnectMsg}&quot; to your administrator to restart the graph.\n        </div>\n      </div>\n    );\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    const NAVBAR = (\n      <nav className=\"--NetCreate_Fixed_Top nc-navbar\" role=\"navigation\">\n        <div style={{ width: '3rem' }}></div>\n        <SessionShell />\n        <div style={{ flexGrow: 1 }}></div>\n        <URCommentStatus\n          message={commentStatusMessage}\n          handleMessageUpdate={handleMessageUpdate}\n        />\n        <div style={{ flexGrow: 1 }}></div>\n        <img src=\"images/netcreate-logo.svg\" height=\"25px\" alt=\"NetCreate Logo\" />\n      </nav>\n    );\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// Force Help and Advanced to render AFTER main page\n    /// so that focus tab order comes AFTER the main content.\n    const NAVBTNS = (\n      <div className=\"nc-navbar-btns\">\n        <URButtonToggle\n          title=\"Show/Hide Help\"\n          selected={PANELMGR.HelpIsOpen()}\n          onClick={PANELMGR.ToggleHelp}\n        >\n          <img src=\"images/icn_help.svg\" alt=\"Help\" />\n        </URButtonToggle>\n        <URButtonToggle\n          title=\"Show/Hide Advanced\"\n          selected={PANELMGR.AdvancedIsOpen()}\n          onClick={PANELMGR.ToggleAdvanced}\n        >\n          <img src=\"images/icn_advanced.svg\" alt=\"Advanced\" />\n        </URButtonToggle>\n      </div>\n    );\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n    return (\n      <main className=\"--NetCreate nc-base\" role=\"main\">\n        {DISCONNECTED_MSG}\n        {NAVBAR}\n\n        <div className=\"--NetCreate_Rows nc-rows\" style={{ visibility: hideGraph }}>\n          {/*** LEFT EDITOR COLUMN ***************/}\n          <div className=\"--NetCreate_Columns nc-col-left\" id=\"left\">\n            <NCSearch />\n            <NCNode />\n          </div>\n          {/*** CENTER NETVIEW COLUMN***************/}\n          <div className=\"--NetCreate_Column_NetView nc-col-middle\">\n            <NCInfoPanel />\n            <NCGraph />\n          </div>\n          {/*** RIGHT VIEW COLUMN ***************/}\n          <div className=\"--NetCreate_Column_Filters_Open nc-col-right\" id=\"right\">\n            <div\n              id=\"filterpanel\"\n              className={layoutFiltersOpen ? 'filterpanelOpen' : ''}\n            >\n              <button\n                className=\"cat\"\n                id=\"filterpanel-btn\"\n                type=\"button\"\n                aria-label={\n                  layoutFiltersOpen\n                    ? `Close ${FILTER.PANEL_LABEL}`\n                    : `Open ${FILTER.PANEL_LABEL}`\n                }\n                onClick={this.onFilterBtnClick}\n              >\n                {FILTER.PANEL_LABEL}\n              </button>\n              <NCFiltersPanel hidden={!layoutFiltersOpen} />\n            </div>\n          </div>\n\n          {NAVBTNS}\n        </div>\n        {/*** DIALOGS ***************/}\n        <div id=\"dialog-container\"></div>\n        <NCHelpPanel />\n        <NCAdvancedPanel />\n      </main>\n    ); // end return\n  } // end render()\n} // end class NetCreate\n\n/// EXPORT UNISYS SIGNATURE ///////////////////////////////////////////////////\n/// used in init.jsx to set module scope early\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nNetCreate.UMOD = module.id;\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NetCreate;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  COMMENT MANAGER\n\n  uses new ursys-min (minimal ursys for netcreate), see _mur/ directory\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst ReactDOM = require('react-dom');\nconst UNISYS = require('unisys/client');\nconst LOCKMGR = require('./lock-mgr');\nconst { COMMENT } = require('ursys-min');\nconst DATASTORE = require('system/datastore');\nconst { ARROW_RIGHT } = require('system/util/constant');\nconst { EDITORTYPE } = require('system/util/enum');\nconst NCUI = require('./nc-ui');\nconst NCDialog = require('./components/NCDialog');\nconst SETTINGS = require('settings');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'comment-mgr: ';\n\nconst CMTBTNOFFSET = 10;\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet MOD = UNISYS.NewModule(module.id);\nlet UDATA = UNISYS.NewDataLink(MOD);\nconst dialogContainerId = 'dialog-container'; // used to inject dialogs into NetCreate.jsx\n\nlet UID; // user id, cached.  nc-logic updates this on INITIALIZE and SESSION\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** lifecycle INITIALIZE handler\n */\nMOD.Hook('INITIALIZE', () => {\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** LOAD_COMMENT_DATACORE\n   *  Called by nc-logic.m_PromiseLoadDB\n   *  Primarily after LOADASSETS\n   *  Loads comments from the database into dc-comments\n   *  @param {Object} data\n   *  @param {Object} data.users\n   *  @param {Object} data.commenttypes\n   *  @param {Object} data.comments\n   */\n  // Comment AddOn Handlers\n  UDATA.HandleMessage('LOAD_COMMENT_DATACORE', MOD.LoadDB); // MEME equivalent: DATA_UPDATED\n  /// STATE UPDATES and Message Handlers\n  UDATA.OnAppStateChange('LOCKSTATE', m_urstate_LOCKSTATE);\n  UDATA.HandleMessage('COMMENTS_UPDATE', MOD.HandleCOMMENTS_UPDATE);\n  UDATA.HandleMessage('COMMENT_UPDATE', MOD.HandleCOMMENT_UPDATE);\n  UDATA.HandleMessage('READBY_UPDATE', MOD.HandleREADBY_UPDATE);\n  // Currently not used\n  // UDATA.OnAppStateChange('COMMENTCOLLECTION', COMMENTCOLLECTION => console.log('comment-mgr.COMMENTCOLLECTION state updated:', COMMENTCOLLECTION));\n  // UDATA.OnAppStateChange('COMMENTVOBJS', COMMENTVOBJS => console.error('comment-mgr.COMMENTVOBJS state updated', COMMENTVOBJS));\n}); // end INITIALIZE Hook\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** CONFIGURE fires after LOADASSETS, so this is a good place to put TEMPLATE\n *  validation.\n */\nMOD.Hook('CONFIGURE', () => {\n  if (DBG) console.log('comment-mgr CONFIGURE');\n}); // end CONFIGURE Hook\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** The APP_READY hook is fired after all initialization phases have finished\n *  and may also fire at other times with a valid info packet\n */\nMOD.Hook('APP_READY', function (info) {\n  if (DBG) console.log('comment-mgr APP_READY');\n}); // end APP_READY Hook\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.LoadDB = data => {\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  COMMENT.LoadTemplate(TEMPLATE.commentTypes);\n  COMMENT.LoadDB(data);\n\n  // After loading db, derive the view objects\n  // This is needed to force update of the project comment count\n  const uid = MOD.GetCurrentUserId();\n  COMMENT.DeriveAllThreadedViewObjects(uid);\n  const COMMENTCOLLECTION = COMMENT.GetCommentCollections();\n  UDATA.SetAppState('COMMENTCOLLECTION', COMMENTCOLLECTION);\n};\n\n/// HELPER FUNCTIONS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n// From Evan O'Neil https://drive.google.com/drive/folders/1fJ5WiLMVQxxaqghrCOFwegmnYoOvst7E\nMOD.COMMENTICON = (\n  <g transform=\"matrix(1.6,0,0,1.6,4,0)\">\n    <path\n      className=\"svg-fill\"\n      d=\"M8 15C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1C4.13401 1 1 4.13401 1 8C1 9.15705 1.28072 10.2485 1.77778 11.21V15H8Z\"\n    ></path>\n    <path\n      className=\"svg-outline\"\n      d=\"M3.17778 10.8696V13.6H8C11.0928 13.6 13.6 11.0928 13.6 8C13.6 4.90721 11.0928 2.4 8 2.4C4.90721 2.4 2.4 4.90721 2.4 8C2.4 8.92813 2.62469 9.79968 3.02143 10.5671L3.17778 10.8696ZM15 8C15 11.866 11.866 15 8 15H1.77778V11.21C1.28072 10.2485 1 9.15705 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8Z\"\n    ></path>\n    <path fill=\"none\" d=\"M0 0h24v24H0z\"></path>\n  </g>\n);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_SetAppStateCommentCollections() {\n  const COMMENTCOLLECTION = COMMENT.GetCommentCollections();\n  UDATA.SetAppState('COMMENTCOLLECTION', COMMENTCOLLECTION);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_SetAppStateCommentVObjs() {\n  const COMMENTVOBJS = COMMENT.GetCOMMENTVOBJS();\n  UDATA.SetAppState('COMMENTVOBJS', COMMENTVOBJS);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_UpdateComment(comment) {\n  const cobj = {\n    collection_ref: comment.collection_ref,\n    comment_id: comment.comment_id,\n    comment_id_parent: comment.comment_id_parent,\n    comment_id_previous: comment.comment_id_previous,\n    comment_type: comment.comment_type,\n    comment_createtime: comment.comment_createtime,\n    comment_modifytime: comment.comment_modifytime,\n    comment_isMarkedDeleted: comment.comment_isMarkedDeleted,\n    commenter_id: comment.commenter_id,\n    commenter_text: comment.commenter_text\n  };\n  const uid = MOD.GetCurrentUserId();\n  COMMENT.UpdateComment(cobj, uid);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_urstate_LOCKSTATE(LOCKSTATE) {\n  UDATA.SetAppState('CMTLOCKSTATE', LOCKSTATE);\n}\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// CONSTANTS\nMOD.VIEWMODE = NCUI.VIEWMODE;\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Collection Reference Generators\n/// e.g. converts node id to \"n32\"\nMOD.GetNodeCREF = nodeId => `n${nodeId}`;\nMOD.GetEdgeCREF = edgeId => `e${edgeId}`;\nMOD.GetProjectCREF = projectId => `p${projectId}`;\n\n/// deconstructs \"n32\" into {type: \"n\", id: 32}\nMOD.DeconstructCREF = cref => {\n  const type = cref.substring(0, 1);\n  const id = cref.substring(1);\n  return { type, id };\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Generate a human friendly label based on the cref (e.g. `n21`, `e4`)\n * e.g. \"n32\" becomes {typeLabel \"Node\", sourceLabel: \"32\"}\n * @param {string} cref\n * @returns { typeLabel, sourceLabel } sourceLabel is undefined if the source has been deleted\n */\nMOD.GetCREFSourceLabel = cref => {\n  const { type, id } = MOD.DeconstructCREF(cref);\n  let typeLabel;\n  let node, edge, nodes, sourceNode, targetNode;\n  let sourceLabel; // undefined if not found\n  switch (type) {\n    case 'n':\n      typeLabel = 'Node';\n      node = UDATA.AppState('NCDATA').nodes.find(n => n.id === Number(id));\n      if (!node) break; // node might be missing if comment references a node that was removed\n      if (node) sourceLabel = node.label;\n      break;\n    case 'e':\n      typeLabel = 'Edge';\n      edge = UDATA.AppState('NCDATA').edges.find(e => e.id === Number(id));\n      if (!edge) break; // edge might be missing if the comment references an edge that was removed\n      nodes = UDATA.AppState('NCDATA').nodes;\n      sourceNode = nodes.find(n => n.id === Number(edge.source));\n      targetNode = nodes.find(n => n.id === Number(edge.target));\n      if (edge && sourceNode && targetNode)\n        sourceLabel = `${sourceNode.label}${ARROW_RIGHT}${targetNode.label}`;\n      break;\n    case 'p':\n      typeLabel = 'Project'; // reserve for future use\n      sourceLabel = id;\n      break;\n  }\n  return { typeLabel, sourceLabel };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Returns the position for the comment button\n * Adjusting for window position is done via GetCommentCollectionPosition\n */\nMOD.GetCommentBtnPosition = cref => {\n  const btn = document.getElementById(cref);\n  if (!btn)\n    throw new Error(`${PR}GetCommentCollectionPosition: Button not found ${cref}`);\n  const bbox = btn.getBoundingClientRect();\n  return { x: bbox.left, y: bbox.top };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Returns the comment window position for the comment button\n * shifting the window to the left if it's too close to the edge of the screen.\n * or shifting it up if it's too close to the bottom of the screen.\n * x,y is the position of the comment button, offsets are then caclulated\n */\nMOD.GetCommentCollectionPosition = ({ x, y }, isExpanded) => {\n  const windowWidth = Math.min(screen.width, window.innerWidth);\n  const windowHeight = Math.min(screen.height, window.innerHeight);\n  let newX;\n  if (windowWidth - x < 500) {\n    newX = x - 410;\n  } else {\n    newX = x + CMTBTNOFFSET * 2;\n  }\n  let newY = y + window.scrollY;\n  if (windowHeight - y < 250) {\n    if (isExpanded) newY = y - 250;\n    else newY = y - 150;\n  } else {\n    newY = y - CMTBTNOFFSET;\n  }\n  return { x: newX, y: newY };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Open the object that the comment refers to\n/// e.g. in Net.Create it's a node or edge object\nMOD.OpenReferent = cref => {\n  const { type, id } = MOD.DeconstructCREF(cref);\n  let edge;\n  switch (type) {\n    case 'n':\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [parseInt(id)] });\n      break;\n    case 'e':\n      edge = UDATA.AppState('NCDATA').edges.find(e => e.id === Number(id));\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [edge.source] }).then(() => {\n        UDATA.LocalCall('EDGE_SELECT', { edgeId: edge.id });\n      });\n      break;\n    case 'p': // reserve for future use\n      // do something?\n      break;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Open comment using a comment id\nMOD.OpenComment = (cref, cid) => {\n  const { type, id } = MOD.DeconstructCREF(cref);\n  let edge;\n  switch (type) {\n    case 'n':\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [parseInt(id)] }).then(() => {\n        UDATA.LocalCall('COMMENT_SELECT', { cref }).then(() => {\n          const commentEl = document.getElementById(cid);\n          commentEl.scrollIntoView({ behavior: 'smooth' });\n        });\n      });\n      break;\n    case 'e':\n      edge = UDATA.AppState('NCDATA').edges.find(e => e.id === Number(id));\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [edge.source] }).then(() => {\n        UDATA.LocalCall('EDGE_SELECT', { edgeId: edge.id }).then(() => {\n          UDATA.LocalCall('COMMENT_SELECT', { cref }).then(() => {\n            const commentEl = document.getElementById(cid);\n            commentEl.scrollIntoView({ behavior: 'smooth' });\n          });\n        });\n      });\n      break;\n    case 'p': // reserve for future use\n      // do something?\n      break;\n  }\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// User Id\nMOD.SetCurrentUserId = uid => (UID = uid);\nMOD.GetCurrentUserId = () => UID; // called by other comment classes\nMOD.GetUserName = uid => {\n  return COMMENT.GetUserName(uid);\n};\nMOD.IsAdmin = () => {\n  return SETTINGS.IsAdmin();\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Comment Type\nMOD.GetCommentTypes = () => {\n  return COMMENT.GetCommentTypes();\n};\nMOD.GetCommentType = slug => {\n  return COMMENT.GetCommentType(slug);\n};\nMOD.GetDefaultCommentType = () => {\n  return COMMENT.GetDefaultCommentType();\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Global Operations\nMOD.MarkAllRead = () => {\n  const uid = MOD.GetCurrentUserId();\n  const crefs = COMMENT.GetCrefs();\n  crefs.forEach(cref => {\n    m_DBUpdateReadBy(cref, uid);\n    COMMENT.MarkRead(cref, uid);\n  });\n  COMMENT.DeriveAllThreadedViewObjects(uid);\n  m_SetAppStateCommentCollections();\n};\n\n/// COMMENT COLLECTIONS ///////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Comment Collections\nMOD.GetCommentCollection = uiref => {\n  return COMMENT.GetCommentCollection(uiref);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*\n  OpenCommentCollection\n\n  The requests come from four sources:\n    * Node Editor\n    * Edge Editor\n    * Node Table\n    * Edge Table\n\n  URCommentVBtn is a UI component that passes clicks\n  to URCommentCollectionMgr via UR.Publish(`CMT_COLLECTION_SHOW`) calls\n\n  URCommentSVGBtn is a purely visual component that renders SVG buttons\n  as symbols and displays the comment count and selection status.\n  It pases the click events to URCommentVBtn.\n\n  MAP\n    * URCommentStatus\n      > URCommentCollectionMgr\n        > URCommentThread\n          > URCommentVBtn\n            > URCommentSVGBtn\n\n\n  HOW IT WORKS\n  When a Node Editor, Edge Editor, Node Table, or Edge Table clicks on the\n  URCommentVBtn, URCommentCollectionMgr will:\n  * Add the requested Thread to the URCommentCollectionMgr\n  * Open the URCommentThread\n  * When the URCommentThread is closed, it will be removed from the URCommentCollectionMgr\n\n*/\nMOD.OpenCommentCollection = (cref, position) => {\n  // Validate\n  if (cref === undefined)\n    throw new Error(\n      `comment-mgr.OpenCommentCollection: missing cref data ${JSON.stringify(cref)}`\n    );\n  if (position === undefined || position.x === undefined || position.y === undefined)\n    throw new Error(\n      `comment-mgr.OpenCommentCollection: missing position data ${JSON.stringify(\n        position\n      )}`\n    );\n  position.x = parseInt(position.x); // handle net call data\n  position.y = parseInt(position.y);\n  // 0. If the comment is already open, do nothing\n  const openComments = MOD.GetOpenComments(cref);\n  if (openComments) {\n    MOD.CloseCommentCollection(cref, cref, MOD.GetCurrentUserId());\n    return; // already open, close it\n  }\n  // 1. Position the window to the right of the click\n  const commentThreadWindowIsExpanded = MOD.GetCommentCollectionCount(cref);\n  const collectionPosition = MOD.GetCommentCollectionPosition(\n    position,\n    commentThreadWindowIsExpanded\n  );\n\n  // 2. Update the state\n  MOD.UpdateCommentUIState(cref, { cref, isOpen: true });\n  // 3. Open the collection in the collection manager\n  UDATA.LocalCall('CMT_COLLECTION_SHOW', { cref, position: collectionPosition });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Called by URCommentVBtn\n * @param {string} cref\n */\nMOD.OpenCommentCollectionByCref = cref => {\n  const cmtPosition = MOD.GetCommentBtnPosition(cref);\n  MOD.OpenCommentCollection(cref, {\n    x: cmtPosition.x + CMTBTNOFFSET,\n    y: cmtPosition.y + CMTBTNOFFSET\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Open comment inside a collection using a comment id\n/// NOTE this is NOT used by SVGButtons\nMOD.OpenCommentStatusComment = (cref, cid) => {\n  const { type, id } = MOD.DeconstructCREF(cref);\n  let parms;\n\n  // if a comment is being edited...\n  // - don't close all comments\n  // - don't open a new one\n  if (MOD.GetCommentsAreBeingEdited()) {\n    const CMTSTATUS = UDATA.AppState('CMTSTATUS');\n    CMTSTATUS.dialog = {\n      isOpen: true,\n      message: `Please finish editing your comment before opening a different comment!`,\n      okmessage: 'OK',\n      onOK: m_CloseRemoveCommentDialog,\n      cancelmessage: '',\n      onCancel: undefined\n    };\n\n    UDATA.SetAppState('CMTSTATUS', CMTSTATUS);\n    return;\n  }\n\n  MOD.CloseAllCommentCollectionsWithoutMarkingRead();\n\n  let edge;\n  switch (type) {\n    case 'p': // project (from MEME, currently not used) reserved for future use\n      MOD.OpenCommentCollectionByCref('projectcmt');\n      break;\n    case 'n':\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [parseInt(id)] }).then(() => {\n        MOD.OpenCommentCollectionByCref(cref);\n        // wait for the comment to open before scrolling to the current comment\n        // REVIEW: Do this as a callback?\n        //         Problem is that this is a long chain for the callback\n        //         - OpenCommentCollectionByCref\n        //         - OpenCommentCollection\n        //         - UpdateCommentUIState\n        //         - m_SetAppStateCommentCollections\n        //         - UDATA.SetAppState('COMMENTCOLLECTION)\n        setTimeout(() => {\n          const commentEl = document.getElementById(cid);\n          commentEl.scrollIntoView({ behavior: 'smooth' });\n        }, 100);\n      });\n      break;\n    case 'e':\n      edge = UDATA.AppState('NCDATA').edges.find(e => e.id === Number(id));\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [edge.source] }).then(() => {\n        UDATA.LocalCall('EDGE_SELECT', { edgeId: edge.id }).then(() => {\n          MOD.OpenCommentCollectionByCref(cref);\n          // wait for the comment to open before scrolling to the current comment\n          // REVIEW: Do this as a callback?\n          setTimeout(() => {\n            const commentEl = document.getElementById(cid);\n            commentEl.scrollIntoView({ behavior: 'smooth' });\n          });\n        });\n      });\n      break;\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// DEPRECATED -- URCommentVBtn handles this currently\n///               But we might want to restore the ability to toggle in place.\n// /**\n//  * Used by NCNodeTable and NCEdgeTable to open/close the comment thread\n//  * If a comment is already opened by one button (e.g. node), and the user\n//  * clicks on another comment button (e.g. NodeTable), the new one will open,\n//  * and the old one closed.\n//  * Called by URCommentBtn, NCNodeTable, and NCEdgeTable\n//  * @param {TCommentUIRef} uiref comment button id\n//  * @param {TCollectionRef} cref collection_ref\n//  * @param {Object} position x, y position of the comment button\n//  */\n// MOD.ToggleCommentCollection = (uiref, cref, position) => {\n//   const uid = MOD.GetCurrentUserId();\n//   // is the comment already open?\n//   const open_uiref = MOD.GetOpenComments(cref);\n//   if (open_uiref === uiref) {\n//     // already opened by THIS uiref, so toggle it closed.\n//     MOD.CloseCommentCollection(uiref, cref, uid);\n//   } else if (open_uiref !== undefined) {\n//     // already opened by SOMEONE ELSE, so close it, then open the new one\n//     MOD.CloseCommentCollection(open_uiref, cref, uid);\n//     // REVIEW remove uiref?\n//     MOD.OpenCommentCollection(uiref, cref, position);\n//   } else {\n//     // no comment is open, so open the new one\n//     // REVIEW remove uiref?\n//     MOD.OpenCommentCollection(uiref, cref, position);\n//   }\n// };\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Marks a comment as read, and closes the component.\n * Called by NCCommentBtn when clicking \"Close\"\n * @param {Object} uiref comment button id\n * @param {Object} cref collection_ref\n * @param {Object} uid user id\n */\nMOD.CloseCommentCollection = (uiref, cref, uid) => {\n  if (!MOD.OKtoClose(cref)) {\n    // Comment is still being edited, prevent close\n    // eslint-disable-next-line no-alert\n    alert(\n      'This comment is still being edited!  Please Save or Cancel before closing the comment.'\n    );\n    return;\n  }\n  // OK to close\n  UDATA.LocalCall('CMT_COLLECTION_HIDE', { cref });\n  COMMENT.CloseCommentCollection(uiref, cref, uid);\n  m_SetAppStateCommentCollections();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Marks a comment as read, and closes the component.\n * Called by NCCommentBtn when clicking \"Close\"\n * @param {Object} uiref comment button id (note kept for Net.Create compatibility)\n * @param {Object} cref collection_ref\n * @param {Object} uid user id\n */\nMOD.CloseCommentCollectionAndMarkRead = (uiref, cref, uid) => {\n  if (!MOD.OKtoClose(cref)) {\n    // Comment is still being edited, prevent close\n    // eslint-disable-next-line no-alert\n    alert(\n      'This comment is still being edited!  Please Save or Cancel before closing the comment.'\n    );\n    return;\n  }\n  // OK to close\n  UDATA.LocalCall('CMT_COLLECTION_HIDE', { cref });\n  // Update the readby\n  m_DBUpdateReadBy(cref, uid);\n  COMMENT.CloseCommentCollection(uiref, cref, uid);\n  m_SetAppStateCommentCollections();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Closes all comment collections without marking them as read.\n * Used by comment status when user clicks on status updates to display\n * updated comments.\n * @param {*} uid\n */\nMOD.CloseAllCommentCollectionsWithoutMarkingRead = () => {\n  const uid = MOD.GetCurrentUserId();\n  UDATA.LocalCall('CMT_COLLECTION_HIDE_ALL');\n  COMMENT.CloseAllCommentCollections(uid);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.GetCommentCollectionCount = cref => {\n  const ccol = COMMENT.GetCommentCollection(cref);\n  return ccol ? ccol.commentCount : 0;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.GetCommentStats = () => {\n  const uid = MOD.GetCurrentUserId();\n  return COMMENT.GetCommentStats(uid);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.GetCommentThreadPosition = commentButtonId => {\n  const btn = document.getElementById(commentButtonId);\n  const cmtbtnx = btn.getBoundingClientRect().left;\n  const windowWidth = Math.min(screen.width, window.innerWidth);\n  let x;\n  if (windowWidth - cmtbtnx < 500) {\n    x = cmtbtnx - 405;\n  } else {\n    x = cmtbtnx + 35;\n  }\n  const y = btn.getBoundingClientRect().top + window.scrollY;\n  return { x, y };\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Comment UI State\n * @param {string} uiref\n * @returns {TCommentOpenState} {isOpen: boolean, cref: string}\n */\nMOD.GetCommentUIState = uiref => {\n  return COMMENT.GetCommentUIState(uiref);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Used to open/close the comment thread\n * @param {string} uiref\n * @param {TCommentOpenState} openState\n */\nMOD.UpdateCommentUIState = (uiref, openState) => {\n  COMMENT.UpdateCommentUIState(uiref, openState);\n  m_SetAppStateCommentCollections();\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Open Comments\nMOD.GetOpenComments = cref => COMMENT.GetOpenComments(cref);\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Editable Comments (comments being edited)\nMOD.RegisterCommentBeingEdited = cid => {\n  COMMENT.RegisterCommentBeingEdited(cid);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.DeRegisterCommentBeingEdited = cid => {\n  return COMMENT.DeRegisterCommentBeingEdited(cid);\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Are ANY comments being edited?\n/// Returns True if ANY comment is being edited\n/// * Used by comment status when user clicks on a comment id to view a saved comment\n///   to prevent closing the comment collection if a comment is being edited.\n/// * Also used by URCommentThread to determine whether \"Click to add\" is displayed\nMOD.GetCommentsAreBeingEdited = () => {\n  return COMMENT.GetCommentsAreBeingEdited();\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.OKtoClose = cref => {\n  const cvobjs = MOD.GetThreadedViewObjects(cref);\n  let isBeingEdited = false;\n  cvobjs.forEach(cvobj => {\n    if (COMMENT.GetCommentBeingEdited(cvobj.comment_id)) isBeingEdited = true;\n  });\n  return !isBeingEdited;\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Threaded View Objects\nMOD.GetThreadedViewObjects = (cref, uid) => {\n  return COMMENT.GetThreadedViewObjects(cref, uid);\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Comment View Objects\nMOD.GetCommentVObj = (cref, cid) => {\n  return COMMENT.GetCommentVObj(cref, cid);\n};\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Comments\nMOD.GetComment = cid => {\n  return COMMENT.GetComment(cid);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.GetUnreadRepliesToMe = uid => {\n  return COMMENT.GetUnreadRepliesToMe(uid);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.GetUnreadComments = () => {\n  return COMMENT.GetUnreadComments();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * @param {Object} cobj Comment Object\n */\nMOD.AddComment = cobj => {\n  // This just generates a new ID, but doesn't update the DB\n  DATASTORE.PromiseNewCommentID().then(newCommentID => {\n    cobj.comment_id = newCommentID;\n    COMMENT.AddComment(cobj); // creates a comment vobject\n    m_SetAppStateCommentVObjs();\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** User clicks Edit on a comment\n *  @param {TCommentID} comment_id\n */\nMOD.UIEditComment = comment_id => {\n  MOD.RegisterCommentBeingEdited(comment_id);\n  MOD.LockComment(comment_id);\n  UDATA.NetSend('COMMENT_UPDATE_PERMISSIONS');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** User clicks Cancel on a comment\n *  @param {TCommentID} comment_id\n */\nMOD.UICancelComment = comment_id => {\n  MOD.DeRegisterCommentBeingEdited(comment_id);\n  MOD.UnlockComment(comment_id);\n  UDATA.NetSend('COMMENT_UPDATE_PERMISSIONS');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** User clicks Save coment\n *  @param {TComment} cobj\n */\nMOD.UISaveComment = cobj => {\n  MOD.UnlockComment(cobj.comment_id);\n  MOD.DeRegisterCommentBeingEdited(cobj.comment_id);\n  MOD.UpdateComment(cobj);\n  UDATA.NetSend('COMMENT_UPDATE_PERMISSIONS');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Update the ac/dc comments, then save it to the db\n * This will also broadcast COMMENT_UPDATE so other clients on the network\n * update the data to match the server.\n * @param {Object} cobj\n */\nMOD.UpdateComment = cobj => {\n  COMMENT.UpdateComment(cobj);\n  m_DBUpdateComment(cobj);\n  m_SetAppStateCommentVObjs();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Removing a comment can affect multiple comments, so this is done\n * via a batch operation.  We queue up all of the comment changes\n * using the logic for removing/re-arranging the comments in\n * ac-comments/dc-comments, then write out the db updates. This way\n * the db updates can be blindly accomplished in a single operation.\n *\n * Removing is a two step process:\n * 1. Show confirmation dialog\n * 2. Execute the removal\n *\n * Also used by \"Cancel\" button to remove a comment being edited\n * @param {Object} parms\n * @param {string} parms.collection_ref\n * @param {string} parms.comment_id\n * @param {string} parms.id\n * @param {string} parms.uid\n * @param {boolean} parms.isAdmin\n * @param {boolean} parms.showCancelDialog\n * @param {boolean} parms.skipDialog\n */\nMOD.RemoveComment = parms => {\n  let confirmMessage, okmessage, cancelmessage;\n  if (parms.showCancelDialog) {\n    // Are you sure you want to cancel?\n    confirmMessage = `Are you sure you want to cancel editing this comment #${parms.id}?`;\n    okmessage = 'Cancel Editing and Delete';\n    cancelmessage = 'Go Back to Editing';\n  } else {\n    // show delete confirmaiton dialog\n    // Are you sure you want to delete?\n    parms.isAdmin = SETTINGS.IsAdmin();\n    confirmMessage = parms.isAdmin\n      ? `Are you sure you want to delete this comment #${parms.id} and ALL related replies (admin only)?`\n      : `Are you sure you want to delete this comment #${parms.id}?`;\n    okmessage = 'Delete';\n    cancelmessage = \"Don't Delete\";\n  }\n\n  const CMTSTATUS = UDATA.AppState('CMTSTATUS');\n  if (parms.skipDialog) {\n    m_ExecuteRemoveComment(event, parms);\n  } else {\n    CMTSTATUS.dialog = {\n      isOpen: true,\n      message: confirmMessage,\n      okmessage,\n      onOK: event => m_ExecuteRemoveComment(event, parms),\n      cancelmessage,\n      onCancel: m_CloseRemoveCommentDialog\n    };\n  }\n  UDATA.SetAppState('CMTSTATUS', CMTSTATUS);\n\n  MOD.DeRegisterCommentBeingEdited(parms.comment_id);\n  MOD.UnlockComment(parms.comment_id);\n\n  UDATA.LocalCall('COMMENT_UPDATE_PERMISSIONS');\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * The db call is made AFTER ac/dc handles the removal and the logic of\n * relinking comments.  The db call is dumb, all the logic is in dc-comments.\n * @param {Object} event\n * @param {Object} parms\n * @param {Object} parms.collection_ref\n * @param {Object} parms.comment_id\n * @param {Object} parms.uid\n */\nfunction m_ExecuteRemoveComment(event, parms, cb) {\n  const queuedActions = COMMENT.RemoveComment(parms);\n  m_DBRemoveComment(queuedActions);\n  m_SetAppStateCommentVObjs();\n  m_CloseRemoveCommentDialog();\n  if (typeof cb === 'function') cb();\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_CloseRemoveCommentDialog() {\n  const CMTSTATUS = UDATA.AppState('CMTSTATUS');\n  CMTSTATUS.dialog = { isOpen: false };\n  UDATA.SetAppState('CMTSTATUS', CMTSTATUS);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Requested when a node/edge is deleted\n * @param {string} cref\n */\nMOD.RemoveAllCommentsForCref = cref => {\n  const uid = MOD.GetCurrentUserId();\n  const parms = { uid, collection_ref: cref };\n  const queuedActions = COMMENT.RemoveAllCommentsForCref(parms);\n  m_DBRemoveComment(queuedActions);\n  m_SetAppStateCommentVObjs();\n};\n\n/// EVENT HANDLERS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Respond to network COMMENTS_UPDATE Messages\n * Usually used after a comment deletion to handle a batch of comment updates\n * This can include\n *   * updates to existing comments (marked DELETE or re-linked to other removed comment)\n *   * removal of comment altogether\n * This a network call that is used to update local state for other browsers\n * (does not trigger another DB update)\n * @param {Object[]} dataArray\n */\nMOD.HandleCOMMENTS_UPDATE = dataArray => {\n  if (DBG) console.log('COMMENTS_UPDATE======================', dataArray);\n  const updatedComments = [];\n  const removedComments = [];\n  const updatedCrefs = new Map();\n  dataArray.forEach(data => {\n    if (data.comment) {\n      updatedComments.push(data.comment);\n      updatedCrefs.set(data.comment.collection_ref, 'flag');\n    }\n    if (data.commentID) removedComments.push(data.commentID);\n    if (data.collection_ref) updatedCrefs.set(data.collection_ref, 'flag');\n  });\n  const uid = MOD.GetCurrentUserId();\n  COMMENT.HandleRemovedComments(removedComments, uid);\n  COMMENT.HandleUpdatedComments(updatedComments, uid);\n\n  const crefs = [...updatedCrefs.keys()];\n  crefs.forEach(cref => COMMENT.DeriveThreadedViewObjects(cref, uid));\n\n  // and broadcast a state change\n  m_SetAppStateCommentCollections();\n  m_SetAppStateCommentVObjs();\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Respond to COMMENT_UPDATE Messages from the network\n * After the server/db saves the new/updated comment, COMMENT_UPDATE is\n * broadcast across the network.  This a network call that is used to update\n * the local state to match the server's comments.\n * (does not trigger another DB update)\n * @param {Object} data\n * @param {Object} data.comment cobj\n */\nMOD.HandleCOMMENT_UPDATE = data => {\n  if (DBG) console.log('COMMENT_UPDATE======================', data);\n\n  // If a new comment is sent over the network\n  // and the incoming comment conflicts with a comment being edited\n  // then re-link the editing comment to point to the incoming comment\n\n  const { comment: incomingComment } = data;\n  const editingCommentId = COMMENT.GetCommentsBeingEdited().values().next().value;\n  const editingComment = COMMENT.GetComment(editingCommentId);\n\n  if (editingComment) {\n    // conflict if both think they're the root\n    if (\n      incomingComment.comment_id_parent === '' &&\n      incomingComment.comment_id_previous === '' &&\n      editingComment.comment_id_parent === '' &&\n      editingComment.comment_id_previous === ''\n    ) {\n      if (DBG) console.error('CONFLICT! both think they are root');\n      // Re-link the comment to the incoming\n      editingComment.comment_id_previous = incomingComment.comment_id;\n    }\n    // conflict if previous of both are the same\n    if (incomingComment.comment_id_previous === editingComment.comment_id_previous) {\n      if (DBG) console.error('CONFLICT! both think they are reply to same previous');\n      // Re-link the comment to the incoming\n      editingComment.comment_id_previous = incomingComment.comment_id;\n    }\n    // conflict if parent of both are the same and previous are blank (new reply root)\n    if (\n      incomingComment.comment_id_parent === editingComment.comment_id_parent &&\n      incomingComment.comment_id_previous === '' &&\n      editingComment.comment_id_previous === ''\n    ) {\n      if (DBG) console.error('CONFLICT! both think they are reply to same parent');\n      // Re-link the comment to the incoming\n      editingComment.comment_id_previous = incomingComment.comment_id;\n    }\n  }\n\n  const updatedComments = [{ comment: incomingComment }, { comment: editingComment }];\n  MOD.HandleCOMMENTS_UPDATE(updatedComments);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.HandleREADBY_UPDATE = data => {\n  if (DBG) console.log('READBY_UPDATE======================');\n  // Not used currently\n  // Use this if we need to update READBY status from another user.\n  // Since \"read\" status is only displayed for the current user,\n  // we don't need to worry about \"read\" status updates from other users\n  // across the network.\n  //\n  // The exception to this would be if we wanted to support a single user\n  // logged in to multiple browsers.\n};\n\n/// DB CALLS //////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.LockComment = comment_id => {\n  UDATA.NetCall('SRV_DBLOCKCOMMENT', { commentID: comment_id }).then(() => {\n    UDATA.LocalCall('SELECTMGR_SET_MODE', { mode: 'comment_edit' });\n  });\n};\nMOD.UnlockComment = comment_id => {\n  UDATA.NetCall('SRV_DBUNLOCKCOMMENT', { commentID: comment_id }).then(() => {\n    UDATA.LocalCall('SELECTMGR_SET_MODE', { mode: 'normal' });\n  });\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_DBUpdateComment(cobj, cb) {\n  const comment = {\n    collection_ref: cobj.collection_ref,\n    comment_id: cobj.comment_id,\n    comment_id_parent: cobj.comment_id_parent,\n    comment_id_previous: cobj.comment_id_previous,\n    comment_type: cobj.comment_type,\n    comment_createtime: cobj.comment_createtime,\n    comment_modifytime: cobj.comment_modifytime,\n    comment_isMarkedDeleted: cobj.comment_isMarkedDeleted,\n    commenter_id: cobj.commenter_id,\n    commenter_text: cobj.commenter_text\n  };\n  UDATA.LocalCall('DB_UPDATE', { comment }).then(data => {\n    if (typeof cb === 'function') cb(data);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_DBUpdateReadBy(cref, uid) {\n  // Get existing readby\n  const cvobjs = COMMENT.GetThreadedViewObjects(cref, uid);\n  const readbys = [];\n  cvobjs.forEach(cvobj => {\n    const commenter_ids = COMMENT.GetReadby(cvobj.comment_id) || [];\n    // Add uid if it's not already marked\n    if (!commenter_ids.includes(uid)) commenter_ids.push(uid);\n    const readby = {\n      comment_id: cvobj.comment_id,\n      commenter_ids\n    };\n    readbys.push(readby);\n  });\n  UDATA.LocalCall('DB_UPDATE', { readbys }).then(data => {\n    if (typeof cb === 'function') cb(data);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Executes multiple database operations via a batch of commands:\n * - `cobjs` will be updated\n * - `commentIDs` will be deleted\n * @param {Object[]} items [ ...cobj, ...commentID ]\n * @param {function} cb callback\n */\nfunction m_DBRemoveComment(items, cb) {\n  UDATA.LocalCall('DB_BATCHUPDATE', { items }).then(data => {\n    if (typeof cb === 'function') cb(data);\n  });\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  MUR Property Group Component\n  used by mur-settings-client.jsx to generate a text input component\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nconst React = require('react');\nconst RSB = require('./react-settings-bridge');\nconst { DerefGroupDef } = RSB;\nimport TextInput from './MURTextInput';\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = true;\n\n/// HELPER METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction GroupHeader(props) {\n  const { label } = props;\n  return (\n    <span>\n      <b>{label}</b>\n    </span>\n  );\n}\n\n/// COMPONENTS ////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction PropertyGroup(props) {\n  const {\n    groupDef, // { groupname: { propname: { type, default }, {}... }\n    metaDef // { groupname:{ propname: { _groupMeta, propname: metaDef, {}... } }\n  } = props;\n  if (DBG) {\n    if (typeof groupDef !== 'object') return <p>PropertyGroup bad groupDef</p>;\n    if (typeof metaDef !== 'object') return <p>PropertyGroup bad metaDef</p>;\n  }\n  const gdata = DerefGroupDef(groupDef);\n  if (gdata.error) return <p>PropertyGroup bad groupDef {gdata.error}</p>;\n  const { groupName, properties } = gdata;\n  const propList = Object.keys(properties); // list of property names\n  const meta = metaDef[groupName];\n  const { title, description } = meta._groupMeta || {};\n  const key = `pg-${groupName}`;\n  return (\n    <div key={key} style={{ margin: '1rem' }}>\n      <details open>\n        <summary>\n          <GroupHeader label={title || groupName} />\n        </summary>\n        {description && (\n          <p style={{ color: 'gray', fontStyle: 'italic' }}>{description}</p>\n        )}\n        {propList.map(p => {\n          if (properties[p].type) {\n            const key = `in-${groupName}.${p}`;\n            return <TextInput propDef={properties[p]} metaDef={meta[p]} key={key} />;\n          }\n          return null;\n        })}\n      </details>\n    </div>\n  );\n}\n\n/// EXPORTS ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = PropertyGroup;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  MUR Property Editor Panel\n  (test replacement `NCTemplate.jsx`)\n\n  Requires that init.jsx has called UR.ViewLib.DeclareComponents() to make\n  custom web components available _before_ React renders anything.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst { ConsoleStyler } = require('ursys-min');\nconst RSB = require('./react-settings-bridge');\nconst PropertyGroup = require('./MURPropertyGroup');\nconst { diff } = require('deep-object-diff');\n\n/// RUNTIME INITIALIZATION ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = true;\nconst PR = ConsoleStyler('SetEdit', 'TagBlue');\nconst LOG = console.log.bind(console);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** a react context object, providing access to the values prop of the\n *  SettingsProvider. It has to be defined within the React App root */\nconst SettingsContext = RSB.GetSettingsContext(); // get the settings context\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction MURSettingsEditor() {\n  const api = RSB.useSettings();\n  const [oldState, saveOldState] = React.useState(api.lastSettingsUpdate);\n  const [showToDo, setShowToDo] = React.useState(true);\n\n  function saveChanges() {\n    saveOldState(api.lastSettingsUpdate);\n    LOG(...PR('would save changes'));\n  }\n\n  function revertChanges() {\n    LOG(...PR('would revert changes'));\n  }\n\n  const propDefs = RSB.GetPropertyDefs();\n  const metaDefs = RSB.GetMetaDefs();\n  const { opBtnStyle, modColor } = RSB.GetStyles();\n\n  const mod = api.lastSettingsUpdate !== oldState;\n  const backgroundColor = mod ? modColor : 'white';\n  const color = mod ? 'black' : 'gray';\n  const btnStyle = { ...opBtnStyle, backgroundColor, color };\n  const toDoList = (\n    <div>\n      <ul>\n        <li>graph name</li>\n        <li>graph description</li>\n        <li>secret key (for tokens)</li>\n        <li>admin password</li>\n        <li>\n          Node Definitions\n          <ul>\n            <li>\n              Node Type\n              <ul>\n                <li>1: [label, color]</li>\n                <li>2: [label, color]</li>\n                <li>...7</li>\n              </ul>\n            </li>\n            <li>Notes -- label, type, hide</li>\n            <li>Info -- label, type, hide</li>\n            <li>InfoSource -- label, type, hide</li>\n          </ul>\n        </li>\n        <li>\n          Edge Definitions\n          <ul>\n            <li>\n              Edge Type\n              <ul>\n                <li>1: [label, color]</li>\n                <li>2: [label, color]</li>\n                <li>...7</li>\n              </ul>\n            </li>\n            <li>Notes -- label, type, hide</li>\n            <li>InfoOrigin -- label, type, hide</li>\n            <li>Citation -- label, type, hide</li>\n            <li>Category -- label, type, hide</li>\n          </ul>\n        </li>\n        <li>\n          Comment Types\n          <ul>\n            <li>slug</li>\n            <li>label</li>\n            <li>\n              prompts\n              <ul>\n                <li>1: [format, prompt, help, feedback]</li>\n                <li>2: [format, prompt, help, feedback]</li>\n              </ul>\n            </li>\n          </ul>\n        </li>\n      </ul>\n      <p>NOTES: </p>\n      <ul>\n        <li>\n          `isProvenance` will place a field in the Proveannce tab. But we do not\n          expect teachers to need to change that.\n        </li>\n        <li>\n          Ideally teachers can add and remove new Node and Edge field definitions,\n          rather merely re-purposing existing fields. e.g. they might add an Event\n          Date field.\n        </li>\n      </ul>\n    </div>\n  );\n\n  return (\n    <SettingsContext.Provider value={api} modified={mod}>\n      <button style={btnStyle} onClick={saveChanges} disabled={!mod}>\n        Save Changes\n      </button>\n      &nbsp;\n      <button style={btnStyle} onClick={revertChanges} disabled={!mod}>\n        Revert Changes\n      </button>\n      <button style={btnStyle} onClick={() => setShowToDo(!showToDo)}>\n        {showToDo ? 'ShowWIP' : 'ShowToDo'}\n      </button>\n      {!showToDo &&\n        Object.keys(propDefs).map(gn => (\n          <PropertyGroup\n            groupDef={{ [gn]: propDefs[gn] }}\n            metaDef={{ [gn]: metaDefs[gn] }}\n            key={gn}\n          />\n        ))}\n      {showToDo && toDoList}\n    </SettingsContext.Provider>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MURSettingsEditor;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  MUR Text Input Component\n  used by mur-settings-client.jsx to generate a text input component\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nconst React = require('react');\nconst { Settings } = require('ursys-min'); // import the settings manager\nconst RSB = require('./react-settings-bridge');\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = true;\nconst LOG = console.log.bind(console);\nconst SettingsContext = RSB.GetSettingsContext();\n\n/// STYLING OBJECTS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst { itemGrid, labelStyle, inputStyle, popupStyle, modColor } = RSB.GetStyles();\n\n/// TEXT INPUT COMPONENT //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** A TextInput component */\nfunction TextInput(props) {\n  const { propDef, metaDef } = props;\n  if (DBG) {\n    if (typeof propDef !== 'object') return <p>TextInput bad groupDef</p>;\n    if (typeof metaDef !== 'object') return <p>TextInput bad metaDef</p>;\n  }\n  const { value, default: defValue } = propDef;\n  const { label, tooltip, help, placeholder } = metaDef;\n  // declare reactive render state\n  const [labelColor, setLabelColor] = React.useState('black');\n  const [tooltipStyle, setTooltipStyle] = React.useState({ ...popupStyle });\n  const [oldStyle, setOldStyle] = React.useState({ ...popupStyle });\n  const [oldValue] = React.useState(value || defValue);\n  const [inputValue, setInputValue] = React.useState(value || defValue);\n\n  /// CONTEXT ///\n\n  const api = React.useContext(SettingsContext);\n\n  /// TESTS ///\n\n  function assert_is_modified() {\n    if (label === 'description')\n      console.log(\n        `old / input / propDef\\n${oldValue} \\t${inputValue} \\t${propDef.value}`\n      );\n  }\n\n  /// UI-SETTINGS INTEROP EVENT UPDATES ///\n\n  // send data to settings object, which will trigger rerender\n  const submitToSettings = async value => {\n    LOG('would check data', propDef);\n    LOG('would call RSB.UpdateProperty(args)');\n    // api.forceUpdate();\n  };\n\n  /// LOCAL EVENT UPDATES ///\n\n  // input changes will update the current inputValue\n  const handleTyping = event => {\n    propDef.value = event.target.value;\n    setInputValue(propDef.value);\n  };\n\n  // input key return will submit the value to settings object\n  const handleEnterKey = async event => {\n    if (event.key === 'Enter') submitToSettings(event.target.value);\n  };\n\n  // hovering over label will show tooltip\n  const handleTooltip = event => {\n    if (event.type === 'mouseover') {\n      const offset = RSB.EventTargetOffsetStyle(event);\n      setTooltipStyle({\n        ...popupStyle,\n        ...offset,\n        display: 'block',\n        content: tooltip || ''\n      });\n      setLabelColor('maroon');\n    } else if (event.type === 'mouseout') {\n      setTooltipStyle({ ...popupStyle });\n      setLabelColor('black');\n    }\n  };\n\n  // hovering over a changed input will show the old value\n  const showOldValue = event => {\n    if (oldValue === inputValue) {\n      setOldStyle({ ...popupStyle });\n      return;\n    } else if (event.type === 'mouseover') {\n      const offset = RSB.EventTargetOffsetStyle(event);\n      setOldStyle({\n        ...popupStyle,\n        ...offset,\n        display: 'block',\n        content: oldValue || ''\n      });\n    } else if (event.type === 'mouseout') {\n      setOldStyle({ ...popupStyle });\n    }\n  };\n\n  /// RENDER ///\n\n  // conditional flags based on inputValue\n  const mod = inputValue !== oldValue;\n  const bgColor = mod ? modColor : 'white';\n  const pad = mod ? '1rem' : '0';\n\n  // assert_is_modified();\n\n  return (\n    <div style={itemGrid}>\n      <label\n        htmlFor={name}\n        style={{ ...labelStyle, color: labelColor }}\n        onMouseOver={handleTooltip}\n        onMouseOut={handleTooltip}\n      >\n        {label || name}\n      </label>\n      <input\n        type=\"text\"\n        name=\"${name}\"\n        style={{\n          ...inputStyle,\n          color: labelColor,\n          backgroundColor: bgColor,\n          paddingRight: pad\n        }}\n        defaultValue={inputValue}\n        onKeyDown={handleEnterKey}\n        onBlur={submitToSettings}\n        onInput={handleTyping}\n        onMouseOver={showOldValue}\n        onMouseOut={showOldValue}\n      />\n      {tooltip && <div style={tooltipStyle}>{tooltip}</div>}\n      <div style={oldStyle}>\n        <span style={{ opacity: 0.5 }}>old value: </span>\n        {oldValue}\n      </div>\n    </div>\n  );\n}\n\n/// EXPORTS ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = TextInput;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Optimized Markdwon React Component\n\n  This is based on Joshua's implementation of Markdown React in NodeTable\n  and EdgeTable.\n\n  Wraps the MDReactComponent and only updates when the text changes.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nconst MDReactComponent = require('markdown-react-js');\nconst mdEmoji = require('markdown-it-emoji');\nconst React = require('react');\nconst UNISYS = require('unisys/client');\n\n/// COMPONENT DECLARATION /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass MarkdownNote extends UNISYS.Component {\n  constructor() {\n    super();\n    this.markdownIterate = this.markdownIterate.bind(this);\n  }\n\n  markdownIterate(Tag, props, children) {\n    if (Tag === 'a') {\n      props.target = '_blank';\n    }\n    return <Tag {...props}>{children}</Tag>;\n  }\n\n  shouldComponentUpdate(np, ns) {\n    let bReturn = true;\n    if (this.text === np.text) bReturn = false;\n    else this.text = np.text;\n    return bReturn;\n  }\n\n  render() {\n    const { text } = this.props;\n    return (\n      <MDReactComponent\n        text={text}\n        onIterate={this.markdownIterate}\n        markdownOptions={{ typographer: true, linkify: true }}\n        plugins={[mdEmoji]}\n      />\n    );\n  }\n}\n\n/// EXPORTS ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MarkdownNote;\n","/* eslint-disable react/no-unescaped-entities */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  # NCAdvancedPanel\n\n  NCAdvancedPanel handles:\n  - Template Import/Export\n  - Node/Edge Import/Export\n  - User Tokens\n  - Admin Password\n\n  By default, only Export nodes/edges is enabled for normal users.\n  (The \"Import/Export\" tab will display \"Export\" only).\n  The other functions are admin-only.\n\n\n  ### PERMISSIONS App State\n\n  The `PERMISSIONS` app state is used to track the admin permissions.\n  This app state is used by NCNode, NCEdge, NCImportExport to\n  enable/disable admin-only features.\n\n  REVIEW: This probably should be moved to a permissions manager.\n\n\n  ### Admin Password\n\n  Only administrators (teachers) can manage templates, import data, and manage\n  user tokens.\n\n  The admin password is defined in the project template with the `adminPassword`\n  property and is not visible to students.\n\n  Admin features will be enabled as soon as you enter the correct password.\n  (You don't need to hit return).  When the password is validated, the input\n  form will turn into a \"Reset Password\"\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport NCImportExport from './NCImportExport';\nimport NCTemplate from './NCTemplate';\nimport NCUserTokens from './NCUserTokens';\nimport MURSettingEditor from './MURSettingsEditor';\nimport URPopover from './URPopover';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCAdvancedPanel' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst VIEWS = {\n  template: 'Template',\n  importexport: 'Import/Export',\n  usertokens: 'User Tokens',\n  settings: 'Settings'\n};\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nfunction NCAdvancedPanel() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [openTab, setOpenTab] = useState('importexport');\n  const [password, setPassword] = useState('');\n  const [hasAdminPermissions, setHasAdminPermissions] = useState(undefined);\n\n  useEffect(() => {\n    const PERMISSIONS = UDATA.AppState('PERMISSIONS');\n    UDATA.SetAppState('PERMISSIONS', {\n      ...PERMISSIONS,\n      isAdmin: hasAdminPermissions\n    });\n\n    UDATA.OnAppStateChange('PANELSTATE', evt_ToggleAdvanced);\n    assessAdminPrivileges();\n    return () => {\n      UDATA.AppStateChangeOff('PANELSTATE', evt_ToggleAdvanced);\n    };\n  }, []);\n\n  useEffect(() => {\n    assessAdminPrivileges();\n  }, [password]);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_ToggleAdvanced(PANELSTATE) {\n    setIsOpen(PANELSTATE.advancedIsOpen);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function assessAdminPrivileges() {\n    const TEMPLATE = UDATA.AppState('TEMPLATE');\n    if (TEMPLATE && TEMPLATE.adminPassword === undefined)\n      console.warn(\n        'No admin password defined!  Please set it if you need admin access'\n      );\n    const isAdmin =\n      TEMPLATE && TEMPLATE.adminPassword && TEMPLATE.adminPassword === password;\n    setHasAdminPermissions(isAdmin);\n\n    const PERMISSIONS = UDATA.AppState('PERMISSIONS');\n    UDATA.SetAppState('PERMISSIONS', { ...PERMISSIONS, isAdmin });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_CloseAdvanced() {\n    const PANELSTATE = UDATA.AppState('PANELSTATE');\n    UDATA.SetAppState('PANELSTATE', { ...PANELSTATE, advancedIsOpen: false });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_SelectTab(tab) {\n    setOpenTab(tab);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_PasswordChange(e) {\n    const password = e.target.value;\n    setPassword(password);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_PasswordClear() {\n    setPassword('');\n  }\n\n  // COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const TABS = hasAdminPermissions\n    ? VIEWS // show all tabs to admin\n    : { export: 'Export' }; // show \"Export\" only\n\n  let jsx;\n  switch (openTab) {\n    case 'template':\n      jsx = <NCTemplate />;\n      break;\n    case 'importexport':\n    case 'export':\n      jsx = <NCImportExport isAdmin={hasAdminPermissions} />;\n      break;\n    case 'usertokens':\n      jsx = <NCUserTokens />;\n      break;\n    case 'settings':\n      jsx = <MURSettingEditor />;\n      break;\n    default:\n      break;\n  }\n\n  if (!isOpen) return null;\n\n  let adminStatus;\n  if (hasAdminPermissions === undefined) {\n    adminStatus = <span>Admin Mode Disabled</span>;\n    console.error(\n      '\"adminPassword\" has not been defined in template!  You will not be able to access admin features.  Add a \"adminPassword\" property to the template to enable admin features.'\n    );\n  } else if (hasAdminPermissions === false)\n    adminStatus = (\n      <label>\n        admin: <input type=\"password\" id=\"password\" onChange={ui_PasswordChange} />\n      </label>\n    );\n  else if (hasAdminPermissions === true)\n    adminStatus = (\n      <button type=\"button\" onClick={ui_PasswordClear}>\n        Admin Logout\n      </button>\n    );\n\n  return (\n    <URPopover title=\"Advanced\" onClose={ui_CloseAdvanced}>\n      <div id=\"NCTabPanel\" className=\"NCAdvancedPanel\">\n        <div className=\"tabs\" role=\"tablist\">\n          {Object.keys(TABS).map(k => (\n            <button\n              key={k}\n              role=\"tab\"\n              className={openTab === k ? 'selected' : ''}\n              aria-selected={openTab === k}\n              aria-controls={k}\n              tabIndex={openTab === k ? '0' : '-1'}\n              onClick={() => ui_SelectTab(k)}\n            >\n              {TABS[k]}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"tabpanels\">{jsx}</div>\n\n        <div className=\"footer\">{adminStatus}</div>\n      </div>\n    </URPopover>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCAdvancedPanel;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Custom Auto Suggest for NetCreate\n\n  USE:\n\n    <NCAutoSuggest\n      parentKey={key}\n      value={value}\n      onChange={this.handleInputUpdate}\n      onSelect={this.handleSelection}\n    />\n\n  PROPS\n\n    onChange(key, value) -- returns `key` and `value` for the input field\n\n    onSelect(parentKey, value, id)\n        -- returns `state` and `value` for the final submission as well as the\n           matching id.  `value` is then passed back to NCAutoSuggest as the\n           search field input value.\n\n  This will look up matching nodes via FIND_MATCHING_NODES nc-logic request.\n\n  This is a simple HTML component that will allow users to enter arbitrary\n  text input.  Any partial node labels will display as a list of popup\n  menu options.\n\n  It can be used in a NCSearch or NCEdge\n  (NOTE NCNode does not not use NCAutoSuggest, but displays a matchlist using\n  a mechanism similar to NCAutoSuggest -- the key difference is that NCNode's\n  matchlist is simply a static display list to let you know which nodes match\n  the current input field, and does NOT support selecting a match.)\n\n  `parentKey` provides a unique key to determine whether this NCAutoSuggest\n  component is being used for a `search`, a `source`, or a `target` selection\n\n  Replaces the deprecated AutoComplete and AutoSuggest components.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\nconst { SEARCH_PLACEHOLDER } = require('system/util/constant');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCAutoSuggest';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NCAutoSuggest extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      matches: [], // {id, label}\n      higlightedLine: -1,\n      isValidNode: true,\n      uShowMatchlist: false,\n      uNodeOrEdgeBeingEdited: false\n    };\n\n    this.urstate_LOCKSTATE = this.urstate_LOCKSTATE.bind(this);\n    this.m_UIInputFocus = this.m_UIInputFocus.bind(this);\n    this.m_UIInputClick = this.m_UIInputClick.bind(this);\n    this.m_UIUpdate = this.m_UIUpdate.bind(this);\n    this.m_UISelectByLabel = this.m_UISelectByLabel.bind(this);\n    this.m_UISelectById = this.m_UISelectById.bind(this);\n    this.m_UIKeyDown = this.m_UIKeyDown.bind(this);\n    this.m_UIMouseHighlightLine = this.m_UIMouseHighlightLine.bind(this);\n    this.m_UIMouseUnhighlightLine = this.m_UIMouseUnhighlightLine.bind(this);\n    this.m_UIHighlightLine = this.m_UIHighlightLine.bind(this);\n    this.m_UIClickOutside = this.m_UIClickOutside.bind(this);\n\n    document.addEventListener('click', this.m_UIClickOutside);\n\n    this.OnAppStateChange('LOCKSTATE', this.urstate_LOCKSTATE);\n  }\n\n  componentWillUnmount() {\n    this.AppStateChangeOff('LOCKSTATE', this.urstate_LOCKSTATE);\n    document.removeEventListener('click', this.m_UIClickOutside);\n  }\n\n  urstate_LOCKSTATE(LOCKSTATE) {\n    this.setState({ uNodeOrEdgeBeingEdited: LOCKSTATE.nodeOrEdgeBeingEdited });\n  }\n\n  /**\n   * User has clicked inside the input field to set selection point\n   * This is needed to restore the selection point after a blur\n   * `focus` fires before `click`\n   */\n  m_UIInputFocus(event) {\n    event.target.select();\n    this.m_UIUpdate(event);\n  }\n\n  /**\n   * User has clicked in the input field, so update and show the matchlist\n   * and catch the event to prevent the document click handler from firing other actions\n   */\n  m_UIInputClick(event) {\n    event.preventDefault(); // this prevents the document click handler from closing the matchlist\n    event.stopPropagation();\n    this.setState({ uShowMatchlist: true });\n  }\n\n  /**\n   * User has typed in the input field, or the field is getting focus again.\n   * This processes the form data before passing it on to the parent handler.\n   * The callback function is generally an input state update method in\n   * NCNode or NCEdge\n   * @param {Object} event\n   */\n  m_UIUpdate(event) {\n    const { onChange } = this.props;\n    const key = event.target.id;\n    const value = event.target.value;\n    // save the selection cursor position\n    const selstart = event.target.selectionStart;\n    const inputEl = event.target;\n\n    let isValidNode = false;\n    this.AppCall('FIND_MATCHING_NODES', { searchString: value }).then(data => {\n      const matches =\n        data.nodes && data.nodes.length > 0\n          ? data.nodes.map(d => {\n              if (d.label === value) isValidNode = true;\n              return { id: d.id, label: d.label };\n            })\n          : undefined;\n      this.setState({ matches, isValidNode, uShowMatchlist: true });\n      if (typeof onChange === 'function')\n        onChange(key, value, () => {\n          // restore  selection cursor position\n          inputEl.selectionStart = selstart;\n          inputEl.selectionEnd = selstart;\n        });\n    });\n  }\n  /**\n   * User has clicked an item in the matchlist,\n   * or selected an item by typing ENTER\n   * selecting one of the autosuggest items\n   * @param {Object} event\n   * @param {string} parentKey Either `search`, `source` or `target`\n   * @param {string} value The autosuggest input value\n   */\n  m_UISelectByLabel(event, parentKey, value) {\n    event.preventDefault(); // catch click to close matchlist\n    event.stopPropagation();\n    const { onSelect } = this.props;\n    const { matches } = this.state;\n    const matchedNodeViaID = matches ? matches.find(n => n.id === value) : undefined;\n    this.setState({\n      isValidNode: matchedNodeViaID,\n      matches: [],\n      higlightedLine: -1,\n      uShowMatchlist: false\n    }); // clear matches\n    if (typeof onSelect === 'function') {\n      onSelect(\n        parentKey,\n        value,\n        matchedNodeViaID ? matchedNodeViaID.id : undefined // ...or id, not both\n      ); // callback function NCEdge.uiSourceTargetInputUpdate\n    }\n  }\n\n  m_UISelectById(event, parentKey, id) {\n    event.preventDefault(); // catch click to close matchlist\n    event.stopPropagation();\n    const { onSelect, value } = this.props;\n    const { matches } = this.state;\n    const matchedNodeViaID = matches ? matches.find(n => n.id === id) : undefined;\n    this.setState({\n      isValidNode: matchedNodeViaID,\n      matches: [],\n      higlightedLine: -1,\n      uShowMatchlist: false\n    }); // clear matches\n    if (typeof onSelect === 'function') {\n      onSelect(\n        parentKey,\n        value, // show the current input field value\n        matchedNodeViaID ? matchedNodeViaID.id : undefined // ...or `id`, not both\n      ); // callback function NCEdge.uiSourceTargetInputUpdate\n    }\n  }\n\n  /**\n   * Handle key strokes\n   * --  Typing UP/DOWN arrow will select the higlight\n   * --  Typing ESC will cancel the autosuggest, also hitting Tab will prevent selecting the next field\n   * --  Typing ENTER will select the item\n   * @param {Object} event\n   */\n  m_UIKeyDown(event) {\n    const { matches, higlightedLine, uNodeOrEdgeBeingEdited } = this.state;\n    const { parentKey, value, onSelect } = this.props;\n    const keystroke = event.key;\n    const lastLine = matches ? matches.length : -1;\n    let newHighlightedLine = higlightedLine;\n    if (keystroke === 'Enter') {\n      if (higlightedLine > -1 && matches) {\n        // make sure matches exists, b/c hitting Enter with a typo can end up with bad match\n        // there is highlight, so select that using the id in the matchlist\n        const id = matches[higlightedLine].id;\n        this.m_UISelectById(event, parentKey, id); // user selects current highlight\n      } else if (value !== '') {\n        if (!uNodeOrEdgeBeingEdited) {\n          // Create a new node -- see also NCSearch\n          document.activeElement.blur(); // allow new node to receive focus\n          this.m_UISelectByLabel(event, parentKey, value); // user selects current highlight\n        }\n      }\n    }\n    if (keystroke === 'Escape') {\n      // close autosuggest\n      event.preventDefault();\n      event.stopPropagation();\n      this.setState({ matches: [], higlightedLine: -1 });\n    }\n    if (keystroke === 'ArrowUp') newHighlightedLine--;\n    if (keystroke === 'ArrowDown') newHighlightedLine++;\n    if (\n      higlightedLine !== newHighlightedLine &&\n      newHighlightedLine > -1 &&\n      lastLine > 0\n    ) {\n      this.m_UIHighlightLine(newHighlightedLine);\n    }\n  }\n\n  m_UIMouseHighlightLine(event, line) {\n    this.m_UIHighlightLine(line);\n  }\n  m_UIMouseUnhighlightLine(event) {\n    // Placeholder for future functionality\n    // Catch the event, but don't do anything.\n    // We want to keep the matchlist open even if you move the mouse\n    // outside of the line.\n  }\n\n  m_UIHighlightLine(line) {\n    const { matches } = this.state;\n    const lastLine = matches ? matches.length : -1;\n    line = Math.min(lastLine - 1, Math.max(0, line));\n    this.setState({ higlightedLine: line, uShowMatchlist: true });\n    const highlightedNode = matches[line];\n    this.AppCall('AUTOSUGGEST_HILITE_NODE', { nodeId: highlightedNode.id });\n  }\n\n  // Clicking outside of the matchlist should close the autosuggest\n  m_UIClickOutside(event) {\n    if (event.defaultPrevented)\n      return; // clicking on the input field or the matchlist catches the click and prevents inadvertently closing the matchlist\n    else this.setState({ matches: [], higlightedLine: -1, uShowMatchlist: false }); // close matchlist\n  }\n\n  render() {\n    const { matches, higlightedLine, isValidNode, uShowMatchlist } = this.state;\n    const { parentKey, value, onSelect } = this.props;\n    const matchList =\n      matches && matches.length > 0\n        ? matches.map((n, i) => (\n            <div\n              key={`${n.label}${i}`}\n              value={n.label}\n              className={higlightedLine === i ? 'highlighted' : ''}\n              onClick={event => this.m_UISelectById(event, parentKey, n.id)}\n              onMouseEnter={event => this.m_UIMouseHighlightLine(event, i)}\n            >\n              {n.label} <span className=\"id\">#{n.id}</span>\n            </div>\n          ))\n        : undefined;\n    return (\n      <div className=\"NCAutoSuggest\">\n        <label className=\"helptop\" htmlFor={parentKey}>\n          Click on a node, or type a node name\n        </label>\n        <input\n          id={parentKey}\n          key={`${parentKey}input`}\n          value={value}\n          type=\"string\"\n          autoFocus\n          className={!isValidNode ? 'invalid' : ''}\n          onChange={this.m_UIUpdate}\n          onKeyDown={this.m_UIKeyDown}\n          onFocus={this.m_UIInputFocus}\n          onClick={this.m_UIInputClick}\n          placeholder={SEARCH_PLACEHOLDER}\n          autoComplete=\"off\" // turn off Chrome's default autocomplete, which conflicts\n        />\n        {uShowMatchlist && matchList && (\n          <div style={{ position: 'relative' }}>\n            <div\n              id=\"matchlist\"\n              className=\"matchlist\"\n              onMouseLeave={this.m_UIMouseUnhighlightLine}\n            >\n              {matchList}\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCAutoSuggest;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Generic Dialog\n\n  USE:\n\n    <NCDialog\n      statekey={key}\n      value={value}\n      onChange={this.handleInputUpdate}\n      onSelect={this.handleSelection}\n    />\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst Draggable = require('react-draggable');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCDialog';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass NCDialog extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const {\n      message = 'Are you sure?',\n      okmessage = 'OK',\n      cancelmessage = 'Cancel',\n      onOK,\n      onCancel\n    } = this.props;\n    const OKBtn = (\n      <button onClick={onOK} autoFocus>\n        {okmessage}\n      </button>\n    );\n    const CancelBtn = onCancel ? (\n      <button onClick={onCancel} type=\"button\">\n        {cancelmessage}\n      </button>\n    ) : (\n      ''\n    );\n    return (\n      <div className=\"dialog\">\n        <div className=\"screen\"></div>\n        <Draggable>\n          <div className=\"dialogwindow\">\n            <div className=\"dialogmessage\">{message}</div>\n            <div className=\"dialogcontrolbar\">\n              {CancelBtn}\n              {`\\u00a0`}\n              {OKBtn}\n            </div>\n          </div>\n        </Draggable>\n      </div>\n    );\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCDialog;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Citation Dialog\n\n  USE:\n\n    <NCDialogCitation\n      message={message}\n      copymessage={'Copy to Clipboard\"}\n      onClose={this.UIHandleClose}\n    />\n\n  This display citation text with a \"Copy to Clipboard\" button.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCDialogCitation';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass NCDialogCitation extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { copiedMessage: '' };\n    this.m_UIOnCopy = this.m_UIOnCopy.bind(this);\n  }\n\n  m_UIOnCopy() {\n    const { onClose } = this.props;\n    const messageEl = document.querySelector('#citationMessage');\n    messageEl.select();\n    document.execCommand('copy'); // deprecated, but other techniques require HTTPS\n    if (typeof onClose === 'function') {\n      this.setState({ copiedMessage: 'Copied to Clipboard!' }, () =>\n        setTimeout(onClose, 500)\n      );\n    }\n  }\n\n  render() {\n    const { copiedMessage } = this.state;\n    const {\n      message = 'message',\n      copymessage = 'Copy to Clipboard',\n      onClose\n    } = this.props;\n    const CopyBtn = (\n      <button onClick={this.m_UIOnCopy} autoFocus>\n        {copymessage}\n      </button>\n    );\n    return (\n      <div className=\"dialog\">\n        <div className=\"screen\"></div>\n        <div className=\"dialogwindow\">\n          <div className=\"dialogmessage\">\n            <textarea\n              id=\"citationMessage\"\n              defaultValue={message}\n              rows=\"5\"\n              cols=\"60\"\n              readOnly\n              style={{\n                fontSize: '12px',\n                fontStyle: 'italic',\n                padding: '5px 10px',\n                border: 'none',\n                color: '#333',\n                background: '#eef'\n              }}\n            />\n          </div>\n          <div className=\"dialogcontrolbar\">\n            {copiedMessage} {CopyBtn}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCDialogCitation;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Image URL Input Dialog\n\n  Dialog that shows an input field for pasting an image URL into a Node or Edge.\n  If the URL is correct, the image will be previewed.\n\n  USE:\n\n    <NCDialogInput\n      message=\"Paste image URL:\"\n      okmessage=\"Insert\"\n      onOK={event => m_UIPasteImageURL(event, key, cb)}\n      cancelMessage=\"Cancel\"\n      onSCancel={m_UICancleInsertImageURL}\n    />\n\n  TO OPEN the DIALOG:\n\n    UDATA.LocalCall(\"IMAGE_URL_DIALOG_OPEN\")\n\n  This will look up matching nodes via FIND_MATCHING_NODES nc-logic request.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCDialogInput';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet UDATA;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass NCDialogInsertImageURL extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isOpen: false,\n      url: ''\n    };\n    this.m_UIOpenDialog = this.m_UIOpenDialog.bind(this);\n    this.m_UIInputChange = this.m_UIInputChange.bind(this);\n    this.m_UIOnOK = this.m_UIOnOK.bind(this);\n    this.m_UIOnCancel = this.m_UIOnCancel.bind(this);\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n    UDATA.HandleMessage('IMAGE_URL_DIALOG_OPEN', this.m_UIOpenDialog);\n  }\n\n  componentWillUnmount() {\n    UDATA.UnhandleMessage('IMAGE_URL_DIALOG_OPEN', this.m_UIOpenDialog);\n  }\n\n  m_UIOpenDialog(data) {\n    const { id } = this.props;\n    if (id === data.id) this.setState({ isOpen: true });\n  }\n\n  m_UIInputChange(event) {\n    this.setState({ url: event.target.value });\n  }\n\n  m_UIOnOK() {\n    const { url } = this.state;\n    const { onOK } = this.props;\n    this.setState({ isOpen: false }, () => onOK && onOK(url));\n  }\n\n  m_UIOnCancel() {\n    const { onCancel } = this.props;\n    this.setState({ isOpen: false }, () => onCancel && onCancel());\n  }\n\n  render() {\n    const { isOpen, url } = this.state;\n    const {\n      id,\n      message = 'Are you sure?',\n      okmessage = 'OK',\n      cancelmessage = 'Cancel',\n      onOK,\n      onCancel\n    } = this.props;\n    const OKBtn = (\n      <button onClick={this.m_UIOnOK} autoFocus>\n        {okmessage}\n      </button>\n    );\n    const CancelBtn = (\n      <button onClick={this.m_UIOnCancel} type=\"button\">\n        {cancelmessage}\n      </button>\n    );\n\n    return !isOpen ? (\n      ''\n    ) : (\n      <div className=\"dialog\">\n        <div className=\"screen\"></div>\n        <div className=\"dialogwindow\">\n          <div className=\"dialogcontent\">\n            <h1 className=\"dialogtitle\">ADD IMAGE URL</h1>\n            <div className=\"dialogmessage\">\n              <div className=\"dialogpreview\">\n                <div className=\"label\">PREVIEW:</div>\n                <img src={url} alt=\"Pasted Image URL Preview\" />\n              </div>\n              <div>{message}</div>\n              <input onChange={this.m_UIInputChange} />\n            </div>\n            <div className=\"dialogcontrolbar\">\n              {CancelBtn}\n              {`\\u00a0`}\n              {OKBtn}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCDialogInsertImageURL;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n    Prototype Simple NetCreate Edge Editor\n\n    Built for Version 2.0 ITEST.\n\n    Provides a viewer and editor for the currently selected edge.\n\n    USAGE\n\n      <NCNEdge edgeId={edgeId} parentNodeId={nodeId} key={e.id} />\n\n    This is designed to be embedded in an <NCNode> object.\n    There should only be one open NCEdge component at a time.\n\n    PERMISSIONS\n    Editting is restricted by:\n    * User must be logged in\n    * Template is not being edited\n    * Data is not being imported\n    * Someone else is not editing the edge (and has placed a lock on it)\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\nconst { BUILTIN_FIELDS_EDGE } = require('system/util/enum');\nconst {\n  EDGE_NOT_SET_LABEL,\n  ARROW_DOWN,\n  ARROW_UPDOWN,\n  ARROW_RIGHT\n} = require('system/util/constant');\nconst LOCKMGR = require('../lock-mgr');\nconst CMTMGR = require('../comment-mgr');\nconst NCLOGIC = require('../nc-logic');\nconst NCUI = require('../nc-ui');\nconst NCAutoSuggest = require('./NCAutoSuggest');\nconst NCDialog = require('./NCDialog');\nconst NCDialogCitation = require('./NCDialogCitation');\nconst SETTINGS = require('settings');\nimport URCommentVBtn from './URCommentVBtn';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCEdge';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// const isAdmin = SETTINGS.IsAdmin();\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst TABS = {\n  // Also used as labels\n  ATTRIBUTES: 'ATTRIBUTES',\n  PROVENANCE: 'PROVENANCE'\n};\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NCEdge extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isLoggedIn: false,\n      isAdmin: false,\n      animateHeight: 0\n    }; // initialized on componentDidMount and clearSelection\n\n    // STATE MANAGEMENT\n    this.ResetState = this.ResetState.bind(this);\n    this.urstate_SESSION = this.urstate_SESSION.bind(this);\n    this.urstate_LOCKSTATE = this.urstate_LOCKSTATE.bind(this);\n    this.urstate_NCDATA = this.urstate_NCDATA.bind(this);\n    this.urstate_PERMISSIONS = this.urstate_PERMISSIONS.bind(this);\n    this.IsLoggedIn = this.IsLoggedIn.bind(this);\n    this.DerivePermissions = this.DerivePermissions.bind(this);\n\n    // EVENT HANDLERS\n    this.CheckUnload = this.CheckUnload.bind(this);\n    this.DoUnload = this.DoUnload.bind(this);\n    this.ClearSelection = this.ClearSelection.bind(this);\n    this.urstate_SELECTION = this.urstate_SELECTION.bind(this);\n    this.ReqLoadEdge = this.ReqLoadEdge.bind(this);\n    // DATA LOADING\n    this.LoadEdge = this.LoadEdge.bind(this);\n    this.DeleteEdge = this.DeleteEdge.bind(this);\n    this.LoadAttributes = this.LoadAttributes.bind(this);\n    this.LoadProvenance = this.LoadProvenance.bind(this);\n    this.UnlockEdge = this.UnlockEdge.bind(this);\n    this.EditEdge = this.EditEdge.bind(this);\n    this.ValidateSourceTarget = this.ValidateSourceTarget.bind(this);\n    this.OfferToCreateNewNode = this.OfferToCreateNewNode.bind(this);\n    this.CreateNode = this.CreateNode.bind(this);\n    this.BackToEditing = this.BackToEditing.bind(this);\n    this.SetSourceTarget = this.SetSourceTarget.bind(this);\n    this.ThenSaveSourceTarget = this.ThenSaveSourceTarget.bind(this);\n    // DATA SAVING\n    this.SaveEdge = this.SaveEdge.bind(this);\n    // HELPER METHODS\n    this.LookupBackgroundColor = this.LookupBackgroundColor.bind(this);\n    this.LookupSourceTargetNodeColor = this.LookupSourceTargetNodeColor.bind(this);\n    this.SwapSourceAndTarget = this.SwapSourceAndTarget.bind(this);\n    this.EdgeDisplayName = this.EdgeDisplayName.bind(this);\n    // UI MANIPULATION METHODS\n    this.EnableEditMode = this.UIEnableEditMode.bind(this);\n    // UI EVENT HANDLERS\n    this.UISelectTab = this.UISelectTab.bind(this);\n    this.UIRequestEditEdge = this.UIRequestEditEdge.bind(this);\n    this.UIDeselectEdge = this.UIDeselectEdge.bind(this);\n    this.UICancelEditMode = this.UICancelEditMode.bind(this);\n    this.UIDisableEditMode = this.UIDisableEditMode.bind(this);\n    this.UIDeleteEdge = this.UIDeleteEdge.bind(this);\n    this.UIInputUpdate = this.UIInputUpdate.bind(this);\n    this.UIProvenanceInputUpdate = this.UIProvenanceInputUpdate.bind(this);\n    this.UIEnableSourceTargetSelect = this.UIEnableSourceTargetSelect.bind(this);\n    this.UISourceTargetInputUpdate = this.UISourceTargetInputUpdate.bind(this);\n    this.UISourceTargetInputSelect = this.UISourceTargetInputSelect.bind(this);\n    this.UICitationShow = this.UICitationShow.bind(this);\n    this.UICitationClose = this.UICitationClose.bind(this);\n    // RENDERERS -- Main\n    this.RenderView = this.RenderView.bind(this);\n    this.RenderEdit = this.RenderEdit.bind(this);\n    // FORM RENDERERS\n    this.RenderSourceTargetButton = this.RenderSourceTargetButton.bind(this);\n\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// REGISTER LISTENERS\n    this.OnAppStateChange('SESSION', this.urstate_SESSION);\n    this.OnAppStateChange('NCDATA', this.urstate_NCDATA);\n    this.OnAppStateChange('SELECTION', this.urstate_SELECTION);\n    this.OnAppStateChange('LOCKSTATE', this.urstate_LOCKSTATE);\n    this.OnAppStateChange('PERMISSIONS', this.urstate_PERMISSIONS);\n    this.HandleMessage('EDGE_OPEN', this.ReqLoadEdge);\n    this.HandleMessage('EDGE_DESELECT', this.ClearSelection);\n    this.HandleMessage('EDGE_EDIT', this.EditEdge); // EdgeTable request\n    this.HandleMessage('SELECT_SOURCETARGET', this.SetSourceTarget);\n  }\n\n  componentDidMount() {\n    this.ResetState(); // Initialize State\n\n    const { edgeId } = this.props;\n    const edge = this.AppState('NCDATA').edges.find(e => e.id === edgeId);\n    this.LoadEdge(edge);\n\n    window.addEventListener('beforeunload', this.CheckUnload);\n    window.addEventListener('unload', this.DoUnload);\n  }\n  componentWillUnmount() {\n    this.AppStateChangeOff('SESSION', this.urstate_SESSION);\n    this.AppStateChangeOff('NCDATA', this.urstate_NCDATA);\n    this.AppStateChangeOff('SELECTION', this.urstate_SELECTION);\n    this.AppStateChangeOff('LOCKSTATE', this.urstate_LOCKSTATE);\n    this.AppStateChangeOff('PERMISSIONS', this.urstate_PERMISSIONS);\n    this.DropMessage('EDGE_OPEN', this.ReqLoadEdge);\n    this.DropMessage('EDGE_DESELECT', this.ClearSelection);\n    this.DropMessage('EDGE_EDIT', this.EditEdge);\n    this.DropMessage('SELECT_SOURCETARGET', this.SetSourceTarget);\n    window.removeEventListener('beforeunload', this.CheckUnload);\n    window.removeEventListener('unload', this.DoUnload);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// STATE MANAGEMENT\n  ///\n  ResetState() {\n    this.setState({\n      // EDGE DEFS 'core state data'\n      id: null,\n      // source: null, // avoid ambiguous keys, use sourceId instead\n      // target: null, // avoid ambiguous keys, use targetId instead\n      sourceId: null,\n      targetId: null,\n      type: '',\n      attributes: {},\n      provenance: {},\n      weight: 0,\n      size: 0,\n      created: undefined,\n      updated: undefined,\n      revision: 0,\n\n      // SYSTEM STATE\n      // isLoggedIn: false, // don't clear session state!\n      isAdmin: false,\n      // previousState: {},\n\n      // UI State 'u'\n      uEditBtnDisable: false,\n      uEditBtnHide: false,\n      uViewMode: NCUI.VIEWMODE.VIEW,\n      uSelectedTab: TABS.ATTRIBUTES,\n      uSelectSourceTarget: undefined,\n      uBackgroundColor: '#ccc', // edge component bgcolor determined by type/COLORMAP\n      uIsLockedByDB: false, // shows db lock message next to Edit Node button\n      uIsLockedByTemplate: false,\n      uIsLockedByImport: false,\n      uEditLockMessage: '',\n      uNewNodeKey: undefined,\n      uNewNodeLabel: undefined,\n      uShowCitationDialog: false,\n\n      // DERIVED VALUES 'd'\n      dSourceNode: undefined,\n      dSourceNodeColor: null,\n      dTargetNode: undefined,\n      dTargetNodeColor: null\n    });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// SYSTEM/NETWORK EVENT HANDLERS\n  ///\n  CheckUnload(event) {\n    event.preventDefault();\n    if (this.state.uViewMode === NCUI.VIEWMODE.EDIT) {\n      (event || window.event).returnValue = null;\n    } else {\n      Reflect.deleteProperty(event, 'returnValue');\n    }\n    return event;\n  }\n  DoUnload(event) {\n    if (this.state.uViewMode === NCUI.VIEWMODE.EDIT) {\n      LOCKMGR.RequestUnlockEdge(this.state.id);\n    }\n  }\n  /**\n   * Handle change in SESSION data\n   * SESSION is called by SessionShell when the ID changes\n   * set system-wide. data: { classId, projId, hashedId, groupId, isValid }\n   * Called both by componentWillMount() and AppStateChange handler.\n   * The 'SESSION' state change is triggered in two places in SessionShell during\n   * its handleChange() when active typing is occuring, and also during\n   * SessionShell.componentWillMount()\n   */\n  urstate_SESSION(decoded) {\n    this.urstate_LOCKSTATE();\n  }\n  urstate_LOCKSTATE() {\n    const permissionsState = this.DerivePermissions(this.state.id);\n    this.setState({ ...permissionsState });\n  }\n  urstate_PERMISSIONS(PERMISSIONS) {\n    this.setState({ isAdmin: PERMISSIONS.isAdmin });\n  }\n\n  /*\n      Called by NCDATA AppState updates\n  */\n  urstate_NCDATA(data) {\n    // If NCDATA is updated, reload the edge b/c db has changed\n    const updatedEdge = data.edges.find(e => e.id === this.props.edgeId);\n    this.LoadEdge(updatedEdge);\n  }\n  /**\n   * Checks current SESSION state to see if user is logged in.\n   * Since NCEdge is dynamically created and closed, we can't rely on\n   * SESSION AppState updates messages.\n   * NOTE updates state.\n   * @returns {boolean} True if user is logged in\n   */\n  IsLoggedIn() {\n    const SESSION = this.AppState('SESSION');\n    const isLoggedIn = SESSION.isValid;\n    return isLoggedIn;\n  }\n\n  // 1. Read the LOCKSTATE\n  // 2. Derive the permissions state (hide/disable the edit button)\n  // 3. Look up any lock messages\n  DerivePermissions(edgeId) {\n    const isLoggedIn = this.IsLoggedIn();\n\n    const LOCKSTATE = this.AppState('LOCKSTATE');\n    const uIsLockedByDB = LOCKSTATE.lockedEdges.includes(edgeId);\n    const uIsLockedByTemplate = LOCKSTATE.templateBeingEdited;\n    const uIsLockedByImport = LOCKSTATE.importActive;\n    // NOT IMPLEMENTED\n    // FUTURE: We may want to lock the edge if a comment is being edited\n    //         but currently there isn't an easy way to do this\n    //         because while we know that a comment is being edited (via LOCKSTATE.lockedComments)\n    //         we don't know if the comment is being edited by the current user or someone else.\n    //         So for now, we allow the edge to be edited while a comment is being edited.\n    //         If we wanted to implement this, we probably need to introduce a new parameter\n    //         or properly implement commentBeingEditedByMe.\n    // const uIsLockedByComment = LOCKSTATE.commentBeingEditedByMe;\n\n    // Derive new message and EditBtn status\n    let uEditLockMessage = '';\n    let uEditBtnDisable = false;\n    let uEditBtnHide = true;\n    const TEMPLATE = this.AppState('TEMPLATE');\n    if (isLoggedIn) uEditBtnHide = false;\n    if (uIsLockedByDB) {\n      uEditBtnDisable = true;\n      uEditLockMessage += TEMPLATE.edgeIsLockedMessage;\n    }\n    if (uIsLockedByTemplate) {\n      uEditBtnDisable = true;\n      uEditLockMessage += TEMPLATE.templateIsLockedMessage;\n    }\n    if (uIsLockedByImport) {\n      uEditBtnDisable = true;\n      uEditLockMessage += TEMPLATE.importIsLockedMessage;\n    }\n    // NOT IMPLEMENTED\n    // if (uIsLockedByComment) {\n    //   uEditBtnDisable = true;\n    //   // no change to lock message for comments\n    // }\n\n    // return all state values\n    return {\n      // User Permissions\n      isLoggedIn,\n      uIsLockedByDB,\n      uIsLockedByTemplate,\n      uIsLockedByImport,\n      // uIsLockedByComment, // NOT IMPLEMENTED\n      // UI State\n      uEditBtnDisable,\n      uEditBtnHide,\n      uEditLockMessage\n    };\n  }\n\n  ClearSelection() {\n    this.ResetState();\n  }\n  urstate_SELECTION(data) {\n    const { sourceTargetSelect } = this.state;\n    const selectedNode = data.nodes[0]; // select the first node\n    if (sourceTargetSelect === 'source') {\n      this.setState({\n        sourceId: selectedNode.id,\n        dSourceNode: selectedNode\n      });\n    } else if (sourceTargetSelect === 'target') {\n      this.setState({\n        targetId: selectedNode.id,\n        dTargetNode: selectedNode\n      });\n    } else {\n      // ignore the selection\n    }\n  }\n  ReqLoadEdge(data) {\n    // handler for UDATA call, interprets the net `data`\n    this.LoadEdge(data.edge);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// DATA LOADING\n  ///\n  LoadEdge(edge) {\n    const { uViewMode } = this.state;\n\n    // If we're editing, ignore the select!\n    if (uViewMode === NCUI.VIEWMODE.EDIT) return;\n\n    // If no edge was selected, deselect\n    if (!edge) {\n      this.ClearSelection();\n      return;\n    }\n\n    // Load the edge\n    //  - Look up source/target nodes\n    //  - convert edge.source/target to sourceId/targetId to disambiguate id vs object\n    const sourceId = edge.source;\n    const targetId = edge.target;\n    const NCDATA = this.AppState('NCDATA');\n    const dSourceNode = NCDATA.nodes.find(n => n.id === sourceId) || {\n      label: ''\n    };\n    const dTargetNode = NCDATA.nodes.find(n => n.id === targetId) || {\n      label: ''\n    };\n    const { dSourceNodeColor, dTargetNodeColor } = this.LookupSourceTargetNodeColor();\n    //  - Load attributes and provenance\n    const attributes = this.LoadAttributes(edge);\n    const provenance = this.LoadProvenance(edge);\n    //  - Load derived values\n    const uBackgroundColor = this.LookupBackgroundColor(edge.type);\n    const permissionsState = this.DerivePermissions(edge.id);\n\n    this.setState({\n      id: edge.id,\n      sourceId: sourceId,\n      targetId: targetId,\n      type: edge.type,\n      attributes: attributes,\n      provenance: provenance,\n      weight: edge.weight,\n      size: edge.size, // `size` is the sum of all weights\n      created: edge.meta ? new Date(edge.meta.created).toLocaleString() : '',\n      createdBy: edge.createdBy,\n      updated: edge.meta ? new Date(edge.meta.updated).toLocaleString() : '',\n      updatedBy: edge.updatedBy,\n      revision: edge.meta ? edge.meta.revision : '',\n      // Derived Values\n      dSourceNode,\n      dTargetNode,\n      dSourceNodeColor,\n      dTargetNodeColor,\n      // UI parameters\n      uBackgroundColor,\n      animateHeight: 'fullheight',\n      ...permissionsState\n    });\n  }\n  /**\n   * Loads up the `attributes` object defined by the TEMPLATE\n   * Will skip\n   *   * BUILTIN fields\n   *   * attributes that are `hidden` by the template\n   * REVIEW: Currently the parameters will show up in random object order.\n   * @param {Object} edge\n   * @returns {Object} { ...attr-key: attr-value }\n   */\n  LoadAttributes(edge) {\n    const EDGEDEFS = this.AppState('TEMPLATE').edgeDefs;\n    const attributes = {};\n    Object.keys(EDGEDEFS).forEach(k => {\n      if (BUILTIN_FIELDS_EDGE.includes(k)) return; // skip built-in fields\n      const attr_def = EDGEDEFS[k];\n      if (attr_def.hidden) return; // skip hidden fields\n      if (attr_def.isProvenance) return; // skip fields that are marked as provenance\n      attributes[k] = edge[k];\n    });\n    return attributes;\n  }\n  /**\n   * Loads up the `provenance` object defined by the TEMPLATE\n   * Will skip\n   *   * BUILTIN fields\n   *   * attributes that are `hidden` by the template\n   * REVIEW: Currently the parameters will show up in random object order.\n   * @param {Object} edge\n   * @returns {Object} { ...attr-key: attr-value }\n   */\n  LoadProvenance(edge) {\n    const EDGEDEFS = this.AppState('TEMPLATE').edgeDefs;\n    const provenance = {};\n    Object.keys(EDGEDEFS).forEach(k => {\n      if (BUILTIN_FIELDS_EDGE.includes(k)) return; // skip built-in fields\n      const provenance_def = EDGEDEFS[k];\n      if (provenance_def.hidden) return; // skip hidden fields\n      if (!provenance_def.isProvenance) return; // skip fields that are not marked as provenance\n      provenance[k] = edge[k];\n    });\n    return provenance;\n  }\n\n  /**\n   * Returns whether the unlock is successful\n   * @param {function} cb Callback function to handle cleanup after unlock\n   */\n  UnlockEdge(cb) {\n    LOCKMGR.RequestUnlockEdge(this.state.id, cb);\n  }\n\n  /**\n   * If `lockEdge` is not successful, then that means the edge was\n   * already locked, so we can't edit.\n   */\n  EditEdge() {\n    const { isLoggedIn } = this.state;\n    if (!isLoggedIn) return;\n    LOCKMGR.RequestLockEdge(this.state.id, lockSuccess => {\n      this.setState({ uIsLockedByDB: !lockSuccess }, () => {\n        if (lockSuccess) this.UIEnableEditMode();\n      });\n    });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// SET SOURCE / TARGET\n  ///\n  /// Selecting a source or target node is a multi-step process.\n  /// 1. First, you need to Enable editing\n  /// 2. Then, you need to click on a Source or Target node to activate\n  ///    the source or target for selection\n  /// 3. Once you enable source or target editing, you need to decide\n  ///    how you want to select the node...\n  ///    A. Click on the node on the d3 graph to select the node, or...\n  ///    B. Type the full node name, or...\n  ///    C. Type a partial name, and..\n  ///       and arrow up/down to highlight\n  ///       and hit Enter to select\n  ///       or click name to select\n  ///    D. Type a new node name and\n  ///       and hit Enter to add a new node\n  ///       and show dialog confirm creating a new node\n  /// 5. Click \"Save\" to exit edit mode\n  ///\n  /**\n   * User has selected a new source or target\n   * validate it to make sure it exists\n   * if it doesn't, offer to create a new one\n   * Uses either `id` or `value` to find the node\n   *\n   * @param {string} key 'source' or 'target'\n   * @param {string} label\n   * @param {number} id\n   */\n  ValidateSourceTarget(key, label, id) {\n    // if we have an id, then the selected source/target is an existing node\n    // but we should probably validate it anyway?\n    let keyType, searchString;\n    if (id) {\n      // find node by 'id'\n      keyType = 'id';\n      searchString = id;\n    } else {\n      // find node by 'label'\n      keyType = 'label';\n      searchString = label;\n    }\n    this.AppCall('FIND_NODE_BY_PROP', {\n      key: keyType,\n      searchString\n    }).then(data => {\n      if (data.nodes.length > 0) {\n        const node = data.nodes[0];\n        this.ThenSaveSourceTarget(key, node);\n      } else {\n        this.OfferToCreateNewNode(key, label);\n      }\n    });\n  }\n  /**\n   * User has input a new node name that doesn't match an existing node\n   * so offer to create a new node\n   * @param {string} key 'source' or 'target'\n   * @param {string} value\n   */\n  OfferToCreateNewNode(key, value) {\n    this.setState({\n      uNewNodeKey: key,\n      uNewNodeLabel: value\n    });\n  }\n  /**\n   * NCDialog offer to create a new node -- user decided to create a new\n   * new node, so add it.\n   */\n  CreateNode() {\n    const { uNewNodeKey, uNewNodeLabel } = this.state;\n    this.AppCall('NODE_CREATE', { label: uNewNodeLabel }).then(node => {\n      this.setState({ uNewNodeKey: undefined, uNewNodeLabel: undefined }, () =>\n        this.ThenSaveSourceTarget(uNewNodeKey, node)\n      );\n    });\n  }\n  /**\n   * NCDialog offer to create a new node -- user clicked Cancel so\n   * go back to editing the node\n   */\n  BackToEditing() {\n    this.setState({ uNewNodeKey: undefined, uNewNodeLabel: undefined });\n  }\n  /**\n   * User has selected a source or target node by clicking on D3 graph\n   * Called by Selection Manager via SELECT_SOURCETARGET\n   * @param {Object} data\n   * @param {Object} data.node\n   */\n  SetSourceTarget(data) {\n    const { uSelectSourceTarget } = this.state;\n\n    // The source/target has been set already, so return to edge edit mode\n    this.AppCall('SELECTMGR_SET_MODE', { mode: 'edge_edit' });\n\n    // Clear the secondary selection\n    this.AppCall('SELECTMGR_DESELECT_SECONDARY');\n\n    this.ThenSaveSourceTarget(uSelectSourceTarget, data.node);\n  }\n  /**\n   * Save the source or target after either creating new node or selecting\n   * an existing ndoe.\n   * Runs after validateSourceTarget\n   * @param {string} key 'source' or 'target'\n   * @param {Object} node {id, label}\n   */\n  ThenSaveSourceTarget(key, node) {\n    // MUST save sourceId or targetId to determine source/target\n    // but ideally set all three?  because that's what loadEdge does?\n    const state = {\n      uSelectSourceTarget: undefined,\n      uNewNodeKey: undefined, // clear NCDialog\n      uNewNodeLabel: undefined // clear NCDialog\n    };\n    const NCDATA = this.AppState('NCDATA');\n    if (key === 'source') {\n      state.sourceId = node.id;\n      state.dSourceNode = NCDATA.nodes.find(n => n.id === node.id) || {\n        label: ''\n      };\n    } else {\n      // 'target'\n      state.targetId = node.id;\n      state.dTargetNode = NCDATA.nodes.find(n => n.id === node.id) || {\n        label: ''\n      };\n    }\n\n    // show secondary selection\n    this.AppCall('SELECTMGR_SELECT_SECONDARY', { node });\n    this.setState(state);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// DATA SAVING\n  ///\n  SaveEdge() {\n    const { id, sourceId, targetId, type, weight, size, attributes, provenance } =\n      this.state;\n    const uid = NCLOGIC.GetCurrentUserId();\n    const edge = {\n      id,\n      source: sourceId,\n      target: targetId,\n      type,\n      weight,\n      size,\n      updatedBy: uid\n    };\n    Object.keys(attributes).forEach(k => (edge[k] = attributes[k]));\n    Object.keys(provenance).forEach(k => (edge[k] = provenance[k]));\n\n    this.setState(\n      {\n        uViewMode: NCUI.VIEWMODE.VIEW\n      },\n      () => {\n        this.AppCall('DB_UPDATE', { edge }).then(() => {\n          this.UnlockEdge(() => {\n            // Clear the secondary selection\n            this.AppCall('SELECTMGR_DESELECT_SECONDARY');\n\n            this.AppCall('SELECTMGR_SET_MODE', { mode: 'normal' });\n            this.setState({\n              uIsLockedByDB: false,\n              uSelectSourceTarget: undefined\n            });\n          });\n        });\n      }\n    );\n    UNISYS.Log('click save edge', id, this.EdgeDisplayName(), JSON.stringify(edge));\n  }\n  DeleteEdge() {\n    const { id } = this.state;\n    this.AppCall('DB_UPDATE', { edgeID: id }); // Calling DB_UPDATE with `edgeID` will remove the edge\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// HELPER METHODS\n  ///\n  /**\n   * Sets the background color of the node editor via `uBackgroundColor` state.\n   * Currently the background color is determined by the template edge type\n   * color mapping.  This will eventually be replaced with a color manager.\n   */\n  LookupBackgroundColor(type) {\n    const COLORMAP = this.AppState('COLORMAP');\n    const uBackgroundColor = COLORMAP.edgeColorMap[type] || '#555555';\n    return uBackgroundColor;\n  }\n  LookupSourceTargetNodeColor({ dSourceNode, dTargetNode } = this.state) {\n    const COLORMAP = this.AppState('COLORMAP');\n    const dSourceNodeColor =\n      COLORMAP.nodeColorMap[dSourceNode ? dSourceNode.type : ''];\n    const dTargetNodeColor =\n      COLORMAP.nodeColorMap[dTargetNode ? dTargetNode.type : ''];\n    return { dSourceNodeColor, dTargetNodeColor };\n  }\n  SwapSourceAndTarget() {\n    const {\n      sourceId,\n      dSourceNode,\n      dSourceNodeColor,\n      targetId,\n      dTargetNode,\n      dTargetNodeColor\n    } = this.state;\n\n    // swap\n    const swappedTargetId = sourceId;\n    const swappedSourceId = targetId;\n    const swappedTargetNode = dSourceNode;\n    const swappedSourceNode = dTargetNode;\n    const swappedTargetNodeColor = dSourceNodeColor;\n    const swappedSourceNodeColor = dTargetNodeColor;\n\n    this.setState({\n      sourceId: swappedSourceId,\n      dSourceNode: swappedSourceNode,\n      dSourceNodeColor: swappedSourceNodeColor,\n      targetId: swappedTargetId,\n      dTargetNode: swappedTargetNode,\n      dTargetNodeColor: swappedTargetNodeColor\n    });\n  }\n  EdgeDisplayName() {\n    const { dSourceNode, dTargetNode } = this.state;\n    return `${dSourceNode.label}${ARROW_RIGHT}${dTargetNode.label}`;\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UI MANIPULATION METHODS\n  ///\n  /**\n   * Save `previousState` so that we can undo/restore data if user cancels\n   */\n  UIEnableEditMode() {\n    const {\n      uSelectedTab,\n      id,\n      sourceId,\n      targetId,\n      type,\n      weight,\n      size,\n      attributes,\n      provenance\n    } = this.state;\n    const previousState = {\n      sourceId,\n      targetId,\n      type,\n      weight,\n      size,\n      attributes: Object.assign({}, attributes),\n      provenance: Object.assign({}, provenance)\n    };\n    this.setState({\n      uViewMode: NCUI.VIEWMODE.EDIT,\n      uSelectedTab,\n      previousState\n    });\n    this.AppCall('SELECTMGR_SET_MODE', { mode: 'edge_edit' });\n\n    const edge = {\n      id,\n      source: sourceId,\n      target: targetId,\n      type,\n      weight,\n      size,\n      provenance\n    };\n    Object.keys(attributes).forEach(k => (edge[k] = attributes[k]));\n    Object.keys(provenance).forEach(k => (edge[k] = provenance[k]));\n    UNISYS.Log('edit edge', id, this.EdgeDisplayName(), JSON.stringify(edge));\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UI EVENT HANDLERS\n  ///\n  UISelectTab(event) {\n    event.stopPropagation();\n    const { id } = this.state;\n    this.setState({ uSelectedTab: event.target.value });\n    UNISYS.Log('select edge tab', id, this.EdgeDisplayName(), event.target.value);\n  }\n\n  UIRequestEditEdge(event) {\n    event.stopPropagation();\n    this.EditEdge();\n  }\n\n  UIDeselectEdge() {\n    this.AppCall('EDGE_DESELECT');\n  }\n\n  UICancelEditMode() {\n    const { id, revision, previousState } = this.state;\n    // if user is cancelling a newly created unsaved edge, delete the edge instead\n    if (revision < 1) {\n      this.UIDisableEditMode();\n      this.DeleteEdge();\n      return;\n    }\n\n    // restore previous state\n    this.setState(\n      {\n        sourceId: previousState.sourceId,\n        targetId: previousState.targetId,\n        type: previousState.type,\n        weight: previousState.weight,\n        size: previousState.size,\n        attributes: previousState.attributes,\n        provenance: previousState.provenance,\n        uSelectSourceTarget: undefined\n      },\n      () => this.UIDisableEditMode()\n    );\n    UNISYS.Log('cancel edit edge', id, this.EdgeDisplayName());\n  }\n\n  UIDisableEditMode() {\n    this.UnlockEdge(() => {\n      this.setState({\n        uViewMode: NCUI.VIEWMODE.VIEW\n      });\n\n      // Clear the secondary selection\n      this.AppCall('SELECTMGR_DESELECT_SECONDARY');\n      this.AppCall('SELECTMGR_SET_MODE', { mode: 'normal' });\n    });\n  }\n\n  UIDeleteEdge() {\n    this.UIDisableEditMode();\n    this.DeleteEdge();\n  }\n\n  UIInputUpdate(key, value) {\n    let state = {};\n    if (BUILTIN_FIELDS_EDGE.includes(key)) {\n      const data = {};\n      data[key] = value;\n      state = data;\n    } else {\n      const { attributes } = this.state;\n      attributes[key] = value;\n      state = attributes;\n    }\n    // HACK Allow any field to be used to specify color\n    //      Eventually this needs to be built into the template.\n    const COLORFIELDS = ['type'];\n    // special handling to update the background color immediately if `type` is changed\n    const type = COLORFIELDS.includes(key) ? value : this.state.type;\n    const uBackgroundColor = this.LookupBackgroundColor(type);\n    this.setState({ ...state, uBackgroundColor });\n  }\n  UIProvenanceInputUpdate(key, value) {\n    if (BUILTIN_FIELDS_EDGE.includes(key)) {\n      const data = {};\n      data[key] = value;\n      this.setState(data);\n    } else {\n      const { provenance } = this.state;\n      provenance[key] = value;\n      this.setState({ provenance });\n    }\n  }\n\n  UIEnableSourceTargetSelect(event) {\n    const key = event.target.id;\n    this.setState({ uSelectSourceTarget: key });\n    this.AppCall('SELECTMGR_SET_MODE', { mode: 'sourcetarget' });\n  }\n\n  /**\n   * Handles keystrokes as user inputs new node in form\n   * @param {string} key\n   * @param {string} value\n   */\n  UISourceTargetInputUpdate(key, value) {\n    const updatedState = {};\n    if (key === 'source') {\n      updatedState.dSourceNode = { label: value };\n    } else {\n      updatedState.dTargetNode = { label: value };\n    }\n    this.setState(updatedState);\n  }\n\n  /**\n   * User has selected a node with NCAutoSuggest, either\n   * - Clicking on a suggested node\n   * - Hitting Enter with the form field showing either a valid node or a new node\n   * @param {string} key is 'id' or 'label'\n   * @param {string} label\n   * @param {number} id\n   */\n  UISourceTargetInputSelect(key, label, id) {\n    this.ValidateSourceTarget(key, label, id);\n  }\n\n  UICitationShow(event) {\n    event.stopPropagation();\n    this.setState({ uShowCitationDialog: true });\n  }\n  UICitationClose() {\n    this.setState({ uShowCitationDialog: false });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// RENDER METHODS\n  RenderView() {\n    const {\n      uSelectedTab,\n      uBackgroundColor,\n      animateHeight,\n      uEditBtnDisable,\n      uEditBtnHide,\n      uEditLockMessage,\n      uShowCitationDialog,\n      id,\n      dSourceNode = { label: undefined },\n      dTargetNode = { label: undefined },\n      type,\n      isAdmin\n    } = this.state;\n    const bgcolor = uBackgroundColor + '66'; // hack opacity\n    const TEMPLATE = this.AppState('TEMPLATE');\n    const defs = TEMPLATE.edgeDefs;\n    const uShowCitationButton = TEMPLATE.citation && !TEMPLATE.citation.hidden;\n    const disableSourceTargetInView = true;\n    const citation =\n      `NetCreate ${TEMPLATE.name} network, ` +\n      `Edge: (ID ${id}), ` +\n      `from \"${dSourceNode.label}\" to \"${dTargetNode.label}\". ` +\n      (TEMPLATE.citation && TEMPLATE.citation.text\n        ? `${TEMPLATE.citation.text}. `\n        : '') +\n      `Last accessed at ${NCUI.DateFormatted()}.`;\n    const collection_ref = CMTMGR.GetEdgeCREF(id);\n\n    return (\n      <div className={`nccomponent ncedge ${animateHeight}`}>\n        <div\n          className=\"view\"\n          style={{ backgroundColor: bgcolor }}\n          onClick={this.UIDeselectEdge}\n        >\n          {/* BUILT-IN - - - - - - - - - - - - - - - - - */}\n          <div className=\"titlebar\" style={{ marginBottom: '3px' }}>\n            <div className=\"nodenumber\">EDGE {id} </div>\n            <div></div>\n            <URCommentVBtn cref={collection_ref} key={collection_ref} />\n          </div>\n          <div className=\"formview\">\n            {NCUI.RenderLabel('source', defs['source'].displayLabel)}\n            {this.RenderSourceTargetButton(\n              'source',\n              dSourceNode.label,\n              disableSourceTargetInView\n            )}\n            <div />\n            <div className=\"edgetypeRow\">\n              <div className=\"targetarrow\">{ARROW_DOWN}</div>\n              {/* Special handling for `type` field */}\n              {defs['type'] && !defs['type'].hidden ? (\n                <div className=\"formview typeview\">\n                  {NCUI.RenderLabel(\n                    'type',\n                    defs['type'].displayLabel,\n                    defs['type'].help\n                  )}\n                  {NCUI.RenderStringValue('type', type)}\n                </div>\n              ) : (\n                <div />\n              )}\n            </div>\n            {NCUI.RenderLabel('target', defs['target'].displayLabel)}\n            {this.RenderSourceTargetButton(\n              'target',\n              dTargetNode.label,\n              disableSourceTargetInView\n            )}\n          </div>\n          {/* TABS - - - - - - - - - - - - - - - - - - - */}\n          <div className=\"tabcontainer\">\n            {NCUI.RenderTabSelectors(TABS, this.state, this.UISelectTab)}\n            <div className=\"tabview\">\n              {uSelectedTab === TABS.ATTRIBUTES &&\n                NCUI.RenderAttributesTabView(this.state, defs, BUILTIN_FIELDS_EDGE)}\n              {uSelectedTab === TABS.PROVENANCE &&\n                NCUI.RenderProvenanceTabView(this.state, defs, BUILTIN_FIELDS_EDGE)}\n            </div>\n          </div>\n          {/* CONTROL BAR - - - - - - - - - - - - - - - - */}\n          <div className=\"controlbar\">\n            {uShowCitationButton && (\n              <button\n                id=\"citationbtn\"\n                className=\"citationbutton\"\n                onClick={this.UICitationShow}\n                type=\"button\"\n              >\n                Cite Edge\n              </button>\n            )}\n            <div style={{ flexGrow: 1 }}></div>\n            {!uEditBtnHide && uSelectedTab !== TABS.EDGES && (\n              <button\n                id=\"editbtn\"\n                onClick={this.UIRequestEditEdge}\n                disabled={uEditBtnDisable}\n                type=\"button\"\n              >\n                Edit\n              </button>\n            )}\n          </div>\n          {!uEditBtnHide && uEditLockMessage && (\n            <div className=\"message warning\" style={{ marginTop: '1em' }}>\n              <p>{uEditLockMessage}</p>\n              <p hidden={!isAdmin}>\n                <b>ADMINISTRATOR ONLY</b>: If you are absolutely sure this is an\n                error, you can force the unlock.\n                <button\n                  onClick={this.UIDisableEditMode}\n                  style={{ marginLeft: 0 }}\n                  type=\"button\"\n                >\n                  Force Unlock\n                </button>\n              </p>\n            </div>\n          )}\n        </div>\n        {uShowCitationDialog && (\n          <NCDialogCitation message={citation} onClose={this.UICitationClose} />\n        )}\n      </div>\n    );\n  }\n\n  RenderEdit() {\n    const { parentNodeId } = this.props;\n    const {\n      sourceId,\n      targetId,\n      type,\n      revision,\n      uSelectedTab,\n      uSelectSourceTarget,\n      uBackgroundColor,\n      uNewNodeLabel,\n      animateHeight,\n      dSourceNode,\n      dTargetNode\n    } = this.state;\n    const bgcolor = uBackgroundColor + '99'; // hack opacity\n    const defs = this.AppState('TEMPLATE').edgeDefs;\n    const AskNodeDialog = uNewNodeLabel ? (\n      <NCDialog\n        message={`Node \"${uNewNodeLabel}\" does not exist.  Do you want to create it?`}\n        okmessage={`Create \"${uNewNodeLabel}\" node`}\n        onOK={this.CreateNode}\n        cancelmessage=\"Back to Edge Edit\"\n        onCancel={this.BackToEditing}\n      />\n    ) : (\n      ''\n    );\n    const saveIsDisabled = uSelectSourceTarget || isNaN(sourceId) || isNaN(targetId);\n    return (\n      <div>\n        <div className=\"screen\"></div>\n        <div className={`nccomponent ncedge ${animateHeight}`}>\n          <div\n            className=\"edit\"\n            style={{\n              background: bgcolor,\n              borderColor: uBackgroundColor\n            }}\n          >\n            {/* BUILT-IN - - - - - - - - - - - - - - - - - */}\n            <div className=\"formview\">\n              {NCUI.RenderLabel('source', defs['source'].displayLabel)}\n              {this.RenderSourceTargetButton(\n                'source',\n                dSourceNode.label,\n                parentNodeId === sourceId\n              )}\n              <div />\n              <div className=\"edgetypeRow\">\n                <div className=\"targetarrow\">\n                  <button\n                    className=\"swapbtn\"\n                    onClick={this.SwapSourceAndTarget}\n                    title=\"Swap 'Source' and 'Target' nodes\"\n                    type=\"button\"\n                  >\n                    {ARROW_UPDOWN}\n                  </button>\n                </div>\n                {/* Special handling for `type` field */}\n                {defs['type'] && !defs['type'].hidden && (\n                  <div className=\"formview typeview\">\n                    {NCUI.RenderLabel(\n                      'type',\n                      defs['type'].displayLabel,\n                      defs['type'].help\n                    )}\n                    {NCUI.RenderOptionsInput(\n                      'type',\n                      type,\n                      defs,\n                      this.UIInputUpdate,\n                      defs['type'].help\n                    )}\n                  </div>\n                )}\n              </div>\n              {NCUI.RenderLabel('target', defs['target'].displayLabel)}\n              {this.RenderSourceTargetButton(\n                'target',\n                dTargetNode.label,\n                parentNodeId === targetId\n              )}\n            </div>\n            {/* TABS - - - - - - - - - - - - - - - - - - - */}\n            <div className=\"tabcontainer\">\n              {NCUI.RenderTabSelectors(TABS, this.state, this.UISelectTab)}\n              <div className=\"tabview\">\n                {uSelectedTab === TABS.ATTRIBUTES &&\n                  NCUI.RenderAttributesTabEdit(\n                    this.state,\n                    defs,\n                    this.UIInputUpdate,\n                    BUILTIN_FIELDS_EDGE\n                  )}\n                {uSelectedTab === TABS.PROVENANCE &&\n                  NCUI.RenderProvenanceTabEdit(\n                    this.state,\n                    defs,\n                    this.UIProvenanceInputUpdate,\n                    BUILTIN_FIELDS_EDGE\n                  )}\n              </div>\n            </div>\n            {/* CONTROL BAR - - - - - - - - - - - - - - - - */}\n            <div className=\"controlbar\" style={{ justifyContent: 'space-between' }}>\n              {revision > 0 && (\n                <button\n                  className=\"cancelbtn\"\n                  onClick={this.UIDeleteEdge}\n                  type=\"button\"\n                >\n                  Delete\n                </button>\n              )}\n              <button\n                className=\"cancelbtn\"\n                onClick={this.UICancelEditMode}\n                type=\"button\"\n              >\n                Cancel\n              </button>\n              <button onClick={this.SaveEdge} disabled={saveIsDisabled} type=\"button\">\n                Save\n              </button>\n            </div>\n          </div>\n        </div>\n        {AskNodeDialog}\n      </div>\n    );\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// FORM RENDERERS\n  ///\n\n  /**\n   * The Source and Target Buttons are used for\n   * - Displaying the source / target name in the view/edit panel\n   * - Click on Source or Target to select a new one\n   * - Showing a focus ring (outline) after having secondarily selected a source/target\n   * @param {string} key 'source' or 'target'\n   * @param {string} value\n   * @param {boolean} disabled Used by renderView to disable source/target selection buttons\n   *                           when it isn't being edited\n   * @returns {jsx}\n   */\n  RenderSourceTargetButton(key, value, disabled) {\n    const {\n      sourceId,\n      targetId,\n      uSelectSourceTarget,\n      dSourceNodeColor,\n      dTargetNodeColor\n    } = this.state;\n    let color;\n    if (!disabled && (uSelectSourceTarget === key || value === undefined)) {\n      return (\n        <NCAutoSuggest\n          parentKey={key}\n          value={value}\n          onChange={this.UISourceTargetInputUpdate}\n          onSelect={this.UISourceTargetInputSelect}\n        />\n      );\n    } else {\n      color = key === 'source' ? dSourceNodeColor : dTargetNodeColor;\n      // Secondary selection?\n      const SELECTION = this.AppState('SELECTION');\n      let isSecondarySelection = false;\n      if (key === 'source') {\n        isSecondarySelection = SELECTION.selectedSecondary === sourceId;\n      } else {\n        // key === 'target'\n        isSecondarySelection = SELECTION.selectedSecondary === targetId;\n      }\n      const selected = isSecondarySelection ? 'selected' : '';\n      return (\n        <button\n          id={key}\n          key={`${key}value`}\n          className={`sourcetargetbtn ${selected}`}\n          onClick={this.UIEnableSourceTargetSelect}\n          style={{ backgroundColor: color + '55', borderColor: color }}\n          disabled={disabled}\n          autoFocus={!disabled}\n          type=\"button\"\n        >\n          {value || EDGE_NOT_SET_LABEL}\n        </button>\n      );\n    }\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// MAIN RENDER\n  ///\n  render() {\n    const { id, uViewMode } = this.state;\n    if (!id) return ''; // nothing selected\n    if (uViewMode === NCUI.VIEWMODE.VIEW) {\n      return this.RenderView();\n    } else {\n      return this.RenderEdit();\n    }\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCEdge;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    EdgeTable is used to to display a table of edges for review.\n\n    It checks FILTEREDNCDATA to show highlight/filtered state\n\n    It uses URTable for rendering and sorting.\n\n  ## PROPS\n\n    * tableHeight -- sets height based on InfoPanel dragger\n    * isOpen -- whether the table is visible\n\n  ## TO USE\n\n    EdgeTable is self contained and relies on global NCDATA to load.\n\n      <EdgeTable tableHeight isOpen />\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport UNISYS from 'unisys/client';\nimport NCUI from '../nc-ui';\nimport UTILS from '../nc-utils';\nimport FILTER from './filter/FilterEnums';\nimport CMTMGR from '../comment-mgr';\n\nimport URTable from './URTable';\nimport URCommentVBtn from './URCommentVBtn';\n\nimport { BUILTIN_FIELDS_EDGE } from 'system/util/enum';\nimport { ICON_PENCIL, ICON_VIEW } from 'system/util/constant';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for functional react component\nconst UDATAOwner = { name: 'NCEdgeTable' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n\nconst DBG = false;\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCEdgeTable({ isOpen }) {\n  const isOpenRef = useRef(isOpen);\n  const [state, setState] = useState({});\n\n  /// USEEFFECT ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    const TEMPLATE = UDATA.AppState('TEMPLATE');\n    const SESSION = UDATA.AppState('SESSION');\n    const NCDATA = UDATA.AppState('NCDATA');\n    setState({\n      edgeDefs: TEMPLATE.edgeDefs,\n      edges: NCDATA.edges,\n      nodes: [], // needed for dereferencing source/target\n      disableEdit: false,\n      isLocked: !SESSION.isValid\n    });\n\n    UDATA.OnAppStateChange('FILTEREDNCDATA', urstate_FILTEREDNCDATA);\n    UDATA.OnAppStateChange('SESSION', urstate_SESSION);\n    UDATA.OnAppStateChange('TEMPLATE', urstate_TEMPLATE);\n    return () => {\n      UDATA.AppStateChangeOff('FILTEREDNCDATA', urstate_FILTEREDNCDATA);\n      UDATA.AppStateChangeOff('SESSION', urstate_SESSION);\n      UDATA.AppStateChangeOff('TEMPLATE', urstate_TEMPLATE);\n    };\n  }, []);\n\n  useEffect(() => {\n    isOpenRef.current = isOpen;\n  }, [isOpen]);\n\n  /// UR HANDLERS /////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// FILTEREDNCDATA is the reduced list of nodes, not ALL edges\n  function urstate_FILTEREDNCDATA(data) {\n    // skip update if not open\n    if (!isOpenRef.current) return;\n\n    if (data.edges) {\n      // If we're transitioning from \"COLLAPSE\" or \"FOCUS\" to \"HILIGHT/FADE\", then we\n      // also need to add back in edges that are not in filteredEdges\n      // (because \"COLLAPSE\" and \"FOCUS\" removes edges that are not matched)\n      const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n      if (FILTERDEFS.filterAction === FILTER.ACTION.FADE) {\n        const NCDATA = UDATA.AppState('NCDATA');\n        setState(prevState => ({ ...prevState, edges: NCDATA.edges }));\n      } else {\n        setState(prevState => ({ ...prevState, edges: data.edges }));\n      }\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urstate_SESSION(decoded) {\n    const isLocked = !decoded.isValid;\n    if (isLocked === state.isLocked) {\n      return;\n    }\n    setState(prevState => ({ ...prevState, isLocked }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urstate_TEMPLATE(data) {\n    setState(prevState => ({\n      ...prevState,\n      edgeDefs: data.edgeDefs,\n      selectedEdgeColor: data.sourceColor\n    }));\n  }\n\n  /// COLUMN DEFINTION GENERATION /////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function DeriveColumnDefs(incomingEdgeDefs) {\n    const { edges, edgeDefs, disableEdit, isLocked } = state;\n    const defs = incomingEdgeDefs || edgeDefs;\n\n    // Only include built in fields\n    // Only include non-hidden fields\n    // Only include non-provenance fields\n    const attributeDefs = Object.keys(defs).filter(\n      k =>\n        !BUILTIN_FIELDS_EDGE.includes(k) && !defs[k].isProvenance && !defs[k].hidden\n    );\n    const provenanceDefs = Object.keys(defs).filter(\n      k => !BUILTIN_FIELDS_EDGE.includes(k) && defs[k].isProvenance && !defs[k].hidden\n    );\n\n    /// CLICK HANDLERS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function ui_ClickViewEdge(event, value) {\n      event.preventDefault();\n      event.stopPropagation();\n      const { edgeId, sourceId } = value;\n      // Load Source Node then Edge\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [sourceId] }).then(() => {\n        UDATA.LocalCall('EDGE_SELECT', { edgeId });\n      });\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function ui_ClickEditEdge(event, value) {\n      event.preventDefault();\n      event.stopPropagation();\n      const { edgeId, sourceId } = value;\n      // Load Source Node then Edge\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [sourceId] }).then(() => {\n        UDATA.LocalCall('EDGE_SELECT_AND_EDIT', { edgeId });\n      });\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function ui_ClickViewNode(event, nodeId) {\n      event.preventDefault();\n      event.stopPropagation();\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [parseInt(nodeId)] });\n    }\n    /// RENDERERS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function col_RenderViewOrEdit(key, tdata, coldef) {\n      const value = tdata[key];\n      return (\n        <div>\n          {!disableEdit && (\n            <button\n              className=\"outline\"\n              type=\"button\"\n              aria-label=\"View Edge\"\n              onClick={event => ui_ClickViewEdge(event, value)}\n            >\n              {ICON_VIEW}\n            </button>\n          )}\n          {!disableEdit && !isLocked && (\n            <button\n              className=\"outline\"\n              type=\"button\"\n              aria-label=\"Edge Edge\"\n              onClick={event => ui_ClickEditEdge(event, value)}\n            >\n              {ICON_PENCIL}\n            </button>\n          )}\n        </div>\n      );\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // interface TTblNodeObject {\n    //   id: String;\n    //   label: String;\n    // }\n    function col_RenderNode(key, tdata, coldef) {\n      const value = tdata[key];\n      if (!value) return; // skip if not defined yet\n      if (tdata.id === undefined)\n        throw new Error(`RenderNode: id is undefined. tdata=${tdata}`);\n      if (value === undefined)\n        throw new Error(`RenderNode: label is undefined. value=${value}`);\n      return (\n        <button\n          className=\"outline\"\n          type=\"button\"\n          aria-label=\"View Edge\"\n          onClick={event => ui_ClickViewNode(event, value.id)}\n        >\n          <span>{value.label}</span>\n        </button>\n      );\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function col_RenderCommentBtn(key, tdata, coldef) {\n      const value = tdata[key];\n      return <URCommentVBtn cref={value.cref} />;\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// tdata = { weight: Number, size: Number }\n    function col_RenderWeight(key, tdata, coldef) {\n      const value = tdata[key];\n      return `${value.weight} (${value.size})`;\n    }\n    /// CUSTOM SORTERS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// tdata = TTblNodeObject[] = { id: String, label: String }\n    function col_SortNodes(key, tdata, order) {\n      const sortedData = [...tdata].sort((a, b) => {\n        if (String(a[key].label).toLowerCase() < String(b[key].label).toLowerCase())\n          return order;\n        if (String(a[key].label).toLowerCase() > String(b[key].label).toLowerCase())\n          return order * -1;\n        return 0;\n      });\n      return sortedData;\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function col_SortCommentsByCount(key, tdata, order) {\n      const sortedData = [...tdata].sort((a, b) => {\n        if (!a[key].count) return 1; // Move undefined or '' to the bottom regardless of sort order\n        if (!b[key].count) return -1; // Move undefined or '' the bottom regardless of sort order\n        if (a[key].count < b[key].count) return order;\n        if (a[key].count > b[key].count) return order * -1;\n        return 0;\n      });\n      return sortedData;\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// tdata = { weight: Number, size: Number }\n    function col_SortWeight(key, tdata, order) {\n      const sortedData = [...tdata].sort((a, b) => {\n        if (a[key].weight < b[key].weight) return order;\n        if (a[key].weight > b[key].weight) return order * -1;\n        return 0;\n      });\n      return sortedData;\n    }\n    /// COLUMN DEFINITIONS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // column definitions for custom attributes\n    // (built in columns are: view, degrees, label)\n    const ATTRIBUTE_COLUMNDEFS = attributeDefs.map(key => {\n      return {\n        title: defs[key].displayLabel,\n        type: defs[key].type,\n        data: key\n      };\n    });\n    const PROVENANCE_COLUMNDEFS = provenanceDefs.map(key => {\n      return {\n        title: defs[key].displayLabel,\n        type: defs[key].type,\n        data: key\n      };\n    });\n    const COLUMNDEFS = [\n      {\n        title: '', // View/Edit\n        data: 'id',\n        type: defs['id'].type,\n        width: 45, // in px\n        renderer: col_RenderViewOrEdit,\n        sortDisabled: true,\n        tipDisabled: true\n      },\n      {\n        title: defs['source'].displayLabel,\n        width: 130, // in px\n        data: 'sourceDef',\n        renderer: col_RenderNode,\n        sorter: col_SortNodes\n      }\n    ];\n    if (defs['type'] && !defs['type'].hidden) {\n      COLUMNDEFS.push({\n        title: defs['type'].displayLabel,\n        type: 'text-case-insensitive',\n        width: 130, // in px\n        data: 'type'\n      });\n    }\n    COLUMNDEFS.push(\n      {\n        title: defs['target'].displayLabel,\n        width: 130, // in px\n        data: 'targetDef',\n        renderer: col_RenderNode,\n        sorter: col_SortNodes\n      },\n      ...ATTRIBUTE_COLUMNDEFS\n    );\n    if (defs['weight'] && !defs['weight'].hidden)\n      COLUMNDEFS.push({\n        title: defs['weight'].displayLabel,\n        type: 'number',\n        width: 45, // in px\n        data: 'weightDef',\n        renderer: col_RenderWeight,\n        sorter: col_SortWeight\n      });\n    COLUMNDEFS.push(...PROVENANCE_COLUMNDEFS);\n    // History\n    if (defs['createdBy'] && !defs['createdBy'].hidden)\n      COLUMNDEFS.push({\n        title: defs['createdBy'].displayLabel,\n        type: 'text-case-insensitive',\n        width: 60, // in px\n        data: 'createdBy'\n      });\n    if (defs['created'] && !defs['created'].hidden)\n      COLUMNDEFS.push({\n        title: defs['created'].displayLabel,\n        type: 'timestamp-short',\n        width: 60, // in px\n        data: 'created'\n      });\n    if (defs['updatedBy'] && !defs['updatedBy'].hidden)\n      COLUMNDEFS.push({\n        title: defs['updatedBy'].displayLabel,\n        type: 'text-case-insensitive',\n        width: 60, // in px\n        data: 'updatedBy'\n      });\n    if (defs['updated'] && !defs['updated'].hidden)\n      COLUMNDEFS.push({\n        title: defs['updated'].displayLabel,\n        type: 'timestamp-short',\n        width: 60, // in px\n        data: 'updated'\n      }); // Comment is last\n    COLUMNDEFS.push({\n      title: ' ',\n      data: 'commentVBtnDef',\n      type: 'text',\n      width: 40, // in px\n      renderer: col_RenderCommentBtn,\n      sorter: col_SortCommentsByCount,\n      tipDisabled: true\n    });\n    return COLUMNDEFS;\n  }\n\n  /// TABLE DATA GENERATION ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function DeriveTableData({ edgeDefs, edges }) {\n    // Only include built in fields\n    // Only include non-hidden fields\n    // Only include non-provenance fields\n    let attributeDefs = Object.keys(edgeDefs).filter(\n      k =>\n        !BUILTIN_FIELDS_EDGE.includes(k) &&\n        !edgeDefs[k].hidden &&\n        !edgeDefs[k].isProvenance\n    );\n    const provenanceDefs = Object.keys(edgeDefs).filter(\n      k => edgeDefs[k].isProvenance\n    );\n\n    return edges.map((edge, i) => {\n      const { id, source, target, sourceLabel, targetLabel, type, weight, size } =\n        edge;\n      const sourceDef = { id: source, label: sourceLabel };\n      const targetDef = { id: target, label: targetLabel };\n\n      // weightDef\n      const weightDef = { weight, size };\n\n      // custom attributes\n      const attributes = {};\n      attributeDefs.forEach((key, i) => {\n        let data = {};\n        if (edgeDefs[key].type === 'markdown') {\n          // for markdown:\n          // a. provide the raw markdown string\n          // b. provide the HTML string\n          data.html = NCUI.Markdownify(edge[key]);\n          data.raw = edge[key];\n        } else if (edgeDefs[key].type === 'hdate') {\n          data = edge[key] && edge[key].formattedDateString;\n        } else if (edgeDefs[key].type === 'infoOrigin') {\n          data =\n            edge[key] === undefined || edge[key] === ''\n              ? UTILS.DeriveInfoOriginString(\n                  edge.createdBy,\n                  edge.meta ? edge.meta.created : ''\n                )\n              : edge[key];\n        } else data = edge[key];\n        attributes[key] = data;\n      });\n\n      // comment button definition\n      const cref = CMTMGR.GetEdgeCREF(id);\n      const commentCount = CMTMGR.GetCommentCollectionCount(cref);\n      const ccol = CMTMGR.GetCommentCollection(cref) || {};\n      const hasUnreadComments = ccol.hasUnreadComments;\n      const selected = CMTMGR.GetOpenComments(cref);\n      const commentVBtnDef = {\n        cref,\n        count: commentCount,\n        hasUnreadComments,\n        selected\n      };\n\n      // provenance\n      const provenance = {};\n      provenanceDefs.forEach((key, i) => {\n        let data = {};\n        if (edgeDefs[key].type === 'markdown') {\n          // for markdown:\n          // a. provide the raw markdown string\n          // b. provide the HTML string\n          data.html = NCUI.Markdownify(edge[key]);\n          data.raw = edge[key];\n        } else if (edgeDefs[key].type === 'hdate') {\n          data = edge[key] && edge[key].formattedDateString;\n        } else if (edgeDefs[key].type === 'infoOrigin') {\n          data =\n            edge[key] === undefined || edge[key] === ''\n              ? UTILS.DeriveInfoOriginString(\n                  edge.createdBy,\n                  edge.meta ? edge.meta.created : ''\n                )\n              : edge[key];\n        } else data = edge[key] || '';\n        provenance[key] = data;\n      });\n\n      // history\n      const history = {\n        createdBy: edge.createdBy,\n        created: edge.meta ? edge.meta.created : '', // meta may not be defined when a new node is creatd\n        updatedBy: edge.updatedBy,\n        updated: edge.meta ? edge.meta.updated : '' // meta may not be defined when a new node is creatd\n      };\n\n      return {\n        id: { edgeId: id, sourceId: source }, // { edgeId, sourceId} for click handler\n        sourceDef, // { id: String, label: String }\n        targetDef, // { id: String, label: String }\n        type,\n        weightDef, // { weight: Number, size: Number }\n        weight,\n        size,\n        ...attributes,\n        commentVBtnDef,\n        ...provenance,\n        ...history,\n        meta: {\n          filteredTransparency: edge.filteredTransparency\n        }\n      };\n    });\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  if (state.edges === undefined) return `loading...waiting for edges ${state.edges}`;\n  if (state.edgeDefs === undefined)\n    return `loading...waiting for nodeDefs ${state.edgeDefs}`;\n\n  const COLUMNDEFS = DeriveColumnDefs();\n  const TABLEDATA = DeriveTableData({ edgeDefs: state.edgeDefs, edges: state.edges });\n  return (\n    <div id=\"NCEdgeTable\">\n      <URTable isOpen={isOpenRef.current} data={TABLEDATA} columns={COLUMNDEFS} />\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCEdgeTable;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n  NCFiltersSummary displays:\n  * If no filters are active, the count of nodes and edges in the graph\n  * If filters are active...\n    - the summary of filters applied and\n    - the count of nodes and edges active in the graph\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport UNISYS from 'unisys/client';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCFiltersSummary' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCFiltersSummary() {\n  const [state, setState] = useState({\n    filtersSummary: '',\n    graphStats: ''\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    UDATA.OnAppStateChange('FILTEREDNCDATA', urmsg_UpdateFilterSummary);\n    return () => {\n      UDATA.AppStateChangeOff('FILTEREDNCDATA', urmsg_UpdateFilterSummary);\n    };\n  }, []);\n\n  function urmsg_UpdateFilterSummary(data) {\n    // If there is no change in filtersSummary or graphStats, skip the state update\n    // This prevents unnecessary re-renders and improves performance\n\n    const { filtersSummary, graphStats } = data.stats;\n\n    if (filtersSummary === state.filtersSummary && graphStats === state.graphStats) {\n      console.warn(\n        'FILTER_SUMMARY_UPDATE...urmsg_UpdateFilterSummary... no data skipping state update'\n      );\n      return;\n    }\n\n    if (\n      (filtersSummary && filtersSummary !== state.filtersSummary) ||\n      (graphStats && graphStats !== state.graphStats)\n    ) {\n      setState(prevState => ({\n        ...prevState,\n        filtersSummary: filtersSummary,\n        graphStats: graphStats\n      }));\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_ClearFilters() {\n    UDATA.LocalCall('FILTER_CLEAR');\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <div id=\"filters-summary\">\n      {!state.filtersSummary && state.graphStats}\n      {state.filtersSummary}\n      {state.filtersSummary && (\n        <button className=\"cat\" onClick={evt_ClearFilters}>\n          Clear Filters\n        </button>\n      )}\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCFiltersSummary;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  NetGraph is a React wrapper for a D3 network graph component.\n\n  This component uses React to create the base dom element, but ncGraphRenderer\n  handles the data updates, rendering and animation updates.\n\n  React is explicitly prevented from updating the component (see\n  shouldComponentUpdate)\n\n  ## TO USE\n\n          <NCGraph/>\n\n  ## Why not use FauxDom?\n\n  https://lab.oli.me.uk/react-faux-dom-state/\n  This article suggests that maybe using force graphs with react-faux-dom\n  not quite work.\n      \"If you want to animate things, use a React animation library (they’re\n        great and work fine with faux DOM), you have to find the React way to\n        do things, sadly some D3 concepts just don’t translate. If you want\n        some physics based graph full of state then you’re probably better\n        off keeping to the original way of embedding D3 in React, dropping\n        out of React and letting D3 mutate that element.\"\n  Indeed, in our testing, the animation updates were not optimal.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst NCGraphRenderer = require('./NCGraphRenderer');\nconst UNISYS = require('unisys/client');\nconst RENDERMGR = require('../render-mgr');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCGraph';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NCGraph extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ncGraphRenderer: undefined,\n      d3data: {},\n      nodeTypes: [],\n      edgeTypes: []\n    };\n\n    this.updateVData = this.updateVData.bind(this);\n    this.updateTemplate = this.updateTemplate.bind(this);\n    this.updateColorMap = this.updateColorMap.bind(this);\n    this.updateSelection = this.updateSelection.bind(this);\n    this.onZoomReset = this.onZoomReset.bind(this);\n    this.onZoomIn = this.onZoomIn.bind(this);\n    this.onZoomOut = this.onZoomOut.bind(this);\n    this.constructGraph = this.constructGraph.bind(this);\n\n    this.OnAppStateChange('VDATA', this.updateVData);\n    this.OnAppStateChange('TEMPLATE', this.updateTemplate);\n    this.OnAppStateChange('COLORMAP', this.updateColorMap);\n    this.OnAppStateChange('SELECTION', this.updateSelection);\n    this.OnAppStateChange('HILITE', this.updateSelection);\n    this.HandleMessage('CONSTRUCT_GRAPH', this.constructGraph);\n  } // constructor\n\n  /// CLASS PRIVATE METHODS /////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// DATA METHODS\n  /**\n   *\n   * @param {object} data\n   * @param {array} data.nodes\n   * @param {array} data.edges\n   */\n  updateVData(data) {\n    if (DBG) console.log(PR, 'got state D3DATA', data, RENDERMGR);\n    if (!this.state.ncGraphRenderer) return;\n    const d3data = RENDERMGR.ProcessNCData(data);\n    this.state.ncGraphRenderer.SetData(d3data);\n  }\n  /**\n   * Update default values when template has changed\n   * @param {object} data TEMPLATE\n   */\n  updateTemplate(data) {\n    if (DBG) console.log(PR, 'got state TEMPLATE', data);\n    const TEMPLATE = this.AppState('TEMPLATE');\n    // Update Legends\n    const nodeTypes = TEMPLATE.nodeDefs.type.options;\n    const edgeTypes = TEMPLATE.edgeDefs.type.options;\n    // Update\n    this.setState({ nodeTypes, edgeTypes }, () => {\n      this.forceUpdate(); // just once, needed to overcome shouldComponentUpdate override\n    });\n  }\n  /**\n   * Node/Edge Colors in Template have been changed.\n   * The template may be loaded or changed after NCDATA is loaded.\n   * So we need to explicitly update the colors if the color\n   * definitions have changed.\n   */\n  updateColorMap(data) {\n    if (DBG) console.log(PR, 'got state COLORMAP', data);\n    this.state.ncGraphRenderer.UpdateGraph();\n  }\n  /**\n   *\n   * @param {*} data\n   */\n  updateSelection(data) {\n    if (DBG) console.log(PR, 'updateSelection', data);\n    const d3data = RENDERMGR.UpdateSelection(data);\n    this.state.ncGraphRenderer.SetData(d3data, { skipForceUpdate: true });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UI METHODS\n\n  /**\n   */\n  onZoomReset() {\n    this.state.ncGraphRenderer.ZoomReset();\n  }\n  /**\n   */\n  onZoomIn() {\n    this.state.ncGraphRenderer.ZoomIn();\n  }\n  /**\n   */\n  onZoomOut() {\n    this.state.ncGraphRenderer.ZoomOut();\n  }\n\n  /// REACT LIFECYCLE ///////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  constructGraph() {\n    // first destroy any existing SVG graph elements\n    const netgraph = document.getElementById('netgraph');\n    if (netgraph) netgraph.remove();\n\n    // ncGraphRenderer Constructor\n    const TEMPLATE = this.AppState('TEMPLATE');\n    if (this.state.ncGraphRenderer && this.state.ncGraphRenderer.Deregister) {\n      // if ncGraphRenderer was previously created, deregister it so it stops receiving data updates\n      this.state.ncGraphRenderer.Deregister();\n    }\n    const ncGraphRenderer = new NCGraphRenderer(this.dom); // this.dom defined in render via ref\n    try {\n      const nodeTypes = TEMPLATE.nodeDefs.type.options;\n      const edgeTypes = TEMPLATE.edgeDefs.type.options;\n      this.setState({ ncGraphRenderer, nodeTypes, edgeTypes });\n      this.forceUpdate(); // just once, needed to overcome shouldComponentUpdate override\n    } catch (err) {\n      console.warn('constructGraph error', err);\n    }\n  }\n\n  /// REACT LIFECYCLE ///////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  componentDidMount() {\n    this.constructGraph();\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  componentWillUnMount() {\n    this.AppStateChangeOff('VDATA', this.updateVData);\n    this.AppStateChangeOff('TEMPLATE', this.updateTemplate);\n    this.AppStateChangeOff('COLORMAP', this.updateColorMap);\n    this.AppStateChangeOff('SELECTION', this.updateSelection);\n    this.AppStateChangeOff('HILITE', this.updateSelection);\n    this.DropMessage('CONSTRUCT_GRAPH', this.constructGraph);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  shouldComponentUpdate() {\n    // This prevents React from updating the component,\n    // allowing D3 to handle the simulation animation updates\n    // This is also necessary for D3 to handle the\n    // drag events.\n    return false;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  render() {\n    const { nodeTypes, edgeTypes } = this.state;\n    return (\n      <div className=\"NCGraph\" ref={dom => (this.dom = dom)}>\n        <div className=\"zoom-buttons\">\n          <button onClick={this.onZoomIn} role=\"button\" aria-label=\"Zoom In\">\n            <img src=\"/images/icn_plus.svg\" alt=\"\" />\n          </button>\n          &nbsp;\n          <button onClick={this.onZoomReset} role=\"button\" aria-label=\"Zoom Reset\">\n            <img src=\"/images/icn_circle.svg\" alt=\"\" />\n          </button>\n          &nbsp;\n          <button onClick={this.onZoomOut} role=\"button\" aria-label=\"Zoom Out\">\n            <img src=\"/images/icn_minus.svg\" alt=\"\" />\n          </button>\n        </div>\n        <div className=\"legend\">\n          <h1>Node Types:</h1>\n          {nodeTypes.map((type, i) => (\n            <div key={i} className=\"tooltipAnchor\">\n              <div className=\"legend-item\">\n                <div className=\"swatch\" style={{ backgroundColor: type.color }}></div>\n                &nbsp;{type.label === '' ? 'No Type Selected' : type.label}\n              </div>\n              <span className=\"tooltiptextabove\">\n                {type.label === '' ? 'No Type Selected' : type.help || type.label}\n              </span>\n            </div>\n          ))}\n          <br></br>\n          <h1>Edge Types:</h1>\n          {edgeTypes.map((type, i) => (\n            <div key={i} className=\"tooltipAnchor\">\n              <div className=\"legend-item\">\n                <div className=\"swatch\" style={{ backgroundColor: type.color }}></div>\n                &nbsp;{type.label === '' ? 'No Type Selected' : type.label}\n              </div>\n              <span className=\"tooltiptextabove\">\n                {type.label === '' ? 'No Type Selected' : type.help || type.label}\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n} // class NetGraph\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCGraph;\n","/* eslint-disable prefer-reflect */\n/* d3.call() is false-triggering the above rule */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  NCGraphRenderer\n\n  This uses D3 Version 4.0.\n\n  This is a pure data renderer based on d3-simplenetgraph.\n  It does not rely on any outside data sources/dependencies or UNISYS calls.\n\n  The one exception is that `mouseover` and `node click` events are\n  broadcast through UNISYS calls.\n\n  This is designed to work with the NCGraph React component.\n\n  NCGraph calls NCGraphRenderer.SetData whenever it receives an updated data object.\n  This triggers NCGraphRenderer to redraw itself.\n\n  VDATA\n  -----\n  The data for display is generally referred to as VDATA, for visual\n  rendering data.\n\n    VDATA = { nodes:Object, edges:Object }\n    nodes = [ ...{ id :number,\n                    label :string,\n                    selected :boolean,\n                    selectedSecondary :boolean,  // for selected source/target node\n                    size :number,\n                    color :string(css),\n                    opacity :number(0-1),\n                    strokeColor :string(css),\n                    strokeWidth :number,\n                    textColor :string(css),\n                    help :string\n                  }],\n    edges = [ ...{ id :number,\n                    sourceId :number,\n                    targetId :number,\n                    size: number,\n                    color: string(css),\n                    opacity: number(0-1)\n                  }]\n\n\n  Using NCGraphRenderer\n  ---------------------\n  Embed NCGraphRender in a parent component.  See NCGraph for an example of use.\n  1. const graph = NCGraphRender(this.dom) -- Root element to attach the SVG graph to\n  2. graph.SetData(VDATA) -- Define data to draw\n      graph.UpdateGraph()   -- Force a redraw using the loaded data set\n\n  External Controls\n  * graph.ZoomReset()\n  * graph.ZoomIn()\n  * graph.ZoomOut()\n\n\n  Zoom/Pan\n  --------\n  Zooming/panning is handled via D3's zoom() function.  Basically it\n  involves creating a `g` element that wraps the node and link elements\n  and applying transforms on that wrapper.\n\n\n  Provenance\n  ----------\n  d3-simplenetgraph was based on:\n  *  rdpoor's commented version of mbostock's original code\n      https://gist.github.com/rdpoor/3a66b3e082ffeaeb5e6e79961192f7d8\n  *  danilo's v4 update\n      https://bl.ocks.org/tezzutezzu/cd04b3f1efee4186ff42aae66c87d1a7\n  *  mbostock's general update pattern\n      https://bl.ocks.org/mbostock/3808218\n  *  Coderwall's zoom and pan method\n      https://coderwall.com/p/psogia/simplest-way-to-add-zoom-pan-on-d3-js\n  *  Vladyslav Babenko's zoom buttons example\n      https://jsfiddle.net/vbabenko/jcsqqu6j/9/\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst d3 = require('d3');\nconst UNISYS = require('unisys/client');\nvar UDATA = null;\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCGraphRenderer';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet m_width = 800;\nlet m_height = 800;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst M_FORCEPROPERTIES = {\n  // values for all forces\n  center: {\n    x: 0.5,\n    y: 0.5\n  },\n  charge: {\n    // 'charge' provides a repelling force against other nodes\n    enabled: true,\n    // -50 works well for small networks with no links\n    strength: -200, // during _UpdateForces, 'strength' is multipled by the size of the node (degrees+1)\n    // -50 close < -1000 pushes nodes far apart\n    distanceMin: 1, // use 'collide' to keep nodes from intersecting, not distance\n    distanceMax: 750 // max keeps large clusters from pushing unattached nodes too far away\n    // 250 close < 500 med < 1000 spacious < 10000 far away\n  },\n  collide: {\n    // 'collide' keeps nodes from overlapping each other\n    // collide's `radius` value maintains a minimum distance between nodes\n    enabled: true,\n    strength: 0.75, // 1 keeps nodes from intersecting during drag so nodes feel more solid\n    // 0.75 softens the collisions so they don't feel so jarring\n    // 0.3 will allow nodes to intersect, then iterations will push them out\n    iterations: 5, // need at least 3 iterations to stabilize\n    // at 1 graph takes a long time to reach equilibrium\n    radius: 7 // `radius` is added to node.degrees + defaultSize during _UpdateForces with the node radius\n  },\n  forceX: {\n    // 'forceX' pushes nodes towards a normalized x position\n    // x is calculated relative to the m_width\n    // e.g. x=0.5 is the center\n    // higher strength will push harder towards the x point\n    // e.g. to create a narrow tall graph, use strength: 2\n    enabled: true,\n    strength: 0.25, // 1 clumped < 0.3 med  < 0.2 loose < 0.1 very loose\n    x: 0.5\n  },\n  forceY: {\n    // 'forceY' pushes nodes towards a normalized y position\n    // y is calculated relative to the m_height\n    // e.g. y=0.5 is the center\n    // higher strength will push harder towards the y point\n    // e.g. to create a wide short graph, use strength: 2\n    enabled: true,\n    strength: 0.25, // 1 clumped < 0.3 med  < 0.2 loose < 0.1 very loose\n    y: 0.5\n  },\n  link: {\n    enabled: true,\n    distance: 50, // sets the basic link distance between nodes\n    // 10 is a little too close\n    // 25 is cozy\n    // 50 is spacious\n    // 100 leaves everything too far apart\n    iterations: 5 // Orig val = 1.  More iterations will give graph time to settle\n  }\n}; // M_FORCEPROPERTIES\n\n/// NCGraphRenderer CLASS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass NCGraphRenderer {\n  constructor(rootElement) {\n    this.rootElement = rootElement;\n    this.d3svg = {};\n    this.zoom = {};\n    this.zoomWrapper = {};\n    this.simulation = {};\n    this.data = { nodes: [], edges: [] };\n\n    this.clickFn = {};\n\n    /// Initialize UNISYS DATA LINK for REACT\n    UDATA = UNISYS.NewDataLink(this);\n\n    /// D3 CODE ///////////////////////////////////////////////////////////////////\n    /// note: this is all inside the class constructor function!\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n    // this.UpdateDefaultValues(); // needs TEMPLATE\n\n    // Set up Zoom\n    this.zoom = d3.zoom().on('zoom', this.m_HandleZoom);\n\n    /** Create svg element which will contain our D3 DOM elements.\n        Add default click handler so when clicking empty space, deselect all.\n        NOTE: the svg element is actualy d3.selection object, not an svg obj.\n     */\n    this.d3svg = d3\n      .select(rootElement)\n      .append('svg')\n      .attr('id', 'netgraph')\n      .attr('width', '100%') // maximize width and height\n      .attr('height', '100%') // then set center dynamically below\n      .on('click', (e, event) => {\n        // Deselect\n        UDATA.LocalCall('D3_SELECT_NODE', { nodeLabels: [] });\n        // DEPRECATED for now 7/2023 -- use D3_SELECT_NODE instead\n        // UDATA.LocalCall('SOURCE_SELECT', { nodeLabels: [] });\n      })\n      .on('mouseover', d => {\n        UDATA.LocalCall('USER_HILITE_NODE', { nodeId: undefined });\n        // Deselect edges\n        d3.selectAll('.edge')\n          .transition()\n          .duration(1500)\n          .style('stroke-width', e => e.width);\n        d3.event.stopPropagation();\n      })\n      .call(this.zoom);\n\n    this.zoomWrapper = this.d3svg.append('g').attr('class', 'zoomer');\n\n    // Set SVG size and centering.\n    let svg = document.getElementById('netgraph');\n    m_width = svg.clientWidth;\n    m_height = svg.clientHeight;\n\n    this.simulation = d3.forceSimulation();\n\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// END D3 CODE ///////////////////////////////////////////////////////////////\n\n    this.ClearSVG = this.ClearSVG.bind(this);\n    this.SetData = this.SetData.bind(this);\n    this.m_Initialize = this.m_Initialize.bind(this);\n    this.UpdateGraph = this.UpdateGraph.bind(this);\n    this.m_UpdateForces = this.m_UpdateForces.bind(this);\n    this.m_Tick = this.m_Tick.bind(this);\n    this.ZoomReset = this.ZoomReset.bind(this);\n    this.ZoomIn = this.ZoomIn.bind(this);\n    this.ZoomOut = this.ZoomOut.bind(this);\n    this.ZoomPanReset = this.ZoomPanReset.bind(this);\n    this.m_HandleZoom = this.m_HandleZoom.bind(this);\n    this.m_Transition = this.m_Transition.bind(this);\n    this.m_Dragstarted = this.m_Dragstarted.bind(this);\n    this.m_Dragged = this.m_Dragged.bind(this);\n    this.m_Dragended = this.m_Dragended.bind(this);\n  }\n\n  /// CLASS PUBLIC METHODS //////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  Deregister() {\n    if (DBG) console.log(PR, 'NCGraphRenderer.DESTRUCT!!!');\n    // Take care of any de-registration of listeners...\n    // ...there aren't any at the moment...\n  }\n\n  /// CLASS PRIVATE METHODS /////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  /** Clear the SVG data\n      Currently not used because we just deconstruct d3-simplenetgraph insead.\n      Was thought to be needed during imports otherwise _UpdateGraph reads data from existing\n      SVG elements rather than the new data.\n   */\n  ClearSVG() {\n    this.zoomWrapper.selectAll('.edge').remove();\n    this.zoomWrapper.selectAll('.node').remove();\n  }\n\n  /** The parent container passes data to the d3 graph via this SetData call\n   *  which then triggers all the internal updates\n   *\n   *  When a SELECTION is updated, we use skipForceUpdate to preven the\n   *  simulation from re-applying forces, causing nodes to move.  Without this\n   *  as you mouseover a node, ALL the nodes move and it becomes impossible to\n   *  select the node.\n   *  @param {Object} newData VDATA { nodes, edges }\n   *  @param {Object} options\n   *  @param {boolean} options.skipForceUpdate skip force updates during selection updates\n   */\n  SetData(newData, options = {}) {\n    if (newData) {\n      // Make a shallow copy to protect against mutation, while\n      // recycling old nodes to preserve position and velocity.\n      // From https://observablehq.com/@d3/modifying-a-force-directed-graph?collection=@d3/d3-force\n      // grab the SVG nodes\n      const svgNodes = this.zoomWrapper.selectAll('.node');\n      const oldNodes = new Map(svgNodes.data().map(d => [d.id, d]));\n\n      this.data.nodes = newData.nodes.map(d =>\n        Object.assign(oldNodes.get(d.id) || {}, d)\n      );\n      this.data.edges = newData.edges.map(d => Object.assign({}, d));\n\n      // FIXME: REVIEW: is this not necessary?  Just check initialize once?\n      if (!options.skipForceUpdate) this.m_Initialize();\n      if (!options.skipForceUpdate) this.m_UpdateForces();\n      this.UpdateGraph(options.skipForceUpdate);\n\n      // updates ignored until this is run restarts the simulation\n      // (important if simulation has already slowed down)\n      // skipForceUpdate here is helpful for preventing force updates when hovering\n      // or tryng to select an object.\n      if (!options.skipForceUpdate) this.simulation.alpha(0.1).restart(); // was 1 - JD\n    }\n  }\n\n  /** This sets up the force properties for the simulation and tick handler.\n   */\n  m_Initialize() {\n    // Create the force layout.  After a call to force.start(), the tick\n    // method will be called repeatedly until the layout \"gels\" in a stable\n    // configuration.\n    this.simulation\n      .force('link', d3.forceLink())\n      .force('charge', d3.forceManyBody())\n      .force('collide', d3.forceCollide())\n      .force('center', d3.forceCenter())\n      .force('forceX', d3.forceX())\n      .force('forceY', d3.forceY())\n\n      .on('tick', this.m_Tick);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * Call UpdateGraph() after new data has been loaded. This creates link and node\n      svg objects and sets their forceProperties.\n      The component `node` structure:\n          <g class=\"node\">  // node group object\n            <circle>\n            <text>         // label\n            <title>        // tooltip\n          </g>\n\n      This method implements the unified enter/exit/update pattern described\n      here: http://d3indepth.com/enterexit/#general-update-pattern\n\n      By convention, selection methods that return the current selection use\n      four spaces of indent, while methods that return a new selection use only two.\n      This helps reveal changes of context by making them stick out of the chain.\n\n      This method actually does more than just \"update\" an existing graph; in D3\n      you can write code that initializes AND updates data.\n   */\n  UpdateGraph() {\n    // DATA JOIN\n    // select all elemnts with class .node in d3svg\n    // bind selected elements with elements in this.data.nodes,\n    // assigning each one an id using the key function.\n\n    // nodeElements is a d3.selection object\n    let nodeElements = this.zoomWrapper\n      .selectAll('.node')\n      .data(this.data.nodes, d => {\n        return d.id;\n      }); // fn returns the calculated key for the data object\n\n    // linkElements is a d3.selection object\n    let linkElements = this.zoomWrapper\n      .selectAll('.edge')\n      .data(this.data.edges, d => {\n        return d.id;\n      }); // fn returns the calculated key for the data object\n\n    // TELL D3 HOW TO HANDLE NEW NODE DATA\n    // the d3.selection.enter() method sets the operational scope for\n    // subsequent calls\n    let elementG = nodeElements.enter().append('g').classed('node', true);\n\n    // enter node: append 'g' (group) element and click behavior\n    elementG\n      .call(\n        d3\n          .drag()\n          .on('start', d => {\n            this.m_Dragstarted(d, this);\n          })\n          .on('drag', this.m_Dragged)\n          .on('end', d => {\n            this.m_Dragended(d, this);\n          })\n      )\n      .on('click', d => {\n        if (DBG) console.log('clicked on', d.label, d.id);\n        UDATA.LocalCall('D3_SELECT_NODE', { nodeIDs: [d.id] });\n        // DEPRECATED for now 7/2023 -- use D3_SELECT_NODE instead\n        // UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [d.id] });\n        d3.event.stopPropagation();\n      })\n      .on('mouseover', d => {\n        UDATA.LocalCall('USER_HILITE_NODE', { nodeId: d.id });\n        d3.selectAll('.edge')\n          .transition()\n          .duration(500)\n          .style('stroke-width', e => e.width);\n        d3.event.stopPropagation();\n      });\n\n    // enter node: also append 'circle' element of a calculated size\n    elementG\n      .append('circle')\n      .attr('r', d => d.size) // \"r\" has to be set here or circles don't draw.\n      .attr('fill', d => d.color)\n      .style('opacity', d => d.opacity);\n\n    // EXPERIMENTAL: Show rectangle shapes\n    // REVIEW: Is there a way not to create this if it's not needed?\n    // elementG\n    //   .append('rect')\n    //   .attr('width', d => d.size * 2)\n    //   .attr('height', d => d.size * 2)\n    //   .attr('x', d => -d.size)\n    //   .attr('y', d => -d.size)\n    //   .attr('fill', d => d.color)\n    //   .style('opacity', 0);\n\n    // enter node: also append 'text' element\n    elementG\n      .append('text')\n      .classed('noselect', true)\n      .attr('font-size', 10)\n      .attr('dx', d => d.size + 5)\n      .attr('dy', '0.35em') // \".15em\")\n      .text(d => d.label)\n      .style('opacity', d => d.opacity);\n\n    // enter node: also append a 'title' tag\n    // we should move this to our tooltip functions, but it works for now\n    elementG\n      .append('title') // node tooltip\n      .text(d => d.help);\n\n    /** TRICKY D3 CODE CONCEPTS AHEAD\n\n        CONTEXT: The author of this code has assumed that NCDATA may\n        completely changed, so his update code is written with this in mind.\n\n        At this point in the code, nodeElements is operating on the enter()\n        selection set (remember: nodeElements is a REFERENCE to the\n        original d3 selection object, which is being transmutted by every\n        operation).\n\n        Given the above, .merge() will combine the current active d3\n        selection (enter()) with all the nodes (nodeEntry in its entirety).\n\n        It may seem weird because:\n\n        (1) the d3.selection() context isn't always obvious unless you\n            know that d3.selections and key ops like .enter(), .update(),\n            and .exit() affect certain other ops.\n        (2) this code reads like it's executing immediately on nodeElements,\n            but it actually is a PROGRAM being defined for a d3.selection\n            event that runs later. The value of the parameter nodeElements\n            will have a different value in the future than it does at the\n            time of definition here.\n\n        In effect, the merge() operation is used to use the same\n        initialization code for both enter() and manual refresh.\n\n        ASIDE: There is an d3.selection.update() operation, but that  is\n        called when d3 detects that data node bound to an existing DOM\n        element has changed. This code doesn't use update(), and instead\n        relies on manual event detection to force a full data refresh and\n        update. D3 doesn't die because it is aware of the persistent SVG\n        elements  it created, and checks data binding through the id. This\n        is fast, and the SVG elements do not have to be recreated.\n\n     */\n\n    // UPDATE circles in each node for all nodes\n    nodeElements\n      .merge(nodeElements)\n      .selectAll('circle')\n      .attr('stroke', d => d.strokeColor)\n      .attr('stroke-width', d => d.strokeWidth)\n      .attr('fill', d => d.color)\n      .attr('r', d => d.size)\n      .transition()\n      .duration(500)\n      .style('opacity', d => d.opacity);\n\n    // UPDATE text in each node for all nodes\n    // (technically this could have proceeded from the previous operation,\n    // but this makes it a little easier to findthe text-specific code as\n    // a block\n    nodeElements\n      .merge(nodeElements)\n      .selectAll('text')\n      .attr('fill', d => d.textColor)\n      // .attr('stroke', d => d.strokeColor) // stroke overlaps on text\n      // .attr('stroke-width', '0.5px') // stroke overlaps on text\n      .attr('font-weight', d => {\n        return d.strokeColor ? 'bold' : undefined;\n      })\n      .text(d => d.label) // in case text is updated\n      .transition()\n      .duration(500)\n      .style('opacity', d => d.opacity);\n\n    nodeElements\n      .merge(nodeElements)\n      .selectAll('title') // node tooltip\n      .text(d => d.help);\n\n    // EXPERIMENTAL: Show rectangle shapes\n    // nodeElements\n    //   .merge(nodeElements)\n    //   .selectAll('rect')\n    //   .attr('stroke', d => d.strokeColor)\n    //   .attr('stroke-width', d => d.strokeWidth)\n    //   .style('opacity', d => d.shape === 'rectangle' ? 1 : 0);\n\n    // TELL D3 what to do when a data node goes away\n    nodeElements.exit().remove();\n\n    // NOW TELL D3 HOW TO HANDLE NEW EDGE DATA\n    // .insert will add an svg `line` before the objects classed `.node`\n    // .enter() sets the initial state of links as they are created\n    linkElements\n      .enter()\n      .insert('line', '.node')\n      .classed('edge', true)\n      .style('stroke', e => e.color)\n      .style('stroke-width', e => e.width)\n      .style('stroke-linecap', 'round')\n      // Edge selection disabled.\n      // .on(\"click\",   (d) => {\n      //   if (DBG) console.log('clicked on',d.label,d.id)\n      //   this.edgeClickFn( d )\n      // })\n      .style('opacity', e => e.opacity);\n\n    // .merge() updates the visuals whenever the data is updated.\n    linkElements\n      .merge(linkElements)\n      // .classed(\"selected\", e => e.selected) // is this used?\n      .style('stroke', e => e.color)\n      .style('stroke-width', e => e.width)\n      .style('stroke-linecap', 'round')\n      .transition()\n      .duration(500)\n      .style('opacity', e => e.opacity);\n\n    linkElements.exit().remove();\n\n    // UPDATE ANIMATED SIMULATION\n    // this is a plugin\n    this.simulation.nodes(this.data.nodes);\n    if (this.data.edges) {\n      this.simulation.force('link').links(this.data.edges);\n    }\n\n    // SELECTION ARROW\n    this.d3svg.selectAll('#selectorArrow').remove();\n    this.d3svg.selectAll('#secondarySelectorArrow').remove();\n\n    // SINGLE ARROW APPROACH\n    // nodeElements\n    //   .merge(nodeElements)\n    //   .filter(d => d.selected)\n    //   .append('g')\n    //   .attr('id', 'selectorArrow')\n    //   .attr('transform', d => `translate(${- d.size - 5},0)`)\n    //   .append('polygon')\n    //   .attr('points', '0,0 -10,5 -10,-5 ')\n    //   .attr('fill', 'red')\n    //   .append('animateTransform')\n    //   .attr('attributeName', 'transform')\n    //   .attr('attributeType', 'XML')\n    //   .attr('type', 'rotate')\n    //   .attr('from', d => `0 ${d.size + 5} 0`)\n    //   .attr('to', d => `360 ${d.size + 5} 0`)\n    //   .attr('dur', '2s')\n    //   .attr('repeatCount', 'indefinite')\n\n    // MULTIPLE ARROW APPROACH\n    this.selectorArrows = nodeElements\n      .merge(nodeElements)\n      .filter(d => d.selected)\n      .append('g')\n      .attr('id', 'selectorArrow')\n      .attr('transform', d => `translate(${-d.size - 5},0)`);\n    this.selectorArrows\n      .append('polygon')\n      .attr('points', '0,0 -10,5 -10,-5 ')\n      .attr('fill', d => d.strokeColor)\n      .append('animateTransform')\n      .attr('attributeName', 'transform')\n      .attr('attributeType', 'XML')\n      .attr('type', 'rotate')\n      .attr('from', d => `0 ${d.size + 5} 0`)\n      .attr('to', d => `360 ${d.size + 5} 0`)\n      .attr('dur', '6s')\n      .attr('repeatCount', 'indefinite');\n    this.selectorArrows\n      .append('polygon')\n      .attr('transform', d => `translate(${d.size + 5},0)`)\n      .attr('points', '0,0 -10,5 -10,-5 ')\n      .attr('fill', d => d.strokeColor)\n      .append('animateTransform')\n      .attr('attributeName', 'transform')\n      .attr('attributeType', 'XML')\n      .attr('type', 'rotate')\n      .attr('from', d => `120 ${d.size + 5} 0`) // different rotation start\n      .attr('to', d => `480 ${d.size + 5} 0`) // different rotation end\n      .attr('dur', '6s')\n      .attr('repeatCount', 'indefinite');\n    this.selectorArrows\n      .append('polygon')\n      .attr('transform', d => `translate(${d.size + 5},0)`)\n      .attr('points', '0,0 -10,5 -10,-5 ')\n      .attr('fill', d => d.strokeColor)\n      .append('animateTransform')\n      .attr('attributeName', 'transform')\n      .attr('attributeType', 'XML')\n      .attr('type', 'rotate')\n      .attr('from', d => `240 ${d.size + 5} 0`) // different rotation start\n      .attr('to', d => `600 ${d.size + 5} 0`) // different rotation end\n      .attr('dur', '6s')\n      .attr('repeatCount', 'indefinite');\n\n    // SECONDARY SELECTOR ARROW\n    nodeElements\n      .merge(nodeElements)\n      .filter(d => d.selectedSecondary)\n      .append('g')\n      .attr('id', 'secondarySelectorArrow')\n      .attr('transform', d => `translate(${-d.size - 5},0)`)\n      .append('polygon')\n      .attr('points', '0,0 -10,5 -10,-5 ')\n      .attr('fill', 'blue')\n      // .attr('fill', d => d.strokeColor)\n      .append('animateTransform')\n      .attr('attributeName', 'transform')\n      .attr('attributeType', 'XML')\n      .attr('type', 'rotate')\n      .attr('from', d => `0 ${d.size + 5} 0`)\n      .attr('to', d => `360 ${d.size + 5} 0`)\n      .attr('dur', '2s')\n      .attr('repeatCount', 'indefinite');\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Apply new force properties\n      Call this on construct and if forceProperties have changed.\n   */\n  m_UpdateForces() {\n    this.simulation\n      .force(\n        'link',\n        d3\n          .forceLink()\n          .id(d => d.id) // note `d` is an edge, not a node\n          // all edges use the same link distance, charge is what pushes them apart\n          .distance(M_FORCEPROPERTIES.link.distance)\n          .iterations(M_FORCEPROPERTIES.link.iterations)\n      )\n      .force(\n        'charge',\n        d3\n          .forceManyBody()\n          // the larger the node, the harder it pushes\n          .strength(\n            d =>\n              d.size *\n              M_FORCEPROPERTIES.charge.strength *\n              M_FORCEPROPERTIES.charge.enabled\n          )\n          .distanceMin(M_FORCEPROPERTIES.charge.distanceMin)\n          .distanceMax(M_FORCEPROPERTIES.charge.distanceMax)\n      )\n      .force(\n        'collide',\n        d3\n          .forceCollide()\n          .strength(\n            M_FORCEPROPERTIES.collide.strength * M_FORCEPROPERTIES.collide.enabled\n          )\n          // node radius (defaultSize+degrees) + preset radius keeps nodes separated\n          // from each other like bouncing balls\n          .radius(d => d.size + M_FORCEPROPERTIES.collide.radius)\n          .iterations(M_FORCEPROPERTIES.collide.iterations)\n      )\n      .force(\n        'center',\n        d3\n          .forceCenter()\n          .x(m_width * M_FORCEPROPERTIES.center.x)\n          .y(m_height * M_FORCEPROPERTIES.center.y)\n      )\n      .force(\n        'forceX',\n        d3\n          .forceX()\n          .strength(\n            M_FORCEPROPERTIES.forceX.strength * M_FORCEPROPERTIES.forceX.enabled\n          )\n          .x(m_width * M_FORCEPROPERTIES.forceX.x)\n      )\n      .force(\n        'forceY',\n        d3\n          .forceY()\n          .strength(\n            M_FORCEPROPERTIES.forceY.strength * M_FORCEPROPERTIES.forceY.enabled\n          )\n          .y(m_height * M_FORCEPROPERTIES.forceY.y)\n      );\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Update the display positions after each simulation tick\n\n    This tick method is called repeatedly until the layout stabilizes.\n\n    NOTE: the order in which we update nodes and links does NOT determine which\n    gets drawn first -- the drawing order is determined by the ordering in the\n    DOM.  See the notes under link_update.enter() above for one technique for\n    setting the ordering in the DOM.\n   */\n  m_Tick() {\n    // Drawing the nodes: Update the location of each node group element\n    // from the x, y fields of the corresponding node object.\n    this.zoomWrapper.selectAll('.node').attr('transform', d => {\n      return 'translate(' + d.x + ',' + d.y + ')';\n    });\n\n    // Drawing the links: Update the start and end points of each line element\n    // from the x, y fields of the corresponding source and target node objects.\n    this.zoomWrapper\n      .selectAll('.edge')\n      .attr('x1', d => {\n        return d.source.x;\n      })\n      .attr('y1', d => {\n        return d.source.y;\n      })\n      .attr('x2', d => {\n        return d.target.x;\n      })\n      .attr('y2', d => {\n        return d.target.y;\n      });\n  }\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  ZoomReset(data) {\n    if (DBG) console.log(PR, 'ZOOM_RESET got state NCDATA', data);\n    // NOTE: The transition/duration call means _HandleZoom will be called multiple times\n    this.d3svg.transition().duration(200).call(this.zoom.scaleTo, 1);\n  }\n\n  ZoomIn(data) {\n    if (DBG) console.log(PR, 'ZOOM_IN got state NCDATA', data);\n    this.m_Transition(1.2);\n  }\n\n  ZoomOut(data) {\n    if (DBG) console.log(PR, 'ZOOM_OUT got state NCDATA', data);\n    this.m_Transition(0.8);\n  }\n\n  // Pan to 0,0 and zoom scale to 1\n  // (Currently not used)\n  ZoomPanReset(data) {\n    if (DBG) console.log(PR, 'ZOOM_PAN_RESET got state NCDATA', data);\n    const transform = d3.zoomIdentity.translate(0, 0).scale(1);\n    this.d3svg.call(this.zoom.transform, transform);\n  }\n\n  /** This primarily handles mousewheel zooms\n   */\n  m_HandleZoom() {\n    if (DBG) console.log(PR, 'HandleZoom');\n    d3.select('.zoomer').attr('transform', d3.event.transform);\n  }\n  /** This handles zoom button zooms.\n   */\n  m_Transition(zoomLevel) {\n    if (DBG) console.log(PR, 'Transition');\n    this.d3svg\n      .transition()\n      //.delay(100)\n      .duration(200)\n      .call(this.zoom.scaleBy, zoomLevel);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  m_Dragstarted(d, self) {\n    if (DBG) console.log(PR, 'Dragstarted', d.x, d.y);\n    // if (!d3.event.active) self.simulation.alphaTarget(0.3).restart(); // orig value results in a lot of movement after selection\n    if (!d3.event.active) self.simulation.alphaTarget(0.01).restart(); // minimize shift after selection\n    d.fx = d.x;\n    d.fy = d.y;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  m_Dragged(d) {\n    if (DBG) console.log(PR, 'Dragged');\n    d.fx = d3.event.x;\n    d.fy = d3.event.y;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   */\n  m_Dragended(d, self) {\n    if (DBG) console.log(PR, 'Dragended');\n    if (!d3.event.active) self.simulation.alphaTarget(0.0001);\n    d.fx = null;\n    d.fy = null;\n  }\n  // update window size-related forces\n  // d3.select(window).on(\"resize\", (){ =>\n  //     width = +svg.node().getBoundingClientRect().width;\n  //     height = +svg.node().getBoundingClientRect().height;\n  //     updateForces();\n  // });\n} // class NCGraphRenderer\n\n/// EXPORT MODULE /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCGraphRenderer;\n/* Exports should be\n\nDeregister,\nClearSVG,\nSetData,\nUpdateGraph,\nZoomReset\nZoomIn\nZoomOut\nZoomPanReset\n\n*/\n","/* eslint-disable react/no-unescaped-entities */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    Vocabulary displays a list of common terms\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport NCHelpVocabulary from './NCHelpVocabulary';\nimport NCHelpText from './NCHelpText';\nimport URPopover from './URPopover';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCHelpPanel' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst VIEWS = {\n  help: 'Help',\n  vocabulary: 'Vocabulary'\n};\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nfunction NCHelpPanel() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [openTab, setOpenTab] = useState('help');\n\n  useEffect(() => {\n    UDATA.OnAppStateChange('PANELSTATE', evt_ToggleHelp);\n    return () => {\n      UDATA.AppStateChangeOff('PANELSTATE', evt_ToggleHelp);\n    };\n  }, []);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_ToggleHelp(PANELSTATE) {\n    setIsOpen(PANELSTATE.helpIsOpen);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_CloseHelp() {\n    const PANELSTATE = UDATA.AppState('PANELSTATE');\n    UDATA.SetAppState('PANELSTATE', { ...PANELSTATE, helpIsOpen: false });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_SelectTab(tab) {\n    setOpenTab(tab);\n  }\n\n  // COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  let jsx;\n  if (openTab === 'help') {\n    jsx = <NCHelpText />;\n  } else {\n    jsx = <NCHelpVocabulary />;\n  }\n\n  if (!isOpen) return null;\n  return (\n    <URPopover title=\"?\" onClose={ui_CloseHelp}>\n      <div id=\"NCTabPanel\">\n        <div className=\"tabs\" role=\"tablist\">\n          {Object.keys(VIEWS).map(k => (\n            <button\n              key={k}\n              role=\"tab\"\n              className={openTab === k ? 'selected' : ''}\n              aria-selected={openTab === k}\n              aria-controls={k}\n              tabIndex={openTab === k ? '0' : '-1'}\n              onClick={() => ui_SelectTab(k)}\n            >\n              {VIEWS[k]}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"tabpanels\">{jsx}</div>\n      </div>\n    </URPopover>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCHelpPanel;\n","/* eslint-disable react/no-unescaped-entities */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    Help displays a hideable generic help screen.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React from 'react';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nfunction NCHelpText() {\n  return (\n    <div id=\"NCHelpText\">\n      <h1>Why Net.Create</h1>\n      <p>\n        In Net.Create, users can simultaneously do data entry on nodes and the edges\n        between them.\n      </p>\n      <h1>Navigation</h1>\n      <ul>\n        <li>Recenter the graph -- press the * button</li>\n        <li>\n          Zoom --\n          <ul>\n            <li>on screen -- use the +/- buttons</li>\n            <li>mouse -- use mousewheel</li>\n            <li>trackpad -- two fingers up/down</li>\n            <li>tablet -- two fingers pinch</li>\n          </ul>\n        </li>\n        <li>Pan -- drag empty space</li>\n      </ul>\n      <h1>Nodes</h1>\n      <ul>\n        <li>\n          Select -- Click on a node, or start typing the node label in the Label field\n          and select a node from the suggestions.'\n        </li>\n      </ul>\n      <h1>Edges</h1>\n      <ul>\n        <li>\n          Create -- To create an edge, first select the source node, then click \"Add\n          New Edge\".\n        </li>\n        <li>\n          Select -- To select an edge, select either of the nodes it is attached to.\n        </li>\n        <li>\n          Editing -- To change the source or target of an existing edge, delete it and\n          create a new one.\n        </li>\n        <li>\n          View Full List -- Click on \"Show Edge Table\" to view a table of all the\n          edges. Click on a column header to sort the table by that parameter.\n        </li>\n      </ul>\n      <h1>About Net.Create</h1>\n      <p>\n        Net.Create is funded through the{' '}\n        <a\n          href=\"https://www.nsf.gov/pubs/policydocs/pappguide/nsf09_1/gpg_2.jsp#IID2\"\n          target=\"NSF\"\n        >\n          EAGER program\n        </a>{' '}\n        at{' '}\n        <a href=\"https://www.nsf.gov/\" target=\"NSF\">\n          NSF\n        </a>{' '}\n        under award #\n        <a\n          href=\"https://www.nsf.gov/awardsearch/showAward?AWD_ID=1848655\"\n          target=\"NSF\"\n        >\n          1848655\n        </a>\n        .{' '}\n        <a href=\"http://www.kalanicraig.com\" target=\"Craig\">\n          Kalani Craig\n        </a>{' '}\n        is the PI, with Co-PIs{' '}\n        <a href=\"http://www.joshuadanish.com\" target=\"Danish\">\n          Joshua Danish\n        </a>{' '}\n        and{' '}\n        <a\n          href=\"https://education.indiana.edu/about/directory/profiles/hmelo-silver-cindy.html\"\n          target=\"Hmelo-Silver\"\n        >\n          Cindy Hmelo-Silver\n        </a>\n        . Software development provided by{' '}\n        <a href=\"http://inquirium.net\" target=\"Inquirium\">\n          Inquirium\n        </a>\n        . For more information, see{' '}\n        <a href=\"http://netcreate.org\" target=\"NetCreateOrg\">\n          Net.Create.org\n        </a>\n      </p>\n    </div>\n  );\n} // class Help\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCHelpText;\n","/* eslint-disable react/no-unescaped-entities */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    Vocabulary displays a list of common terms\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React from 'react';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nfunction NCVocabulary() {\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <div id=\"NCVocabulary\">\n      <dl>\n        <dt>Network</dt>\n        <dd>This is a collection of nodes and the edges between them. </dd>\n\n        <dt>Graph</dt>\n        <dd>\n          a graphic representation of a network and its components.{' '}\n          <em>\n            <strong>Similar terms include:</strong> sociogram, visualization\n          </em>\n        </dd>\n\n        <dt>Node</dt>\n        <dd>\n          The thing or <em>entity</em> (shown as circles) that is connected through\n          relationships. This could be individual people, groups of people,\n          institutions (like churches, organizations, schools). One way of thinking\n          about this is that nodes are nouns and edges are verbs - nodes are things\n          that are connected through edges.{' '}\n          <em>\n            <strong>Similar terms include:</strong> actor, vertex\n          </em>\n        </dd>\n        <ul>\n          <dl>\n            <dt>Ego</dt>\n            <dd>\n              This refers to the node you are focused on at the moment and the\n              connections that they have.{' '}\n            </dd>\n          </dl>\n        </ul>\n\n        <dt>Edge</dt>\n        <dd>\n          The relationships between nodes you are considering (shown as lines).\n          Relationships can take on many forms: nodes could be connected through\n          somewhat intangible relationships, such as friendship or not liking one\n          another. Edges can be based on interactions, such as talking to one another\n          or being in conflict. They could also be defined by sharing resources, such\n          as money or information.{' '}\n          <em>\n            <strong>Similar terms include:</strong> line, tie, arc\n          </em>\n        </dd>\n\n        <ul>\n          <dl>\n            <dt>Edge weight</dt>\n            <dd>\n              Edges can have a value attached to them. So, for instance, an node could\n              sent $10,000 to another actor. Or, they could share three interactions\n              of the same type with one another. This value is referred to as a\n              weight.{' '}\n              <em>\n                <strong>Similar terms include:</strong> value\n              </em>\n            </dd>\n\n            <dt>Directed or undirected edges</dt>\n            <dd>\n              Edges can either be directed or undirected. If a relationship is\n              directed, it is being sent from (originating from) one node to another\n              node. Node A may say they are friends with Node B, but Node B does not\n              say Node A does this. Or Node A gives Node B something, such as\n              resources, information, or an illness. However, in some cases, edges are\n              defined as undirected. Two people who share a meal together or are\n              married are both engaged share an undirected edge.{' '}\n              <em>\n                Note: in some academic literatures, the term \"edge\" is reserved for an\n                undirected relationship, while the term \"arc\" is used to refer to\n                directed ties.\n              </em>\n            </dd>\n          </dl>\n        </ul>\n\n        <dt>Attributes</dt>\n        <dd>\n          Characteristics of the nodes or edges. A node could be designated by gender,\n          for instance or the amount of wealth they possess. They could also be\n          characteristics you find from the network itself - such as how many ties an\n          node has (degree centrality).{' '}\n        </dd>\n\n        <dt>Centrality</dt>\n        <dd>\n          This is a way of ranking the importance of individuals within a network.\n          There are many different ways to measure importance, such as degree\n          centrality, betweenness centrality, and eigenvector centrality.{' '}\n        </dd>\n        <ul>\n          {' '}\n          <dl>\n            <dt>Degree Centrality</dt>\n            <dd>\n              Degree centrality is a measure of how many connections a node has. An\n              node with many ties that are being sent to them has a high in-degree\n              centrality. In a friendship network, this can be easily recognized as\n              popularity. Nodes sending many outgoing ties (high out-degree\n              centrality) may be thought of as expansive in their relationship.\n            </dd>\n\n            <dt>Betweenness Centrality</dt>\n            <dd>\n              Nodes with high betweenness centrality serve as connectors between other\n              individuals who wouldn't otherwise be directly connected. They may not\n              be connected to a large number of people (that would be high degree\n              centrality), but they are unique in their connections. If an actor with\n              high betweenness centrality was removed from a network, the network\n              would be more fragmented and less connected. Often researchers are\n              interested in finding actors with high betweenness centrality because\n              they can control whatever flows in the networks. For instance, military\n              analysts often look for nodes with high betweenness in a terrorist\n              network.\n            </dd>\n\n            <dt>Eigenvector Centrality</dt>\n            <dd>\n              Eigenvector centrality ranks actors based on their connection to other\n              highly central nodes. So, a nodes importance as measured by eigenvector\n              centrality are dependent on the other nodes with whom they share\n              connections. Google's PageRank algorithm was a famous application of a\n              version of this type of centrality, and allowed them to return highly\n              relevant results in search for users.\n            </dd>\n          </dl>\n        </ul>\n\n        <dt>Communities</dt>\n        <dd>\n          A community in a network is a way of thinking about grouping, often by\n          finding densely connected sets of nodes. A community within a network that\n          is tightly connected to one another but not to an outside group might be\n          seen as a faction, such as rival political groups. In this case, nodes with\n          high betweenness centrality in a network with multiple factions might be\n          some of the only points of contact between rival groups - a potentially\n          powerful but also difficult position to be in.\n        </dd>\n      </dl>\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCVocabulary;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n  Provides tools to import and export node/edge data files.\n\n  This also provides a \"Force Unlock All\" button that can be used by Admins\n  to unlock all edit locks requested by node editors, edge editors, template\n  editors, and importers on the network.\n\n  This displays a subpanel on the \"More...\" tab.\n\n\n  ## PRIVILEGES\n\n  There are two levels of privileges for this panel:\n  - Admins\n  - Logged in users with \"allowLoggedInUserToImport\" set to true\n\n  Only admins are allowed to\n  - import data (nodes/edges)\n  - export templates\n  - import templates\n  This is set via an `isAdmin` prop.\n\n  Logged in users with \"allowLoggedInUserToImport\" set to true are allowed to\n  - import data (nodes/edges)\n\n\n  ## USAGE\n\n    <NCImportExport isAdmin={isAdmin} />\n\n\n  `importexport-mgr.js` (IMPORTEXPORT) handles all of the business logic for\n  importing and exporting.  See that file for details.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst SETTINGS = require('settings');\nconst NetMessage = require('unisys/common-netmessage-class');\n\nconst UNISYS = require('unisys/client');\nconst DATASTORE = require('system/datastore');\nconst { EDITORTYPE } = require('system/util/enum');\n\nconst IMPORTEXPORT = require('../importexport-mgr');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'ImportExport';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst NODEFILESTATUS_DEFAULT = 'Select a node .csv file to import';\nconst EDGEFILESTATUS_DEFAULT = 'Select an edge .csv file to import';\nconst IMPORTTYPE = {\n  MERGE: 'merge',\n  REPLACE: 'replace'\n};\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NCImportExport extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n    const TEMPLATE = this.AppState('TEMPLATE');\n    this.state = {\n      isExpanded: true,\n      preventImport: false, // an external source has disabled import for us\n      importIsActive: false, // internal source: keeps track of whether THIS panel has valid import files selected\n      nodefileStatus: NODEFILESTATUS_DEFAULT,\n      nodeValidationMsgs: undefined,\n      nodeOkToImport: false,\n      edgefileStatus: EDGEFILESTATUS_DEFAULT,\n      edgeValidationMsgs: undefined,\n      edgeOkToImport: false,\n      okToImport: false,\n      importMsgs: undefined,\n      allowLoggedInUserToImport: TEMPLATE.allowLoggedInUserToImport\n    };\n    this.checkUnload = this.checkUnload.bind(this);\n    this.doUnload = this.doUnload.bind(this);\n    this.urstate_LOCKSTATE = this.urstate_LOCKSTATE.bind(this);\n    this.updateEditState = this.updateEditState.bind(this);\n    this.onNodesExportSelect = this.onNodesExportSelect.bind(this);\n    this.onEdgesExportSelect = this.onEdgesExportSelect.bind(this);\n    this.onNodeImportFileSelect = this.onNodeImportFileSelect.bind(this);\n    this.onEdgeImportFileSelect = this.onEdgeImportFileSelect.bind(this);\n    this.clearNodefileSelect = this.clearNodefileSelect.bind(this);\n    this.clearEdgefileSelect = this.clearEdgefileSelect.bind(this);\n    this.clearFileSelect = this.clearFileSelect.bind(this);\n    this.onDoImport = this.onDoImport.bind(this);\n    this.unlockAll = this.unlockAll.bind(this);\n\n    this.OnAppStateChange('LOCKSTATE', this.urstate_LOCKSTATE);\n  } // constructor\n\n  componentDidMount() {\n    this.updateEditState();\n    window.addEventListener('beforeunload', this.checkUnload);\n    window.addEventListener('unload', this.doUnload);\n  }\n\n  componentWillUnmount() {\n    this.NetSend('SRV_RELEASE_EDIT_LOCK', { editor: EDITORTYPE.IMPORTER });\n    this.AppStateChangeOff('LOCKSTATE', this.urstate_LOCKSTATE);\n    window.removeEventListener('beforeunload', this.checkUnload);\n    window.removeEventListener('unload', this.doUnload);\n  }\n\n  checkUnload(e) {\n    e.preventDefault();\n    if (this.state.importIsActive) {\n      (e || window.event).returnValue = null;\n    } else {\n      Reflect.deleteProperty(e, 'returnValue');\n    }\n    return e;\n  }\n\n  doUnload(e) {\n    if (this.state.importIsActive) {\n      this.NetSignal('SRV_RELEASE_EDIT_LOCK', { editor: EDITORTYPE.IMPORTER });\n    }\n  }\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  urstate_LOCKSTATE(LOCKSTATE) {\n    const { importIsActive } = this.state;\n    if (!importIsActive) {\n      const preventImport =\n        LOCKSTATE.templateBeingEdited ||\n        LOCKSTATE.importActive ||\n        LOCKSTATE.nodeOrEdgeBeingEdited ||\n        UNISYS.IsStandaloneMode();\n      this.setState({ preventImport });\n    }\n  }\n\n  updateEditState() {\n    // disable edit if someone else is editing a template, node, or edge\n    this.urstate_LOCKSTATE(this.AppState('LOCKSTATE'));\n    // REVIEW: Reduce setState calls?\n    DATASTORE.PromiseCalculateMaxNodeId().then(data => {\n      this.setState({ nextNodeId: data + 1 });\n    });\n    DATASTORE.PromiseCalculateMaxEdgeId().then(data => {\n      this.setState({ nextEdgeId: data + 1 });\n    });\n  }\n\n  onNodesExportSelect() {\n    IMPORTEXPORT.ExportNodes();\n  }\n  onEdgesExportSelect() {\n    IMPORTEXPORT.ExportEdges();\n  }\n\n  onNodeImportFileSelect(e) {\n    const nodefile = e.target.files[0];\n    IMPORTEXPORT.NodefileValidate({ nodefile }).then(result => {\n      const msg = (\n        <div>\n          <div>{result.messageTitle}</div>\n          {result.messageJsx}\n        </div>\n      );\n      // if edge file was already okToImport, then this remains OK.\n      const okToImport = this.state.edgeOkToImport || result.isValid;\n      this.setState({\n        nodeOkToImport: result.isValid,\n        okToImport,\n        nodefileStatus: result.isValid ? 'Ready to Import' : NODEFILESTATUS_DEFAULT,\n        nodeValidationMsgs: msg,\n        importMsgs: undefined\n      });\n      // Clear \"Choose File\"\n      if (!result.isValid) document.getElementById('nodefileInput').value = '';\n    });\n  }\n  onEdgeImportFileSelect(e) {\n    const edgefile = e.target.files[0];\n    IMPORTEXPORT.EdgefileValidate({ edgefile }).then(result => {\n      const msg = (\n        <div>\n          <div>{result.messageTitle}</div>\n          {result.messageJsx}\n        </div>\n      );\n      // if edge file was already okToImport, then this remains OK.\n      const okToImport = this.state.nodeOkToImport || result.isValid;\n      this.setState({\n        edgeOkToImport: result.isValid,\n        okToImport,\n        edgefileStatus: result.isValid ? 'Ready to Import' : EDGEFILESTATUS_DEFAULT,\n        edgeValidationMsgs: msg,\n        importMsgs: undefined\n      });\n      // Clear \"Choose File\"\n      if (!result.isValid) document.getElementById('edgefileInput').value = '';\n    });\n  }\n\n  clearNodefileSelect() {\n    // User Cancelled, reset to default\n    // If edge import is active, then import remains active\n    const importIsActive = this.state.importIsActive || false;\n    this.setState({\n      importIsActive,\n      nodefile: undefined,\n      nodefileStatus: NODEFILESTATUS_DEFAULT,\n      nodeValidationMsgs: undefined\n    });\n    // Clear validated data so it doesn't get imported\n    if (!importIsActive)\n      this.NetSend('SRV_RELEASE_EDIT_LOCK', { editor: EDITORTYPE.IMPORTER });\n    IMPORTEXPORT.ResetNodeImportData();\n  }\n\n  clearEdgefileSelect() {\n    // User Cancelled, reset to default\n    // If node import is active, then import remains active\n    const importIsActive = this.state.importIsActive || false;\n    this.setState({\n      importIsActive,\n      edgefile: undefined,\n      edgefileStatus: EDGEFILESTATUS_DEFAULT,\n      edgeValidationMsgs: undefined\n    });\n    // Clear validated data so it doesn't get imported\n    if (!importIsActive)\n      this.NetSend('SRV_RELEASE_EDIT_LOCK', { editor: EDITORTYPE.IMPORTER });\n    IMPORTEXPORT.ResetEdgeImportData();\n  }\n\n  clearFileSelect() {\n    // User Cancelled, reset to default\n    this.NetSend('SRV_RELEASE_EDIT_LOCK', { editor: EDITORTYPE.IMPORTER });\n    document.getElementById('nodefileInput').value = '';\n    document.getElementById('edgefileInput').value = '';\n    this.clearNodefileSelect();\n    this.clearEdgefileSelect();\n\n    IMPORTEXPORT.ResetImportData();\n    this.setState({\n      nodeValidationMsgs: undefined,\n      edgeValidationMsgs: undefined,\n      importMsgs: undefined\n    });\n  }\n\n  onDoImport() {\n    if (DBG) console.log(PR, 'onDoImport');\n    const replace = document.getElementById('import-replace').checked;\n    IMPORTEXPORT.Import(replace).then(result => {\n      this.setState({\n        okToImport: false, // imported, so hide \"Import\" button\n        nodeOkToImport: false,\n        edgeOkToImport: false,\n        importMsgs: result.messageJsx || 'OK',\n        nodeValidationMsgs: '',\n        edgeValidationMsgs: '',\n        nodefileStatus: NODEFILESTATUS_DEFAULT,\n        edgefileStatus: EDGEFILESTATUS_DEFAULT\n      });\n      document.getElementById('nodefileInput').value = '';\n      document.getElementById('edgefileInput').value = '';\n    });\n  }\n\n  unlockAll() {\n    this.NetCall('SRV_DBUNLOCKALL');\n  }\n\n  /// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  render() {\n    const {\n      preventImport,\n      importIsActive,\n      nodefileStatus,\n      edgefileStatus,\n      importMsgs,\n      allowLoggedInUserToImport,\n      nextNodeId,\n      nextEdgeId,\n      nodeValidationMsgs,\n      edgeValidationMsgs,\n      okToImport\n    } = this.state;\n    const { isAdmin } = this.props;\n\n    // Set Import Permissions\n    // -- Admins can always import\n    // -- If allowLoggedInUserToImport, logged in users can also import\n    const isLoggedIn = NetMessage.GlobalGroupID();\n    const importDisabled = !(isAdmin || (allowLoggedInUserToImport && isLoggedIn));\n    const importBtnDisabled = !okToImport;\n\n    const exportjsx = (\n      <div className=\"panel\">\n        <h1>Export Data</h1>\n        <p className=\"system\">Export data in .csv format.</p>\n        <div className=\"buttonbar\">\n          <button className=\"small\" type=\"button\" onClick={this.onNodesExportSelect}>\n            Export Nodes\n          </button>\n          <button className=\"small\" type=\"button\" onClick={this.onEdgesExportSelect}>\n            Export Edges\n          </button>\n        </div>\n      </div>\n    );\n\n    let importjsx;\n    if (preventImport && !importIsActive) {\n      importjsx = (\n        <div className=\"panel\">\n          <p>\n            <i>\n              You cannot import data while someone is editing a node, edge, or\n              template, or in standalone view.\n            </i>\n          </p>\n          <p>\n            <i>Please finish editing and try again.</i>\n          </p>\n        </div>\n      );\n    } else {\n      importjsx = (\n        <div className=\"panel\" hidden={importDisabled}>\n          <h1>Import Data</h1>\n          <p className=\"system\">Import .csv data</p>\n          <p>\n            To specify node and edge IDs in your import file, use the next unused ID:\n          </p>\n          <ul>\n            <li>Next unused NODE ID: {nextNodeId}</li>\n            <li>Next unused EDGE ID: {nextEdgeId}</li>\n          </ul>\n          <p> </p>\n          <h2>Replace vs Merge</h2>\n          <fieldset>\n            <label>\n              <input\n                id=\"import-replace\"\n                type=\"radio\"\n                name=\"importtype\"\n                value={IMPORTTYPE.REPLACE}\n                defaultChecked\n              />\n              Replace\n            </label>\n            <div>\n              <p>\n                {' '}\n                <b>Replace</b> existing nodes and edges. Use this to <b>load</b> a new\n                project\n              </p>\n              <ul>\n                <li>Existing objects will be removed</li>\n              </ul>\n            </div>\n            <label>\n              <input\n                id=\"import-merge\"\n                type=\"radio\"\n                name=\"importtype\"\n                value={IMPORTTYPE.MERGE}\n              />\n              Merge\n            </label>\n            <div>\n              <p>\n                <b>Merge</b> the new nodes and edges into the existing nodes and\n                edges. Use this to add additional data to an existing project.\n              </p>\n              <ul>\n                <li>\n                  Imported nodes/edges with matching ids will replace existing objects\n                </li>\n                <li>\n                  Existing objects that do not match imported nodes/edges will not be\n                  modified or removed\n                </li>\n              </ul>\n            </div>\n          </fieldset>\n          <p></p>\n          <h2>Nodes</h2>\n          <div className=\"file-import\">\n            <input\n              type=\"file\"\n              accept=\"text/csv\"\n              id=\"nodefileInput\"\n              onInput={this.onNodeImportFileSelect}\n              onClick={e => {\n                // Clear the selected node file whenever \"Choose File\" is clicked so that if the user\n                // cancels, the form is reset to a blank state.  This is necessary to clear out\n                // validation errors after selecting a bad node file.\n                this.clearNodefileSelect();\n              }}\n            />\n            <label htmlFor=\"nodefileInput\" className=\"system\">\n              {nodefileStatus}\n            </label>\n          </div>\n          <h2>Edges</h2>\n          <div className=\"file-import\">\n            <input\n              type=\"file\"\n              accept=\"text/csv\"\n              id=\"edgefileInput\"\n              onInput={this.onEdgeImportFileSelect}\n              onClick={e => {\n                // Clear the selected edge file whenever \"Choose File\" is clicked so that if the user\n                // cancels, the form is reset to a blank state.  This is necessary to clear out\n                // validation errors after selecting a bad edge file.\n                this.clearEdgefileSelect();\n              }}\n            />\n            <label htmlFor=\"edgefileInput\" className=\"system\">\n              {edgefileStatus}\n            </label>\n          </div>\n          {okToImport && (\n            <div className=\"buttonbar importbuttons\">\n              <button\n                className={`small ${importBtnDisabled ? '' : 'cat'}`}\n                type=\"button\"\n                disabled={importBtnDisabled}\n                onClick={this.onDoImport}\n              >\n                Import\n              </button>\n              <label>\n                <button\n                  className=\"small\"\n                  type=\"button\"\n                  onClick={this.clearFileSelect}\n                >\n                  Clear File Selections\n                </button>\n              </label>\n            </div>\n          )}\n          <fieldset className=\"validationMessages\">\n            <legend>Import Status</legend>\n            {nodeValidationMsgs && <div>{nodeValidationMsgs}</div>}\n            {edgeValidationMsgs && <div>{edgeValidationMsgs}</div>}\n            {importMsgs && <div>{importMsgs}</div>}\n          </fieldset>\n        </div>\n      );\n    }\n\n    let unlockAlljsx;\n    if (isAdmin) {\n      unlockAlljsx = (\n        <div className=\"panel\">\n          <h1>Admin Tools</h1>\n          <p>Unlock ALL Template, Import, Node, and Edge Editing.</p>\n          <p>\n            When someone on the network is editing a template, importing data, or\n            editing a node or edge, everyone else on the network is prevented from\n            editing a template or importing data and editing nodes and edges.\n          </p>\n          <p>\n            ADMINS: Use this force the server to release the lock on editing if you\n            know the lock was left on in error, e.g. you know that there is no one on\n            the network actively editing a template, importing, editing a node or an\n            edge.\n          </p>\n          <p>\n            <b>WARNING</b>: Use this with utmost caution! If someone is actively\n            editing or importing, you can delete their work, or even worse,{' '}\n            <b>corrupt the database!</b>\n          </p>\n          <button className=\"small warning\" type=\"button\" onClick={this.unlockAll}>\n            Force Unlock All\n          </button>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"NCImportExport\">\n        {exportjsx}\n        {importjsx}\n        {unlockAlljsx}\n      </div>\n    );\n  }\n} // class Help\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCImportExport;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n  InfoPanel shows a tab panel for selecting:\n  * hiding (showing the Graph)\n  * Filters\n  * Nodes Table\n  * Edges Table\n\n  The panel itself can be resized vertically.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport UNISYS from 'unisys/client';\nimport NCFiltersSummary from './NCFiltersSummary';\nimport NCNodeTable from './NCNodeTable';\nimport NCEdgeTable from './NCEdgeTable';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCInfoPanel' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst TABS = {\n  GRAPH: { label: 'Graph', icon: 'images/icn_graph.svg' },\n  NODESTABLE: { label: 'Nodes Table', icon: 'images/icn_attributes.svg' },\n  EDGESTABLE: { label: 'Edges Table', icon: 'images/icn_edges.svg' }\n};\nconst defaultClosedTabPanelHeight = 65; // show only tab buttons, no gap, max 2 lines\nconst defaultOpenTabPanelHeight = 350; // show tab buttons and table\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCInfoPanel() {\n  const [state, setState] = useState({\n    activeTab: TABS.GRAPH.label,\n    infoPanelTop: 0,\n    tabpanelHeight: defaultClosedTabPanelHeight,\n    prevNodeTableHeight: 0,\n    prevEdgeTableHeight: 0,\n    draggerIsHidden: true\n  });\n  const ref_InfoPanel = useRef(null);\n  const ref_Dragger = useRef(null);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    if (ref_InfoPanel.current) {\n      setState(prevState => ({\n        ...prevState,\n        infoPanelTop: ref_InfoPanel.current.offsetTop\n      }));\n    }\n  }, []);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_SelectTab(tabkey) {\n    let tabpanelHeight = defaultClosedTabPanelHeight;\n    let draggerIsHidden = true;\n\n    if (tabkey === 'NODESTABLE') {\n      tabpanelHeight = state.prevNodeTableHeight || defaultOpenTabPanelHeight;\n      draggerIsHidden = false;\n    } else if (tabkey === 'EDGESTABLE') {\n      tabpanelHeight = state.prevEdgeTableHeight || defaultOpenTabPanelHeight;\n      draggerIsHidden = false;\n    }\n\n    UpdateMaxTableHeight(TABS[tabkey].label);\n\n    setState(prevState => ({\n      ...prevState,\n      activeTab: TABS[tabkey].label,\n      tabpanelHeight,\n      draggerIsHidden\n    }));\n  }\n\n  /// DRAGGER HANDLERS ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Update max table height whenever the active tab changes\n  function UpdateMaxTableHeight(activeTab) {\n    const maxTableHeight =\n      state.infoPanelTop +\n      80 +\n      (activeTab === TABS.NODESTABLE.label\n        ? document.querySelector('#NCNodeTable .URTable').offsetHeight\n        : document.querySelector('#NCEdgeTable .URTable').offsetHeight);\n    ref_Dragger.current = {\n      ...ref_Dragger.current,\n      maxTableHeight\n    };\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_MouseDown(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    const draggerClickOffset = event.target.offsetTop - event.clientY;\n    const maxTableHeight =\n      state.infoPanelTop +\n      draggerClickOffset +\n      80 +\n      (state.activeTab === TABS.NODESTABLE.label\n        ? document.querySelector('#NCNodeTable .URTable').offsetHeight\n        : document.querySelector('#NCEdgeTable .URTable').offsetHeight);\n\n    ref_Dragger.current = {\n      startY: event.clientY,\n      draggerTop: event.target.offsetTop,\n      draggerClickOffset,\n      maxTableHeight\n    };\n    document.onmousemove = ui_MouseMove;\n    document.onmouseup = ui_MouseUp;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_MouseMove(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (ref_Dragger.current !== null) {\n      const { startY, draggerTop, draggerClickOffset, maxTableHeight } =\n        ref_Dragger.current;\n      const tabpanelHeight = Math.min(\n        maxTableHeight,\n        Math.max(\n          120, // make sure one row is visible\n          event.clientY - state.infoPanelTop - draggerClickOffset\n        )\n      );\n      let { prevNodeTableHeight, prevEdgeTableHeight } = state;\n      if (state.activeTab === TABS.NODESTABLE.label) {\n        prevNodeTableHeight = tabpanelHeight;\n      } else if (state.activeTab === TABS.EDGESTABLE.label) {\n        prevEdgeTableHeight = tabpanelHeight;\n      }\n      setState(prevState => ({\n        ...prevState,\n        tabpanelHeight,\n        prevNodeTableHeight,\n        prevEdgeTableHeight\n      }));\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_MouseUp() {\n    ref_Dragger.current = null;\n    document.onmouseup = null;\n    document.onmousemove = null;\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// NOTE: The `id=graph` tabpanel needs to be defined for wcag compliance\n  ///       but it is hidden and not used.\n  return (\n    <div\n      id=\"InfoPanel\"\n      ref={ref_InfoPanel}\n      style={\n        state.activeTab === TABS.GRAPH.label\n          ? {}\n          : { height: `${state.tabpanelHeight}px` }\n      }\n    >\n      <div className=\"graphtitle\">\n        <div className=\"tooltipAnchor\">\n          NETGRAPH for {UDATA.AppState('TEMPLATE').name}&nbsp;\n          <div className=\"badge\">i</div>\n          <span style={{ fontSize: '12px' }} className=\"tooltiptext\">\n            {UDATA.AppState('TEMPLATE').description}\n          </span>\n        </div>\n      </div>\n\n      <div className=\"tabs\" role=\"tablist\">\n        {Object.keys(TABS).map(k => (\n          <button\n            key={k}\n            id={k}\n            className={state.activeTab === TABS[k].label ? 'selected' : ''}\n            onClick={() => evt_SelectTab(k)}\n            role=\"tab\"\n            type=\"button\"\n            aria-selected={state.activeTab === TABS[k].label}\n            aria-controls={TABS[k].label}\n          >\n            {TABS[k].label}\n            {TABS[k].icon && <img src={TABS[k].icon} role=\"presentation\" />}\n          </button>\n        ))}\n      </div>\n\n      <NCFiltersSummary />\n\n      <div className=\"tabpanels\">\n        <section id={TABS.GRAPH.label} className=\"hidden\" role=\"tabpanel\" />\n\n        <section\n          id={TABS.NODESTABLE.label}\n          aria-labelledby=\"NODESTABLE\"\n          role=\"tabpanel\"\n          className={state.activeTab !== TABS.NODESTABLE.label ? 'hidden' : ''}\n        >\n          <NCNodeTable isOpen={state.activeTab === TABS.NODESTABLE.label} />\n        </section>\n\n        <section\n          id={TABS.EDGESTABLE.label}\n          aria-labelledby=\"EDGESTABLE\"\n          role=\"tabpanel\"\n          className={state.activeTab !== TABS.EDGESTABLE.label ? 'hidden' : ''}\n        >\n          <NCEdgeTable isOpen={state.activeTab === TABS.EDGESTABLE.label} />\n        </section>\n      </div>\n\n      <div className=\"bottombar\">\n        <div\n          id=\"dragger\"\n          hidden={state.draggerIsHidden}\n          onMouseDown={ui_MouseDown}\n        ></div>\n      </div>\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCInfoPanel;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Prototype Simple NetCreate Node Editor\n\n  Built for Version 2.0 ITEST.\n\n  Provides a viewer and editor for the currently selected node.\n\n  USAGE\n\n    <NCNode />\n\n  Main changes for 2.0:\n  * Node data is made up of built-in parameters (e.g. label, provenance),\n    and arbitrary custom parameters defined via the template.  This Node\n    editor can support wide variety of data.\n\n  DATA UPDATES\n  * Updates are triggered mostly by:\n    1.  SELECTION state updates when nodes and edges change\n    2.  PERMISSION state updates when locks are set and released.\n\n  Data is currently in a transitional state.\n  Currently all properties are saved in a flat list.\n  Eventually we might want to differentiate between\n  built-in properties (e.g. id, created), and template-defined custom\n  `attributes`.  There is an awkward translation between these two\n  representations during data load, update, and save.\n\n\n  PERMISSIONS\n  Editting is restricted by:\n  * User must be logged in\n  * Template is not being edited\n  * Data is not being imported\n  * Someone else is not editing the node (and has placed a lock on it)\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\nconst EDGEMGR = require('../edge-mgr'); // handles edge synthesis\nconst LOCKMGR = require('../lock-mgr');\nconst CMTMGR = require('../comment-mgr');\nconst { BUILTIN_FIELDS_NODE } = require('system/util/enum');\nconst { EDGE_NOT_SET_LABEL, ARROW_RIGHT } = require('system/util/constant');\nconst NCLOGIC = require('../nc-logic');\nconst NCUI = require('../nc-ui');\nconst NCEdge = require('./NCEdge');\nconst NCDialogCitation = require('./NCDialogCitation');\nconst SETTINGS = require('settings');\nimport URCommentVBtn from './URCommentVBtn';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCNode';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// const isAdmin = SETTINGS.IsAdmin();\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst TABS = {\n  // Also used as labels\n  ATTRIBUTES: 'ATTRIBUTES',\n  EDGES: 'EDGES',\n  PROVENANCE: 'PROVENANCE'\n};\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NCNode extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isLoggedIn: false,\n      isAdmin: false\n    }; // initialized on componentDidMount and clearSelection\n\n    // STATE MANAGEMENT\n    this.ResetState = this.ResetState.bind(this);\n    this.urstate_SESSION = this.urstate_SESSION.bind(this);\n    this.urstate_LOCKSTATE = this.urstate_LOCKSTATE.bind(this);\n    this.urstate_NCDATA = this.urstate_NCDATA.bind(this);\n    this.urstate_PERMISSIONS = this.urstate_PERMISSIONS.bind(this);\n    this.IsLoggedIn = this.IsLoggedIn.bind(this);\n    this.DerivePermissions = this.DerivePermissions.bind(this);\n\n    // EVENT HANDLERS\n    this.CheckUnload = this.CheckUnload.bind(this);\n    this.DoUnload = this.DoUnload.bind(this);\n    this.ClearSelection = this.ClearSelection.bind(this);\n    this.urstate_SELECTION = this.urstate_SELECTION.bind(this);\n    this.SelectEdgeAndEdit = this.SelectEdgeAndEdit.bind(this);\n    this.SelectEdge = this.SelectEdge.bind(this);\n    this.DeselectEdge = this.DeselectEdge.bind(this);\n    // DATA LOADING\n    this.LoadNode = this.LoadNode.bind(this);\n    this.FindLinkedEdges = this.FindLinkedEdges.bind(this);\n    this.LoadAttributes = this.LoadAttributes.bind(this);\n    this.UnlockNode = this.UnlockNode.bind(this);\n    // DATA SAVING\n    this.SaveNode = this.SaveNode.bind(this);\n    this.DeleteNode = this.DeleteNode.bind(this);\n    // HELPER METHODS\n    this.LookupBackgroundColor = this.LookupBackgroundColor.bind(this);\n    this.FindMatchingList = this.FindMatchingList.bind(this);\n    // UI HANDLERS\n    this.UISelectTab = this.UISelectTab.bind(this);\n    this.UIRequestEditNode = this.UIRequestEditNode.bind(this);\n    this.UIReplacementNodeIdUpdate = this.UIReplacementNodeIdUpdate.bind(this);\n    this.UIAddEdge = this.UIAddEdge.bind(this);\n    this.UIEnableEditMode = this.UIEnableEditMode.bind(this);\n    this.UICancelEditMode = this.UICancelEditMode.bind(this);\n    this.UIDisableEditMode = this.UIDisableEditMode.bind(this);\n    this.UIInputUpdate = this.UIInputUpdate.bind(this);\n    this.UIProvenanceInputUpdate = this.UIProvenanceInputUpdate.bind(this);\n    this.UILabelInputUpdate = this.UILabelInputUpdate.bind(this);\n    this.UIViewEdge = this.UIViewEdge.bind(this);\n    this.UIEditEdge = this.UIEditEdge.bind(this);\n    this.UICitationShow = this.UICitationShow.bind(this);\n    this.UICitationClose = this.UICitationClose.bind(this);\n    // RENDERERS -- Main\n    this.RenderView = this.RenderView.bind(this);\n    this.RenderEdit = this.RenderEdit.bind(this);\n    // RENDER HELPERS\n    this.RenderEdgesTab = this.RenderEdgesTab.bind(this);\n\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// REGISTER LISTENERS\n    this.OnAppStateChange('SESSION', this.urstate_SESSION);\n    this.OnAppStateChange('NCDATA', this.urstate_NCDATA);\n    this.OnAppStateChange('SELECTION', this.urstate_SELECTION);\n    this.OnAppStateChange('LOCKSTATE', this.urstate_LOCKSTATE);\n    this.OnAppStateChange('PERMISSIONS', this.urstate_PERMISSIONS);\n    this.HandleMessage('NODE_EDIT', this.UIRequestEditNode); // Node Table request\n    this.HandleMessage('EDGE_SELECT_AND_EDIT', this.SelectEdgeAndEdit);\n    this.HandleMessage('EDGE_SELECT', this.SelectEdge);\n    this.HandleMessage('EDGE_DESELECT', this.DeselectEdge);\n  }\n\n  componentDidMount() {\n    this.ResetState(); // Initialize State\n    window.addEventListener('beforeunload', this.CheckUnload);\n    window.addEventListener('unload', this.DoUnload);\n  }\n  componentWillUnmount() {\n    this.AppStateChangeOff('SESSION', this.urstate_SESSION);\n    this.AppStateChangeOff('NCDATA', this.urstate_NCDATA);\n    this.AppStateChangeOff('SELECTION', this.urstate_SELECTION);\n    this.AppStateChangeOff('LOCKSTATE', this.urstate_LOCKSTATE);\n    this.AppStateChangeOff('PERMISSIONS', this.urstate_PERMISSIONS);\n    this.DropMessage('NODE_EDIT', this.UIRequestEditNode);\n    this.DropMessage('EDGE_SELECT_AND_EDIT', this.SelectEdgeAndEdit);\n    this.DropMessage('EDGE_SELECT', this.SelectEdge);\n    this.DropMessage('EDGE_DESELECT', this.DeselectEdge);\n    window.removeEventListener('beforeunload', this.CheckUnload);\n    window.removeEventListener('unload', this.DoUnload);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// STATE MANAGEMENT\n  ///\n  ResetState() {\n    const TEMPLATE = this.AppState('TEMPLATE');\n    this.setState({\n      // NODE DEFS\n      id: null,\n      label: '',\n      type: '',\n      degrees: null,\n      attributes: {},\n      provenance: {},\n      created: undefined,\n      createdBy: undefined,\n      updated: undefined,\n      updatedBy: undefined,\n      revision: 0,\n      // EDGES\n      edges: [], // selected nodes' edges not ALL edges\n      // SYSTEM STATE\n      // isLoggedIn: false, // don't clear session state!\n      isAdmin: false,\n      previousState: {},\n      // UI State\n      uEditBtnDisable: false,\n      uEditBtnHide: false,\n      uViewMode: NCUI.VIEWMODE.VIEW,\n      uSelectedTab: TABS.ATTRIBUTES,\n      selectedEdgeId: null,\n      uBackgroundColor: 'transparent',\n      uIsLockedByDB: false, // shows db lock message next to Edit Node button\n      uIsLockedByTemplate: false,\n      uIsLockedByImport: false,\n      // uIsLockedByComment: false,     // NOT IMPLEMENTED\n\n      uEditLockMessage: '',\n      uHideDeleteNodeButton: TEMPLATE.hideDeleteNodeButton,\n      uReplacementNodeId: '',\n      uIsValidReplacementNodeID: true,\n      uShowMatchlist: false,\n      uShowCitationDialog: false\n    });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// EVENT HANDLERS\n  ///\n  CheckUnload(event) {\n    if (this.state.uViewMode === NCUI.VIEWMODE.EDIT) {\n      event.preventDefault();\n      (event || window.event).returnValue = null;\n    } else {\n      Reflect.deleteProperty(event, 'returnValue');\n    }\n    return event;\n  }\n  DoUnload(event) {\n    if (this.state.uViewMode === NCUI.VIEWMODE.EDIT) {\n      LOCKMGR.RequestUnlockNode(this.state.id);\n    }\n  }\n\n  /**\n   * Handle change in SESSION data\n   * SESSION is called by SessionShell when the ID changes\n   * set system-wide. data: { classId, projId, hashedId, groupId, isValid }\n   * Called both by componentWillMount() and AppStateChange handler.\n   * The 'SESSION' state change is triggered in two places in SessionShell during\n   * its handleChange() when active typing is occuring, and also during\n   * SessionShell.componentWillMount()\n   */\n  urstate_SESSION(decoded) {\n    this.urstate_LOCKSTATE();\n  }\n\n  urstate_LOCKSTATE() {\n    const permissionsState = this.DerivePermissions(this.state.id);\n    this.setState({ ...permissionsState });\n  }\n\n  urstate_PERMISSIONS(PERMISSIONS) {\n    this.setState({ isAdmin: PERMISSIONS.isAdmin });\n  }\n\n  /*\n      Called by NCDATA AppState updates\n  */\n  urstate_NCDATA(data) {\n    // If NCDATA is updated, reload the node AND the edges b/c db has changed\n    const updatedNode = data.nodes.find(n => n.id === this.state.id);\n    this.LoadNode(updatedNode);\n  }\n\n  /**\n   * Checks current SESSION state to see if user is logged in.\n   * Since NCNode is dynamically created and closed, we can't rely on\n   * SESSION AppState updates messages.\n   * NOTE updates state.\n   * @returns {boolean} True if user is logged in\n   */\n  IsLoggedIn() {\n    const SESSION = this.AppState('SESSION');\n    const isLoggedIn = SESSION.isValid;\n    return isLoggedIn;\n  }\n\n  // 1. Read the LOCKSTATE\n  // 2. Derive the permissions state (hide/disable the edit button)\n  // 3. Look up any lock messages\n  DerivePermissions(nodeId) {\n    const isLoggedIn = this.IsLoggedIn();\n\n    const LOCKSTATE = this.AppState('LOCKSTATE');\n    const uIsLockedByDB =\n      LOCKSTATE.lockedNodes && LOCKSTATE.lockedNodes.includes(nodeId);\n    const uIsLockedByTemplate = LOCKSTATE.templateBeingEdited;\n    const uIsLockedByImport = LOCKSTATE.importActive;\n    // NOT IMPLEMENTED\n    // FUTURE: We may want to lock the node if a comment is being edited\n    //         but currently there isn't an easy way to do this\n    //         because while we know that a comment is being edited (via LOCKSTATE.lockedComments)\n    //         we don't know if the comment is being edited by the current user or someone else.\n    //         So for now, we allow the node to be edited while a comment is being edited.\n    //         If we wanted to implement this, we probably need to introduce a new parameter\n    //         or properly implement commentBeingEditedByMe.\n    // const uIsLockedByComment = LOCKSTATE.commentBeingEditedByMe;\n\n    // Derive new message and EditBtn status\n    let uEditLockMessage = '';\n    let uEditBtnDisable = false;\n    let uEditBtnHide = true;\n    const TEMPLATE = this.AppState('TEMPLATE');\n    if (isLoggedIn) uEditBtnHide = false;\n    if (uIsLockedByDB) {\n      uEditBtnDisable = true;\n      uEditLockMessage += TEMPLATE.nodeIsLockedMessage;\n    }\n    if (uIsLockedByTemplate) {\n      uEditBtnDisable = true;\n      uEditLockMessage += TEMPLATE.templateIsLockedMessage;\n    }\n    if (uIsLockedByImport) {\n      uEditBtnDisable = true;\n      uEditLockMessage += TEMPLATE.importIsLockedMessage;\n    }\n    // NOT IMPLEMENTED\n    // if (uIsLockedByComment) {\n    //   uEditBtnDisable = true;\n    //   // no change to lock message for comments\n    // }\n\n    // return all state values\n    return {\n      // User Permissions\n      isLoggedIn,\n      uIsLockedByDB,\n      uIsLockedByTemplate,\n      uIsLockedByImport,\n      // uIsLockedByComment,  // NOT IMPLEMENTED\n      // UI State\n      uEditBtnDisable,\n      uEditBtnHide,\n      uEditLockMessage\n    };\n  }\n\n  ClearSelection() {\n    this.ResetState();\n  }\n  urstate_SELECTION(data) {\n    if (!data.nodes) return; // SELECTION cleared?\n    const node = data.nodes[0]; // select the first node\n    this.LoadNode(node);\n  }\n  /**\n   * In order to edit an edge, we must first select the source\n   * 1. (this assumes SOURCE_SELECT was already called)\n   * 2. select the Edges tab\n   * 3. open the edge (load the edge data into NCEdge)\n   * 4. trigger edge edit mode\n   * @param {Object} data\n   * @param {string} data.edgeId\n   */\n  SelectEdgeAndEdit(data) {\n    const { edgeId } = data;\n    this.setState({ uSelectedTab: TABS.EDGES, selectedEdgeId: edgeId }, () => {\n      const { edges } = this.state;\n      const edge = edges.find(e => e.id === Number(edgeId));\n      this.setState({ selectedEdgeId: edgeId });\n      this.AppCall('EDGE_OPEN', { edge }).then(() => {\n        this.AppCall('EDGE_EDIT', { edgeId });\n      });\n    });\n  }\n  SelectEdge(data) {\n    const { edgeId } = data;\n    this.setState({ uSelectedTab: TABS.EDGES, selectedEdgeId: edgeId }, () => {\n      const { edges } = this.state;\n      const edge = edges.find(e => e.id === Number(edgeId));\n      this.setState({ selectedEdgeId: edgeId });\n      this.AppCall('EDGE_OPEN', { edge });\n    });\n  }\n  DeselectEdge() {\n    this.setState({ selectedEdgeId: null });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// DATA LOADING\n  ///\n  LoadNode(node) {\n    const { id, uViewMode } = this.state;\n\n    // If we're editing, ignore the select!\n    if (uViewMode === NCUI.VIEWMODE.EDIT) return;\n\n    // If no node was selected, deselect\n    if (!node) {\n      this.ClearSelection();\n      return;\n    }\n\n    // if we're loading a new node, close any open edges\n    if (node.id !== id) this.AppCall('EDGE_DESELECT');\n\n    // Load the node\n    const edges = this.FindLinkedEdges(node.id);\n    const attributes = this.LoadAttributes(node);\n    const provenance = this.LoadProvenance(node);\n    const uBackgroundColor = this.LookupBackgroundColor(node.type);\n    const matchingNodes = this.FindMatchingList(node.label, node.id);\n    const permissionsState = this.DerivePermissions(node.id);\n    this.setState({\n      // node parameters\n      id: node.id,\n      label: node.label,\n      type: node.type,\n      degrees: node.degrees,\n      attributes: attributes,\n      provenance: provenance,\n      created: node.meta ? new Date(node.meta.created).toLocaleString() : '',\n      createdBy: node.createdBy,\n      updated: node.meta ? new Date(node.meta.updated).toLocaleString() : '',\n      updatedBy: node.updatedBy,\n      revision: node.meta ? node.meta.revision : '',\n      edges,\n      // UI parameters\n      uBackgroundColor,\n      matchingNodes,\n      ...permissionsState\n    });\n  }\n  FindLinkedEdges(id) {\n    // -- First, sort edges by source, then target\n    const NCDATA = this.AppState('NCDATA');\n    const linkedEdges = NCDATA.edges.filter(e => e.source === id || e.target === id);\n    linkedEdges.sort((a, b) => {\n      // same source label, sort on target\n      if (a.sourceLabel === b.sourceLabel) {\n        if (a.targetLabel < b.targetLabel) return -1;\n        if (a.targetLabel > b.targetLabel) return 1;\n      }\n      // Always list `this` node first\n      if (a.source === id) return -1;\n      if (b.source === id) return 1;\n      // Otherwise sort on source\n      if (a.sourceLabel < b.sourceLabel) return -1;\n      if (a.sourceLabel > b.sourceLabel) return 1;\n      return 0;\n    });\n    return linkedEdges;\n  }\n  /**\n   * Loads up the `attributes` object defined by the TEMPLATE\n   * Will skip\n   *   * BUILTIN fields\n   *   * attributes that are `hidden` by the template\n   * REVIEW: Currently the parameters will show up in random object order.\n   * @param {Object} node\n   * @returns {Object} { ...attr-key: attr-value }\n   */\n  LoadAttributes(node) {\n    const NODEDEFS = this.AppState('TEMPLATE').nodeDefs;\n    const attributes = {};\n    Object.keys(NODEDEFS).forEach(k => {\n      if (BUILTIN_FIELDS_NODE.includes(k)) return; // skip built-in fields\n      const attr_def = NODEDEFS[k];\n      if (attr_def.hidden) return; // skip hidden fields\n      if (attr_def.isProvenance) return; // skip fields that are marked as provenance\n      attributes[k] = node[k];\n    });\n    return attributes;\n  }\n  /**\n   * Loads up the `provenance` object defined by the TEMPLATE\n   * Will skip\n   *   * BUILTIN fields\n   *   * attributes that are `hidden` by the template\n   * REVIEW: Currently the parameters will show up in random object order.\n   * @param {Object} node\n   * @returns {Object} { ...attr-key: attr-value }\n   */\n  LoadProvenance(node) {\n    const NODEDEFS = this.AppState('TEMPLATE').nodeDefs;\n    const provenance = {};\n    Object.keys(NODEDEFS).forEach(k => {\n      if (BUILTIN_FIELDS_NODE.includes(k)) return; // skip built-in fields\n      const provenance_def = NODEDEFS[k];\n      if (provenance_def.hidden) return; // skip hidden fields\n      if (!provenance_def.isProvenance) return; // skip fields that are not marked as provenance\n      provenance[k] = node[k];\n    });\n    return provenance;\n  }\n\n  UnlockNode(cb) {\n    LOCKMGR.RequestUnlockNode(this.state.id, cb);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// DATA SAVING\n  ///\n  SaveNode() {\n    const { id, label, type, attributes, provenance, created, updated, revision } =\n      this.state;\n    const uid = NCLOGIC.GetCurrentUserId();\n    const node = {\n      id,\n      label,\n      type,\n      updatedBy: uid\n    };\n    Object.keys(attributes).forEach(k => (node[k] = attributes[k]));\n    Object.keys(provenance).forEach(k => (node[k] = provenance[k]));\n\n    // Exit Edit mode first, then send the update\n    // (This is necessary otherwise the db update will trigger a\n    // NCDATA update followed by LoadNode, which will skip loading because\n    // it's still in edit mode)\n    this.setState(\n      {\n        uViewMode: NCUI.VIEWMODE.VIEW\n      },\n      () => {\n        // write data to database\n        // setting dbWrite to true will distinguish this update\n        // from a remote one\n        this.AppCall('DB_UPDATE', { node }).then(() => {\n          this.UnlockNode();\n        });\n      }\n    );\n    UNISYS.Log('click save node', id, label, JSON.stringify(node));\n  }\n  DeleteNode() {\n    const { id, uReplacementNodeId } = this.state;\n\n    // Re-link edges or delete edges?\n    // `NaN` is not valid JSON, so we need to pass -1\n    const replacementNodeID =\n      uReplacementNodeId === '' ? -1 : parseInt(uReplacementNodeId); // '' = Delete edges by default\n\n    this.ResetState();\n    this.AppCall('DB_UPDATE', {\n      nodeID: id,\n      replacementNodeID: replacementNodeID\n    });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// HELPER METHODS\n  /**\n   * Looks up the background color of the node editor for the\n   * `uBackgroundColor` state.\n   * Currently the background color is determined by the template node type\n   * color mapping.  This will eventually be replaced with a color manager.\n   */\n  LookupBackgroundColor(type) {\n    const COLORMAP = this.AppState('COLORMAP');\n    const uBackgroundColor = COLORMAP.nodeColorMap[type] || '#555555';\n    return uBackgroundColor;\n  }\n\n  /**\n   * Create list of nodes that match the label\n   * @param {*} label\n   * @param {*} id optional id -- needed by LoadNode because id may not be defined yet\n   * @returns\n   */\n  FindMatchingList(label, id = this.state.id) {\n    const foundNodes = NCLOGIC.FindMatchingNodesByLabel(label);\n    const matchingNodes = foundNodes.filter(n => n.id !== id); // don't include self\n    return matchingNodes;\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// UI EVENT HANDLERS\n\n  UISelectTab(event) {\n    const { id, label } = this.state;\n    const uSelectedTab = event.target.value;\n    this.setState({ uSelectedTab });\n    if (event.target.value !== TABS.EDGES) this.AppCall('EDGE_DESELECT');\n    UNISYS.Log('select node tab', id, label, uSelectedTab);\n  }\n\n  /**\n   * If `lockNode` is not successful, then that means the node was\n   * already locked, so we can't edit.\n   */\n  UIRequestEditNode() {\n    const { isLoggedIn } = this.state;\n    if (!isLoggedIn) return;\n    LOCKMGR.RequestLockNode(this.state.id, lockSuccess => {\n      if (!lockSuccess) this.setState({ uIsLockedByDB: !lockSuccess });\n      else this.UIEnableEditMode();\n    });\n  }\n\n  UIReplacementNodeIdUpdate(event) {\n    const replacementNodeId = parseInt(event.target.value);\n    let isValid = false;\n    // Allow `` because we use a a blank field to indicate delete node without relinking edges.\n    if (\n      event.target.value === '' ||\n      this.AppState('NCDATA').nodes.find(node => {\n        return node.id === replacementNodeId;\n      })\n    ) {\n      isValid = true;\n    }\n    this.setState({\n      uReplacementNodeId: replacementNodeId,\n      uIsValidReplacementNodeID: isValid\n    });\n  }\n\n  UIAddEdge(event) {\n    event.preventDefault();\n    this.AppCall('EDGE_CREATE', { nodeId: this.state.id }).then(edge => {\n      // enable editing right away\n      this.UIEditEdge(edge.id);\n    });\n  }\n\n  UIEnableEditMode() {\n    const { uSelectedTab, id, label, type, attributes, provenance } = this.state;\n    // If user was on Edges tab while requesting edit (e.g. from Node Table), then\n    // switch to Attributes tab first.\n    const editableTab = uSelectedTab === TABS.EDGES ? TABS.ATTRIBUTES : uSelectedTab;\n    const previousState = {\n      label,\n      type,\n      attributes: Object.assign({}, attributes),\n      provenance: Object.assign({}, provenance)\n    };\n    this.setState({\n      uViewMode: NCUI.VIEWMODE.EDIT,\n      uSelectedTab: editableTab,\n      uIsLockedByDB: false,\n      previousState\n    });\n\n    const node = {\n      id,\n      label,\n      type,\n      provenance\n    };\n    Object.keys(attributes).forEach(k => (node[k] = attributes[k]));\n    Object.keys(provenance).forEach(k => (node[k] = provenance[k]));\n    UNISYS.Log('edit node', id, label, JSON.stringify(node));\n  }\n\n  UICancelEditMode() {\n    const { id, label, revision, previousState } = this.state;\n\n    // if user is cancelling a newly created unsaved node, delete the node instead\n    // Initial Node creation is rev 0, saving it for the first time bumps it to rev 1\n    if (revision < 1) {\n      this.UIDisableEditMode();\n      this.DeleteNode();\n      return;\n    }\n\n    // restore previous state\n    this.setState(\n      {\n        label: previousState.label,\n        type: previousState.type,\n        attributes: previousState.attributes,\n        provenance: previousState.provenance\n      },\n      () => this.UIDisableEditMode()\n    );\n    UNISYS.Log('cancel edit node', id, label);\n  }\n\n  UIDisableEditMode() {\n    this.UnlockNode(() => {\n      this.setState({\n        uViewMode: NCUI.VIEWMODE.VIEW\n      });\n    });\n  }\n  UIInputUpdate(key, value) {\n    let state = {};\n    if (BUILTIN_FIELDS_NODE.includes(key)) {\n      const data = {};\n      data[key] = value;\n      state = data;\n    } else {\n      const { attributes } = this.state;\n      attributes[key] = value;\n      state = attributes;\n    }\n\n    // HACK Allow any field to be used to specify color\n    //      Eventually this needs to be built into the template.\n    const COLORFIELDS = ['type'];\n    // special handling to update the background color immediately if `type` is changed\n    const type = COLORFIELDS.includes(key) ? value : this.state.type;\n    const uBackgroundColor = this.LookupBackgroundColor(type);\n    this.setState({ ...state, uBackgroundColor });\n  }\n  UIProvenanceInputUpdate(key, value) {\n    if (BUILTIN_FIELDS_NODE.includes(key)) {\n      const data = {};\n      data[key] = value;\n      this.setState(data);\n    } else {\n      const { provenance } = this.state;\n      provenance[key] = value;\n      this.setState({ provenance });\n    }\n  }\n  UILabelInputUpdate(key, value) {\n    const data = {};\n    data[key] = value;\n    data.matchingNodes = this.FindMatchingList(value);\n    this.setState(data);\n  }\n\n  UIViewEdge(edgeId) {\n    const { edges } = this.state;\n    const edge = edges.find(e => e.id === Number(edgeId));\n    this.setState({ selectedEdgeId: edgeId });\n    this.AppCall('EDGE_OPEN', { edge });\n  }\n\n  UIEditEdge(edgeId) {\n    const { edges } = this.state;\n    const edge = edges.find(e => e.id === Number(edgeId));\n    this.setState({ selectedEdgeId: edgeId });\n    this.AppCall('EDGE_OPEN', { edge }).then(() =>\n      this.AppCall('EDGE_EDIT', { edge })\n    );\n  }\n\n  UICitationShow() {\n    this.setState({ uShowCitationDialog: true });\n  }\n  UICitationClose() {\n    this.setState({ uShowCitationDialog: false });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// RENDER METHODS\n  RenderView() {\n    const {\n      uSelectedTab,\n      uBackgroundColor,\n      uEditBtnDisable,\n      uEditBtnHide,\n      uEditLockMessage,\n      uHideDeleteNodeButton,\n      uReplacementNodeId,\n      uIsValidReplacementNodeID,\n      uShowCitationDialog,\n      id,\n      label,\n      type,\n      isAdmin\n    } = this.state;\n    const TEMPLATE = this.AppState('TEMPLATE');\n    const defs = TEMPLATE.nodeDefs;\n    const uShowCitationButton = TEMPLATE.citation && !TEMPLATE.citation.hidden;\n    const bgcolor = uBackgroundColor + '44'; // hack opacity\n    const citation =\n      `NetCreate ${TEMPLATE.name} network, ` +\n      `Node: \"${label}\" (ID ${id}). ` +\n      (TEMPLATE.citation && TEMPLATE.citation.text\n        ? `${TEMPLATE.citation.text}. `\n        : '') +\n      `Last accessed at ${NCUI.DateFormatted()}.`;\n    const collection_ref = CMTMGR.GetNodeCREF(id);\n    return (\n      <div className=\"--NCNode_View nccomponent\">\n        <div className=\"view\" style={{ background: bgcolor }}>\n          {/* BUILT-IN - - - - - - - - - - - - - - - - - */}\n          <div className=\"titlebar\">\n            <div className=\"nodenumber\">NODE {id}</div>\n            <div className=\"nodelabel\">{NCUI.RenderLabel('label', label)}</div>\n            <URCommentVBtn cref={collection_ref} key={collection_ref} />\n            {/* use key to make sure URCommentVBtn refreshes */}\n          </div>\n          {/* Special handling for `type` field */}\n          {defs['type'] && !defs['type'].hidden && (\n            <div className=\"formview typeview\">\n              {NCUI.RenderLabel('type', defs['type'].displayLabel, defs['type'].help)}\n              {NCUI.RenderStringValue('type', type)}\n            </div>\n          )}\n          {/* TABS - - - - - - - - - - - - - - - - - - - */}\n          <div className=\"--NCNode_View_Tabs tabcontainer\">\n            {NCUI.RenderTabSelectors(TABS, this.state, this.UISelectTab)}\n            <div className=\"tabview\">\n              {uSelectedTab === TABS.ATTRIBUTES &&\n                NCUI.RenderAttributesTabView(this.state, defs, BUILTIN_FIELDS_NODE)}\n              {uSelectedTab === TABS.EDGES && this.RenderEdgesTab()}\n              {uSelectedTab === TABS.PROVENANCE &&\n                NCUI.RenderProvenanceTabView(this.state, defs, BUILTIN_FIELDS_NODE)}\n            </div>\n          </div>\n          {/* CONTROL BAR - - - - - - - - - - - - - - - - */}\n          {!uEditBtnHide && uEditLockMessage && (\n            <div className=\"message warning\" style={{ marginTop: '1em' }}>\n              <p>{uEditLockMessage}</p>\n              <p hidden={!isAdmin}>\n                <b>ADMINISTRATOR ONLY</b>: If you are absolutely sure this is an\n                error, you can force the unlock.\n                <button\n                  onClick={this.UIDisableEditMode}\n                  style={{ marginLeft: 0 }}\n                  type=\"button\"\n                >\n                  Force Unlock\n                </button>\n              </p>\n            </div>\n          )}\n          <div className=\"--NCNode_View_Controls controlbar\">\n            {uShowCitationButton && (\n              <button\n                id=\"citationbtn\"\n                className=\"citationbutton\"\n                onClick={this.UICitationShow}\n                type=\"button\"\n              >\n                Cite Node\n              </button>\n            )}\n            <div style={{ flexGrow: 1 }}></div>\n            {!uEditBtnHide && uSelectedTab !== TABS.EDGES && (\n              <button\n                id=\"editbtn\"\n                onClick={this.UIRequestEditNode}\n                disabled={uEditBtnDisable}\n                type=\"button\"\n              >\n                Edit\n              </button>\n            )}\n          </div>\n          {isAdmin && !uEditBtnDisable && !uHideDeleteNodeButton && (\n            <div className=\"controlbar deletenode\">\n              <div className=\"message\">\n                Re-link edges to this Node ID (leave blank to delete edge)\n              </div>\n              <div>\n                <input\n                  type=\"number\"\n                  id=\"replacementNodeID\"\n                  className={`deleteinput ${\n                    uIsValidReplacementNodeID ? '' : 'invalid'\n                  }`}\n                  value={uReplacementNodeId || ''}\n                  onChange={this.UIReplacementNodeIdUpdate}\n                />\n                {!uIsValidReplacementNodeID && (\n                  <div className=\"message warning\">Invalid Node ID!</div>\n                )}\n              </div>\n              <button onClick={this.DeleteNode} type=\"button\">\n                Delete\n              </button>\n            </div>\n          )}\n        </div>\n        {uShowCitationDialog && (\n          <NCDialogCitation message={citation} onClose={this.UICitationClose} />\n        )}\n      </div>\n    );\n  }\n\n  RenderEdit() {\n    const {\n      uSelectedTab,\n      uBackgroundColor,\n      uShowMatchlist,\n      matchingNodes,\n      id,\n      label,\n      type\n    } = this.state;\n    const defs = this.AppState('TEMPLATE').nodeDefs;\n    const bgcolor = uBackgroundColor + '66'; // hack opacity\n    const matchList = matchingNodes\n      ? matchingNodes.map(n => (\n          <div key={`${n.label}${n.id}`} value={n.id}>\n            {n.label} <span className=\"id\">#{n.id}</span>\n          </div>\n        ))\n      : undefined;\n    const isDuplicate = matchingNodes && matchingNodes.find(n => n.label === label);\n    const duplicateWarning = this.AppState('TEMPLATE').duplicateWarning;\n    return (\n      <div className=\"--NCNode_Edit\">\n        <div className=\"screen\"></div>\n        <div className=\"nccomponent\">\n          <div\n            className=\"edit\"\n            style={{\n              background: bgcolor,\n              borderColor: uBackgroundColor\n            }}\n          >\n            {/* BUILT-IN - - - - - - - - - - - - - - - - - */}\n            <div className=\"nodelabel\">\n              {NCUI.RenderStringInput(\n                'label',\n                label,\n                this.UILabelInputUpdate,\n                '',\n                () => this.setState({ uShowMatchlist: true }),\n                () => this.setState({ uShowMatchlist: false })\n              )}\n              {uShowMatchlist && matchList && (\n                <div className=\"matchlist\">\n                  {isDuplicate && (\n                    <div className=\"warning\">\n                      <img src={`images/icn_caution.svg`} />\n                      <span>{duplicateWarning}</span>\n                    </div>\n                  )}\n                  {matchList}\n                </div>\n              )}\n              {isDuplicate && (\n                <div className=\"message warning\">\n                  <img src={`images/icn_caution.svg`} />\n                  <span>{duplicateWarning}</span>\n                </div>\n              )}\n            </div>\n            {/* Special handling for `type` field */}\n            {defs['type'] && !defs['type'].hidden && (\n              <div className=\"formview typeview\">\n                {NCUI.RenderLabel(\n                  'type',\n                  defs['type'].displayLabel,\n                  defs['type'].help\n                )}\n                {NCUI.RenderOptionsInput(\n                  'type',\n                  type,\n                  defs,\n                  this.UIInputUpdate,\n                  defs['type'].help\n                )}\n              </div>\n            )}\n            {/* TABS - - - - - - - - - - - - - - - - - - - */}\n            <div className=\"tabcontainer\">\n              {NCUI.RenderTabSelectors(TABS, this.state, this.UISelectTab)}\n              <div className=\"tabview\">\n                {uSelectedTab === TABS.ATTRIBUTES &&\n                  NCUI.RenderAttributesTabEdit(\n                    this.state,\n                    defs,\n                    this.UIInputUpdate,\n                    BUILTIN_FIELDS_NODE\n                  )}\n                {uSelectedTab === TABS.EDGES && this.RenderEdgesTab()}\n                {uSelectedTab === TABS.PROVENANCE &&\n                  NCUI.RenderProvenanceTabEdit(\n                    this.state,\n                    defs,\n                    this.UIProvenanceInputUpdate,\n                    BUILTIN_FIELDS_NODE\n                  )}\n              </div>\n            </div>\n            {/* CONTROL BAR - - - - - - - - - - - - - - - - */}\n            <div className=\"controlbar\">\n              <button\n                className=\"cancelbtn\"\n                onClick={this.UICancelEditMode}\n                type=\"button\"\n              >\n                Cancel\n              </button>\n              <button onClick={this.SaveNode} type=\"button\">\n                Save\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// RENDER HELPERS\n  ///\n  RenderEdgesTab() {\n    const {\n      uSelectedTab,\n      selectedEdgeId,\n      uEditBtnDisable,\n      uEditBtnHide,\n      id,\n      label,\n      edges\n    } = this.state;\n    const NCDATA = this.AppState('NCDATA');\n    const TEMPLATE = this.AppState('TEMPLATE');\n    const me = (\n      <span style={{ color: '#888', fontStyle: 'italic', fontWeight: 'normal' }}>\n        this node\n      </span>\n    );\n    return (\n      <div className=\"edges\">\n        {edges.map(e => {\n          const sourceNode = NCDATA.nodes.find(n => n.id === e.source) || {\n            label: EDGE_NOT_SET_LABEL\n          };\n          const targetNode = NCDATA.nodes.find(n => n.id === e.target) || {\n            label: EDGE_NOT_SET_LABEL\n          };\n          const color = EDGEMGR.LookupEdgeColor(e, TEMPLATE);\n          const bgcolor = color + '33'; // opacity hack\n          if (e.id === selectedEdgeId) {\n            return <NCEdge edgeId={e.id} parentNodeId={id} key={e.id} />;\n          } else {\n            return (\n              <div key={e.id}>\n                <button\n                  className=\"edgebutton\"\n                  onClick={() => this.UIViewEdge(e.id)}\n                  style={{ backgroundColor: bgcolor }}\n                  type=\"button\"\n                >\n                  {id === e.source ? me : sourceNode.label}\n                  &nbsp;<span title={e.type}>{ARROW_RIGHT}</span>&nbsp;\n                  {id === e.target ? me : targetNode.label}\n                </button>\n              </div>\n            );\n          }\n        })}\n        {!uEditBtnHide && uSelectedTab === TABS.EDGES && (\n          <button\n            className=\"addedgebutton\"\n            onClick={this.UIAddEdge}\n            disabled={uEditBtnDisable}\n            type=\"button\"\n          >\n            New Edge\n          </button>\n        )}\n      </div>\n    );\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// MAIN RENDER\n  render() {\n    const { id, uViewMode } = this.state;\n    if (!id) return ''; // nothing selected\n    if (uViewMode === NCUI.VIEWMODE.VIEW) {\n      return this.RenderView();\n    } else {\n      return this.RenderEdit();\n    }\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCNode;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n    NCNodeTable is used to to display a table of nodes for review.\n\n    It checks FILTEREDNCDATA to show highlight/filtered state\n\n    It uses URTable for rendering and sorting.\n\n  ## PROPS\n\n    * tableHeight -- sets height based on InfoPanel dragger\n    * isOpen -- whether the table is visible\n\n  ## TO USE\n\n    NCNodeTable is self contained and relies on global FILTEREDNCDATA to load.\n\n      <NCNodeTable tableHeight isOpen/>\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport UNISYS from 'unisys/client';\nimport NCUI from '../nc-ui';\nimport UTILS from '../nc-utils';\nimport FILTER from './filter/FilterEnums';\nimport CMTMGR from '../comment-mgr';\n\nimport URTable from './URTable';\nimport URCommentVBtn from './URCommentVBtn';\n\nimport { BUILTIN_FIELDS_NODE } from 'system/util/enum';\nimport { ICON_PENCIL, ICON_VIEW } from 'system/util/constant';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for functional react component\nconst UDATAOwner = { name: 'NCNodeTable' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n\nconst DBG = false;\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCNodeTable({ isOpen }) {\n  const isOpenRef = useRef(isOpen);\n  const [state, setState] = useState({});\n\n  /// USEEFFECT ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    const TEMPLATE = UDATA.AppState('TEMPLATE');\n    const SESSION = UDATA.AppState('SESSION');\n    const NCDATA = UDATA.AppState('NCDATA');\n    setState({\n      nodeDefs: TEMPLATE.nodeDefs,\n      nodes: NCDATA.nodes,\n      disableEdit: false,\n      isLocked: !SESSION.isValid\n    });\n\n    UDATA.OnAppStateChange('FILTEREDNCDATA', urstate_FILTEREDNCDATA);\n    UDATA.OnAppStateChange('SESSION', urstate_SESSION);\n    UDATA.OnAppStateChange('TEMPLATE', urstate_TEMPLATE);\n    return () => {\n      UDATA.AppStateChangeOff('FILTEREDNCDATA', urstate_FILTEREDNCDATA);\n      UDATA.AppStateChangeOff('SESSION', urstate_SESSION);\n      UDATA.AppStateChangeOff('TEMPLATE', urstate_TEMPLATE);\n    };\n  }, []);\n\n  useEffect(() => {\n    isOpenRef.current = isOpen;\n  }, [isOpen]);\n\n  /// UR HANDLERS /////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// FILTEREDNCDATA is the reduced list of nodes, not ALL nodes\n  function urstate_FILTEREDNCDATA(data) {\n    // skip update if not open\n    if (!isOpenRef.current) return;\n\n    if (data.nodes) {\n      // If we're transitioning from \"COLLAPSE\" or \"FOCUS\" to \"HILIGHT/FADE\", then we\n      // also need to add back in nodes that are not in filteredNodes\n      // (because \"COLLAPSE\" and \"FOCUS\" removes nodes that are not matched)\n      const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n      if (FILTERDEFS.filterAction === FILTER.ACTION.FADE) {\n        // show ALL nodes\n        const NCDATA = UDATA.AppState('NCDATA');\n        setState(prevState => ({ ...prevState, nodes: NCDATA.nodes }));\n      } else {\n        setState(prevState => ({ ...prevState, nodes: data.nodes }));\n      }\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urstate_SESSION(decoded) {\n    const isLocked = !decoded.isValid;\n    if (isLocked === state.isLocked) {\n      return;\n    }\n    setState(prevState => ({ ...prevState, isLocked }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urstate_TEMPLATE(data) {\n    setState(prevState => ({\n      ...prevState,\n      nodeDefs: data.nodeDefs,\n      selectedNodeColor: data.sourceColor,\n      hilitedNodeColor: data.searchColor\n    }));\n  }\n\n  /// COLUMN DEFINTION GENERATION /////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function DeriveColumnDefs(incomingNodeDefs) {\n    const { nodeDefs, disableEdit, isLocked } = state;\n    const defs = incomingNodeDefs || nodeDefs;\n\n    // Only include built in fields\n    // Only include non-hidden fields\n    // Only include non-provenance fields\n    const attributeDefs = Object.keys(defs).filter(\n      k =>\n        !BUILTIN_FIELDS_NODE.includes(k) && !defs[k].isProvenance && !defs[k].hidden\n    );\n    const provenanceDefs = Object.keys(defs).filter(\n      k => !BUILTIN_FIELDS_NODE.includes(k) && defs[k].isProvenance && !defs[k].hidden\n    );\n\n    /// CLICK HANDLERS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function ui_ClickViewNode(event, nodeId) {\n      event.preventDefault();\n      event.stopPropagation();\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [parseInt(nodeId)] });\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function ui_ClickEditNode(event, nodeId) {\n      event.preventDefault();\n      event.stopPropagation();\n      const nodeID = parseInt(nodeId);\n      UDATA.LocalCall('SOURCE_SELECT', { nodeIDs: [nodeID] }).then(() => {\n        if (DBG) console.error('NodeTable: Calling NODE_EDIT', nodeID);\n        UDATA.LocalCall('NODE_EDIT', { nodeID: nodeID });\n      });\n    }\n    /// RENDERERS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function col_RenderViewOrEdit(key, tdata, coldef) {\n      const value = tdata[key];\n      return (\n        <div>\n          {!disableEdit && (\n            <button\n              className=\"outline\"\n              type=\"button\"\n              aria-label=\"View Node\"\n              onClick={event => ui_ClickViewNode(event, value)}\n            >\n              {ICON_VIEW}\n            </button>\n          )}\n          {!disableEdit && !isLocked && (\n            <button\n              className=\"outline\"\n              type=\"button\"\n              aria-label=\"Edit Node\"\n              onClick={event => ui_ClickEditNode(event, value)}\n            >\n              {ICON_PENCIL}\n            </button>\n          )}\n        </div>\n      );\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // interface TTblNodeObject {\n    //   id: String;\n    //   label: String;\n    // }\n    function col_RenderNode(key, tdata, coldef) {\n      const value = tdata[key];\n      if (!value) return; // skip if not defined yet\n      if (tdata.id === undefined)\n        throw new Error(`RenderNode: id is undefined. tdata=${tdata}`);\n      if (value === undefined)\n        throw new Error(`RenderNode: label is undefined. value=${value}`);\n      return (\n        <button\n          className=\"outline\"\n          type=\"button\"\n          aria-label={`View ${value} Node`}\n          onClick={event => ui_ClickViewNode(event, tdata.id)}\n        >\n          <span>{value}</span>\n        </button>\n      );\n    }\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function col_RenderCommentBtn(key, tdata, coldef) {\n      const value = tdata[key];\n      return <URCommentVBtn cref={value.cref} />;\n    }\n    /// CUSTOM SORTERS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    function col_SortCommentsByCount(key, tdata, order) {\n      const sortedData = [...tdata].sort((a, b) => {\n        if (!a[key].count) return 1; // Move undefined or '' to the bottom regardless of sort order\n        if (!b[key].count) return -1; // Move undefined or '' the bottom regardless of sort order\n        if (a[key].count < b[key].count) return order;\n        if (a[key].count > b[key].count) return order * -1;\n        return 0;\n      });\n      return sortedData;\n    }\n    /// COLUMN DEFINITIONS\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    // column definitions for custom attributes\n    // (built in columns are: view, degrees, label)\n    const ATTRIBUTE_COLUMNDEFS = attributeDefs.map(key => {\n      return {\n        title: defs[key].displayLabel,\n        type: defs[key].type,\n        data: key\n      };\n    });\n    const PROVENANCE_COLUMNDEFS = provenanceDefs.map(key => {\n      return {\n        title: defs[key].displayLabel,\n        type: defs[key].type,\n        data: key\n      };\n    });\n    const COLUMNDEFS = [\n      {\n        title: '', // View/Edit\n        data: 'id',\n        type: defs['id'].type,\n        width: 45, // in px\n        renderer: col_RenderViewOrEdit,\n        sortDisabled: true,\n        tipDisabled: true\n      },\n      {\n        title: defs['degrees'].displayLabel,\n        type: defs['degrees'].type,\n        width: 50, // in px\n        data: 'degrees'\n      },\n      {\n        title: defs['label'].displayLabel,\n        type: 'text-case-insensitive',\n        data: 'label',\n        width: 200, // in px\n        renderer: col_RenderNode\n      }\n    ];\n    if (defs['type'] && !defs['type'].hidden) {\n      COLUMNDEFS.push({\n        title: defs['type'].displayLabel,\n        type: 'text-case-insensitive',\n        width: 130, // in px\n        data: 'type'\n      });\n    }\n    COLUMNDEFS.push(...ATTRIBUTE_COLUMNDEFS);\n    COLUMNDEFS.push(...PROVENANCE_COLUMNDEFS);\n    // History\n    if (defs['createdBy'] && !defs['createdBy'].hidden)\n      COLUMNDEFS.push({\n        title: defs['createdBy'].displayLabel,\n        type: 'text-case-insensitive',\n        width: 60, // in px\n        data: 'createdBy'\n      });\n    if (defs['created'] && !defs['created'].hidden)\n      COLUMNDEFS.push({\n        title: defs['created'].displayLabel,\n        type: 'timestamp-short',\n        width: 60, // in px\n        data: 'created'\n      });\n    if (defs['updatedBy'] && !defs['updatedBy'].hidden)\n      COLUMNDEFS.push({\n        title: defs['updatedBy'].displayLabel,\n        type: 'text-case-insensitive',\n        width: 60, // in px\n        data: 'updatedBy'\n      });\n    if (defs['updated'] && !defs['updated'].hidden)\n      COLUMNDEFS.push({\n        title: defs['updated'].displayLabel,\n        type: 'timestamp-short',\n        width: 60, // in px\n        data: 'updated'\n      });\n    // Comment is last\n    COLUMNDEFS.push({\n      title: ' ',\n      data: 'commentVBtnDef',\n      width: 40, // in px\n      renderer: col_RenderCommentBtn,\n      sorter: col_SortCommentsByCount,\n      tipDisabled: true\n    });\n    return COLUMNDEFS;\n  }\n\n  /// TABLE DATA GENERATION ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function DeriveTableData({ nodeDefs, nodes }) {\n    // Only include built in fields\n    // Only include non-hidden fields\n    // Only include non-provenance fields\n\n    const attributeDefs = Object.keys(nodeDefs).filter(\n      k =>\n        !BUILTIN_FIELDS_NODE.includes(k) &&\n        !nodeDefs[k].hidden &&\n        !nodeDefs[k].isProvenance\n    );\n    const provenanceDefs = Object.keys(nodeDefs).filter(\n      k => nodeDefs[k].isProvenance\n    );\n\n    return nodes.map((node, i) => {\n      const { id, label, type, degrees } = node;\n\n      // custom attributes\n      const attributes = {};\n      attributeDefs.forEach((key, i) => {\n        let data = {};\n        if (nodeDefs[key].type === 'markdown') {\n          // for markdown:\n          // a. provide the raw markdown string\n          // b. provide the HTML string\n          data.html = NCUI.Markdownify(node[key]);\n          data.raw = node[key];\n        } else if (nodeDefs[key].type === 'hdate') {\n          data = node[key] && node[key].formattedDateString;\n        } else if (nodeDefs[key].type === 'infoOrigin') {\n          data =\n            node[key] === undefined || node[key] === ''\n              ? UTILS.DeriveInfoOriginString(\n                  node.createdBy,\n                  node.meta ? node.meta.created : ''\n                )\n              : node[key];\n        } else data = node[key];\n        attributes[key] = data;\n      });\n\n      // comment button definition\n      const cref = CMTMGR.GetNodeCREF(id);\n      const commentCount = CMTMGR.GetCommentCollectionCount(cref);\n      const ccol = CMTMGR.GetCommentCollection(cref) || {};\n      const hasUnreadComments = ccol.hasUnreadComments;\n      const selected = CMTMGR.GetOpenComments(cref);\n      const commentVBtnDef = {\n        cref,\n        count: commentCount,\n        hasUnreadComments,\n        selected\n      };\n\n      // provenance\n      const provenance = {};\n      provenanceDefs.forEach((key, i) => {\n        let data = {};\n        if (nodeDefs[key].type === 'markdown') {\n          // for markdown:\n          // a. provide the raw markdown string\n          // b. provide the HTML string\n          data.html = NCUI.Markdownify(node[key]);\n          data.raw = node[key];\n        } else if (nodeDefs[key].type === 'hdate') {\n          data = node[key] && node[key].formattedDateString;\n        } else if (nodeDefs[key].type === 'infoOrigin') {\n          data =\n            node[key] === undefined || node[key] === ''\n              ? UTILS.DeriveInfoOriginString(\n                  node.createdBy,\n                  node.meta ? node.meta.created : ''\n                )\n              : node[key];\n        } else data = node[key] || '';\n        provenance[key] = data;\n      });\n\n      // history\n      const history = {\n        createdBy: node.createdBy,\n        created: node.meta ? node.meta.created : '', // meta may not be defined when a new node is creatd\n        updatedBy: node.updatedBy,\n        updated: node.meta ? node.meta.updated : '' // meta may not be defined when a new node is creatd\n      };\n\n      return {\n        id,\n        label,\n        type,\n        degrees,\n        ...attributes,\n        commentVBtnDef,\n        ...provenance,\n        ...history,\n        meta: {\n          filteredTransparency: node.filteredTransparency\n        }\n      };\n    });\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  if (state.nodes === undefined) return `loading...waiting for nodes ${state.nodes}`;\n  if (state.nodeDefs === undefined)\n    return `loading...waiting for nodeDefs ${state.nodeDefs}`;\n\n  const COLUMNDEFS = DeriveColumnDefs();\n  const TABLEDATA = DeriveTableData({ nodeDefs: state.nodeDefs, nodes: state.nodes });\n  return (\n    <div id=\"NCNodeTable\">\n      <URTable isOpen={isOpenRef.current} data={TABLEDATA} columns={COLUMNDEFS} />\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCNodeTable;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Prototype Simple NetCreate Search Field\n\n  Built for Version 2.0 ITEST.\n\n  Provides a:\n  * Search Field\n  * \"Add New Node\" button\n  * Autosuggest highlighter\n\n  Features\n  * During node/edge edit, allow search, but not new node creation\n\n  USAGE\n\n    <NCSearch />\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\nconst NCAutoSuggest = require('./NCAutoSuggest');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCSearch';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nclass NCSearch extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isLoggedIn: false,\n      uNodeOrEdgeBeingEdited: false,\n      uIsLockedByComment: false,\n      value: ''\n    }; // initialized on componentDidMount and clearSelection\n\n    this.UpdateSession = this.UpdateSession.bind(this);\n    this.urstate_LOCKSTATE = this.urstate_LOCKSTATE.bind(this);\n    this.UIOnChange = this.UIOnChange.bind(this);\n    this.UIOnSelect = this.UIOnSelect.bind(this);\n    this.UINewNode = this.UINewNode.bind(this);\n\n    /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n    /// REGISTER LISTENERS\n    this.OnAppStateChange('SESSION', this.UpdateSession);\n    this.OnAppStateChange('LOCKSTATE', this.urstate_LOCKSTATE);\n  }\n\n  componentWillUnmount() {\n    this.AppStateChangeOff('SESSION', this.UpdateSession);\n    this.AppStateChangeOff('LOCKSTATE', this.urstate_LOCKSTATE);\n  }\n\n  /**\n   * Handle change in SESSION data\n   * SESSION is called by SessionShell when the ID changes\n   * set system-wide. data: { classId, projId, hashedId, groupId, isValid }\n   * Called both by componentWillMount() and AppStateChange handler.\n   * The 'SESSION' state change is triggered in two places in SessionShell during\n   * its handleChange() when active typing is occuring, and also during\n   * SessionShell.componentWillMount()\n   */\n  UpdateSession(decoded) {\n    this.setState({ isLoggedIn: decoded.isValid });\n  }\n\n  urstate_LOCKSTATE(LOCKSTATE) {\n    this.setState({\n      uNodeOrEdgeBeingEdited: LOCKSTATE.nodeOrEdgeBeingEdited\n    });\n    // DEPRECATED -- comment editing lock state is only relevant if you are editing your own comment\n    //   this.setState({\n    //   // uIsLockedByComment: LOCKSTATE.commentBeingEditedByMe  // NOT IMPLEMENTED\n    // });\n  }\n\n  /**\n   * The callback function (cb) is used to restore the selection point\n   * otherwise the `value` state update will leave the cursor at the end of the field.\n   */\n  UIOnChange(key, value, cb) {\n    // Pass the input value (node label search string) to UDATA\n    // which will in turn pass the searchLabel back to the SEARCH\n    // state handler in the constructor, which will in turn set the state\n    // of the input value to be passed on to AutoSuggest\n    this.AppCall('SOURCE_SEARCH', { searchString: value });\n    // Update current input value and restore the cursor position\n    this.setState({ value }, () => {\n      if (typeof cb === 'function') cb();\n    });\n  }\n\n  UIOnSelect(key, value, id) {\n    const { isLoggedIn } = this.state;\n    // match existing vs create new\n    this.setState({ value }, () => {\n      if (id) {\n        // open existing node\n        this.AppCall('D3_SELECT_NODE', { nodeIDs: [id] });\n      } else if (isLoggedIn) {\n        // create a new node\n        this.UINewNode();\n      }\n    }); // Enter will create a new node\n  }\n\n  UINewNode() {\n    const { value } = this.state;\n    const data = {};\n    data.label = value;\n    this.AppCall('NODE_CREATE', data).then(node => {\n      this.AppCall('D3_SELECT_NODE', { nodeIDs: [node.id] }).then(() => {\n        this.AppCall('NODE_EDIT', { nodeID: node.id });\n      });\n    });\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// MAIN RENDER\n  ///\n  render() {\n    const { value, isLoggedIn, uNodeOrEdgeBeingEdited, uIsLockedByComment } =\n      this.state;\n    const newNodeBtnHidden = !isLoggedIn || uIsLockedByComment;\n    const newNodeBtnDisabled = value === '' || uNodeOrEdgeBeingEdited;\n    const key = 'search'; // used for search/source/target, placeholder for search\n    return (\n      <div className=\"--NCSearch ncsearch\">\n        <NCAutoSuggest\n          parentKey={key}\n          value={value}\n          onChange={this.UIOnChange}\n          onSelect={this.UIOnSelect}\n        />\n        <button\n          hidden={newNodeBtnHidden}\n          disabled={newNodeBtnDisabled}\n          onClick={this.UINewNode}\n          type=\"button\"\n        >\n          New Node\n        </button>\n      </div>\n    );\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCSearch;\n","/* eslint-disable no-alert */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  NC Template Editor View\n  (replaces `Template.jsx`)\n\n  Displays a variety of tools to edit templates:\n  * Edit Node Types\n  * Edit Edge Types\n  * Download Current Template\n  * Create New Template\n  * Import Template from File\n\n  This is displayed on the More.jsx component/panel but can be moved\n  anywhere.\n\n  Templates can only be edited if:\n  * There are no nodes or edges being edited\n  * No one is trying to import data\n  * There are no other templates being edited\n\n  Conversely, if a Template is being edited, Import, Node and Edge editing\n  will be disabled.\n\n  ## BACKGROUND\n\n    Template data is loaded by `server-database` DB.InitializeDatabase call.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\nconst { EDITORTYPE } = require('system/util/enum');\nconst TEMPLATE_MGR = require('../template-editor-mgr');\nconst LOCKMGR = require('../lock-mgr');\nconst SCHEMA = require('../template-schema');\nconst DATASTORE = require('system/datastore');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nclass NCTemplate extends UNISYS.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      disableEdit: false,\n      isBeingEdited: false,\n      editScope: undefined, // Determines whether the user is tring to edit the\n      // template's root (everything in the template),\n      // or just focused on a subsection: nodeTypeOptions,\n      // edgeTypeOptions\n      tomlfile: undefined,\n      tomlfileStatus: '',\n      tomlfileErrors: undefined,\n      tomlfilename: 'loading...'\n    };\n    this.urstate_LOCKSTATE = this.urstate_LOCKSTATE.bind(this);\n    this.loadEditor = this.loadEditor.bind(this);\n    this.disableOrigLabelFields = this.disableOrigLabelFields.bind(this);\n    this.releaseOpenEditor = this.releaseOpenEditor.bind(this);\n    this.onNewTemplate = this.onNewTemplate.bind(this);\n    this.onCurrentTemplateLoad = this.onCurrentTemplateLoad.bind(this);\n    this.onEditNodeTypes = this.onEditNodeTypes.bind(this);\n    this.onEditEdgeTypes = this.onEditEdgeTypes.bind(this);\n    this.onTOMLfileSelect = this.onTOMLfileSelect.bind(this);\n    this.onDownloadTemplate = this.onDownloadTemplate.bind(this);\n    this.onSaveChanges = this.onSaveChanges.bind(this);\n    this.onCancelEdit = this.onCancelEdit.bind(this);\n\n    this.OnAppStateChange('LOCKSTATE', this.urstate_LOCKSTATE);\n  } // constructor\n\n  componentDidMount() {\n    const LOCKSTATE = this.AppState('LOCKSTATE');\n    this.urstate_LOCKSTATE(LOCKSTATE);\n    DATASTORE.GetTemplateTOMLFileName().then(result => {\n      this.setState({ tomlfilename: result.filename });\n    });\n  }\n\n  componentWillUnmount() {\n    this.releaseOpenEditor();\n    this.AppStateChangeOff('LOCKSTATE', this.urstate_LOCKSTATE);\n  }\n\n  /// UI EVENT HANDLERS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  urstate_LOCKSTATE(LOCKSTATE) {\n    // someone else might be editing a template or importing or editing node or edge\n    const disableEdit =\n      LOCKSTATE.templateBeingEdited ||\n      LOCKSTATE.importActive ||\n      LOCKSTATE.nodeOrEdgeBeingEdited;\n    this.setState({ disableEdit });\n  }\n\n  /// METHODS /////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * Was Load JSON Editor\n   * -- If schema is not defined, the default schema is used\n   * -- If startval is not defined, an empty template created from the default\n   *    schema is used.\n   * @param {object} parms { schema, startval }\n   * @param {function} cb - Callback function\n   */\n  loadEditor(parms, cb) {\n    LOCKMGR.RequestEditLock(EDITORTYPE.TEMPLATE).then(data => {\n      console.error('NCTemplate.loadEditor NOT IMPLEMENTED', data);\n    });\n  }\n\n  // When editing Node or Edge Type Options, the original label field should be\n  // disabled so they can't be edited\n  // ClassName added in template-schema.GetTypeEditorSchema()\n  disableOrigLabelFields() {\n    const origLabelFields = document.getElementsByClassName('disabledField');\n    // origLabelFields is a HTMLCollection, not an array\n    // FISHY FIX...is the use of arrow function here correct? The arrow function\n    // arg 'f' is shadowing the 'const f' in the for...of...\n    for (const f of origLabelFields) f => f.setAttribute('disabled', 'disabled');\n  }\n\n  releaseOpenEditor() {\n    LOCKMGR.RequestEditUnlock(EDITORTYPE.TEMPLATE);\n  }\n\n  onNewTemplate() {\n    this.setState({ editScope: 'root', isBeingEdited: true });\n    this.loadEditor(); // new blank template with default schema\n  }\n\n  onCurrentTemplateLoad(e) {\n    this.AppCall('EDIT_CURRENT_TEMPLATE') // nc-logic\n      .then(result => {\n        this.setState({ editScope: 'root', isBeingEdited: true });\n        this.loadEditor({ startval: result.template });\n      });\n  }\n\n  onEditNodeTypes() {\n    // REVIEW: Once this is working we'll need to use lock-mgr to manage locking\n    this.AppCall('EDIT_CURRENT_TEMPLATE') // nc-logic\n      .then(result => {\n        const schemaNodeTypeOptions = SCHEMA.NODETYPEOPTIONS;\n        // Wrap options in custom Schema to show Delete management UI\n        const nodeTypeEditorSchema =\n          SCHEMA.GetTypeEditorSchema(schemaNodeTypeOptions);\n        const startval = { options: result.template.nodeDefs.type.options };\n        this.setState({ editScope: 'nodeTypeOptions', isBeingEdited: true });\n        this.loadEditor(\n          {\n            schema: nodeTypeEditorSchema,\n            startval\n          },\n          () => {\n            this.disableOrigLabelFields();\n            // HACK: After a row is added, we need to also disable the newly added\n            // \"Label\" field -- the new label should be added in the \"Change To\" field\n            EDITOR.on('addRow', editor => {\n              this.disableOrigLabelFields();\n            });\n          }\n        );\n      });\n  }\n\n  onEditEdgeTypes() {\n    // REVIEW: Once this is working we'll need to use lock-mgr to manage locking\n    this.AppCall('EDIT_CURRENT_TEMPLATE') // nc-logic\n      .then(result => {\n        const schemaEdgeTypeOptions = SCHEMA.EDGETYPEOPTIONS;\n        // Wrap options in custom Schema to show Delete management UI\n        const edgeTypeEditorSchema =\n          SCHEMA.GetTypeEditorSchema(schemaEdgeTypeOptions);\n        const startval = { options: result.template.edgeDefs.type.options };\n        this.setState({ editScope: 'edgeTypeOptions', isBeingEdited: true });\n        this.loadEditor(\n          {\n            schema: edgeTypeEditorSchema,\n            startval\n          },\n          () => {\n            this.disableOrigLabelFields();\n            // HACK: After a row is added, we need to also disable the newly added\n            // \"Label\" field -- the new label should be added in the \"Change To\" field\n            EDITOR.on('addRow', editor => {\n              this.disableOrigLabelFields();\n            });\n          }\n        );\n      });\n  }\n\n  onTOMLfileSelect(e) {\n    // import\n    const tomlfile = e.target.files[0];\n    TEMPLATE_MGR.ValidateTOMLFile({ tomlfile }).then(result => {\n      if (result.isValid) {\n        console.log('got template', result.templateJSON);\n        this.onSaveChanges(result.templateJSON);\n      } else {\n        const errorMsg = result.error;\n        this.setState({\n          tomlfile: undefined,\n          tomlfileStatus: 'Invalid template file!!!',\n          tomlfileErrors: errorMsg\n        });\n        this.releaseOpenEditor();\n      }\n    });\n  }\n\n  onDownloadTemplate() {\n    TEMPLATE_MGR.DownloadTemplate();\n  }\n\n  onSaveChanges(templateJSON) {\n    TEMPLATE_MGR.SaveTemplateToFile(templateJSON).then(result => {\n      console.error('onSaveChanges', result, templateJSON);\n      if (!result.OK) {\n        alert(result.info);\n      } else {\n        alert(`Template Saved: ${templateJSON.name}`);\n        this.setState({ isBeingEdited: false });\n      }\n      this.releaseOpenEditor();\n    });\n  }\n\n  onCancelEdit() {\n    this.setState({ isBeingEdited: false });\n    this.releaseOpenEditor();\n  }\n\n  /// REACT LIFECYCLE METHODS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  render() {\n    const {\n      disableEdit,\n      isBeingEdited,\n      tomlfile,\n      tomlfileStatus,\n      tomlfileErrors,\n      tomlfilename\n    } = this.state;\n    let editorjsx;\n\n    if (disableEdit && !isBeingEdited) {\n      // Node or Edge is being edited, show disabled message\n      editorjsx = (\n        <div>\n          <p>\n            <i>\n              Templates cannot be edited while someone is editing a node, edge, or\n              template, or importing data.\n            </i>\n          </p>\n          <p>\n            <i>Please finish editing and try again.</i>\n          </p>\n        </div>\n      );\n    } else {\n      // OK to Edit, show edit buttons\n      editorjsx = (\n        <div hidden={isBeingEdited}>\n          <p>\n            <b>PROCEED WITH CAUTION!</b>: Editing templates will modify the data in\n            your dataset and may leave your dataset in an unusable state. Only{' '}\n            <b>expert users</b> who know how the data is set up should do this.\n          </p>\n          <div\n            style={{\n              display: 'grid',\n              gridTemplateColumns: 'repeat(2, 1fr)',\n              columnGap: '10px',\n              rowGap: '5px'\n            }}\n          >\n            <i className=\"small text-muted\">Edit Current Template Options</i>\n            <br />\n            <button size=\"sm\" onClick={this.onEditNodeTypes} disabled>\n              Edit Node Types\n            </button>\n            <button size=\"sm\" onClick={this.onEditEdgeTypes} disabled>\n              Edit Edge Types\n            </button>\n          </div>\n          <div>\n            <div style={{ color: 'red' }}>\n              [Edit Node Types] and [Edit Edge Types] are currently disabled because\n              JSON Editor has been deprecated. Stay tuned for return of that\n              functionality.\n            </div>\n            <p></p>\n            <p></p>\n            <hr />\n            <hr />\n            <p>ADVANCED USERS ONLY</p>\n            <p></p>\n            <div>\n              <i className=\"small text-muted\">\n                Import TOML template (replace existing template)\n              </i>\n              <br />\n              <label>\n                <input\n                  type=\"file\"\n                  accept=\"text/toml\"\n                  id=\"tomlfileInput\"\n                  onChange={this.onTOMLfileSelect}\n                />\n                &nbsp;<i>{tomlfileStatus}</i>\n                <br />\n                {tomlfileErrors && (\n                  <span style={{ color: 'red' }}>{tomlfileErrors}</span>\n                )}\n              </label>\n            </div>\n            <p></p>\n            <i className=\"small text-muted\">Current Template</i>\n            <br />\n            <button size=\"sm\" onClick={this.onDownloadTemplate}>\n              Download Current Template\n            </button>\n            <p></p>\n            <i className=\"small text-muted\">Create New Template</i>\n            <br />\n            <button size=\"sm\" onClick={this.onNewTemplate} disabled>\n              New Template\n            </button>\n            <br />\n            <div style={{ color: 'red' }}>\n              [New Template] is disabled because JSON Editor has been deprecated. Stay\n              tuned for return of that functionality.\n            </div>\n            <p></p>\n          </div>\n          <hr />\n        </div>\n      );\n    }\n    return (\n      <div\n        style={{\n          backgroundColor: '#0003',\n          padding: '10px 20px'\n        }}\n      >\n        <h4>Template Editor</h4>\n        <p>\n          <label>Current Template File Name:</label> <code>{tomlfilename}</code>\n        </p>\n        {editorjsx}\n        <div hidden={!isBeingEdited}>\n          <button onClick={this.onCancelEdit} size=\"sm\">\n            Cancel\n          </button>\n          &nbsp;\n          <button onClick={this.onSaveChanges} size=\"sm\" color=\"primary\">\n            Save Changes\n          </button>\n          <hr />\n        </div>\n        <div id=\"editor\" hidden={!isBeingEdited}></div>\n      </div>\n    );\n  }\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = NCTemplate;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## OVERVIEW\n\n     Allows admins to define user tokens.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport SESSION from 'unisys/common-session';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCUserTokens' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// export a class object for consumption by brunch/require\nfunction NCUserTokens() {\n  const DATASET = window.NC_CONFIG.dataset;\n  const [state, setState] = useState({\n    tokens: '',\n    isShareable: false,\n    classId: '',\n    projId: '',\n    templateSalt: undefined\n  });\n\n  const ref_classId = useRef(null);\n  const ref_projId = useRef(null);\n  const ref_count = useRef(null);\n\n  useEffect(() => {\n    const TEMPLATE = UDATA.AppState('TEMPLATE');\n    if (TEMPLATE && TEMPLATE.secretKey !== undefined)\n      setState(prevState => ({\n        ...prevState,\n        templateSalt: TEMPLATE.secretKey\n      }));\n  }, []);\n\n  /// UTILITY FUNCTIONS /////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function validate(str) {\n    return str.replace(/[^a-z0-9]/gi, '').slice(0, 12);\n  }\n\n  /// UI EVENT HANDLERS ///////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_ClassIdInputChange(event) {\n    const newClassId = validate(event.target.value);\n    setState(prevState => ({\n      ...prevState,\n      classId: newClassId\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_ProjIdInputChange(event) {\n    const newProjId = validate(event.target.value);\n    setState(prevState => ({\n      ...prevState,\n      projId: newProjId\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_SetShareable(event) {\n    const isChecked = event.target.checked;\n    setState(prevState => ({\n      ...prevState,\n      isShareable: isChecked,\n      tokens: ''\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_MakeTokens() {\n    const clsId = ref_classId.current.value;\n    const projId = ref_projId.current.value;\n    const numGroups = parseInt(ref_count.current.value);\n    const result = MakeTokens(clsId, projId, numGroups);\n    setState(prevState => ({\n      ...prevState,\n      tokens: result\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Generates a list of tokens using the NetCreate common-session module\n   *  REVIEW: Requiring a module from the secondary netcreate-2018 repo\n   *  is a little iffy.\n   *  @param {string} clsId - classId\n   *  @param {string} projId - projectId\n   *  @param {integer} numGroups - number of tokens to generate\n   *  @return {string}\n   */\n  function MakeTokens(clsId, projId, numGroups) {\n    // from nc-logic.js\n    if (typeof clsId !== 'string')\n      return 'args: str classId, str projId, int numGroups';\n    if (typeof projId !== 'string')\n      return 'args: str classId, str projId, int numGroups';\n    // Not really relevant for nc-logic's\n    // if (!state.isShareable && typeof templateSalt !== 'string')\n    //   return 'args: str classId, str projId, int numGroups';\n    if (clsId.length > 12) return 'classId arg1 should be 12 chars or less';\n    if (projId.length > 12) return 'classId arg1 should be 12 chars or less';\n    if (!Number.isInteger(numGroups)) return 'numGroups arg3 must be integer';\n    if (numGroups < 1) return 'numGroups arg3 must be positive integer';\n\n    // if templateSalt is not defined, then isShareable is implicitly true\n    const isShareable = state.isShareable || !state.templateSalt;\n    const salt = isShareable ? undefined : state.templateSalt;\n\n    let out = isShareable ? 'Shareable ' : '';\n    out += `TOKEN LIST for class '${clsId}' project '${projId}' `;\n    out += isShareable\n      ? 'that can be used for any graph.'\n      : `templateSalt '${state.templateSalt}'`;\n    out += `\\n\\n`;\n    let pad = String(numGroups).length;\n    for (let i = 1; i <= numGroups; i++) {\n      let id = String(i);\n      id = id.padStart(pad, '0');\n      out += `${SESSION.MakeToken(clsId, projId, i, salt)}\\n`;\n    }\n    return out;\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <div id=\"NCUserTokens\">\n      <h1>Generate User Tokens</h1>\n      <p>\n        User tokens are used to identify a user as a node, edge, and comment author.\n        They take the form <code>CLASSID-PROJID-HASH</code>. To generate a token,\n        enter a class id, a project id, and number of tokens to generate. Then click\n        &ldquo;Generate Tokens&rdquo;.\n      </p>\n      <p>\n        &ldquo;Class ID&rdquo; and &ldquo;Project ID&rdquo; can be any short\n        alphanumeric (no spaces or punctuation) string less than 12 characters.\n      </p>\n      <div className=\"form\">\n        {!state.isShareable && <label htmlFor=\"dataset\">Graph</label>}\n        {!state.isShareable && (\n          <input\n            id=\"dataset\"\n            placeholder=\"Dataset e.g. 'netcreate'\"\n            defaultValue={DATASET}\n            readOnly\n          />\n        )}\n        <label htmlFor=\"classid\">Class ID</label>\n        <input\n          id=\"classid\"\n          type=\"text\"\n          value={state.classId}\n          onChange={evt_ClassIdInputChange}\n          placeholder=\"Class ID e.g. 'PER1'\"\n          ref={ref_classId}\n        />\n        <label htmlFor=\"projid\">Project ID</label>\n        <input\n          id=\"projid\"\n          type=\"text\"\n          value={state.projId}\n          onChange={evt_ProjIdInputChange}\n          placeholder=\"Project ID e.g. 'ROME'\"\n          ref={ref_projId}\n        />\n        <label htmlFor=\"count\">Number of Tokens</label>\n        <input\n          id=\"count\"\n          type=\"number\"\n          placeholder=\"Num of tokens e.g. '10'\"\n          defaultValue=\"10\"\n          ref={ref_count}\n        />\n        <div></div>\n        <button onClick={evt_MakeTokens} className=\"cat\" role=\"button\">\n          Generate Tokens\n        </button>\n        <div></div>\n        <fieldset>\n          <legend>Advanced Options</legend>\n          {!state.templateSalt && (\n            <span style={{ color: 'red', gridColumn: 'span 2' }}>\n              WARNING: Project template secretKey not defined. Tokens will be\n              shareable for graphs without a secretKey.\n            </span>\n          )}\n          <input\n            id=\"shareable\"\n            type=\"checkbox\"\n            checked={state.isShareable || !state.templateSalt}\n            onChange={evt_SetShareable}\n            disabled={!state.templateSalt}\n          />\n          <label htmlFor=\"shareable\">\n            Shareable -- Make tokens usable for ANY graph without a template\n            secretKey.\n          </label>\n        </fieldset>\n      </div>\n      <br />\n      <label htmlFor=\"tokenDisplay\">Copy and share these tokens.</label>\n      <textarea\n        id=\"tokenDisplay\"\n        className=\"no-drag\"\n        rows=\"10\"\n        cols=\"80\"\n        placeholder=\"Tokens will appear here...\"\n        readOnly\n        defaultValue={state.tokens}\n      />\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCUserTokens;\n","import React, { useRef, useState, useCallback, useEffect } from 'react';\nimport SwatchesPicker from './SwatchesPicker.jsx';\nimport { useClickOutside } from './useeffects-library.js';\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// eventually move this to settings manager\nconst PRESET_COLORS = ['#cd9323', '#1a53d8', '#9a2151', '#0d6416', '#8d2808'];\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst PopupPicker = ({ color, onChange, name }) => {\n  const popover = useRef();\n  const [isOpen, toggle] = useState(false);\n\n  const close = useCallback(() => toggle(false), []);\n  useClickOutside(popover, close);\n\n  return (\n    <div className=\"picker\">\n      <label htmlFor={name}>${name}</label>\n      <div\n        className=\"swatch\"\n        style={{ backgroundColor: color }}\n        onClick={() => toggle(true)}\n      />\n      <div className=\"tooltip\"></div>\n      {isOpen && (\n        <div className=\"popover\" ref={popover}>\n          <SwatchesPicker\n            color={color}\n            onChange={onChange}\n            presetColors={PRESET_COLORS}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = PopupPicker;\n","import React, { useRef, useState, useEffect } from 'react';\nimport { HexColorPicker } from 'react-colorful';\n\nconst SwatchesPicker = ({ color, onChange, presetColors }) => {\n  return (\n    <div className=\"picker\">\n      <HexColorPicker color={color} onChange={onChange} />\n\n      <div className=\"picker__swatches\">\n        {presetColors.map(presetColor => (\n          <button\n            key={presetColor}\n            className=\"picker__swatch\"\n            style={{ background: presetColor }}\n            onClick={() => onChange(presetColor)}\n          />\n        ))}\n      </div>\n    </div>\n  );\n};\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = SwatchesPicker;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Generic Floating, Draggable, Closeable Window\n\n  USE:\n\n    <URButtonToggle\n      dialog={CMTSTATUS.dialog}\n    />\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState } from 'react';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'URButtonToggle';\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URButtonToggle({ title, selected, onClick, children, tabindex }) {\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  return (\n    <button\n      className={`URButtonToggle icon ${selected ? 'selected' : ''}`}\n      type=\"button\"\n      role=\"switch\"\n      aria-label={title}\n      aria-checked={selected}\n      onClick={onClick}\n      tabIndex={tabindex}\n    >\n      {children}\n    </button>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URButtonToggle;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URComment is a representation of an individual comment, used in the context\n  of a URCommentThread.\n\n  USE:\n\n    <URComment\n      cref={cref} // collection reference (e.g. node, edge, project)\n      cid={cvobj.comment_id} // comment id\n      uid={uid} // user id\n      key={cvobj.comment_id} // part of thread array\n    />\n\n  1. UI input cycle\n      URComment handles updates from by the URCommentPrompt component.\n      The data is stored locally until evt_SaveBtn is clicked, which then\n      calls comment-mgr.UpdateComment.\n  2. Data State management\n      comment-mgr saves the data to the database\n      and updates COMMENTVOJBS state, which triggers a re-render of the\n      URCommentThread component.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport UNISYS from 'unisys/client';\nimport NetMessage from 'unisys/common-netmessage-class';\nimport CMTMGR from '../comment-mgr';\nimport URCommentPrompt from './URCommentPrompt';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'URComment' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// Debug Flags\nconst DBG = false;\nconst PR = 'URComment';\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** URComment renders a single comment in the context of a URCommentThread\n *  manager.\n *  @param {string} cref - Collection reference\n *  @param {string} cid - Comment ID\n *  @param {string} uid - User ID\n *  @returns {React.Component} - URComment\n */\nfunction URComment({ cref, cid, uid }) {\n  const [element, setElement] = useState(null);\n  const [state, setState] = useState({\n    id: undefined,\n    commenter: '',\n    createtime_string: '',\n    modifytime_string: '',\n    selected_comment_type: '',\n    commenter_text: ['hah'],\n    comment_error: '',\n    uViewMode: CMTMGR.VIEWMODE.VIEW,\n    uIsSelected: false,\n    uIsBeingEdited: false,\n    uIsEditable: false,\n    uIsDisabled: false,\n    uAllowReply: false\n  });\n\n  /** Component Effect - initial comment viewobject on mount */\n  useEffect(\n    () => c_LoadCommentVObj(),\n    [] // run once because no dependencies are declared\n  );\n\n  /** Component Effect - scroll component into view on mount */\n  useEffect(() => {\n    if (element) element.scrollIntoView({ behavior: 'smooth' });\n  }, [element]);\n\n  /** Component Effect - updated comment */\n  useEffect(() => {\n    const urstate_CMT_LOCKSTATE = data => {\n      setState(prevState => ({\n        ...prevState,\n        uIsDisabled: c_IsDisabled()\n      }));\n    };\n    const urstate_UpdateCommentVObjs = () => c_LoadCommentVObj();\n\n    // hook UNISYS state change and message handlers\n    UDATA.OnAppStateChange('COMMENTVOBJS', urstate_UpdateCommentVObjs);\n    UDATA.OnAppStateChange('CMTLOCKSTATE', urstate_CMT_LOCKSTATE);\n\n    // cleanup methods for functional component unmount\n    return () => {\n      if (state.uIsBeingEdited) CMTMGR.UnlockComment(cid);\n      UDATA.AppStateChangeOff('COMMENTVOBJS', urstate_UpdateCommentVObjs);\n      UDATA.AppStateChangeOff('CMTLOCKSTATE', urstate_CMT_LOCKSTATE);\n    };\n  }, [state.uIsBeingEdited]); // run when uIsBeingEdited changes\n\n  /// COMPONENT HELPER METHODS ////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** UI is disabled if either:\n   *  - the comment is being edited by this user\n   *  - someone else is editing this comment\n   */\n  function c_IsDisabled() {\n    const LOCKSTATE = UDATA.AppState('LOCKSTATE');\n    return (\n      LOCKSTATE.lockedComments.includes(cid) || CMTMGR.GetCommentsAreBeingEdited()\n    );\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Declare helper method to load viewdata from comment manager into the\n   *  component state */\n  function c_LoadCommentVObj() {\n    // If the comment is being edited, skip the update, else we'd lose the edit\n    if (state.uIsBeingEdited) {\n      if (DBG)\n        console.log(\n          `COMMENTVOBJS Update!  ${cid} is being edited skipping update!!!`\n        );\n      return;\n    }\n\n    const cvobj = CMTMGR.GetCommentVObj(cref, cid);\n    const comment = CMTMGR.GetComment(cid);\n\n    // When deleting, COMMENTVOBJS state change will trigger a load and render\n    // before the component is unmounted.  So catch it and skip the state update.\n    if (!cvobj || !comment) {\n      console.log(\n        'c_LoadCommentVObj: comment or cvobj not found!  Usually because it has been deleted.'\n      );\n      return;\n    }\n\n    // Error check: verify that comment types exist, if not, fall back gracefully to default type\n    const { comment_error, selected_comment_type } = c_ValidateCommentType(\n      comment.comment_type\n    );\n\n    // set component state from retrieved data\n    setState({\n      // Data\n      // REVIEW MEME uses `comment.id` and NC uses `comment.comment_id`\n      id: comment.comment_id, // human readable \"#xxx\" id matching db id // MEME uses comment.id, matching pmcData id\n      comment_id_parent: comment.comment_id_parent,\n      commenter: CMTMGR.GetUserName(comment.commenter_id),\n      selected_comment_type,\n      commenter_text: [...comment.commenter_text],\n      createtime_string: cvobj.createtime_string,\n      modifytime_string: cvobj.modifytime_string,\n      // Messaging\n      comment_error,\n      // UI State\n      uViewMode: cvobj.isBeingEdited ? CMTMGR.VIEWMODE.EDIT : CMTMGR.VIEWMODE.VIEW,\n      uIsSelected: cvobj.isSelected,\n      uIsBeingEdited: cvobj.isBeingEdited,\n      uIsEditable: cvobj.isEditable,\n      uAllowReply: cvobj.allowReply,\n      uIsDisabled: c_IsDisabled()\n    });\n\n    // Lock edit upon creation of a new comment or a new reply\n    if (cvobj.isBeingEdited) CMTMGR.LockComment(comment.comment_id);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Validate selected comment type\n   *  Make sure the selected comment type exists.  If not, show error.\n   */\n  function c_ValidateCommentType(selected_comment_type) {\n    let comment_error = '';\n    if (!CMTMGR.GetCommentType(selected_comment_type)) {\n      const defaultCommentTypeObject = CMTMGR.GetDefaultCommentType();\n      comment_error = `Comment type \"${selected_comment_type}\" not found: Falling back to default  \"${defaultCommentTypeObject.label}\"`;\n      console.warn(comment_error);\n      selected_comment_type = defaultCommentTypeObject.slug;\n    }\n    // set component state from retrieved data\n    return { comment_error, selected_comment_type };\n  }\n  /// COMPONENT UI HANDLERS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle edit button, which toggles the viewmode of this URComment */\n  function evt_EditBtn() {\n    const uViewMode =\n      state.uViewMode === CMTMGR.VIEWMODE.EDIT\n        ? CMTMGR.VIEWMODE.VIEW\n        : CMTMGR.VIEWMODE.EDIT;\n    setState(prevState => ({\n      ...prevState,\n      uViewMode\n    }));\n    CMTMGR.UIEditComment(cid);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle save button, which saves the state to comment manager.\n   *  looks like there are some side effects being handled at the end */\n  function evt_SaveBtn() {\n    const { selected_comment_type, commenter_text } = state;\n    const comment = CMTMGR.GetComment(cid);\n    comment.comment_type = selected_comment_type;\n    comment.commenter_text = [...commenter_text]; // clone, not byref\n    comment.commenter_id = uid;\n    CMTMGR.UISaveComment(comment);\n    setState(prevState => ({\n      ...prevState,\n      uViewMode: CMTMGR.VIEWMODE.VIEW\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle reply button, which adds a new comment via comment manager,\n   *  updating the thread data structure associated with URCommentThread */\n  function evt_ReplyBtn() {\n    const { comment_id_parent } = state;\n    if (comment_id_parent === '') {\n      // Reply to a root comment\n      CMTMGR.AddComment({\n        cref,\n        comment_id_parent: cid,\n        comment_id_previous: '',\n        commenter_id: uid\n      });\n    } else {\n      // Reply to a threaded comment\n      CMTMGR.AddComment({\n        cref,\n        comment_id_parent,\n        comment_id_previous: cid,\n        commenter_id: uid\n      });\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle delete button, which removes the comment associated with this\n   *  commment from the comment manager */\n  function evt_DeleteBtn() {\n    const { id } = state;\n    CMTMGR.RemoveComment({\n      collection_ref: cref,\n      id,\n      comment_id: cid,\n      uid\n    });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle cancel button, which reverts the comment to its previous state,\n   *  doing additional housekeeping to keep comment manager consistent\n   *  If the comment is empty and it's a new comment, just remove it\n   * */\n  function evt_CancelBtn() {\n    const { commenter_text, id } = state;\n\n    let previouslyHadText = false;\n    CMTMGR.GetComment(cid).commenter_text.forEach(t => {\n      if (t !== '') previouslyHadText = true;\n    });\n\n    if (previouslyHadText) {\n      // revert to previous text\n      CMTMGR.UICancelComment(cid);\n      const comment = CMTMGR.GetComment(cid);\n      setState(prevState => ({\n        ...prevState,\n        modifytime_string: comment.modifytime_string,\n        selected_comment_type: comment.comment_type,\n        commenter_text: [...comment.commenter_text], // restore previous text clone, not by ref\n        comment_error: '',\n        uViewMode: CMTMGR.VIEWMODE.VIEW\n      }));\n    } else {\n      // Remove the temporary comment and unlock\n      CMTMGR.RemoveComment({\n        collection_ref: cref,\n        id,\n        comment_id: cid,\n        uid,\n        skipDialog: true\n      });\n      setState({\n        commenter_text: [],\n        uViewMode: CMTMGR.VIEWMODE.VIEW\n      });\n    }\n\n    return;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle select button, which updates the comment type associated with this\n   *  comment via comment manager */\n  function evt_TypeSelector(event) {\n    const selection = event.target.value;\n    // Error check: verify that comment types exist, if not, fall back gracefully to default type\n    const { comment_error, selected_comment_type } = c_ValidateCommentType(selection);\n    setState(prevState => ({\n      ...prevState,\n      comment_error,\n      selected_comment_type\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle input update, which updates the text associated with this comment\n   *  via comment manager */\n  function evt_CommentText(index, event) {\n    const { commenter_text } = state;\n    commenter_text[index] = event.target.value;\n    setState(prevState => ({\n      ...prevState,\n      commenter_text: [...commenter_text]\n    }));\n  }\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** The URComment conditionally renders its display state based on several\n   *  states:\n   *  - isAdmin - read from commentmgr directly\n   *  - state.uViewMode - \"edit\" or \"view\" mode of comment\n   *  - state.uIsSelected - is current selected comment\n   *  - state.uIsBeingEdited - is being live edited\n   *  - state.uIsEditable - can be edited\n   *  - state.uIsDisabled - is active/inactive\n   */\n  const {\n    commenter,\n    selected_comment_type,\n    commenter_text,\n    createtime_string,\n    modifytime_string,\n    comment_error,\n    uViewMode,\n    uIsDisabled,\n    uAllowReply\n  } = state;\n\n  const isAdmin = CMTMGR.IsAdmin();\n  const comment = CMTMGR.GetComment(cid);\n  const commentTypes = CMTMGR.GetCommentTypes();\n\n  if (!comment) {\n    if (DBG)\n      console.log(`URComment rendering skipped because comment ${cid} was removed`);\n    return '';\n  }\n  if (!commenter) return null; // not ready\n\n  // TODO Allow admins\n  const isAllowedToEditOwnComment = uid === comment.commenter_id;\n\n  /// SUB COMPONENTS\n  const EditBtn = (\n    <button className=\"outline small\" onClick={evt_EditBtn} type=\"button\">\n      Edit\n    </button>\n  );\n  const DeleteBtn = (\n    <button className=\"outline small danger\" onClick={evt_DeleteBtn} type=\"button\">\n      Delete\n    </button>\n  );\n  const SaveBtn = (\n    <button onClick={evt_SaveBtn} type=\"button\">\n      Save\n    </button>\n  );\n  const ReplyBtn = uAllowReply ? (\n    <button onClick={evt_ReplyBtn} type=\"button\">\n      Reply\n    </button>\n  ) : (\n    <div></div> // empty div to keep layout consistent\n  );\n  const CancelBtn = (\n    <button className=\"secondary\" onClick={evt_CancelBtn} type=\"button\">\n      Cancel\n    </button>\n  );\n  const TypeSelector = (\n    <label className=\"commentTypeLabel\">\n      Select a comment type\n      <select value={selected_comment_type} onChange={evt_TypeSelector}>\n        {[...commentTypes.entries()].map(type => (\n          <option key={type[0]} value={type[0]}>\n            {type[1].label}\n          </option>\n        ))}\n      </select>\n    </label>\n  );\n  const SelectedType = commentTypes.get(selected_comment_type);\n  const SelectedTypeLabel = SelectedType ? SelectedType.label : 'Type not found';\n  // Alternative three-dot menu approach to hide \"Edit\" and \"Delete\"\n  // const UIOnEditMenuSelect = event => {\n  //   switch (event.target.value) {\n  //     case 'edit':\n  //       evt_EditBtn();\n  //       break;\n  //     case 'delete':\n  //       evt_DeleteBtn();\n  //       break;\n  //     default:\n  //       break;\n  //   }\n  // };\n  // const EditMenu = (\n  //   <select className=\"editmenu\" onChange={this.UIOnEditMenuSelect}>\n  //     <option>...</option>\n  //     <option value=\"edit\">EDIT</option>\n  //     <option value=\"delete\">DELETE</option>\n  //   </select>\n  // );\n\n  const cvobj = CMTMGR.GetCommentVObj(cref, cid);\n\n  let CommentComponent;\n  if (uViewMode === CMTMGR.VIEWMODE.EDIT) {\n    // EDIT mode\n    CommentComponent = (\n      <div\n        id={cid}\n        ref={setElement}\n        className={`comment ${comment.comment_isMarkedDeleted && 'deleted'}`}\n        onMouseDown={e => e.stopPropagation()}\n      >\n        <div>\n          <div className=\"commenter\">{commenter}</div>\n          <div className=\"date\">{modifytime_string || createtime_string}</div>\n        </div>\n        <div>\n          <div className=\"commentTypeBar\">\n            <div className=\"commentTypeLabel\">{TypeSelector}</div>\n            <div className=\"commentId\">#{comment.comment_id}</div>\n          </div>\n          <URCommentPrompt\n            cref={cref}\n            commentType={selected_comment_type}\n            commenterText={commenter_text}\n            isMarkedDeleted={comment.comment_isMarkedDeleted}\n            isMarkedRead={cvobj.isMarkedRead}\n            viewMode={CMTMGR.VIEWMODE.EDIT}\n            onChange={evt_CommentText}\n            errorMessage={comment_error}\n          />\n          <div className=\"editbar\">\n            {CancelBtn}\n            {SaveBtn}\n          </div>\n        </div>\n      </div>\n    );\n  } else {\n    // VIEW mode\n    CommentComponent = (\n      <div\n        id={cid}\n        ref={setElement}\n        className={`comment ${comment.comment_isMarkedDeleted ? 'deleted' : ''} ${\n          cvobj.isMarkedRead ? '' : 'unread'\n        }`}\n        tabIndex=\"0\"\n      >\n        <div>\n          <div className=\"commenter\">{commenter}</div>\n          <div className=\"date\">{modifytime_string || createtime_string}</div>\n        </div>\n        <div>\n          <div className=\"commentTypeBar\">\n            <div className=\"commentTypeLabel\">\n              <span className=\"date\">TYPE: </span>\n              <span className=\"type\">{SelectedTypeLabel}</span>\n            </div>\n            <div className=\"commentId\">#{comment.comment_id}</div>\n          </div>\n          <URCommentPrompt\n            cref={cref}\n            commentType={selected_comment_type}\n            commenterText={commenter_text}\n            isMarkedDeleted={comment.comment_isMarkedDeleted}\n            isMarkedRead={cvobj.isMarkedRead}\n            viewMode={CMTMGR.VIEWMODE.VIEW}\n            errorMessage={comment_error}\n          />\n          {uid && !uIsDisabled && (\n            <div className=\"commentbar\">\n              {!comment.comment_isMarkedDeleted && ReplyBtn}\n              {(isAllowedToEditOwnComment &&\n                !comment.comment_isMarkedDeleted &&\n                EditBtn) || <div></div>}\n              {(((isAllowedToEditOwnComment && !comment.comment_isMarkedDeleted) ||\n                isAdmin) &&\n                DeleteBtn) || <div></div>}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n  // Simple show threads -- if comment has a parent, indent it\n  return cvobj.level > 0 ? (\n    <div className=\"commentIndented\">{CommentComponent}</div>\n  ) : (\n    CommentComponent\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URComment;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URCommentCollectionMgr\n\n  Comment collection components are dynamically created and destroyed in the\n  DOM as the user requests opening and closing comment collection windows.\n  The URCommentCollectionMgr handles the insertion and removal of these\n  components.\n\n  UR MESSAGES\n  *  CMT_COLLECTION_SHOW {cref, position}\n  *  CMT_COLLECTION_HIDE {cref}\n  *  CMT_COLLECTION_HIDE_ALL\n\n  USE:\n\n    <URCommentCollectionMgr message={message} handleMessageUpdate/>\n\n\n  HISTORY\n  Originally, URCommentBtn were designed to handle comment opening\n  in Net.Create from two types componets: nodes/edges and\n  NodeTables/EdgeTables.  Since the requests could come\n  from different components, we had to keep track of which component\n  was requesting the opening, so they could close the corresponding\n  comment.  In order to do this, we used a reference that combined\n  the comment id reference (collection reference, or cref)\n  with a unique user interface id (uuiid).\n\n  MEME doesn't need that so we simply use `cref` as the\n  comment id.\n\n  That simplifies the comment references, but there was a second\n  challenge:\n\n  Since the SVG props and mechanisms are NOT react components, we\n  cannot use URCommentBtn to manage opening and editing comments.\n  Moreover, URCommentBtns opened inside Evidence Links are embedded\n  inside the Evidence Library and comments created inside the library\n  end up hidden due to layers of overflow divs.\n\n  To get around this, URCommentCollectionMgr essentially replaces the\n  functionality of URCommentBtn with three pieces, acting as a middle\n  man and breaking out the...\n  * visual display    -- URCommentSVGBtn\n  * UI click requests -- URCommentVBtn\n  * thread opening / closing requests -- URCommentCollectionMgr\n  ...into different functions handled by different components.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport UNISYS from 'unisys/client';\n// import UR from '../../../system/ursys';\n// const STATE = require('../lib/client-state');\n\nimport CMTMGR from '../comment-mgr';\nimport URCommentThread from './URCommentThread';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = true;\nconst PR = 'URCommentCollectionMgr';\n\nconst UDATAOwner = { name: 'URCommentCollectionMgr' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URCommentCollectionMgr(props) {\n  const uid = CMTMGR.GetCurrentUserId();\n  const [cmtBtns, setCmtBtns] = useState([]);\n  const [dummy, setDummy] = useState(0); // Dummy state variable to force update\n\n  /** Component Effect - register listeners on mount */\n  useEffect(() => {\n    UDATA.OnAppStateChange('COMMENTVOBJS', redraw, UDATAOwner);\n    UDATA.HandleMessage('CMT_COLLECTION_SHOW', urmsg_COLLECTION_SHOW);\n    UDATA.HandleMessage('CMT_COLLECTION_HIDE', urmsg_COLLECTION_HIDE);\n    UDATA.HandleMessage('CMT_COLLECTION_HIDE_ALL', urmsg_COLLECTION_HIDE_ALL);\n\n    return () => {\n      UDATA.AppStateChangeOff('COMMENTVOBJS', redraw);\n      UDATA.UnhandleMessage('CMT_COLLECTION_SHOW', urmsg_COLLECTION_SHOW);\n      UDATA.UnhandleMessage('CMT_COLLECTION_HIDE', urmsg_COLLECTION_HIDE);\n      UDATA.UnhandleMessage('CMT_COLLECTION_HIDE_ALL', urmsg_COLLECTION_HIDE_ALL);\n    };\n  }, []);\n\n  /// COMPONENT HELPER METHODS ////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  /// UR HANDLERS /////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function redraw(data) {\n    // This is necessary to force a re-render of the threads\n    // when the comment collection changes on the net\n    // especially when a new comment is added.\n    setDummy(dummy => dummy + 1); // Trigger re-render\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * Handle urmsg_COLLECTION_SHOW message\n   * 1. Register the button, and\n   * 2. Open the URCommentBtn\n   * @param {Object} data\n   * @param {string} data.cref - Collection reference\n   * @param {Object} data.position - Position of the button\n   */\n  function urmsg_COLLECTION_SHOW(data) {\n    if (DBG) console.log(PR, 'CMT_COLLECTION_SHOW', data);\n    setCmtBtns(prevBtns => [...prevBtns, data]);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urmsg_COLLECTION_HIDE(data) {\n    if (DBG) console.log(PR, 'CMT_COLLECTION_HIDE', data);\n    setCmtBtns(prevBtns => prevBtns.filter(btn => btn.cref !== data.cref));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urmsg_COLLECTION_HIDE_ALL(data) {\n    if (DBG) console.log(PR, 'CMT_COLLECTION_HIDE_ALL', data);\n    setCmtBtns([]);\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  return (\n    <div className=\"URCommentCollectionMgr\">\n      {cmtBtns.map(btn => (\n        <URCommentThread\n          key={btn.cref}\n          uiref={btn.cref}\n          cref={btn.cref}\n          uid={uid}\n          x={btn.position.x}\n          y={btn.position.y}\n        />\n      ))}\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URCommentCollectionMgr;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URCommentPrompt\n\n  In edit mode, displays input widgets for entering prompts.\n  In view mode, displays static comment prompt.\n  A comment can contain one or more comment prompts.\n  Each prompt can use a different prompt format.\n\n  PROMPT FORMATS:\n    - text\n    - dropdown\n    - checkbox\n    - likert\n    - radio\n    - discrete-slider\n\n  Prompt formats use exact `text` matching to determine the selected item,\n  not an index.  So if you change the label on the prompt type, you will\n  have to update the selection as well.  The rationale for this is that\n  we want the comment database data to be as human-readable as possible.\n  Otherwise comment data would mostly be a series of indices that you\n  would have to back-match:\n    - dropdown\n    - likert\n    - radio\n  The exceptions are:\n    - checkbox -- matches `text` within a \\n-delimited string\n    - discrete-slider -- matches based on the selected index value\n                         In this case, using the value makes sense\n                         because the saved data is a number.\n\n  This uses a lot of props because it really is a helper componnent for\n  URComment.  The current state is maintained in URComment, but during\n  edit, input updates are stored temporarily in this component.\n\n  USE:\n\n    <URCommentPrompt\n      cref={cref}  // collection reference (e.g. node, edge, project)\n      commentType={comment_type} // currently selected comment type, not stored comment.comment_type\n      commenterText={commenter_text}\n      isMarkedDeleted={comment.comment_isMarkedDeleted}\n      isMarkedRead={cvobj.isMarkedRead}\n      viewMode={uViewMode}\n      onChange={this.UIOnInputUpdate}\n      errorMessage={comment_error}\n    />\n\n    We use props (especially `commenter_text`) here because URComment stores the\n    current interim state of the comment text during editing.  The `commment`\n    object stores the previous saved state.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport CMTMGR from '../comment-mgr';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Debug Flags\nconst DBG = false;\nconst PR = 'URCommentPrompt';\n/// Constants\nconst CHECKBOX_DELIMITER = /\\n/;\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URCommentPrompt({\n  cref,\n  commentType,\n  commenterText,\n  isMarkedDeleted,\n  isMarkedRead,\n  viewMode,\n  onChange,\n  errorMessage\n}) {\n  const commentTypes = CMTMGR.GetCommentTypes();\n\n  /** Component Effect - set the focus to the first empty field on\n   *  entering edit mode, or selecting a new comment type\n   */\n  useEffect(() => {\n    if (viewMode === CMTMGR.VIEWMODE.EDIT) {\n      // find the first empty `text` prompt\n      let foundIndex = -1;\n      commentTypes.get(commentType).prompts.find((prompt, promptIndex) => {\n        if (prompt.format === 'text' && !commenterText[promptIndex]) {\n          foundIndex = promptIndex;\n          return true;\n        }\n      });\n      // set focus to the found empty 'text' prompt\n      const foundTextArea = document.getElementById(u_TextareaId(cref, foundIndex));\n      if (foundTextArea) foundTextArea.focus();\n    }\n  }, [viewMode, commentType]);\n\n  /// UTILITIES ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Used for radio buttons to indicate that there is nothing selected\n   * @param {string} commenterTextStr current radio button value\n   * @returns {boolean} true if the string is empty\n   */\n  function u_IsEmpty(commenterTextStr) {\n    return (\n      commenterTextStr === undefined ||\n      commenterTextStr === null ||\n      commenterTextStr === ''\n    );\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Converts `index` into \"prompt-<index>\" for use in HTML id attributes */\n  function u_TextareaId(cref, index) {\n    return `prompt-${cref}-${index}`;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * Converts \"Apple Pie\\nApple Fritter\" into [\"Apple Pie\", \"Apple Fritter\"]\n   * @param {string} commenterTextStr newline delimited string, e.g. \"Apple Pie\\nApple Fritter\"\n   * @returns {string[]} updated commenter text\n   */\n  function u_SplitCheckboxCommentText(commenterTextStr) {\n    if (!commenterTextStr) return [];\n    return commenterTextStr.split(CHECKBOX_DELIMITER);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * Converts a selection 0-based index into a stacked discrete slider string\n   * to save as comment text, e.g. 2 becomes `★★★`\n   * Each option can have a different value\n   * @param {number} index the selected item index (0-based)\n   * @param {string[]} options e.g.  ['💙', '💚', '💛', '🧡', '🩷']\n   * @returns {string} e.g. 2 returns '💙💚💛'\n   */\n  function u_SelectedIndex2CommentText(index, options) {\n    return options.map((o, i) => (i <= index ? o : '')).join('');\n  }\n\n  /// COMPONENT UI HANDLERS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * handles checkbox changing by\n   * 1. combining all checkbox items into a single newline-delimited string\n   * 2. calling onChange handler with derived data for checkboxes\n   * e.g. \"Apple\\nBanana\"\n   * @param {number} promptIndex index pointing to the currently active prompt\n   * @param {number} optionIndex index of the checkbox option item\n   * @param {Object} options all of the checkbox options\n   * @param {Object} event\n   */\n  function evt_OnCheck(promptIndex, optionIndex, options, event) {\n    // e.g. selectedCheckboxes =  [\"Apple Pie\", \"Apple Fritter\"]\n    const selectedCheckboxes = u_SplitCheckboxCommentText(commenterText[promptIndex]);\n    let items = [];\n    options.forEach((o, index) => {\n      if (optionIndex === index) {\n        // handle the current selection\n        if (event.target.checked) items[index] = o;\n        else items[index] = '';\n      } else {\n        // handle previous selections\n        if (selectedCheckboxes.includes(o)) items[index] = o;\n        else items[index] = '';\n      }\n    });\n    event.target.value = items.join('\\n');\n    onChange(promptIndex, event);\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** URCommentPrompt renders its display state based on:\n   *  - viewMode -- \"edit\" or \"view\" mode\n   */\n  const RenderEditMode = () => {\n    return commentTypes.get(commentType).prompts.map((prompt, promptIndex) => {\n      let inputJSX;\n      switch (prompt.format) {\n        case 'text':\n          inputJSX = (\n            <textarea\n              id={u_TextareaId(cref, promptIndex)}\n              autoFocus\n              onChange={event => onChange(promptIndex, event)}\n              value={commenterText[promptIndex] || ''}\n            />\n          );\n          break;\n        case 'dropdown':\n          if (!prompt.options.includes(commenterText[promptIndex])) {\n            // currently selected value does not match an item in the dropdown\n            // fall back to the first item in the dropdown\n            if (prompt.options.length > 0)\n              commenterText[promptIndex] = prompt.options[0];\n            else {\n              console.warn(\n                `Dropdown for ${commentType} has no options!  Check definition!`\n              );\n              commenterText[promptIndex] = ''; // fall back to an empty string\n            }\n          }\n          inputJSX = (\n            <select\n              value={commenterText[promptIndex] || ''}\n              onChange={event => onChange(promptIndex, event)}\n            >\n              {prompt.options.map((option, index) => (\n                <option key={index} value={option}>\n                  {option}\n                </option>\n              ))}\n            </select>\n          );\n          break;\n        case 'checkbox': {\n          // converts commment text into [\"Apple\", \"Banana\"]\n          const selectedCheckboxes = u_SplitCheckboxCommentText(\n            commenterText[promptIndex]\n          );\n          inputJSX = (\n            <div className=\"prompt\">\n              {prompt.options.map((option, optionIndex) => (\n                <label key={optionIndex}>\n                  <input\n                    type=\"checkbox\"\n                    value={option}\n                    onChange={event =>\n                      evt_OnCheck(promptIndex, optionIndex, prompt.options, event)\n                    }\n                    checked={selectedCheckboxes.includes(option)}\n                  />\n                  {option}\n                </label>\n              ))}\n            </div>\n          );\n          break;\n        }\n        case 'radio':\n          inputJSX = (\n            <div>\n              {prompt.options.map((option, index) => (\n                <label key={index}>\n                  <input\n                    type=\"radio\"\n                    value={option}\n                    onChange={event => onChange(promptIndex, event)}\n                    checked={commenterText[promptIndex] === option}\n                  />\n                  {option}\n                </label>\n              ))}\n            </div>\n          );\n          break;\n        case 'likert':\n          inputJSX = (\n            <div className=\"prompt\">\n              {prompt.options.map((option, optionIndex) => (\n                <button\n                  key={optionIndex}\n                  value={option}\n                  className={\n                    commenterText[promptIndex] === option ? 'selected' : 'notselected'\n                  }\n                  onClick={event => onChange(promptIndex, event)}\n                >\n                  {option}\n                </button>\n              ))}\n            </div>\n          );\n          break;\n        case 'discrete-slider':\n          inputJSX = (\n            <div className=\"prompt\">\n              {prompt.options.map((option, index) => (\n                <button\n                  key={index}\n                  value={[index, u_SelectedIndex2CommentText(index, prompt.options)]}\n                  className={\n                    String(index) <= commenterText[promptIndex]\n                      ? 'selected'\n                      : 'notselected'\n                  }\n                  onClick={event => onChange(promptIndex, event)}\n                >\n                  {option}\n                </button>\n              ))}\n            </div>\n          );\n          break;\n        default:\n          break;\n      }\n      return (\n        <div key={promptIndex}>\n          <div className=\"label\">{prompt.prompt}</div>\n          <div className=\"help\">{prompt.help}</div>\n          {inputJSX}\n          <div className=\"feedback\">{prompt.feedback}</div>\n          <div className=\"error\">{errorMessage}</div>\n        </div>\n      );\n    });\n  };\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const RenderViewMode = () => {\n    const NOTHING_SELECTED = <span className=\"help\">(nothing selected)</span>;\n    if (isMarkedDeleted) return <div className=\"commenttext\">DELETED</div>;\n    return commentTypes.get(commentType).prompts.map((prompt, promptIndex) => {\n      let displayJSX;\n      switch (prompt.format) {\n        case 'text':\n        case 'dropdown':\n        case 'radio':\n          displayJSX = (\n            <div className=\"commenttext\">\n              {!isMarkedDeleted && commenterText[promptIndex]}\n              {u_IsEmpty(commenterText[promptIndex]) && NOTHING_SELECTED}\n            </div>\n          );\n          break;\n        case 'checkbox': {\n          const selectedCheckboxes = u_SplitCheckboxCommentText(\n            commenterText[promptIndex]\n          );\n          displayJSX = (\n            <div className=\"prompt\">\n              {prompt.options.map((option, optionIndex) => (\n                <label key={optionIndex}>\n                  <input\n                    type=\"checkbox\"\n                    value={option}\n                    checked={selectedCheckboxes.includes(option)}\n                    readOnly // React will emit warning if there isn't an onChange handler\n                    className={'readonly'} // css: class is necessary for styling\n                    // css: `input[type='checkbox']:read-only` doesn't work -- it matches non-`readOnly` too\n                    // css: `disabled` grays out the checkbox too much, use the css class to style\n                  />\n                  {option}\n                </label>\n              ))}\n            </div>\n          );\n          break;\n        }\n        case 'likert':\n          displayJSX = (\n            <div className=\"prompt\">\n              {prompt.options.map((option, index) => (\n                <button\n                  key={index}\n                  value={option}\n                  className={\n                    commenterText[promptIndex] === option ? 'selected' : 'notselected'\n                  }\n                  disabled\n                >\n                  {option}\n                </button>\n              ))}\n            </div>\n          );\n          break;\n        case 'discrete-slider':\n          displayJSX = (\n            <div className=\"prompt\">\n              {prompt.options.map((option, index) => (\n                <button\n                  key={index}\n                  value={option}\n                  className={\n                    String(index) <= commenterText[promptIndex]\n                      ? 'selected'\n                      : 'notselected'\n                  }\n                  disabled\n                >\n                  {option}\n                </button>\n              ))}\n            </div>\n          );\n          break;\n        default:\n          break;\n      }\n\n      return (\n        <div key={promptIndex} className=\"comment-item\">\n          <div className=\"label\">{prompt.prompt}</div>\n          {/* <div className=\"help\">{prompt.help}</div> */}\n          {displayJSX}\n          {/* <div className=\"feedback\">{prompt.feedback}</div> */}\n          <div className=\"error\">{errorMessage}</div>\n        </div>\n      );\n    });\n  };\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return viewMode === CMTMGR.VIEWMODE.EDIT ? RenderEditMode() : RenderViewMode();\n}\n\nexport default URCommentPrompt;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URCommentSVGBtn\n\n  A purely visual button that uses SVG Symbols.\n  Relies on props to render.\n\n  USE:\n      <URCommentSVGBtn\n        uiref={cref}\n        count={countRepliesToMe}\n        hasUnreadComments={countRepliesToMe > 0}\n        hasReadComments={countRepliesToMe === 0}\n        selected={false}\n        disabled={false}\n        small={false}\n        onClick={evt_ExpandPanel}\n      />\n\n  Used by:\n  - URCommentStatus\n\n  Displays three visual states:\n  - read/unread status\n    - has unread comments (gold color)\n    - all comments are read (gray color)\n  - is open / selected (displaying comments)\n  - the number of comments.\n\n\n  NOTE: Unlike MEME's implementation, we do not use svgjs\n        we retain svgjs for documentation purposes only.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useRef, useState, useEffect } from 'react';\nimport CMTMGR from '../comment-mgr';\n\n// MEME implementation\n// import { SVG } from '@svgdotjs/svg.js'; // esm version // MEME implementation\n// import './URComment.css'; // MEME implementation\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URCommentSVGBtn({\n  uiref,\n  count,\n  hasUnreadComments,\n  hasReadComments,\n  selected,\n  disabled,\n  small,\n  onClick,\n  ariaLabel = `Comments (${count})`\n}) {\n  // REVIEW: Remove?  not being used?\n  const svgRef = useRef(null);\n\n  const [state, setState] = useState({\n    label: '',\n    css: '',\n    svgClass: ''\n  });\n\n  /// USEEFFECT ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    // MEME implementation\n    // const draw = SVG(svgRef.current);\n\n    c_DrawCommentIcon();\n\n    return () => {\n      // MEME implementation\n      // draw.remove();\n    };\n  }, []);\n\n  useEffect(() => {\n    c_DrawCommentIcon();\n  }, [count, hasUnreadComments, hasReadComments, selected]);\n\n  /// COMPONENT HELPER METHODS ////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function c_DrawCommentIcon() {\n    // css\n    let css = ' ';\n    if (hasUnreadComments) css += 'hasUnreadComments ';\n    else if (hasReadComments) css += 'hasReadComments ';\n    css += selected ? 'isOpen ' : '';\n    css += disabled ? 'disabled ' : '';\n\n    const commentCountLabel = count > 0 ? count : ' ';\n\n    let SVGClass = 'svgcmt-unread';\n    if ((hasReadComments && !hasUnreadComments) || count === '' || count === 0) {\n      // it's possible to have both read and unread comments\n      // if there's anything unread, we want to mark it unread\n      if (selected) SVGClass = 'svgcmt-readSelected';\n      else SVGClass = 'svgcmt-read-outlined'; // only vprops use non-outlined\n    } else {\n      // hasUnreadComments or no comments\n      if (selected) SVGClass = 'svgcmt-unreadSelected';\n      else SVGClass = 'svgcmt-unread';\n    }\n\n    setState({\n      label: commentCountLabel,\n      css,\n      svgClass: SVGClass\n    });\n\n    // MEME implementation\n    // const draw = SVG(svgRef.current);\n    // draw.clear();\n    // draw\n    //   .group()\n    //   .attr('class', svgDefKey)\n    //   .add(CMTMGR.COMMENTICON)\n    //   // .add(CMTMGR.COMMENTICON(draw).clone())\n    //   // .add(SVGDEFS.get('comment').clone())\n    //   .transform({\n    //     translate: [4, 0], // center within 32,32\n    //     origin: 'top left', // seems to default to 'center' if not specified\n    //     scale: small ? 0.9 : 1.6\n    //   });\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  const size = small ? '24' : '32';\n  return (\n    <button\n      id={uiref}\n      className={'commentbtn' + state.css}\n      onClick={onClick}\n      disabled={disabled}\n      type=\"button\"\n      role=\"switch\"\n      aria-label={ariaLabel}\n      aria-checked={selected}\n    >\n      <div className=\"comment-count\">{state.label}</div>\n      <svg width={size} height={size}>\n        <g className={state.svgClass}>{CMTMGR.COMMENTICON}</g>\n      </svg>\n    </button>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URCommentSVGBtn;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URCommentStatus displays a summary of new comments being added across the\n  network in the nav bar.  There are two views:\n  - uiIsExpanded = false: A count of the most recent read and unread comments\n  - uiIsExpanded = true: The full list of the the most recent comments\n  In addition, there are two commands:\n  - \"Mark All Read\" will mark all of the messages in the status list \"read\"\n  - Close will close the status list\n\n  The comment status messages remain visible through the whole user session.\n  Marking all messages as \"read\" will clear the status list.\n\n  USE:\n\n    <URCommentStatus message={message} handleMessageUpdate/>\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport UNISYS from 'unisys/client';\nimport CMTMGR from '../comment-mgr';\nimport URCommentCollectionMgr from './URCommentCollectionMgr';\nimport URCommentSVGBtn from './URCommentSVGBtn';\nimport URDialog from './URDialog';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for functional react component\nconst UDATAOwner = { name: 'URCommentStatus' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n\n/// Debug Flags\nconst DBG = false;\nconst PR = 'URCommentStatus';\n/// Animation Timers\nlet AppearTimer;\nlet DisappearTimer;\nlet ResetTimer;\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** URCommentStatus renders a summary of new comments in the nav bar.\n * @param {*} props currently not used\n * @returns\n */\nfunction URCommentStatus(props) {\n  const uid = CMTMGR.GetCurrentUserId();\n\n  const [CMTSTATUS, setCMTSTATUS] = useState({});\n\n  const [message, setMessage] = useState('');\n  const [messages, setMessages] = useState([]);\n  const [activeCSS, setActiveCSS] = useState('');\n  const [uiIsExpanded, setUiIsExpanded] = useState(false);\n  const [dummy, setDummy] = useState(0); // Dummy state variable to force update\n\n  // const ref_commentbar = useRef(null);\n  const ref_commentstatus_close = useRef(null);\n\n  /** Component Effect - register listeners on mount */\n  useEffect(() => {\n    UDATA.OnAppStateChange('CMTSTATUS', state_CMTSTATUS, UDATAOwner);\n    UDATA.OnAppStateChange('COMMENTCOLLECTION', redraw, UDATAOwner); // respond to close\n    UDATA.HandleMessage('COMMENTS_UPDATE', redraw);\n    UDATA.HandleMessage('COMMENT_UPDATE', urmsg_COMMENT_UPDATE);\n\n    return () => {\n      UDATA.AppStateChangeOff('CMTSTATUS', state_CMTSTATUS, UDATAOwner);\n      UDATA.AppStateChangeOff('COMMENTCOLLECTION', redraw, UDATAOwner); // respond to close\n      UDATA.UnhandleMessage('COMMENTS_UPDATE', redraw);\n      UDATA.UnhandleMessage('COMMENT_UPDATE', urmsg_COMMENT_UPDATE);\n      clearTimeout(AppearTimer);\n      clearTimeout(DisappearTimer);\n      clearTimeout(ResetTimer);\n    };\n  }, []);\n\n  useEffect(() => {\n    // wcag set focus to the close button when the panel is expanded\n    if (uiIsExpanded && ref_commentstatus_close.current) {\n      ref_commentstatus_close.current.focus();\n    }\n  }, [uiIsExpanded]);\n\n  /// UR HANDLERS /////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function state_CMTSTATUS(CMTSTATUS) {\n    setCMTSTATUS(CMTSTATUS);\n  }\n\n  /** force re-render after COMMENTS_UPDATE from a new comment another user */\n  function redraw() {\n    // This is necessary to force a re-render of the comment summaries\n    // when the comment collection changes on the net\n    setDummy(dummy => dummy + 1); // Trigger re-render\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** animate the addition of new comment messages after a new comment from another user */\n  function urmsg_COMMENT_UPDATE(data) {\n    const { comment, uaddr } = data;\n\n    const my_uaddr = UNISYS.SocketUADDR();\n    const isNotMe = my_uaddr !== uaddr;\n\n    // clone the comment object so we can modify the reply text\n    // otherwise we inadvertently change the commenter_id\n    const status_comment = Object.assign({}, comment);\n    if (\n      status_comment &&\n      status_comment.commenter_text &&\n      status_comment.commenter_text.length > 0\n    ) {\n      let source;\n      if (status_comment.comment_id_parent) {\n        source = `${status_comment.commenter_id} replied: `;\n      } else {\n        source = `${status_comment.commenter_id} commented: `;\n      }\n      status_comment.commenter_id = source;\n      const message = c_GetCommentItemJSX(status_comment);\n      setMessages(prevMessages => [...prevMessages, message]);\n\n      // Only show status update if it's coming from another\n      if (isNotMe) {\n        clearTimeout(AppearTimer);\n        clearTimeout(DisappearTimer);\n        clearTimeout(ResetTimer);\n        // clear it first, then appear (so that each new comment triggers the animation)\n        setMessage(message);\n        AppearTimer = setTimeout(() => {\n          setActiveCSS('appear');\n        }, 250);\n        DisappearTimer = setTimeout(() => {\n          setActiveCSS('disappear');\n        }, 8000);\n        ResetTimer = setTimeout(() => {\n          setMessage('');\n          setActiveCSS('');\n        }, 13000); // should equal the `disappear` ease-in period + 'disappear' timeout\n      } else {\n        setDummy(dummy => dummy + 1); // force update to update counts\n      }\n    }\n  }\n\n  /// COMPONENT UI HANDLERS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_ExpandPanel() {\n    clearTimeout(DisappearTimer);\n    clearTimeout(ResetTimer);\n    setActiveCSS('appear');\n    setUiIsExpanded(true);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_KeyDownExpandPanel(event) {\n    // handle focus\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      event.stopPropagation();\n      evt_ExpandPanel();\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_Close() {\n    setMessage('');\n    setActiveCSS('');\n    setUiIsExpanded(false);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_MarkAllRead() {\n    CMTMGR.MarkAllRead();\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_OpenReferent(event, cref) {\n    event.preventDefault();\n    event.stopPropagation();\n    CMTMGR.OpenReferent(cref);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_OpenComment(event, cref, cid) {\n    event.preventDefault();\n    event.stopPropagation();\n    CMTMGR.OpenCommentStatusComment(cref, cid);\n  }\n\n  /// RENDER HELPERS //////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Renders each comment item summary as a JSX element\n   *  @param {TCommentObject} comment\n   *  @returns {JSX.Element}\n   */\n  function c_GetCommentItemJSX(comment) {\n    if (comment.comment_isMarkedDeleted) return ''; // was marked deleted, so skip\n    const cref = comment ? comment.collection_ref : '';\n    const { typeLabel, sourceLabel } = CMTMGR.GetCREFSourceLabel(cref);\n    if (sourceLabel === undefined) return ''; // source was deleted, so skip\n    return (\n      <div className=\"comment-item\" key={comment.comment_id}>\n        <div className=\"comment-sourcetype\">{typeLabel}&nbsp;</div>\n        <a\n          href=\"#\"\n          className=\"comment-sourcelabel\"\n          onClick={event => evt_OpenReferent(event, cref)}\n        >\n          {sourceLabel}\n        </a>\n        <div className=\"commenter\">: {comment.commenter_id}&nbsp;</div>\n        <a\n          href=\"#\"\n          onClick={event => evt_OpenComment(event, cref, comment.comment_id)}\n        >{`#${comment.comment_id}`}</a>\n        <div className=\"comment-text\">\n          &nbsp;&ldquo;\n          {String(comment.commenter_text.join('|')).trim()}\n          &rdquo;\n        </div>\n      </div>\n    );\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  // Uncomment this line to disable the comments if not logged in\n  // if (!uid) return ''; // if not logged in, there's no comment status\n\n  const { countRepliesToMe, countUnread } = CMTMGR.GetCommentStats();\n  const unreadRepliesToMe = CMTMGR.GetUnreadRepliesToMe();\n  const unreadRepliesToMeItems = unreadRepliesToMe.map(comment =>\n    c_GetCommentItemJSX(comment)\n  );\n  const unreadComments = CMTMGR.GetUnreadComments();\n  const unreadCommentItems = unreadComments.map(comment =>\n    c_GetCommentItemJSX(comment)\n  );\n\n  const UnreadRepliesToMeButtonJSX = (\n    <div className=\"comment-summary-item\">\n      <URCommentSVGBtn\n        uiref=\"unreadRepliesToMe\"\n        count={countRepliesToMe}\n        hasUnreadComments={countRepliesToMe > 0}\n        hasReadComments={countRepliesToMe === 0}\n        selected={false}\n        disabled // display only\n        onClick={evt_ExpandPanel}\n        ariaLabel={`Unread replies to me (${countRepliesToMe})`}\n      />\n      <label htmlFor=\"unreadRepliesToMe\">unread replies to me</label>\n    </div>\n  );\n  const UnreadButtonJSX = (\n    <div className=\"comment-summary-item\">\n      <URCommentSVGBtn\n        uiref=\"unread\"\n        count={countUnread}\n        hasUnreadComments={countUnread > 0}\n        hasReadComments={countUnread === 0}\n        selected={false}\n        disabled // display only\n        onClick={evt_ExpandPanel}\n        ariaLabel={`Unread comments (${countUnread})`}\n      />\n      <label htmlFor=\"unread\">unread</label>\n    </div>\n  );\n\n  return (\n    <div>\n      <div id=\"comment-bar\">\n        <div\n          id=\"comment-alert\"\n          className={`${activeCSS} ${uiIsExpanded ? ' expanded' : ''}`}\n        >\n          {!uiIsExpanded && <div className=\"comment-status-body\">{message}</div>}\n        </div>\n        <div>\n          <div\n            id=\"comment-summary\"\n            className={`${uiIsExpanded ? ' expanded' : ''}`}\n            onClick={evt_ExpandPanel}\n            onKeyDown={evt_KeyDownExpandPanel}\n            role=\"button\"\n            tabIndex=\"0\"\n            aria-label={`Expand Comment Status`}\n          >\n            {UnreadRepliesToMeButtonJSX}&nbsp;{UnreadButtonJSX}\n          </div>\n          <div\n            id=\"comment-panel\"\n            className={`${uiIsExpanded ? ' expanded' : ''}`}\n            onClick={evt_Close}\n            role=\"button\"\n          >\n            <div className=\"comments-unread\">\n              {UnreadRepliesToMeButtonJSX}\n              <div className=\"comment-status-body\">{unreadRepliesToMeItems}</div>\n              {UnreadButtonJSX}\n              <div className=\"comment-status-body\">{unreadCommentItems}</div>\n              <div className=\"commentbar\">\n                <button\n                  className=\"small\"\n                  onClick={evt_Close}\n                  role=\"button\"\n                  ref={ref_commentstatus_close}\n                >\n                  Close\n                </button>\n                <button className=\"small\" onClick={evt_MarkAllRead} role=\"button\">\n                  Mark All Read\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <URCommentCollectionMgr />\n      <URDialog info={CMTSTATUS.dialog} />\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URCommentStatus;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URCommentThread displays all of the comments and replies for a given referent\n  object.  It is a draggable window that can be opened and closed by the user\n  via the URCommentBtn.  Clickin \"X\" or close will mark all comments as \"read\".\n\n  USE:\n\n    <URCommentThread\n      uiref\n      cref={collection_ref}\n      uid\n      x\n      y\n    />\n\n  PROPS:\n    * uiref   -- reference to the ui component that opened the thread, usu commentButtonId\n    * cref    -- collection reference (usu node id, edge id)\n    * uid     -- user id of current active user viewing or changing comment\n    * x,y     -- position of open comment thread used to set proximity to\n                 comment button\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport Draggable from 'react-draggable';\nimport UNISYS from 'unisys/client';\nimport CMTMGR from '../comment-mgr';\nimport URComment from './URComment';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'URCommentThread' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// Debug Flags\nconst DBG = false;\nconst PR = 'URCommentThread';\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** URCommentThread renders the set of individual comments and replies\n *  (URComment) in a single window.  Handles marking comments as \"read\"\n *  when the thread is closed.\n */\nfunction URCommentThread({ uiref, cref, uid, x, y }) {\n  const [forceRender, setForceRender] = useState(0); // Dummy state variable to force update\n\n  /** Component Effect - set up listeners on mount */\n  useEffect(() => {\n    UDATA.OnAppStateChange('CMTLOCKSTATE', urmsg_ForceRender);\n\n    return () => {\n      UDATA.AppStateChangeOff('CMTLOCKSTATE', urmsg_ForceRender);\n    };\n  }, []);\n\n  /// UR HANDLERS /////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urmsg_ForceRender() {\n    // This is necessary to force a re-render of \"Click to add a Comment\"\n    // text area if the comment edit is cancelled and placeholder\n    // comment is removed\n    // Current disabled state is refreshed with each render\n    setForceRender(forceRender => forceRender + 1); // Trigger re-render\n  }\n\n  /// COMPONENT UI HANDLERS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handles clicking the \"Click to add a Comment\" textarea to create a new\n   *  coment.\n   */\n  function evt_OnAddComment() {\n    const commentVObjs = CMTMGR.GetThreadedViewObjects(cref, uid);\n    const numComments = commentVObjs.length;\n    if (numComments < 1) {\n      // Add first root comment\n      CMTMGR.AddComment({\n        cref,\n        comment_id_parent: '',\n        comment_id_previous: '',\n        commenter_id: uid\n      });\n    } else {\n      // Add reply to last ROOT comment in thread (last comment at level 0)\n      const lastComment = commentVObjs.reverse().find(cvobj => cvobj.level === 0);\n      CMTMGR.AddComment({\n        cref,\n        comment_id_parent: '',\n        comment_id_previous: lastComment.comment_id,\n        commenter_id: uid\n      });\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_OnKeyDown(event) {\n    // \"Enter\" adds a new comment\n    if (event.key === 'Enter') {\n      // ignore tabs changing focus\n      event.preventDefault();\n      event.stopPropagation();\n      evt_OnAddComment();\n    }\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handles the \"X\" or \"Close\" button click, marks all comments \"read\" */\n  function evt_OnClose() {\n    CMTMGR.CloseCommentCollectionAndMarkRead(uiref, cref, uid);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handles clicking on the name of the object being commented on\n   *  opens the object -- useful for finding the source object if the\n   *  thread window has moved.\n   */\n  function evt_OnReferentClick(event, cref) {\n    event.preventDefault();\n    event.stopPropagation();\n    CMTMGR.OpenReferent(cref);\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const commentVObjs = CMTMGR.GetThreadedViewObjects(cref, uid);\n  const isDisabled = CMTMGR.GetCommentsAreBeingEdited();\n\n  /// SUB COMPONENTS\n  const CloseBtn = (\n    <button onClick={evt_OnClose} disabled={isDisabled}>\n      Close\n    </button>\n  );\n\n  // HACK: To keep the comment from going off screen:\n  const windowHeight = Math.min(screen.height, window.innerHeight);\n  // max 350 ensures that comments near the bottom of the screen\n  const commentMaxHeight = `${Math.max(350, windowHeight - y - 100)}px`;\n\n  const { typeLabel, sourceLabel } = CMTMGR.GetCREFSourceLabel(cref);\n\n  // This is the text area that the user clicks to add a comment\n  // emulates Google Doc comments\n  const showAddCommentClickTarget = !CMTMGR.GetCommentsAreBeingEdited();\n\n  return (\n    <Draggable>\n      <div\n        className=\"commentThread\"\n        style={{ left: `${x}px`, top: `${y}px`, maxHeight: commentMaxHeight }}\n        onClick={e => e.stopPropagation()}\n      >\n        <div className=\"topbar\">\n          <div className=\"commentTitle\">\n            Comments on {typeLabel}{' '}\n            <a\n              href=\"#\"\n              onClick={event => evt_OnReferentClick(event, cref)}\n              aria-label={sourceLabel}\n            >\n              {sourceLabel}\n            </a>\n          </div>\n          {!isDisabled && (\n            <button\n              className=\"closeBtn\"\n              onClick={evt_OnClose}\n              type=\"button\"\n              aria-label=\"Close\"\n            >\n              X\n            </button>\n          )}\n        </div>\n        <div className=\"commentScroller\">\n          {commentVObjs.map(cvobj => (\n            <URComment\n              cref={cref}\n              cid={cvobj.comment_id}\n              uid={uid}\n              key={cvobj.comment_id}\n            />\n          ))}\n          {showAddCommentClickTarget && !isDisabled && uid && (\n            <textarea\n              className=\"add\"\n              placeholder=\"Click to add a Comment...\"\n              readOnly\n              onClick={evt_OnAddComment}\n              onKeyDown={evt_OnKeyDown}\n              autoFocus\n            ></textarea>\n          )}\n          {!uid && commentVObjs.length < 1 && (\n            <div className=\"label\" style={{ textAlign: 'center' }}>\n              No comments\n            </div>\n          )}\n        </div>\n        <div className=\"commentbar\">{CloseBtn}</div>\n      </div>\n    </Draggable>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URCommentThread;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URCommentVBtn\n\n  NOTE: This is a different implementation from Net.Create's.\n        MEME's URCommentVBtn\n        * uses props only for id (instead of ALL parameters)\n        * id is `cref` (instead of `uiref)`\n        * comment state is derived from global state objects (not props)\n\n  A display button that calls URCommentCollectionMgr to open comments.\n  It emulates the visual functionality of URCommentBtn but is not a parent\n  of the URCommentThread and does not directly handle the opening and closing\n  of URCommentThreads.  URCommentThreads are opened separately via\n  URCommentCollectionMgr.\n\n  FUNCTIONALITY:\n    URCommentVBtn does five things:\n    1. Displays whether the comment thread is open (bordered) or closed (no border)\n    2. Displays the number of comments in the thread\n    3. Provides the position of the source component requesting the thread\n    4. Requests URCommentCollectionMgr to open the comment thread\n    5. Requests URCommentCollectionMgr to close the comment thread\n    4. // REVIEW: isDisabled is not used -- where do we get that status forom?\n\n  USE:\n\n    <URCommentVBtn\n      cref={collection_ref}\n    />\n\n  PROPS:\n    * cref    -- collection reference (usu node id, edge id)\n\n  USED BY:\n    * URCommentStatus > URCommentCollectionMgr\n    * Navbar\n    * ELink\n\n  NOTE unlike URCommentBtn, URCommentVBtn does not use the unique user\n  interface id (uuiid) to differentiate comment buttons on EVLinks vs props.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport UNISYS from 'unisys/client';\nimport CMTMGR from '../comment-mgr';\nimport URCommentSVGBtn from './URCommentSVGBtn';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for functional react component\nconst UDATAOwner = { name: 'URCommentVBtn' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// Debug Flags\nconst DBG = false;\nconst PR = 'URCommentVBtn';\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** URCommentVBtn\n *  @param {string} cref - Collection reference\n *  @returns {React.Component} - URCommentVBtn\n */\nfunction URCommentVBtn({ cref }) {\n  const btnRef = useRef(null);\n  const [state, setState] = useState({\n    count: 0,\n    hasUnreadComments: false,\n    hasReadComments: false,\n    isOpen: false\n  });\n\n  /// USEEFFECT ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    c_Update();\n    // Handlers\n    UDATA.OnAppStateChange('COMMENTCOLLECTION', urstate_UpdateCollection, UDATAOwner);\n    UDATA.OnAppStateChange('COMMENTVOBJS', urstate_UpdateVObj, UDATAOwner);\n    // window.addEventListener('resize', evt_OnResize);\n    // clean up on unmount\n    return () => {\n      UDATA.AppStateChangeOff('COMMENTCOLLECTION', urstate_UpdateCollection);\n      UDATA.AppStateChangeOff('COMMENTVOBJS', urstate_UpdateVObj, UDATAOwner);\n      // window.removeEventListener('resize', evt_OnResize);\n    };\n  }, []);\n\n  useEffect(() => {\n    c_Update();\n  }, [cref]);\n\n  /// UR HANDLERS /////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urstate_UpdateCollection(COMMENTCOLLECTION) {\n    c_Update();\n  }\n  function urstate_UpdateVObj(COMMENTVOBJS) {}\n\n  /// COMPONENT HELPER METHODS ////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  function c_Update() {\n    const ccol = CMTMGR.GetCommentCollection(cref) || {};\n    const { hasReadComments, hasUnreadComments } = ccol;\n\n    const uistate = CMTMGR.GetCommentUIState(cref);\n    const isOpen = uistate ? uistate.isOpen : false;\n\n    // commentCountLabel\n    const commentCount = CMTMGR.GetCommentCollectionCount(cref);\n\n    setState({\n      count: commentCount,\n      hasUnreadComments,\n      hasReadComments,\n      isOpen\n    });\n  }\n  /// COMPONENT UI HANDLERS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** handle URCommentBtn click, which opens and closes the URCommentThread */\n  function evt_OnClick(event) {\n    event.stopPropagation();\n    if (state.isOpen) {\n      // is currently open, so close it\n      const uid = CMTMGR.GetCurrentUserId();\n      CMTMGR.CloseCommentCollection(cref, cref, uid);\n    } else {\n      // is currently closed, so open it\n      CMTMGR.OpenCommentCollectionByCref(cref);\n    }\n  }\n  /// DEPRECATED FOR NOW\n  /// -- URCommentCollectionMgr should handle window resize?\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // /** handles window resize, which will adjust the URCommentThread window\n  //  *  position relative to the resized location of the URCommentBtn\n  //  */\n  // function evt_OnResize() {\n  //   const position = c_GetCommentThreadPosition();\n  //   setPosition(position);\n  // }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <div ref={btnRef}>\n      <URCommentSVGBtn\n        uiref={cref}\n        count={state.count}\n        hasUnreadComments={state.hasUnreadComments}\n        hasReadComments={state.hasReadComments}\n        selected={state.isOpen}\n        onClick={evt_OnClick}\n        ariaLabel={`Comments (${state.count})`}\n      />\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URCommentVBtn;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  URDateField\n\n  A general date input field that can support a variety of calendar formats\n  for historical projects, e.g. 1000 AD, 10,000 BCE.\n\n  The intent is to provide a unstructured input field that allows users to\n  enter arbitrary date-related strings that can be parsed by the application\n  well enough to support filtering and sorting.\n\n  This is primarily used for data input rather than timestamping.\n\n  The input field itself is intended to be flexible, using the `chrono-node`\n  library to parse a wide variety of date formats.\n  1. The user inputs a raw date-related string, e.g. \"circa 1492\"\n  2. The component then interprets the parsed date and offers a selection of\n     formats for the user to choose from.  The user has the option to select\n     the format \"as entered\" or to choose from a list of suggested formats\n     based on the parsed date.\n  3. The selected format is then displayed in the field.\n  4. When the user clicks \"Save\", the date is saved as\n      {value: \"raw date string\", format: \"selected format\"}\n\n  Formats are dynamically generated based on the available parsed date,\n  displaying only formats that match the the parsed dimensions. For example, if\n  the parsed data includes a year, month, and day, the component will offer\n  a variety of formats including \"April 1, 2024\" and \"2024/4/1\". If the parsed\n  date only includes a year and month, the component will offer formats like\n  \"April 2024\" and \"2024/4\", but not \"April 1, 2024\" if the day is missing.\n  If the parsed date only includes a year, the component will offer formats\n  like \"2024\" and \"2024 CE\", etc.\n\n  Eras are handled via a template setting. The user can set the era to BCE/CE or BC/AD.\n  Dates can be entered in any format, e.g. \"2024 BCE\", \"2024 BC\", \"2024 CE\",\n  but the selected format will use the format defined in the template, e.g.\n  if the eras format is set to \"BCE/CE\", entering \"1024 ad\" will be formatted\n  as \"1024 CE\".  (If you select \"as entered\" as the format you can still use \"1024 ad\")\n\n  For ambiguous years, adding a \"CE\" or \"AD\" to the end of the date can\n  clarify the era. For example, \"102\" can't be parsed, but \"102 ad\"\n  will parse the input as a year.\n\n  You can add extra descriptive text to the field.  As long as the field can\n  interpret the date, the exact text doesn't matter.  So you can add other\n  descriptive text as part of the field and sorting and filtering should still\n  work.  This doesn't work if the input can't be interpreted.  And you do have\n  to make sure the interpretation is correct.\n\n  The stored value of a historical date field includes:\n  - The raw input string (`value`)\n  - The selected format ('format')\n  - The formatted date string (`formattedDateString`)\n  The final output is then dynamically generated based on the selection.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport HDATE from 'system/util/hdate';\nimport UNISYS from 'unisys/client';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for functional react component\nconst UDATAOwner = { name: 'URDateField' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\nconst DBG = false;\nconst PR = 'URDateField';\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URDateField({\n  id,\n  value = '', // string or {value, format, formattedDateString}\n  dateFormat = 'AS_ENTERED',\n  allowFormatSelection = false,\n  readOnly,\n  onChange,\n  helpText,\n  isFilter = false,\n  disabled = false\n}) {\n  /// CONSTANTS + STATES\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const inputRef = useRef(null);\n  const cursorPos = useRef(0);\n\n  const [hdate, setHDate] = useState({\n    value: typeof value === 'object' ? value.value : value,\n    format: allowFormatSelection ? value.format || dateFormat : dateFormat,\n    formattedDateString: value.formattedDateString || ''\n  });\n  const [dateValidationStr, setValidationStr] = useState(); // human-readable verification e.g. 'month:2024'\n  const [formatMenuOptions, setFormatMenuOptions] = useState([\n    { value: 'AS_ENTERED', preview: 'as entered' }\n  ]);\n\n  /// Component Effect - set up listeners on mount */\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    // 1. Copy state to local variables\n    const result = { ...hdate };\n    result.value = typeof value === 'object' ? value.value : value;\n    result.format = allowFormatSelection ? value.format || dateFormat : dateFormat;\n\n    // 2. Parse and format the date based on selected format\n    const ParsingResult = HDATE.Parse(result.value);\n    const knownValues =\n      ParsingResult.length > 0 ? ParsingResult[0].start.knownValues : {};\n    result.formattedDateString = HDATE.GetPreviewStr(\n      result.value,\n      knownValues,\n      result.format\n    );\n\n    // 3. Save derived values\n    const dateValidationResults = HDATE.ShowValidationResults(ParsingResult);\n    setValidationStr(dateValidationResults ? dateValidationResults.join(' ') : '');\n    setFormatMenuOptions(\n      HDATE.ShowMatchingFormats(ParsingResult, result.format, allowFormatSelection)\n    );\n\n    // 4. Save State\n    setHDate(result);\n\n    // 5. Force change so that the current format is changed when the field is opened\n    if (onChange && hdate.formattedDateString !== result.formattedDateString)\n      c_HandleChange(result);\n  }, [value, dateFormat]);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Retain cursor position across updates\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.selectionStart = cursorPos.current;\n      inputRef.current.selectionEnd = cursorPos.current;\n    }\n  }, [hdate.value]);\n\n  /// COMPONENT UI HANDLERS ///////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function c_HandleChange(result) {\n    // 2. Parse and format the date based on selected format\n    const ParsingResult = HDATE.Parse(result.value);\n    const knownValues =\n      ParsingResult.length > 0 ? ParsingResult[0].start.knownValues : {};\n    result.formattedDateString = HDATE.GetPreviewStr(\n      result.value,\n      knownValues,\n      result.format\n    );\n\n    // 3. Send input string, format, and formattedDateString to onChange handler\n    const eventWithFormat = { target: {} };\n    eventWithFormat.target.id = id;\n    eventWithFormat.target.value = result;\n    onChange(eventWithFormat);\n  }\n\n  /** Handle user text input updates, parse and format the date string based\n   *  on the input values, and trigger the onChange handler.\n   */\n  function evt_OnInputUpdate(event) {\n    // Copy state to local variables\n    const result = { ...hdate };\n    result.value = event.target.value;\n    cursorPos.current = event.target.selectionStart;\n    c_HandleChange(result);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Handle user selection of a date format.  Formats the current date field\n   *  with the selected format, and trigger the onChange handler.\n   */\n  function evt_OnFormatSelect(event) {\n    // Copy state to local variables\n    const result = { ...hdate };\n    result.format = event.target.value;\n    c_HandleChange(result);\n  }\n\n  /// RENDER /////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const READONLY = <div className=\"viewvalue\">{hdate.formattedDateString}</div>;\n\n  const FILTER = (\n    <div className=\"urdate\">\n      <div className=\"filter\">\n        <input\n          ref={inputRef}\n          id={id}\n          className={dateValidationStr === '' ? 'not-validated' : ''}\n          onChange={evt_OnInputUpdate}\n          value={hdate.value}\n          placeholder=\"...\"\n          disabled={disabled}\n        />\n        <div className=\"validator\">{dateValidationStr}</div>\n      </div>\n    </div>\n  );\n\n  const NORMAL = (\n    <div className=\"urdate\">\n      <div className=\"help\">{helpText}</div>\n      <div className=\"help\">Enter a date</div>\n      <input\n        ref={inputRef}\n        id={id}\n        className={dateValidationStr === '' ? 'not-validated' : ''}\n        onChange={evt_OnInputUpdate}\n        value={hdate.value}\n        disabled={disabled}\n      />\n      <div className=\"validator\">{dateValidationStr}</div>\n      <div className=\"help\">Display as</div>\n      {allowFormatSelection ? (\n        <select\n          onChange={evt_OnFormatSelect}\n          value={hdate.format}\n          disabled={!allowFormatSelection}\n        >\n          {formatMenuOptions.map(option => (\n            <option key={option.value} value={option.value}>\n              {option.preview}\n            </option>\n          ))}\n        </select>\n      ) : (\n        <div>{hdate.formattedDateString}</div>\n      )}\n    </div>\n  );\n\n  if (readOnly) return READONLY;\n  if (isFilter) return FILTER;\n  return NORMAL;\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URDateField;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Generic Dialog\n\n  USE:\n\n    <URDialog\n      dialog={CMTSTATUS.dialog}\n    />\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React from 'react';\nimport Draggable from 'react-draggable';\n// import './URDialog.css'; // MEME-only\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'URDialog';\n\n/// REACT COMPONENT ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URDialog({ info }) {\n  if (info === undefined) return null;\n\n  const {\n    isOpen,\n    message = 'Are you sure?',\n    okmessage = 'OK',\n    cancelmessage = 'Cancel',\n    onOK, // function\n    onCancel // function\n  } = info;\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  const BTN_OK = (\n    <button onClick={onOK} autoFocus>\n      {okmessage}\n    </button>\n  );\n  const BTN_CANCEL = onCancel ? (\n    <button onClick={onCancel} type=\"button\">\n      {cancelmessage}\n    </button>\n  ) : (\n    ''\n  );\n\n  return (\n    isOpen && (\n      <div id=\"urdialog\">\n        <div className=\"screen\"></div>\n        <Draggable>\n          <div className=\"dialogwindow\">\n            <div className=\"dialogmessage\">{message}</div>\n            <div className=\"dialogcontrolbar\">\n              {BTN_CANCEL}\n              {`\\u00a0`}\n              {BTN_OK}\n            </div>\n          </div>\n        </Draggable>\n      </div>\n    )\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URDialog;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Generic Floating, Draggable, Closeable Window\n\n  USE:\n\n    <URPopover\n      dialog={CMTSTATUS.dialog}\n    />\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState } from 'react';\nimport Draggable from 'react-draggable';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'URPopover';\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URPopover({ title, onClose, children }) {\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const BTN_CLOSE = (\n    <button\n      className=\"icon\"\n      type=\"button\"\n      role=\"button\"\n      aria-label=\"Close\"\n      onClick={onClose}\n    >\n      <img src=\"images/icn_plus.svg\" alt=\"\" />\n    </button>\n  );\n  return (\n    <Draggable cancel=\".no-drag\">\n      <div id=\"popover\">\n        <div className=\"popover-toolbar\">\n          {title}\n          {BTN_CLOSE}\n        </div>\n        <div className=\"popover-content\">{children}</div>\n      </div>\n    </Draggable>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URPopover;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n\nUR Table\n\nImplements a table with resizable and sortable columns.\nEmulates the API of Handsontable.\nUsed also on https://github.com/netcreateorg/netcreate-itest/\n\n# API - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n## Renderers\n  This emulates Handsontable's renderer concept.\n  * A renderer is a function that takes a value and returns a JSX element\n  * If a column has a renderer, it will be used to render the value in the cell\n\n## Sorters\n  This emulates Handsontable's sorter concept.\n  * A sorter is a function that takes a key, the table data, and the sort order\n  * If a column has a sorter, it will be used to sort the table data\n\n## Column Widths\n  * Column widths can be set in the column definition\n  * Columns without a width will be evenly distributed\n\n## Column Types\n  Note that `type` determines both the default renderer and sorter\n  but they can be separately overriden.\n\n\n# User Interaction - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n## Resizing Columns\n  * Columns can be resized by dragging the right edge of the column header\n    The column to the right of the dragged edge will expand or contract\n  * Max resize -- Resizing is done between two columns: the current column,\n  and the column to the right. (We assume the table width is fixed or 100%).\n  To give you simple, but finer control over resizing columns, you can expand or\n  contract the current column and the next column up/down to a minimum size.\n  Once you hit the max size, you need to resize other columns to adjust.\n  (We don't allow you to resize neighboring columns once you've hit the\n  max/min just to simplify the math).\n\n## Sort Order\n  By default the table is unsorted.\n  * Clicking on a column header will sort the table by that column in ascending order\n  * Subsequent clicks will toggle to descending to unsorted and back to ascending\n  * The next sort order is highlighted on hover with a transparent arrow\n  * The column remembers the previous sort order when another column is selected\n    so re-selecting the column will restore the previous sort order\n  * A column can be designated unsortable by setting `sortDisabled` to `true`\n\n## Tooltips\n  * Tooltips are displayed when hovering over a cell\n  * The tooltip text is the same as the cell text\n  * Tooltips can be disabled by setting `tipDisabled` to `true`\n\n# PROPS - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  `tableData`: array\n      The data to be displayed in the table.\n\n      [\n        { id: 1, label: 'Constantinople', founding: '100 ce' },\n        { id: 2, label: 'Athens', founding: '1000 bce' },\n        { id: 3, label: 'Cairo', founding: '3000 bce' },\n      ]\n\n  `isOpen`: boolean\n      To optimize performance, the column widths are only calculated\n      when it's open.\n\n  `columns`: array\n      Specifications for how each column is to be rendered and sorted.\n\n      Column Definition\n        title: string\n        data: string\n        type: 'text' | 'text-case-insensitive' | 'number' | 'timestamp' | 'markdown' | 'hdate'\n        width: number in px\n        renderer: (value: any) => JSX.Element\n        sorter: (key: string, tdata: any[], order: number) => any[]\n        sortDisabled: boolean\n        tipDisabled: boolean\n\n  Example usage:\n\n    const COLUMNDEFS = [\n      {\n        title: 'TITLE',\n        data: 'title',\n        type: 'text',\n        width: 300, // in px\n        renderer: this.RendererTitle,\n        sorter: (key, tdata, order) => {\n          const sortedData = [...tdata].sort((a, b) => {\n            // note `title` is stuffed into `tdata`\n            if (a[key].title < b[key].title) return order;\n            if (a[key].title > b[key].title) return order * -1;\n            return 0;\n          });\n          return sortedData;\n        }\n      },\n      {\n        title: 'UPDATED',\n        data: 'dateModified',\n        type: 'text',\n        width: 300 // in px\n      },\n    ]\n\n    const TABLEDATA = modelsWithGroupLabels.map(model => {\n      return {\n        id: model.id,\n        title: model.title,\n        groupLabel: model.groupLabel,\n        dateModified: HumanDate(model.dateModified),\n        dateCreated: HumanDate(model.dateCreated)\n      };\n    });\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\n/// LIBRARIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nimport React, { useState, useEffect, useRef } from 'react';\nimport HDATE from 'system/util/hdate';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n\nconst SORTORDER = new Map();\nSORTORDER.set(0, '▲▼');\nSORTORDER.set(1, '▲');\nSORTORDER.set(-1, '▼');\n\nconst HumanDateCache = new Map();\nconst HumanDateShortCache = new Map();\n\n/// FUNCTIONAL COMPONENT DECLARATION //////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction URTable({ isOpen, data, columns }) {\n  const [_tabledata, setTableData] = useState([]);\n  const [_columndefs, setColumnDefs] = useState([]);\n  const [_columnWidths, setColumnWidths] = useState([]);\n  const [_sortColumnIdx, setSortColumnIdx] = useState(0);\n  const [_sortOrder, setSortOrder] = useState(0);\n  const [_previousColSortOrder, setPreviousColSortOrder] = useState({});\n\n  const ref_Table = useRef(null);\n  const ref_Resize = useRef(null);\n\n  /// USE EFFECT //////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Init table data\n  useEffect(() => {\n    setTableData(data);\n    // default to ascending when a column is first clicked\n    const defaultSortOrders = {};\n    columns.forEach((item, idx) => (defaultSortOrders[idx] = -1));\n    setPreviousColSortOrder(defaultSortOrders);\n  }, []);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Calculate Initial Column Widths\n  useEffect(() => {\n    // ...AFTER the table is opened otherwise the table width is 0 at the first render\n    if (isOpen) {\n      // Only calculate widths if the table is open\n      u_CalculateColumnWidths();\n    }\n  }, [isOpen]);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Update column definitions\n  useEffect(() => {\n    // Set columns independently of the table data so that data can be updated\n    // without affecting columns\n    setColumnDefs(columns);\n    u_CalculateColumnWidths();\n  }, [columns]);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Update table data\n  useEffect(() => {\n    m_ExecuteSorter(data);\n  }, [data]);\n  // Handle column sort selection\n  useEffect(() => {\n    // Sort table data\n    m_ExecuteSorter(data);\n  }, [_sortColumnIdx, _sortOrder, _previousColSortOrder]);\n\n  /// UTILITIES ///////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// e.g. Jan 7 10:05:29 AM\n  function u_HumanDate(timestamp) {\n    if (timestamp === undefined || timestamp === '') return '<no date>';\n\n    // Check cache first\n    if (HumanDateCache.has(timestamp)) return HumanDateCache.get(timestamp);\n\n    const date = new Date(timestamp);\n    const timestring = date.toLocaleTimeString('en-Us', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit'\n    });\n    const datestring = date.toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    });\n\n    // Cache the result\n    // - Clear cache if it gets too large\n    if (HumanDateCache.size > 2048) HumanDateCache.clear();\n    HumanDateCache.set(timestamp, `${datestring} ${timestring}`);\n\n    return `${datestring} ${timestring}`;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// e.g. 1/7/25 10:05a\n  function u_HumanDateShort(timestamp) {\n    if (timestamp === undefined || timestamp === '') return '<no date>';\n\n    // Check cache first\n    if (HumanDateShortCache.has(timestamp)) return HumanDateShortCache.get(timestamp);\n\n    const date = new Date(timestamp);\n    const timestring = date.toLocaleTimeString('en-Us', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n    const datestring = date.toLocaleDateString('en-US', {\n      month: '2-digit',\n      day: '2-digit',\n      year: '2-digit'\n    });\n\n    // Cache the result\n    // - Clear cache if it gets too large\n    if (HumanDateShortCache.size > 2048) HumanDateShortCache.clear();\n    HumanDateShortCache.set(timestamp, `${datestring} ${timestring}`);\n\n    return `${datestring} ${timestring}`;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const u_CalculateColumnWidths = () => {\n    // if table is not drawn yet, skip\n    if (ref_Table.current.clientWidth < 1) return;\n\n    // if it's already set, don't recalculate\n    if (_columnWidths.length > 0 && ref_Table.current.clientWidth > 0) {\n      return;\n    }\n\n    const definedColWidths = columns.filter(col => col.width).map(col => col.width);\n    const definedColWidthSum = definedColWidths.reduce((a, b) => a + b, 0);\n    const remainingWidth = ref_Table.current.clientWidth - definedColWidthSum;\n    const colWidths = columns.map(\n      col => col.width || remainingWidth / (columns.length - definedColWidths.length)\n    );\n    setColumnWidths(colWidths);\n  };\n\n  /// RESIZE COLUMN HANDLERS //////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const ui_MouseDown = (event, index) => {\n    event.preventDefault();\n    event.stopPropagation();\n    ref_Resize.current = {\n      index,\n      startX: event.clientX,\n      startWidth: _columnWidths[index],\n      nextStartWidth: _columnWidths[index + 1],\n      maxCombinedWidth: _columnWidths[index] + _columnWidths[index + 1] - 50\n    };\n  };\n  const ui_MouseMove = event => {\n    if (ref_Resize.current !== null) {\n      const { index, startX, startWidth, nextStartWidth, maxCombinedWidth } =\n        ref_Resize.current;\n      const delta = event.clientX - startX;\n      const newWidths = [..._columnWidths];\n      newWidths[index] = Math.min(Math.max(50, startWidth + delta), maxCombinedWidth); // Minimum width set to 50px\n      newWidths[index + 1] = Math.min(\n        Math.max(50, nextStartWidth - delta),\n        maxCombinedWidth\n      );\n      setColumnWidths(newWidths);\n    }\n  };\n  const ui_MouseUp = () => {\n    ref_Resize.current = null; // Reset on mouse up\n  };\n\n  /// CLICK HANDLERS //////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_SetSelectedColumn(event, index) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (_columndefs[index].sortDisabled) return; // If sort is disabled, do nothing\n\n    if (_sortColumnIdx === index) {\n      // if already selected, toggle the sort order\n      let newSortOrder;\n      if (_sortOrder === 0) newSortOrder = -1;\n      else if (_sortOrder > 0) newSortOrder = 0;\n      else newSortOrder = 1;\n      setSortOrder(newSortOrder);\n    } else {\n      // otherwise default to the previous order\n      setSortOrder(_previousColSortOrder[index]);\n    }\n\n    // update the previous sort order\n    setPreviousColSortOrder({\n      ..._previousColSortOrder,\n      [_sortColumnIdx]: _sortOrder\n    });\n\n    setSortColumnIdx(index);\n  }\n\n  /// BUILT-IN SORTERS ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function m_SortByText(key, tdata, order) {\n    const sortedData = [...tdata].sort((a, b) => {\n      if (DBG) console.log('sort by text', a[key], b[key]);\n      if (!a[key] && !b[key]) return 0;\n      if (!a[key]) return 1; // Move undefined or '' to the bottom regardless of sort order\n      if (!b[key]) return -1; // Move undefined or '' the bottom regardless of sort order\n      if (a[key] < b[key]) return order;\n      if (a[key] > b[key]) return order * -1;\n      return 0;\n    });\n    return sortedData;\n  }\n  function m_SortCaseInsensitive(key, tdata, order) {\n    const sortedData = [...tdata].sort((a, b) => {\n      if (!a[key] && !b[key]) return 0;\n      if (!a[key]) return 1; // Move undefined or '' to the bottom regardless of sort order\n      if (!b[key]) return -1; // Move undefined or '' the bottom regardless of sort order\n      if (a[key].toLowerCase() < b[key].toLowerCase()) return order;\n      if (a[key].toLowerCase() > b[key].toLowerCase()) return order * -1;\n      return 0;\n    });\n    return sortedData;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function m_SortByMarkdown(key, tdata, order) {\n    const sortedData = [...tdata].sort((a, b) => {\n      // NC's markdown format from NCNodeTable will pass:\n      // { html, raw}\n      // We will sort by the raw text\n      if (!a[key].raw) return 1; // Move undefined or '' to the bottom regardless of sort order\n      if (!b[key].raw) return -1; // Move undefined or '' the bottom regardless of sort order\n      if (a[key].raw < b[key].raw) return order;\n      if (a[key].raw > b[key].raw) return order * -1;\n      return 0;\n    });\n    return sortedData;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function m_SortByNumber(key, tdata, order) {\n    const sortedData = [...tdata].sort((a, b) => {\n      const akey = Number(a[key]);\n      const bkey = Number(b[key]);\n      if (isNaN(akey) && isNaN(bkey)) return 0;\n      if (isNaN(akey)) return 1; // Move NaN to the bottom regardless of sort order\n      if (isNaN(bkey)) return -1; // Move NaN to the bottom regardless of sort order\n      if (akey < bkey) return order;\n      if (akey > bkey) return order * -1;\n      return 0;\n    });\n    return sortedData;\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function m_SortByHDate(key, tdata, order) {\n    const sortedData = [...tdata].sort((a, b) => {\n      const akey = HDATE.Parse(a[key]); // parseResult\n      const bkey = HDATE.Parse(b[key]);\n      // if ANY is defined, it's automatically greater than undefined\n      if (akey.length > 0 && bkey.length < 1) return order;\n      if (akey.length < 1 && bkey.length > 0) return order * -1;\n      if (akey.length < 1 && bkey.length < 1) return 0;\n      // two valid dates, compare them!\n      const da = akey[0].start.knownValues;\n      const db = bkey[0].start.knownValues;\n      let dateorder;\n      if (da.year !== db.year) {\n        dateorder = da.year - db.year;\n      } else if (da.month !== db.month) {\n        dateorder = da.month - db.month;\n      } else if (da.day !== db.day) {\n        dateorder = da.day - db.day;\n      } else if (da.hour !== db.hour) {\n        dateorder = da.hour - db.hour;\n      } else if (da.minute !== db.minute) {\n        dateorder = da.minute - db.minute;\n      } else if (da.second !== db.second) {\n        dateorder = da.second - db.second;\n      }\n      return dateorder * order;\n    });\n    return sortedData;\n  }\n  /// BUILT-IN TABLE METHODS //////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * Executes the renderer for a given column\n   * @param {string} key tdata object key\n   * @param {Object} tdata full table data object so you can access other keys\n   * @param {Object} coldef column definition\n   * @returns The final value to be rendered in the table cell\n   */\n  function m_ExecuteRenderer(key, tdata, coldef) {\n    let result = '';\n    const customRenderer = coldef.renderer;\n    if (customRenderer) {\n      if (typeof customRenderer !== 'function')\n        throw new Error('Invalid renderer for', coldef);\n      result = customRenderer(key, tdata, coldef);\n    } else {\n      // Run built-in renderers\n      const value = tdata[key];\n      switch (coldef.type) {\n        case 'markdown': // Net.Create\n          result = value.html;\n          break;\n        case 'hdate': // Net.Create\n          result = value; // display the raw user-entered string\n          break;\n        case 'timestamp':\n          result = u_HumanDate(value);\n          break;\n        case 'hdate-short': // Net.Create\n        case 'timestamp-short':\n          result = u_HumanDateShort(value);\n          break;\n        case 'number':\n        case 'text':\n        case 'text-case-insensitive':\n        default:\n          result = value;\n      }\n    }\n    if (coldef.tipDisabled) return result;\n    return (\n      <div className=\"tabletip\">\n        <div className=\"tabletip-source\">{result}</div>\n        <div className=\"tabletip-text\">{result}</div>\n      </div>\n    );\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Sorts then sets the table data\n  function m_ExecuteSorter(tdata) {\n    if (_columndefs.length < 1) return [];\n\n    const customSorter = _columndefs[_sortColumnIdx].sorter;\n    const key = _columndefs[_sortColumnIdx].data;\n    let sortedData = [];\n    if (customSorter) {\n      if (typeof customSorter !== 'function') throw new Error('Invalid sorter');\n      sortedData = customSorter(key, tdata, _sortOrder);\n    } else {\n      // Run built-in sorters\n      switch (_columndefs[_sortColumnIdx].type) {\n        case 'hdate':\n          sortedData = m_SortByHDate(key, tdata, _sortOrder);\n          break;\n        case 'markdown':\n          sortedData = m_SortByMarkdown(key, tdata, _sortOrder);\n          break;\n        case 'number':\n          sortedData = m_SortByNumber(key, tdata, _sortOrder);\n          break;\n        case 'text-case-insensitive':\n          sortedData = m_SortCaseInsensitive(key, tdata, _sortOrder);\n          break;\n        case 'timestamp': // timestamp is a string\n        case 'text':\n        default:\n          sortedData = m_SortByText(key, tdata, _sortOrder);\n      }\n    }\n    setTableData(sortedData);\n  }\n  /// RENDER //////////////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  /**\n   * jsx_SortBtn tracks two states:\n   * if sort is disabled:\n   *  - do not show sort button in header\n   *  - the header is not clickable (no cursor pointer)\n   * if sort is enabled:\n   *  - show sort erder: '▲' or '▼' or '▲▼'\n   *  - show cursor pointer\n   */\n  function jsx_SortBtn(columndef, idx) {\n    const isSelected = _sortColumnIdx === idx;\n    if (columndef.sortDisabled) {\n      return <span className=\"sortDisabled\">-</span>;\n    } else if (isSelected) {\n      return <span className=\"sortEnabled\">{SORTORDER.get(_sortOrder)}</span>;\n    } else {\n      // not selected, so sort order is the previous sort order\n      return (\n        <span className=\"sortEnabled\">\n          {SORTORDER.get(_previousColSortOrder[idx])}\n        </span>\n      );\n    }\n  }\n\n  // show cursor pointer if not sortDisabled\n  // needs to be set at `th` not at `th span`\n\n  return (\n    <div\n      className=\"URTable\"\n      ref={ref_Table}\n      onMouseMove={ui_MouseMove}\n      onMouseUp={ui_MouseUp}\n    >\n      <table>\n        <thead>\n          <tr>\n            {_columndefs.map((coldef, idx) => (\n              <th\n                key={idx}\n                className={_sortColumnIdx === idx ? 'selected' : ''}\n                width={`${_columnWidths[idx]}`}\n              >\n                <div onClick={e => ui_SetSelectedColumn(e, idx)}>\n                  {coldef.title}&nbsp;\n                  {jsx_SortBtn(coldef, idx)}\n                </div>\n                <div\n                  className=\"resize-handle\"\n                  onMouseDown={e => ui_MouseDown(e, idx)}\n                  hidden={idx === _columndefs.length - 1} // hide last resize handle\n                ></div>\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody>\n          {_tabledata.map((tdata, idx) => (\n            /* Net.Create Special Handling: Show filter transparency */\n            <tr key={idx} style={{ opacity: tdata.meta.filteredTransparency }}>\n              {_columndefs.map((coldef, idx) => (\n                <td key={idx}>{m_ExecuteRenderer(coldef.data, tdata, coldef)}</td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default URTable;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Filter UDATA Messages\n\n  Affects ALL Filters\n  ===================\n\n    FILTERDEFS      AppState\n                    Sets the FILTERDEFS data object\n                    Triggers AppStateChange\n\n    FILTER_CLEAR    Message / LocalCall\n                    Unhides all objects on the graph\n                    Resets filter form to blank state\n\n    FILTER_SUMMARY_UPDATE\n                    Message / LocalCall\n                    Summary of filters for InfoPanel display\n                    is updated.\n\n\n  Affects Individual Filters\n  ==========================\n\n    FILTER_DEFINE   Define a single new filter\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst FILTER = {};\n// Filter Panel Label\nFILTER.PANEL_LABEL = 'ANALYSIS';\n// Determines whether filter action is to highlight/fade or remove (filter) nodes and edges\n// These labels are used as default values if an older version template has not defined them\nFILTER.ACTION = {};\nFILTER.ACTION.FADE = 'FADE';\nFILTER.ACTION.FILTER = 'FILTERING'; // FIX: Remove this after we decide to remove FILTER/HIDE\nFILTER.ACTION.REDUCE = 'REMOVE';\nFILTER.ACTION.FOCUS = 'FOCUS';\n// Types of filters definable in template files.\n// See also `nc-ui.js` for field types\nFILTER.TYPES = {};\nFILTER.TYPES.STRING = 'string';\nFILTER.TYPES.NUMBER = 'number';\nFILTER.TYPES.SELECT = 'select';\nFILTER.TYPES.NODE = 'node'; // edge source / target\nFILTER.TYPES.DATE = 'date';\nFILTER.TYPES.HDATE = 'hdate'; // custom historical date\nFILTER.TYPES.MARKDOWN = 'markdown';\nFILTER.TYPES.TIMESTAMP = 'timestamp';\nFILTER.TYPES.INFOORIGIN = 'infoOrigin';\nFILTER.TYPES.HIDDEN = 'hidden';\n// Special Edge Keys mapped to node objects\n// Used by m_IsEdgeMatchedByFilter to find node labels\nFILTER.KEY = {};\nFILTER.KEY.SOURCE = 'source';\nFILTER.KEY.TARGET = 'target';\n// key needs to match the OPERATOR name for lookup purposes\n// in filter-mgr.js\nFILTER.OPERATORS = {};\nFILTER.OPERATORS.NO_OP = { key: 'NO_OP', label: '--' };\nFILTER.OPERATORS.CONTAINS = { key: 'CONTAINS', label: 'contains' };\nFILTER.OPERATORS.NOT_CONTAINS = { key: 'NOT_CONTAINS', label: 'does not contain' };\nFILTER.OPERATORS.IS_EMPTY = { key: 'IS_EMPTY', label: 'is empty' };\nFILTER.OPERATORS.IS_NOT_EMPTY = { key: 'IS_NOT_EMPTY', label: 'is not empty' };\nFILTER.OPERATORS.EQ = { key: 'EQ', label: '=' };\nFILTER.OPERATORS.NOT_EQ = { key: 'NOT_EQ', label: `\\u2260` };\nFILTER.OPERATORS.GT = { key: 'GT', label: '>' };\nFILTER.OPERATORS.GT_EQ = { key: 'GT_EQ', label: '>=' };\nFILTER.OPERATORS.LT = { key: 'LT', label: '<' };\nFILTER.OPERATORS.LT_EQ = { key: 'LT_EQ', label: '<=' };\n\n/// MODULE EXPORTS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = FILTER;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Group of Filters for Nodes or Edges\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nimport React from 'react';\nimport FILTER from './FilterEnums';\nimport NCNumberFilter from './NCNumberFilter';\nimport NCStringFilter from './NCStringFilter';\nimport NCSelectFilter from './NCSelectFilter';\nimport NCHDateFilter from './NCHDateFilter';\nimport NCFilterGroupProperties from './NCFilterGroupProperties';\n\n/// METHODS ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCFilterGroup({ group, label, filters, filterAction, transparency }) {\n  return (\n    <div className=\"filter-group\">\n      <h1>{label}</h1>\n      {filters.map(filter => {\n        switch (filter.type) {\n          case FILTER.TYPES.MARKDOWN:\n          case FILTER.TYPES.NODE:\n          case FILTER.TYPES.DATE: // generic dates (not hdate) are treated like strings\n          case FILTER.TYPES.INFOORIGIN:\n          case FILTER.TYPES.STRING:\n            return (\n              <NCStringFilter\n                key={filter.id}\n                group={group}\n                filter={filter}\n                filterAction={filterAction}\n              />\n            );\n          case FILTER.TYPES.NUMBER:\n            return (\n              <NCNumberFilter\n                key={filter.id}\n                group={group}\n                filter={filter}\n                filterAction={filterAction}\n              />\n            );\n          case FILTER.TYPES.SELECT:\n            return (\n              <NCSelectFilter\n                key={filter.id}\n                group={group}\n                filter={filter}\n                filterAction={filterAction}\n              />\n            );\n          case FILTER.TYPES.TIMESTAMP: // UI uses HDate to set date, but parser uses custom timestamp\n          case FILTER.TYPES.HDATE:\n            return (\n              <NCHDateFilter\n                key={filter.id}\n                group={group}\n                filter={filter}\n                filterAction={filterAction}\n              />\n            );\n          default:\n            console.error(\n              `FilterGroup: Filter Type not found ${filter.type} for filter`,\n              filter\n            );\n            break;\n        }\n        return '';\n      })}\n      <NCFilterGroupProperties group={group} transparency={transparency} />\n      <hr />\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCFilterGroup;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Filter Group Properties\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCFilterGroupProperties' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n\n/// CLASS DECLARATIONS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCFilterGroupProperties({ group, transparency }) {\n  // Currently inconsistent because not passing in a key, etc.\n  // if we expand on this notion of group-leve globals we'll need to update\n  // the format / approach\n  const [state, setState] = useState({\n    group,\n    inputval: transparency, // Used to maintain input caret position\n    transparency\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    BroadcastChange();\n  }, [state]);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // this is overkill to have these be separate, but mirroring the other filter components and aiming\n  // to have future additional properties here, so this way the flow won't change (change functions call trigger change)\n  function BroadcastChange() {\n    // if no data has changed, skip update\n    if (transparency === state.transparency) return;\n\n    // for debugging\n    // console.log(\n    //   'Filter group for ' +\n    //     this.state.group +\n    //     ' setting transparency to ' +\n    //     this.state.transparency\n    // );\n\n    // set the transparency globally for this group (nodes or edges)\n    UDATA.LocalCall('FILTER_DEFINE', {\n      group,\n      type: 'transparency',\n      transparency: state.inputval\n    }); // set a SINGLE filter\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeValue(event) {\n    // React pools synthetic events for performance. Once the event callback\n    // finishes running, React recycles the event object by clearing its\n    // properties (setting them to null). So if you try to use event.target\n    // asynchronously (e.g. in a setTimeout, or after an await), it will be null.\n    const inputval = event.target.value;\n    setState(prevState => ({\n      ...prevState,\n      inputval,\n      transparency\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnSubmit(event) {\n    // Prevent \"ENTER\" from triggering form submission!\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <div>\n      <br />\n      <form className=\"filter-item\" key={group} onSubmit={ui_OnSubmit}>\n        <fieldset>\n          <label className=\"help\"> Transparency&nbsp;</label>\n          <input\n            type=\"text\"\n            value={state.inputval}\n            onChange={ui_OnChangeValue}\n            aria-label={`Transparency filter value`}\n          />\n        </fieldset>\n      </form>\n    </div>\n  );\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nexport default NCFilterGroupProperties;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  FILTERSPANEL\n\n  This is the base UI component that displays filters in the InfoPanel.\n\n  FiltersPanel\n  |-- FiltersGroup\n      |-- StringFilter\n      |-- NumberFilter\n      |-- SelectFilter\n\n  FiltersPanel reads data directly from FILTERDEFS.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport FILTER from './FilterEnums';\nimport FilterGroup from './NCFilterGroup';\nimport FocusFilter from './NCFocusFilter';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCFiltersPanel' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'NCFiltersPanel: ';\n\n/// CLASS DECLARATIONS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCFiltersPanel({ hidden }) {\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // Load Templates\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const TABS = {\n    FADE: { action: FILTER.ACTION.FADE, label: TEMPLATE.filterFade },\n    REDUCE: { action: FILTER.ACTION.REDUCE, label: TEMPLATE.filterReduce },\n    FOCUS: { action: FILTER.ACTION.FOCUS, label: TEMPLATE.filterFocus }\n  };\n  // The intial `OnAppStateChange(\"FILTERDEFS\")` event when the template is\n  // first loaded is called well before FiltersPanel is\n  // even constructed.  So we need to explicitly load it here.\n  const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n  const [state, setState] = useState({\n    nodes: FILTERDEFS.nodes,\n    edges: FILTERDEFS.edges,\n    filterAction: FILTER.ACTION.FADE,\n    filterActionHelp: '',\n    focusSourceLabel: undefined,\n    focusRange: undefined,\n    statsSummary: ''\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    // update filter stats on load\n    const FILTEREDNCDATA = UDATA.AppState('FILTEREDNCDATA');\n    urstate_UpdateFilteredNCData(FILTEREDNCDATA);\n\n    UDATA.OnAppStateChange('FILTERDEFS', urstate_UpdateFilterDefs);\n    UDATA.OnAppStateChange('FILTEREDNCDATA', urstate_UpdateFilteredNCData);\n    return () => {\n      UDATA.AppStateChangeOff('FILTERDEFS', urstate_UpdateFilterDefs);\n      UDATA.AppStateChangeOff('FILTEREDNCDATA', urstate_UpdateFilteredNCData);\n    };\n  }, []);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urstate_UpdateFilterDefs(data) {\n    if (DBG) console.log(PR, 'FILTERDEFS', data);\n    setState(prevState => ({\n      ...prevState,\n      nodes: data.nodes,\n      edges: data.edges,\n      filterAction: data.filterAction || prevState.filterAction,\n      filterActionHelp: data.filterActionHelp || prevState.filterActionHelp,\n      focusSourceLabel:\n        data.focus && data.focus.sourceLabel ? data.focus.sourceLabel : '',\n      focusRange: data.focus && data.focus.range ? data.focus.range : undefined\n    }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urstate_UpdateFilteredNCData(data = { stats: {} }) {\n    // Skip stats update if not defined yet\n    if (!data.stats) return;\n    setState(prevState => ({ ...prevState, statsSummary: data.stats.statsSummary }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function evt_LookupFilterHelp(filterAction) {\n    if (filterAction === FILTER.ACTION.FADE) return TEMPLATE.filterFadeHelp;\n    if (filterAction === FILTER.ACTION.REDUCE) return TEMPLATE.filterReduceHelp;\n    if (filterAction === FILTER.ACTION.FOCUS) return TEMPLATE.filterFocusHelp;\n    return 'Help not found';\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnClearBtnClick() {\n    UDATA.LocalCall('FILTER_CLEAR');\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_SelectFilterAction(filterAction) {\n    setState(prevState => ({ ...prevState, filterAction }));\n    UDATA.LocalCall('FILTERS_UPDATE', { filterAction });\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  const { filterAction, focusRange, focusSourceLabel, statsSummary, nodes, edges } =\n    state;\n\n  if (!nodes || !edges) return 'loading...'; // skip rendering for now if nodes and edges haven't been loaded yet.\n\n  const defs = [nodes, edges];\n  const filterActionHelp = evt_LookupFilterHelp(filterAction);\n\n  let FilterControlPanel;\n  if (filterAction === FILTER.ACTION.FOCUS) {\n    FilterControlPanel = (\n      <FocusFilter focusSourceLabel={focusSourceLabel} focusRange={focusRange} />\n    );\n  } else {\n    FilterControlPanel = defs.map(def => (\n      <FilterGroup\n        key={def.label}\n        group={def.group}\n        label={def.label}\n        filters={def.filters}\n        filterAction={filterAction}\n        transparency={def.transparency}\n      />\n    ));\n  }\n\n  return (\n    <div className={`NCFiltersPanel ${hidden ? 'hidden' : ''}`}>\n      <div className=\"tabselectors\" role=\"tablist\">\n        {Object.keys(TABS).map(k => (\n          <button\n            key={k}\n            className={filterAction === TABS[k].action ? 'selected' : ''}\n            onClick={() => ui_SelectFilterAction(TABS[k].action)}\n            role=\"tab\"\n            type=\"button\"\n            aria-selected={filterAction === TABS[k].action}\n            aria-controls=\"tabpanel\"\n          >\n            {TABS[k].label}\n          </button>\n        ))}\n      </div>\n\n      <div className=\"tabpanels\" id=\"tabpanel\">\n        <label className=\"help\">{filterActionHelp}</label>\n\n        {FilterControlPanel}\n\n        <div className=\"controlbar\">\n          <button className=\"small\" type=\"button\" onClick={ui_OnClearBtnClick}>\n            Clear Filters\n          </button>\n        </div>\n      </div>\n\n      <label className=\"help\">{statsSummary}</label>\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCFiltersPanel;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  FOCUSFILTER\n\n  FocusFilter provides the UI for entering the numeric range value for\n  the focus filter.\n\n  Selection changes directly trigger a UDATA.LocalCall('FILTER_DEFINE',...).\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport NCAutoSuggest from '../NCAutoSuggest';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCFocusFilter' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCFocusFilter({ focusSourceLabel, focusRange }) {\n  const [state, setState] = useState({\n    focusInputLabel: focusSourceLabel, // Used locally to define result\n    focusRange // Used locally to define result\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    BroadcastChange();\n  }, [state]);\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    setState(prevState => ({ ...prevState, focusInputLabel: focusSourceLabel })); // update local state\n  }, [focusSourceLabel]);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_NodeInputUpdate(key, value) {\n    setState(prevState => ({ ...prevState, focusInputLabel: value })); // update local state\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /**\n   * User has selected a node with NCAutoSuggest, either\n   * - Clicking on a suggested node\n   * - Hitting Enter with the form field showing either a valid node or a new node\n   * @param {string} key is 'id' or 'label'\n   * @param {string} label\n   * @param {number} id\n   */\n  function ui_NodeSelect(key, label, id) {\n    if (UDATA) {\n      const NCDATA = UDATA.AppState('NCDATA');\n      const foundNode = NCDATA.nodes.find(n => n.id === id);\n      if (foundNode)\n        UDATA.LocalCall('FILTER_DEFINE', {\n          group: 'focus',\n          filter: {\n            source: id,\n            sourceLabel: foundNode.label\n          }\n        }); // set a SINGLE filter\n    }\n    // this.ValidateSourceTarget(key, label, id);\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeValue(e) {\n    // The built in <input min=\"0\"> will keep the step buttons from going below 0,\n    // but the user can still input \"0\".  We can't just use Math.min() because the\n    // user would not be allowed to use backspace to delete the value before\n    // entering a new number.  Replacing invalid numbers with a blank value\n    // feels like a more natural way of editing.\n    const focusRange = e.target.value < 1 ? '' : Number(e.target.value);\n    setState(prevState => ({ ...prevState, focusRange }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_DeselectNode(e) {\n    UDATA.LocalCall('FILTER_DEFINE', {\n      group: 'focus',\n      filter: {\n        deselectNode: true // hacky -- force m_FilterDefine to clear the selection\n      }\n    });\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function BroadcastChange() {\n    // even though we allow \"\" in the field, we always define the range to be 1\n    // so that something will show\n    const focusRange = state.focusRange < 1 ? 1 : state.focusRange;\n    if (UDATA)\n      UDATA.LocalCall('FILTER_DEFINE', {\n        group: 'focus',\n        filter: {\n          range: focusRange\n        }\n      }); // set a SINGLE filter\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnSubmit(event) {\n    // Prevent \"ENTER\" from triggering form submission!\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n  // show button if node is selected\n  // else show autosuugst\n  // clicking enables autosuggest\n  let selectedNodeJsx;\n  let selectedNodeHelp;\n  if (focusSourceLabel) {\n    selectedNodeJsx = (\n      <button type=\"button\" className=\"focusnode\" onClick={ui_DeselectNode}>\n        {focusSourceLabel}\n      </button>\n    );\n    selectedNodeHelp = 'Click to select another node';\n  } else {\n    selectedNodeJsx = (\n      <NCAutoSuggest\n        value={state.focusInputLabel}\n        onChange={ui_NodeInputUpdate}\n        onSelect={ui_NodeSelect}\n      />\n    );\n    selectedNodeHelp = 'Click a node or type a node name..';\n  }\n\n  return (\n    <div className=\"filter-group\">\n      <h1></h1>\n      <form className=\"filter-item\" onSubmit={ui_OnSubmit}>\n        <fieldset>\n          <label className=\"help\"></label>\n          <p className=\"help\">{selectedNodeHelp}</p>\n        </fieldset>\n        <fieldset>\n          <label className=\"help\">Selected Node:</label>\n          {selectedNodeJsx}\n        </fieldset>\n        <fieldset>\n          <label className=\"help\">\n            Range <i>(&gt;0)</i>:&nbsp;\n          </label>\n          <input\n            type=\"number\"\n            min=\"1\"\n            onChange={ui_OnChangeValue}\n            value={focusRange}\n            aria-label={`Range value`}\n          />\n        </fieldset>\n      </form>\n    </div>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCFocusFilter;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  HDATEFILTER\n\n  HDateFilter provides the UI for entering search strings for hdate-based\n  node and edge properties.\n\n  Seven Numeric  operators are supported:\n  * >\n  * >=\n  * <\n  * <=\n  * =\n  * !=\n\n  Matches will SHOW the resulting node or edge.\n  Any nodes/edges not matching will be hidden.\n\n  The filter definition is passed in via props.\n\n    props\n      {\n        group       // \"nodes\" or \"edges\"\n        filter: {\n          id,       // numeric id used for unique React key\n          type,     // filter type, e.g \"string\" vs \"number\"\n          key,      // node field key from the template\n          keylabel, // human friendly display name for the key.\n                       This can be customized in the template.\n          operator, // the comparison function, e.g. 'contains' or '>'\n          value     // the search value to be used for matching\n        },\n        filterAction // selected action\n      }\n\n  The `id` variable allows us to potentially support multiple search filters\n  using the same key, e.g. we could have two 'Label' filters.\n\n  In order to retain the input selection cursor between state updates, we use\n  a secondary state `inputval` that retains the cursor position.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport FILTER from './FilterEnums';\nimport URDateField from '../URDateField';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCDateFilter' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst OPERATORS = [\n  FILTER.OPERATORS.NO_OP,\n  FILTER.OPERATORS.EQ,\n  FILTER.OPERATORS.NOT_EQ,\n  FILTER.OPERATORS.LT,\n  FILTER.OPERATORS.LT_EQ,\n  FILTER.OPERATORS.GT,\n  FILTER.OPERATORS.GT_EQ\n];\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCHDateFilter({\n  group,\n  filter: { id, type, key, keylabel, operator, value },\n  filterAction\n}) {\n  const [state, setState] = useState({\n    operator: FILTER.OPERATORS.NO_OP.key, // Used locally to define result\n    inputval: '', // Used to maintain input caret position\n    value: '' // Used to define the final result\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    UDATA.HandleMessage('FILTER_CLEAR', urmsg_ClearFilters);\n    return () => {\n      UDATA.UnhandleMessage('FILTER_CLEAR', urmsg_ClearFilters);\n    };\n  });\n\n  useEffect(() => {\n    BroadcastChange();\n  }, [state]);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urmsg_ClearFilters() {\n    setState(prevState => ({ ...prevState, inputval: '' }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeOperator(event) {\n    const newstate = { operator: event.target.value };\n    // clear value if NO_OP\n    if (event.target.value === FILTER.OPERATORS.NO_OP.key) {\n      newstate.inputval = '';\n      newstate.value = '';\n    }\n    setState(prevState => ({ ...prevState, ...newstate }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeValue(event) {\n    const value = event.target.value;\n    // deconstruct the URDate {value, format, formattedString } object\n    // save the raw input string\n    const inputString = value.value;\n    // First update the input field, retaining cursor position\n    setState(prevState => ({ ...prevState, inputval: value, value }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function BroadcastChange() {\n    // if no data has changed, skip update\n    if (\n      operator === state.operator &&\n      (state.value.value === undefined || value === state.value.value)\n    )\n      return;\n\n    const filterDef = {\n      id,\n      type,\n      key,\n      keylabel,\n      operator: state.operator,\n      value: state.inputval\n    };\n    if (UDATA)\n      UDATA.LocalCall('FILTER_DEFINE', {\n        group,\n        filter: filterDef,\n        filterAction\n      }); // set a SINGLE filter\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnSubmit(event) {\n    // Prevent \"ENTER\" from triggering form submission!\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <form className=\"filter-item\" key={id} onSubmit={ui_OnSubmit}>\n      <fieldset>\n        <label className=\"help\"> {keylabel} </label>\n        <select\n          type=\"select\"\n          value={operator}\n          onChange={ui_OnChangeOperator}\n          aria-label={`${keylabel} filter operator`}\n        >\n          {OPERATORS.map(op => (\n            <option value={op.key} key={`${id}${op.key}`}>\n              {op.label}\n            </option>\n          ))}\n        </select>\n        <URDateField\n          id={key}\n          key={`${key}value`}\n          value={state.inputval}\n          isFilter={true}\n          onChange={ui_OnChangeValue}\n          disabled={operator === FILTER.OPERATORS.NO_OP.key}\n        />\n      </fieldset>\n    </form>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCHDateFilter;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  NUMBERFILTER\n\n  NumberFilter provides the UI for entering search strings for numeric-based\n  node and edge properties.\n\n  Seven Numeric  operators are supported:\n  * >\n  * >=\n  * <\n  * <=\n  * =\n  * !=\n\n  Matches will SHOW the resulting node or edge.\n  Any nodes/edges not matching will be hidden.\n\n  The filter definition is passed in via props.\n\n    props\n      {\n        group       // \"nodes\" or \"edges\"\n        filter: {\n          id,       // numeric id used for unique React key\n          type,     // filter type, e.g \"string\" vs \"number\"\n          key,      // node field key from the template\n          keylabel, // human friendly display name for the key.\n                       This can be customized in the template.\n          operator, // the comparison function, e.g. 'contains' or '>'\n          value     // the search value to be used for matching\n        },\n        filterAction // selected action\n      }\n\n  The `id` variable allows us to potentially support multiple search filters\n  using the same key, e.g. we could have two 'Label' filters.\n\n  In order to retain the input selection cursor between state updates, we use\n  a secondary state `inputval` that retains the cursor position.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport FILTER from './FilterEnums';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCNumberFilter' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst OPERATORS = [\n  FILTER.OPERATORS.NO_OP,\n  FILTER.OPERATORS.EQ,\n  FILTER.OPERATORS.NOT_EQ,\n  FILTER.OPERATORS.LT,\n  FILTER.OPERATORS.LT_EQ,\n  FILTER.OPERATORS.GT,\n  FILTER.OPERATORS.GT_EQ\n];\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCNumberFilter({\n  group,\n  filter: { id, type, key, keylabel, operator, value },\n  filterAction\n}) {\n  const [state, setState] = useState({\n    operator: FILTER.OPERATORS.NO_OP.key, // Used locally to define result\n    inputval: '', // Used to maintain input caret position\n    value: '' // Used to define the final result\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    UDATA.HandleMessage('FILTER_CLEAR', urmsg_ClearFilters);\n    return () => {\n      UDATA.UnhandleMessage('FILTER_CLEAR', urmsg_ClearFilters);\n    };\n  }, []);\n\n  useEffect(() => {\n    BroadcastChange();\n  }, [state]);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urmsg_ClearFilters() {\n    setState(prevState => ({ ...prevState, inputval: '' }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeOperator(event) {\n    const newstate = { operator: event.target.value };\n    // clear value if NO_OP\n    if (event.target.value === FILTER.OPERATORS.NO_OP.key) {\n      newstate.inputval = '';\n      newstate.value = '';\n    }\n    setState(prevState => ({ ...prevState, ...newstate }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeValue(event) {\n    const value = Number(event.target.value);\n    // First update the input field, retaining cursor position\n    // Then send the result\n    setState(prevState => ({ ...prevState, inputval: value, value }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function BroadcastChange() {\n    // if no data has changed, skip update\n    if (operator === state.operator && value === state.value) return;\n\n    const filterDef = {\n      id,\n      type,\n      key,\n      keylabel,\n      operator: state.operator,\n      value: state.inputval\n    };\n    UDATA.LocalCall('FILTER_DEFINE', {\n      group,\n      filter: filterDef,\n      filterAction\n    }); // set a SINGLE filter\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnSubmit(event) {\n    // Prevent \"ENTER\" from triggering form submission!\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <form className=\"filter-item\" key={id} onSubmit={ui_OnSubmit}>\n      <fieldset>\n        <label className=\"help\">{keylabel}</label>\n        <select\n          type=\"select\"\n          value={operator}\n          onChange={ui_OnChangeOperator}\n          aria-label={`${keylabel} filter operator`}\n        >\n          {OPERATORS.map(op => (\n            <option value={op.key} key={`${id}${op.key}`}>\n              {op.label}\n            </option>\n          ))}\n        </select>\n        <input\n          type=\"number\"\n          value={state.inputval}\n          placeholder=\"...\"\n          onChange={ui_OnChangeValue}\n          disabled={operator === FILTER.OPERATORS.NO_OP.key}\n          aria-label={`${keylabel} filter value`}\n        />\n      </fieldset>\n    </form>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCNumberFilter;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  SELECTFILTER\n\n  SelectFilter provides the UI for setting drop-down menu selection\n  style filters typically used for \"type\" node and edge properties.\n\n  The menu options are defined with the extra `options` property\n  of the filter.\n\n  Two Select operators are supported (These just use the string operators on\n  the values set via the menu selectios):\n  * contains\n  * not contains\n\n  Matches will SHOW the resulting node or edge.\n  Any nodes/edges not matching will be hidden.\n\n  The filter definition is passed in via props.\n\n    props\n      {\n        group       // \"nodes\" or \"edges\"\n        filter: {\n          id,       // numeric id used for unique React key\n          type,     // filter type, e.g \"string\" vs \"number\"\n          key,      // node field key from the template\n          keylabel, // human friendly display name for the key.  This can be customized in the template.\n          operator, // the comparison function, e.g. 'contains' or '>'\n          value     // the search value to be used for matching\n          options   // array of select option strings, e.g. ['abc','def',..]\n        },\n        filterAction // selected action\n      }\n\n  The `id` variable allows us to potentially support multiple search filters\n  using the same key, e.g. we could have two 'Label' filters.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport FILTER from './FilterEnums';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCSelectFilter' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst OPERATORS = [\n  FILTER.OPERATORS.NO_OP,\n  FILTER.OPERATORS.CONTAINS,\n  FILTER.OPERATORS.NOT_CONTAINS\n];\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCSelectFilter({\n  group,\n  filter: { id, type, key, keylabel, operator, value, options },\n  filterAction\n}) {\n  const [state, setState] = useState({\n    operator: FILTER.OPERATORS.NO_OP.key, // Used locally to define result\n    inputval: '', // Used to maintain input caret position\n    value: '' // Autoselect the first item\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    BroadcastChange();\n  }, [state]);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeOperator(event) {\n    // on first update, we also need to set the default selected value\n    const value = state.value || (options && options.length > 0) ? options[0] : 0;\n    setState(prevState => ({ ...prevState, operator: event.target.value, value }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeValue(event) {\n    setState(prevState => ({ ...prevState, value: event.target.value }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function BroadcastChange() {\n    // if no data has changed, skip update\n    if (operator === state.operator && value === state.value) return;\n\n    const filterDef = {\n      id,\n      type,\n      key,\n      keylabel,\n      operator: state.operator,\n      value: state.operator === FILTER.OPERATORS.NO_OP.key ? '' : state.value,\n      options\n    };\n    if (UDATA)\n      UDATA.LocalCall('FILTER_DEFINE', {\n        group,\n        filter: filterDef,\n        filterAction\n      }); // set a SINGLE filter\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnSubmit(event) {\n    // Prevent \"ENTER\" from triggering form submission!\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <form className=\"filter-item\" key={id} onSubmit={ui_OnSubmit}>\n      <fieldset>\n        <label className=\"help\"> {keylabel} </label>\n        <select\n          type=\"select\"\n          value={operator}\n          onChange={ui_OnChangeOperator}\n          aria-label={`${keylabel} filter operator`}\n        >\n          {OPERATORS.map(op => (\n            <option value={op.key} key={`${id}${op.key}`}>\n              {op.label}\n            </option>\n          ))}\n        </select>\n        <select\n          type=\"select\"\n          value={value}\n          onChange={ui_OnChangeValue}\n          disabled={operator === FILTER.OPERATORS.NO_OP.key}\n          aria-label={`${keylabel} filter value`}\n        >\n          {operator !== FILTER.OPERATORS.NO_OP.key\n            ? options.map(op => (\n                <option value={op} key={`${id}${op}`}>\n                  {op}\n                </option>\n              ))\n            : ''}\n        </select>\n      </fieldset>\n    </form>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCSelectFilter;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  STRINGFILTER\n\n  StringFilter provides the UI for entering search strings for string-based\n  node and edge properties.\n\n  Two String operators are supported:\n  * contains\n  * not contains\n\n  Matches will SHOW the resulting node or edge.\n  Any nodes/edges not matching will be hidden.\n\n  The filter definition is passed in via props.\n\n    props\n      {\n        group       // \"nodes\" or \"edges\"\n        filter: {\n          id,       // numeric id used for unique React key\n          type,     // filter type, e.g \"string\" vs \"number\"\n          key,      // node field key from the template\n          keylabel, // human friendly display name for the key.  This can be customized in the template.\n          operator, // the comparison function, e.g. 'contains' or '>'\n          value     // the search value to be used for matching\n        },\n        filterAction // selected action\n      }\n\n  The `id` variable allows us to potentially support multiple search filters\n  using the same key, e.g. we could have two 'Label' filters.\n\n  In order to retain the input selection cursor between state updates, we use\n  a secondary state `inputval` that retains the cursor position.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nimport React, { useState, useEffect } from 'react';\nimport UNISYS from 'unisys/client';\nimport FILTER from './FilterEnums';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Initialize UNISYS DATA LINK for react component\nconst UDATAOwner = { name: 'NCStringFilter' };\nconst UDATA = UNISYS.NewDataLink(UDATAOwner);\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst OPERATORS = [\n  FILTER.OPERATORS.NO_OP,\n  FILTER.OPERATORS.CONTAINS,\n  FILTER.OPERATORS.NOT_CONTAINS,\n  FILTER.OPERATORS.IS_EMPTY,\n  FILTER.OPERATORS.IS_NOT_EMPTY\n];\n\n/// REACT FUNCTIONAL COMPONENT ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction NCStringFilter({\n  group,\n  filter: { id, type, key, keylabel, operator, value },\n  filterAction\n}) {\n  const [state, setState] = useState({\n    operator: FILTER.OPERATORS.NO_OP.key, // Used locally to define result\n    inputval: '', // Used to maintain input caret position\n    value: '' // Used to define the final result\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  useEffect(() => {\n    UDATA.HandleMessage('FILTER_CLEAR', urmsg_ClearFilters);\n    return () => {\n      UDATA.UnhandleMessage('FILTER_CLEAR', urmsg_ClearFilters);\n    };\n  }, []);\n\n  useEffect(() => {\n    BroadcastChange();\n  }, [state]);\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function urmsg_ClearFilters() {\n    setState(prevState => ({ ...prevState, inputval: '' }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeOperator(event) {\n    const newstate = { operator: event.target.value };\n    // clear value if NO_OP\n    if (event.target.value === FILTER.OPERATORS.NO_OP.key) {\n      newstate.inputval = '';\n      newstate.value = '';\n    }\n    setState(prevState => ({ ...prevState, ...newstate }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnChangeValue(event) {\n    const value = event.target.value;\n    // First update the input field, retaining cursor position\n    setState(prevState => ({ ...prevState, inputval: value, value }));\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function BroadcastChange() {\n    // if no data has changed, skip update\n    if (operator === state.operator && value === state.value) return;\n\n    const filterDef = {\n      id,\n      type,\n      key,\n      keylabel,\n      operator: state.operator,\n      value: state.inputval\n    };\n    if (UDATA)\n      UDATA.LocalCall('FILTER_DEFINE', {\n        group,\n        filter: filterDef,\n        filterAction\n      }); // set a SINGLE filter\n  }\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  function ui_OnSubmit(event) {\n    // Prevent \"ENTER\" from triggering form submission!\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  /// COMPONENT RENDER ////////////////////////////////////////////////////////\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  return (\n    <form className=\"filter-item\" key={id} onSubmit={ui_OnSubmit}>\n      <fieldset>\n        <label className=\"help\"> {keylabel}</label>\n        <select\n          type=\"select\"\n          value={operator}\n          onChange={ui_OnChangeOperator}\n          aria-label={`${keylabel} filter operator`}\n        >\n          {OPERATORS.map(op => (\n            <option value={op.key} key={`${id}${op.key}`}>\n              {op.label}\n            </option>\n          ))}\n        </select>\n        <input\n          type=\"text\"\n          value={state.inputval}\n          placeholder=\"...\"\n          onChange={ui_OnChangeValue}\n          disabled={operator === FILTER.OPERATORS.NO_OP.key}\n          hidden={\n            operator === FILTER.OPERATORS.IS_EMPTY.key ||\n            operator === FILTER.OPERATORS.IS_NOT_EMPTY.key\n          }\n          aria-label={`${keylabel} filter value`}\n        />\n      </fieldset>\n    </form>\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\nexport default NCStringFilter;\n","/*///////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  React Settings Bridge\n  bridges the difference legacy netcreate modules and new settings manager\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * /////////////////////////////////////*/\n\nconst React = require('react');\nconst { Settings, ConsoleStyler } = require('ursys-min');\nconst UNISYS = require('unisys/client');\n\n/// RUNTIME UNISYS HOOKS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst LOG = console.log.bind(console);\nconst PR = ConsoleStyler('SettingClient', 'TagBlue');\nconst DBG = true;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst MOD = UNISYS.NewModule(module.id);\n\n/// SETTINGS CHANGE SUBSCRIPTION //////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Subscribe to changes in the settings object\n *  @param string event - 'group', 'group.prop', or '*' for all changes\n *  @param function changeHandler - (propDef, eventObj) => {} */\nfunction Subscribe(event, changeHandler) {\n  Settings.Subscribe(event, changeHandler);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Subscribe to changes in the settings object\n *  @param string event - 'group', 'group.prop', or '*' for all changes\n *  @param function changeHandler - (propDef, eventObj) => {} */\nfunction Unsubscribe(event, changeHandler) {\n  Settings.Unsubscribe(event, changeHandler);\n}\n\n/// REACT SETTINGS API ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: PropertyDefs define the type and default value of a property, but not\n *  the value itself. */\nfunction GetPropertyDefs() {\n  return Settings.Get('PropertyDefs');\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: MetaDefs define metadata for a property's UI representation */\nfunction GetMetaDefs() {\n  return Settings.Get('MetaDefs');\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Update a property in the settings object.\n *  @param string dotProp - 'group.prop'\n *  @param any value - new value for the property */\nasync function UpdateProperty(dotProp, value) {\n  const opResult = await Settings.UpdateProperty(dotProp, value);\n  if (opResult.status === 'ok') return opResult;\n  throw Error(`Failed to update ${dotProp} with value ${value}`);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API: Update a group in the settings object.\n *  @param string groupName - 'group'\n *  @param object propObj - { prop: value, prop2: value2 } */\nasync function UpdateGroup(groupName, propObj) {\n  const opResult = await Settings.UpdateGroup(groupName, propObj);\n  if (opResult.status === 'ok') return opResult;\n  throw Error(`Failed to update group ${groupName} with properties ${propObj}`);\n}\n\n/// DECODERS //////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** UTILITY: Return the name of the single key in an object, undefined\n *  otherwise */\nfunction GetSingularKey(obj) {\n  const groupList = Object.keys(obj).filter(key => !key.startsWith('_'));\n  if (groupList.length !== 1) return;\n  return groupList[0];\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** UTILITY: Dereference groupObj, returning groupName and properties list */\nfunction DerefGroupDef(groupObj) {\n  const groupName = GetSingularKey(groupObj);\n  if (groupName === undefined) return { error: 'groupObj must have a single key' };\n  const properties = groupObj[groupName];\n  const deref = { groupName, properties };\n  //\n  return deref; // { groupname, properties:{[propName]:{ definition props }} }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** UTILITY: Dereference metaObj, returning just the properites for the */\nfunction DerefSingularMetaDef(metaObj) {\n  const groupName = GetSingularKey(metaObj);\n  if (groupName === undefined) return { error: 'metaObj must have a single key' };\n  const deref = metaObj[groupName];\n  //\n  return deref; // { metadata props }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** UTILITY: promote a named key as the direct value of a property,\n *  converting { group:{prop:{value:1}} } to { group: {prop:1} } for using\n *  in a settings values structure */\nfunction FlattenPropertyDefs(propDefs, key = 'value') {\n  const flat = {};\n  Object.keys(propDefs).forEach(groupName => {\n    flat[groupName] = {};\n    const group = propDefs[groupName];\n    Object.keys(group).forEach(propName => {\n      const propDef = group[propName];\n      flat[groupName][propName] = propDef[key];\n    });\n  });\n  return flat;\n}\n\n/// SHARED STYLING OBJECTS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst padding = '0.2rem 0.4rem';\nconst margin = '0.2rem 0.4rem';\nconst border = '1px solid #cc8';\nconst modColor = '#ffff00a0';\n// itemGrid is for the container of a label and input\nconst itemGrid = {\n  display: 'grid',\n  gridTemplateColumns: 'minmax(200px,max-content) auto',\n  alignItems: 'baseline',\n  margin\n};\n// styling for the label and input\nconst labelStyle = { paddingRight: '0.5rem' };\nconst inputStyle = { border, padding };\n// popupStyle is for the tooltip\nconst popupStyle = {\n  position: 'fixed',\n  backgroundColor: 'gray',\n  color: 'white',\n  padding,\n  zIndex: 1000,\n  maxWidth: '20rem',\n  display: 'none'\n};\n// opBtnStyle is for operation buttons\nconst opBtnStyle = {\n  backgroundColor: 'white',\n  border,\n  padding,\n  margin,\n  cursor: 'pointer'\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction GetStyles() {\n  return { itemGrid, labelStyle, inputStyle, popupStyle, opBtnStyle, modColor };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction EventTargetOffsetStyle(event) {\n  const rect = event.target.getBoundingClientRect();\n  return {\n    left: `${rect.left + window.scrollX}px`,\n    top: `${rect.top + window.scrollY + rect.height + 2}px`\n  };\n}\n\n/// CUSTOM HOOK FOR SETTINGS CONTEXT //////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** React Hook to manage settings context. The original reference\n *  implementation is in mur-settings-context */\nfunction useSettings(initialSettings = {}) {\n  //\n  const [lastSettingsUpdate, _updateSettings] = React.useState({});\n\n  /** universal get settings */\n  const get = dotProp => Settings.Get(dotProp);\n\n  /** update property via settings manager, then trigger rerender */\n  const updateProperty = async (dotProp, value) => {\n    const opResult = await Settings.UpdateProperty(dotProp, value);\n    const { error, changed } = opResult;\n    if (error) {\n      console.error(`updateProperty: ${error}`);\n      return false; // indicate failure\n    }\n    _updateSettings(opResult); // trigger a rerender\n    return true;\n  };\n\n  /** update group of properties via settings manager, then trigger rerender */\n  const updateGroup = async (groupName, propObj) => {\n    const opResult = await Settings.UpdateGroup(groupName, propObj);\n    const { error, changed } = opResult;\n    if (error) {\n      console.error(`updateGroup: ${error}`);\n      return false;\n    }\n    _updateSettings(opResult); // trigger a rerender\n    return true;\n  };\n\n  return {\n    // to trigger rerender\n    lastSettingsUpdate,\n    // api\n    get,\n    updateProperty,\n    updateGroup\n  };\n}\n\n/// EXPORTS ///////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = {\n  GetPropertyDefs,\n  GetMetaDefs,\n  //\n  DerefGroupDef,\n  DerefSingularMetaDef,\n  FlattenPropertyDefs,\n  //\n  UpdateProperty,\n  UpdateGroup,\n  //\n  Subscribe,\n  Unsubscribe,\n  //\n  GetStyles,\n  EventTargetOffsetStyle,\n  //\n  GetSettingsContext: Settings.GetSettingsContext,\n  useSettings // locally-defined to match react version/instance\n};\n","import { useEffect } from 'react';\n\n// Improved version of https://usehooks.com/useOnClickOutside/\nconst useClickOutside = (ref, handler) => {\n  useEffect(() => {\n    let startedInside = false;\n    let startedWhenMounted = false;\n\n    const listener = event => {\n      // Do nothing if `mousedown` or `touchstart` started inside ref element\n      if (startedInside || !startedWhenMounted) return;\n      // Do nothing if clicking ref's element or descendent elements\n      if (!ref.current || ref.current.contains(event.target)) return;\n\n      handler(event);\n    };\n\n    const validateEventStart = event => {\n      startedWhenMounted = ref.current;\n      startedInside = ref.current && ref.current.contains(event.target);\n    };\n\n    document.addEventListener('mousedown', validateEventStart);\n    document.addEventListener('touchstart', validateEventStart);\n    document.addEventListener('click', listener);\n\n    return () => {\n      document.removeEventListener('mousedown', validateEventStart);\n      document.removeEventListener('touchstart', validateEventStart);\n      document.removeEventListener('click', listener);\n    };\n  }, [ref, handler]);\n};\n\nmodule.exports = { useClickOutside };\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  EDGE MANAGER\n\n  edge-mgr takes the incoming FILTEREDNCDATA and simplifies the\n  edges, doing the following:\n    1. Removes any duplicate edges between a source and target\n    2. Caclulates the edge size using the edge.weight parameter\n    3. Updates the VDATA app state\n\n  When VDATA is updated, NCGraphRenderer will redraw.\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// lifecycle INITIALIZE handler\nMOD.Hook('INITIALIZE', () => {\n  // FILTEREDNCDATA is updated by filter-mgr after NCDATA is changed.\n  UDATA.OnAppStateChange('FILTEREDNCDATA', data => {\n    m_RenderEdges(data);\n  });\n}); // end UNISYS_INIT\n\n/// PUBLIC METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Looks up the edge color defined in the passed TEMPLATE\n *  Fall back to default if type is not defined\n *  @param {Object} edge\n *  @param {Object} TEMPLATE\n *  @returns {string} e.g. '#FF00FF' as defined by TEMPLATE type.option\n *                   or `undefined` if no color type is defined\n */\nMOD.LookupEdgeColor = (edge, TEMPLATE) => {\n  const type = edge.type;\n  const typeOption = TEMPLATE.edgeDefs.type.options.find(o => o.label === type);\n  return typeOption ? typeOption.color : TEMPLATE.edgeDefs.type.options[0].color;\n};\n\n/// MODULE METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** m_RenderEdges uses a Map to reduce duplicate edges into a single\n *  edge, calculating edge size based on edge.weight parameter along the way.\n *  @param {Object} data FILTEREDNCDATA e.g. { nodes, edges }\n *  @return Updates VDATA AppState\n */\nfunction m_RenderEdges(data) {\n  const DEFAULT_SIZE = 1;\n  const VDATA = data;\n\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n\n  /*/ ISSUES\n      * How do we handle direction?\n        => Can be handled with a single edge, we just need to determin directionlaity\n      * How do we handle bidrectionality?  Is it a single edge?\n        => Yes.  Just with two arrowheads.\n  /*/\n\n  // Prepare to check for color\n  const colorsAreDefined =\n    TEMPLATE.edgeDefs.type &&\n    TEMPLATE.edgeDefs.type.options &&\n    Array.isArray(TEMPLATE.edgeDefs.type.options) &&\n    TEMPLATE.edgeDefs.type.options.length > 0;\n\n  // Synthesize duplicate edges into a single edge.\n  const edgeMap = new Map(); // key = {source}{target}\n  const cumulativeSize = new Map(); // key = {source}{target}\n  const edgeColorWeightMap = new Map(); // key = {source}{target}, value = colorMap[[color, weightTotal]]\n  VDATA.edges.forEach(e => {\n    const edgeKey = m_GetEdgeKey(e); // single key for both directions\n    const eWeight = Number(e.weight) || DEFAULT_SIZE; // weight defaults to 1, force Number\n\n    // 1. Set Size\n    e.size = eWeight;\n    //     Calculate cumulative size\n    const sum = (cumulativeSize.get(edgeKey) || 0) + e.size;\n    cumulativeSize.set(edgeKey, sum);\n\n    // 2. Update Color Weight Map\n    if (colorsAreDefined) {\n      const colorWeightMap = edgeColorWeightMap.get(edgeKey) || new Map(); // key = color, value = weight\n      const color = MOD.LookupEdgeColor(e, TEMPLATE);\n      const colorWeight = colorWeightMap.get(color) || 0; // default to weight 0 if color was not previously defined\n      colorWeightMap.set(color, colorWeight + eWeight);\n      edgeColorWeightMap.set(edgeKey, colorWeightMap);\n    }\n\n    // 3. Save value\n    edgeMap.set(edgeKey, e);\n  });\n\n  // 4. Set Color and Cumulative Size\n  VDATA.edges.forEach(e => {\n    e.size = cumulativeSize.get(m_GetEdgeKey(e));\n    e.color = m_GetWeightiestColor(e, edgeColorWeightMap);\n  });\n\n  UDATA.SetAppState('VDATA', VDATA);\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Returns a unique key in the form \"<lowestID>,<highestID>\"\n * Used to generate a key for all edges that share the same source and target\n * regardless of direction\n * @param {Object} edge\n * @returns {string}\n */\nfunction m_GetEdgeKey(edge) {\n  let skey = edge.source;\n  let tkey = edge.target;\n  return [skey, tkey].sort().toString();\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Finds the color with the most weight for each edge in edgeColorWeightMap\n * @param {Object} edge\n * @param {Map} edgeColorWeightMap\n * @returns\n */\nfunction m_GetWeightiestColor(edge, edgeColorWeightMap) {\n  const edgeKey = m_GetEdgeKey(edge);\n  const colorWeightMap = edgeColorWeightMap.get(edgeKey); // Map[[ color, weight ]]\n  const colors = [...colorWeightMap.keys()];\n  colors.sort((a, b) => colorWeightMap.get(b) - colorWeightMap.get(a)); // descending\n  return colors[0];\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  FILTER MANAGER\n\n  Filter Definitions\n\n  The initial filter definitions are loaded from the current database template.\n\n    FILTERDEFS = {\n        nodes: {                    // group\n            label: \"Node Filters\",  // group label\n            filters: [              // array of filter objects\n                {\n                  id: '4',\n                  type: 'string',\n                  key: 'label',\n                  keylabel: 'Label',\n                  operator: 'no-op',\n                  value: ''\n                },\n                {\n                  id: '2',\n                  type: 'select',\n                  key: 'type',\n                  keylabel: 'Type',\n                  operator: 'no-op',\n                  value: ''\n                },\n                ...\n            ]\n        },\n        edges: {\n            label: \"Edge Filters\",\n            filters: [...]\n        }\n        focus: {\n          source: undefined,\n          sourceLabel: '',\n          range: 1\n        }\n    }\n\n\n    FILTEREDNCDATA = {\n        nodes: [ ... ],\n        edges: [ ... ],\n        stats: {\n            nodeCount: 0,\n            edgeCount: 0,\n            filteredNodeCount: 0,\n            filteredEdgeCount: 0,\n            statsSummary: '',     // NCFiltersPanel count of nodes/edges if filters are applied\n                                  // (displayed at bottom of NCFiltersPanel)\n\n            graphStats: ''        // NCInfoPanel count of nodes/edges if no filters\n            filtersSummary: '',   // NCInfoPanel summary of active filters\n        }\n    }\n\n  FEATURES\n\n  * See Whimiscal [diagram](https://whimsical.com/d3-data-flow-B2tTGnQYPSNviUhsPL64Dz)\n\n  * filterAction: \"Highlight\" vs \"Filter\"\n    --  Version 1.4 introduces two different types of filtering:\n        \"Highlight\" highlights the matching nodes/edges and fades the others\n        \"Filter\" shows matching nodes/edges and removes the non-matching\n        nodes/edges from the display without affecting the underlying data.\n\n  * With Version 1.4, the only data that is graphed is FILTEREDNCDATA.\n    --  d3-simplenetgraph no longer plots on NCDATA changes.\n    --  Instead, it plots the new FILTEREDNCDATA state.  Whenever NCDATA changes,\n        FILTERDD3DATA is udpated.\n    --  This way there is only one source of truth: all draw updates\n        are routed through filter-mgr.\n    --  If filters have not been defined, we just pass the raw NCDATA\n\n  * Filters can be stacked.\n        You can define two \"Label\" filters, for example.\n        The only reason you can't do it right now is because the filter template\n        is reading directly from the _default.template file.  You can easily\n        insert another filter into the mix programmatically.\n\n  JD added some global settins for filters\n    Settings\n      Transparency\n        Nodes\n        Edges\n\n  NOTE: Default is hand-set to 0 for now, but this should be in a / the template\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst FILTER = require('./components/filter/FilterEnums');\nconst UNISYS = require('unisys/client');\nconst clone = require('rfdc')();\nconst UTILS = require('./nc-utils');\nconst PROMPTS = require('system/util/prompts');\nconst NCLOGIC = require('./nc-logic');\nimport HDATE from 'system/util/hdate';\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'filter-mgr: ';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar TEMPLATE = null; // template definition for prompts\nvar FILTERDEFS_RESTORE; // pristine FILTERDEFS for clearing\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet NODE_DEFAULT_TRANSPARENCY;\nlet EDGE_DEFAULT_TRANSPARENCY;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet RemovedNodes = []; // nodes removed via COLLAPSE filter action\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DATASET = window.NC_CONFIG.dataset || 'netcreate';\nconst TEMPLATE_URL = `templates/${DATASET}.json`;\n\n/// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** lifecycle INITIALIZE handler\n */\nMOD.Hook('INITIALIZE', () => {\n  UDATA.OnAppStateChange('FILTERDEFS', data => {\n    if (DBG) console.log(PR + 'OnAppStateChange: FILTERDEFS', data);\n    // The filter defs have been updated, so apply the filters.\n    m_FiltersApply();\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** FILTER_DEFINE is called by StringFilter when user has updated filter.\n   */\n  UDATA.HandleMessage('FILTER_DEFINE', data => {\n    if (DBG) console.log(PR + 'FILTER_DEFINE', data);\n    m_FilterDefine(data);\n    UNISYS.Log('define filter', JSON.stringify(data));\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** FILTER_CLEAR is called by FiltersPanel when user clicks \"Clear Filters\" button\n   */\n  UDATA.HandleMessage('FILTER_CLEAR', () => {\n    if (DBG) console.log(PR + 'FILTER_CLEAR');\n    m_ClearFilters();\n    UNISYS.Log('clear filters');\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** FILTERS_UPDATE is called by FiltersPanel switches between filters and highlights\n   */\n  UDATA.HandleMessage('FILTERS_UPDATE', data => {\n    if (DBG) console.log(PR + 'FILTERS_UPDATE', data);\n    const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n    FILTERDEFS.filterAction = data.filterAction;\n    // if the Focus panel is being selected, grab update the selection so that\n    // the selected node is immediately focused on (otherwise the system ignores\n    // the currently selecte dnode and you have to click on it again)\n    if (data.filterAction === FILTER.ACTION.FOCUS) {\n      const SELECT = UDATA.AppState('SELECTION');\n      const selectedNode = SELECT.nodes ? SELECT.nodes[0] : undefined;\n      if (selectedNode) {\n        FILTERDEFS.focus = {\n          source: selectedNode.id,\n          sourceLabel: selectedNode.label,\n          range: FILTERDEFS.focus.range\n        };\n      }\n    }\n    UDATA.SetAppState('FILTERDEFS', FILTERDEFS);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Listen for NCDATA updates so we know to trigger change?\n   */\n  UDATA.OnAppStateChange('NCDATA', data => {\n    if (DBG) console.log(PR + 'OnAppStateChange: NCDATA', data);\n    m_FiltersApply();\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** Listen for TEMPLATE updates so we know to trigger change?\n   */\n  UDATA.OnAppStateChange('TEMPLATE', data => {\n    if (DBG) console.log(PR + 'OnAppStateChange: TEMPLATE', data);\n    // this is critical -- graph will not draw if this is\n    // not called from nc-logic.LOADASSETS\n    m_ImportFilters();\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /** 2023-06 Interim Approach -- eventually should convert to new selection mgr\n      Listen for SELECTION changes for setting Focus\n   */\n  UDATA.OnAppStateChange('SELECTION', data => {\n    if (DBG) console.log(PR + 'OnAppStateChange: SELECTION', data);\n    // Only if Focus is active\n    const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n    if (FILTERDEFS.filterAction === FILTER.ACTION.FOCUS) {\n      m_SetFocus(data);\n    }\n  });\n}); // end UNISYS_INIT\n\n/// IMPORT FILTER DEFINITIONS /////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Loads filters from template file\n */\nfunction m_ImportFilters() {\n  TEMPLATE = UDATA.AppState('TEMPLATE');\n  const nodeDefs = TEMPLATE.nodeDefs;\n  const edgeDefs = TEMPLATE.edgeDefs;\n  NODE_DEFAULT_TRANSPARENCY = TEMPLATE.nodeDefaultTransparency;\n  EDGE_DEFAULT_TRANSPARENCY = TEMPLATE.edgeDefaultTransparency;\n\n  /** HACK Source / Target Filter Definitions\n      Source and Target are normally built-in numeric id fields.\n      But for filtering we want to use the corresponding source/target labels as strings.\n      In m_FiltersDefine we are already injecting `sourceLabel` and `targetLabel` into the edge objects\n      to facilitate filtering (saves an extra lookup).  So we can just repurpose the filter definitions\n      to use sourceLabel and targetLabel.  The tricky part is hiding and re-ordering the numeric id filters.\n  */\n  edgeDefs.sourceLabel = {\n    displayLabel: 'Source',\n    exportLabel: 'Source Label',\n    help: 'Source label',\n    hidden: false,\n    type: 'string'\n  };\n  edgeDefs.targetLabel = {\n    displayLabel: 'Target',\n    exportLabel: 'Target Label',\n    help: 'Target label',\n    hidden: false,\n    type: 'string'\n  };\n  /* END HACK */\n\n  let fdefs = {\n    nodes: {\n      group: 'nodes', // this needs to be passed to StringFilter\n      label: 'Node Filters',\n      filters: m_ImportPrompts(nodeDefs),\n      transparency: 0.2 // Default transparency form for Highlight should be 0.2, not template default which is usu 1.0\n    },\n    edges: {\n      group: 'edges', // this needs to be passed to StringFilter\n      label: 'Edge Filters',\n      filters: m_ReplaceSourceTargetIdsWithStrings(m_ImportPrompts(edgeDefs)),\n      transparency: 0.2 // Default transparency form for Highlight should be 0.2, not template default which is usu 0.7\n    },\n    focus: {\n      source: undefined, // nothing focused by default\n      sourceLabel: '',\n      range: 1\n    }\n  };\n\n  UDATA.SetAppState('FILTERDEFS', fdefs);\n\n  // Save off a copy for clearing the form.\n  FILTERDEFS_RESTORE = clone(fdefs);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_ImportPrompts(prompts) {\n  let filters = [];\n  let counter = 0;\n\n  for (const [key, prompt] of Object.entries(prompts)) {\n    let operator;\n    switch (prompt.type) {\n      case FILTER.TYPES.MARKDOWN:\n      case FILTER.TYPES.STRING:\n      case FILTER.TYPES.NUMBER:\n      case FILTER.TYPES.SELECT:\n      case FILTER.TYPES.NODE:\n      case FILTER.TYPES.DATE:\n      case FILTER.TYPES.HDATE:\n      case FILTER.TYPES.TIMESTAMP:\n      case FILTER.TYPES.INFOORIGIN:\n        operator = FILTER.OPERATORS.NO_OP.key;\n        break;\n      case FILTER.TYPES.HIDDEN:\n        break; // hidden filters are not added\n      default:\n        // edge template item \"edgeIsLockedMessage\" will trigger this message\n        // filters will not be created for entries with no `type` defined.\n        if (DBG)\n          console.warn(PR + `Unknown node prompt type ${prompt.type} for ${prompt}`);\n        break;\n    }\n    if (operator === undefined) continue; // don't add filter if operator is hidden\n    if (prompt.hidden) continue; // don't add filter if \"hidden\": true\n    let filter = {\n      id: counter++,\n      key: key,\n      type: prompt.type,\n      keylabel: prompt.displayLabel,\n      operator: operator,\n      value: ''\n    };\n    // Add \"Options\" for \"select\" filter types\n    if (prompt.type === FILTER.TYPES.SELECT) {\n      let options = [];\n      prompt.options.forEach(opt => {\n        if (opt.label === '') return;\n        options.push(opt.label);\n      });\n      filter.options = options;\n    }\n\n    filters.push(filter);\n  }\n  return filters;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Used to replace the `source` and `target` numeric id filter definitions\n *  with `sourceLabel` and `targetLabel` string defintions.\n *  m_ImportPrompts converts the edgeDefs object to an array\n *  We then insert sourceLabel and targetLabel in place of source and target\n *  and then remove the now extraneous sourceLabel and targetLabel definitions.\n *  This is a hacky brute force solution but it gives us better control over\n *  the field order.\n */\nfunction m_ReplaceSourceTargetIdsWithStrings(filters) {\n  const reorderedFilters = [...filters];\n  // Replace `source` with 'sourceLabel'\n  const sourceIndex = 1; // force seccond item // reorderedFilters.findIndex(f => f.key === 'source');\n  const sourceLabelIndex = reorderedFilters.findIndex(f => f.key === 'sourceLabel');\n  reorderedFilters.splice(sourceIndex, 1, reorderedFilters[sourceLabelIndex]);\n  reorderedFilters.splice(sourceLabelIndex, 1);\n  // and 'target' with 'targetLabel'\n  const targetIndex = 2; // force third item // reorderedFilters.findIndex(f => f.key === 'target');\n  const targetLabelIndex = reorderedFilters.findIndex(f => f.key === 'targetLabel');\n  reorderedFilters.splice(targetIndex, 1, reorderedFilters[targetLabelIndex]);\n  reorderedFilters.splice(targetLabelIndex, 1);\n  return reorderedFilters;\n}\n\n/// UDATA HANDLERS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Define an individual filter\n *  @param {Object} data {group, filter}\n */\nfunction m_FilterDefine(data) {\n  const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n  FILTERDEFS.filterAction = data.filterAction || FILTERDEFS.filterAction; // if 'transparency' then filterAction is not passed, so default to existing\n  if (data.group === 'nodes') {\n    if (data.type === 'transparency') {\n      FILTERDEFS.nodes.transparency = data.transparency;\n    } else {\n      let nodeFilters = FILTERDEFS.nodes.filters;\n      const index = nodeFilters.findIndex(f => f.id === data.filter.id);\n      nodeFilters.splice(index, 1, data.filter);\n      FILTERDEFS.nodes.filters = nodeFilters;\n    }\n  } else if (data.group === 'edges') {\n    if (data.type === 'transparency') {\n      FILTERDEFS.edges.transparency = data.transparency;\n    } else {\n      let edgeFilters = FILTERDEFS.edges.filters;\n      const index = edgeFilters.findIndex(f => f.id === data.filter.id);\n      edgeFilters.splice(index, 1, data.filter);\n      FILTERDEFS.edges.filters = edgeFilters;\n    }\n  } else if (data.group === 'focus') {\n    if (data.filter.deselectNode) {\n      // clear out sourceLabel to allow focus filter to select a new node\n      FILTERDEFS.focus.source = undefined;\n      FILTERDEFS.focus.sourceLabel = '';\n    }\n    if (data.filter.sourceLabel)\n      FILTERDEFS.focus.sourceLabel = data.filter.sourceLabel;\n    if (data.filter.source) FILTERDEFS.focus.source = data.filter.source;\n    if (data.filter.range) FILTERDEFS.focus.range = data.filter.range;\n  } else {\n    throw `FILTER_DEFINE called with unknown group: ${data.group}`;\n  }\n  UDATA.SetAppState('FILTERDEFS', FILTERDEFS);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Walk down the list of filters and apply them all\n *  @param {Object} data A UDATA pkt {defs}\n *  @returns {string} Summary of the filter statistics\n */\nfunction m_FiltersApply() {\n  const NCDATA = UDATA.AppState('NCDATA');\n  const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n  const FILTEREDNCDATA = { nodes: [...NCDATA.nodes] };\n\n  // skip if FILTERDEFS has not been defined yet\n  if (Object.keys(FILTERDEFS).length < 1) return;\n\n  // sourceLabel, targetLabel are available\n  // stuff 'sourceLabel' and 'targetLabel' into edges for quicker filtering\n  // otherwise we have to constantly look up the node label\n  FILTEREDNCDATA.edges = NCDATA.edges.map(e => {\n    const source = NCDATA.nodes.find(n => n.id === e.source);\n    const target = NCDATA.nodes.find(n => n.id === e.target);\n    e.sourceLabel = source ? source.label : 'deleted';\n    e.targetLabel = target ? target.label : 'deleted';\n    return e;\n  });\n\n  m_FiltersApplyToNodes(FILTERDEFS, FILTEREDNCDATA);\n  m_FiltersApplyToEdges(FILTERDEFS, FILTEREDNCDATA);\n\n  // REVIEW 2023-0530\n  // -- If \"Filter/Hide\" functionality is going to be kept, this needs to be reworked!\n  //    We SHOULD NOT recalculate sizes in \"Filter/Hide\" mode, otherwise, the size will change.\n  //\n  // Recalculate sizes\n  // ALWAYS recalculate, e.g. if switching from Collapse to Highlight or clearing data\n  UTILS.RecalculateAllEdgeSizes(FILTEREDNCDATA);\n  UTILS.RecalculateAllNodeDegrees(FILTEREDNCDATA);\n\n  // Calculate Stats and Send with FILTEREDNCDATA\n  FILTEREDNCDATA.stats = m_UpdateFilterStats(\n    NCDATA,\n    FILTEREDNCDATA,\n    FILTERDEFS.filterAction\n  );\n\n  // Update Filter Summary\n  const filterSummary = m_UpdateFilterSummary(FILTEREDNCDATA.stats.statsSummary);\n  FILTEREDNCDATA.stats = { ...FILTEREDNCDATA.stats, ...filterSummary };\n\n  // Update FILTEREDNCDATA\n  UDATA.SetAppState('FILTEREDNCDATA', FILTEREDNCDATA);\n  // edge-mgr handles this call and updates VDATA, which is rendered by d3-simplenetgraph\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_ClearFilters() {\n  // Reload fdata\n  const FILTERDEFS = clone(FILTERDEFS_RESTORE);\n  UDATA.SetAppState('FILTERDEFS', FILTERDEFS);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_UpdateFilterStats(NCDATA, FILTEREDNCDATA, filterAction) {\n  const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n  const { transparency: transparencyNode } = FILTERDEFS.nodes;\n  const { transparency: transparencyEdge } = FILTERDEFS.edges;\n\n  const nodeCount = NCDATA.nodes.length;\n  const edgeCount = NCDATA.edges.length;\n  let filteredNodeCount, filteredEdgeCount;\n  if (filterAction === FILTER.ACTION.FADE) {\n    filteredNodeCount =\n      nodeCount -\n      FILTEREDNCDATA.nodes.filter(n => n.filteredTransparency <= transparencyNode)\n        .length;\n    filteredEdgeCount =\n      edgeCount -\n      FILTEREDNCDATA.edges.filter(e => e.filteredTransparency <= transparencyEdge)\n        .length;\n  } else {\n    filteredNodeCount = FILTEREDNCDATA.nodes.length;\n    filteredEdgeCount = FILTEREDNCDATA.edges.length;\n  }\n  const statsSummary = `Showing ${filteredNodeCount}/${nodeCount} nodes, ${filteredEdgeCount}/${edgeCount} edges`;\n\n  return { nodeCount, edgeCount, filteredNodeCount, filteredEdgeCount, statsSummary };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_UpdateFilterSummary(statsSummary) {\n  const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n  const FILTEREDNCDATA = UDATA.AppState('FILTEREDNCDATA');\n\n  const graphStats = `${FILTEREDNCDATA.nodes && FILTEREDNCDATA.nodes.length} nodes, ${\n    FILTEREDNCDATA.edges && FILTEREDNCDATA.edges.length\n  } edges`;\n\n  const typeSummary = FILTERDEFS.filterAction; // text for filter action is the label, e.g. 'HIGHLIGHT'\n  const nodeSummary = m_FiltersToString(FILTERDEFS.nodes.filters);\n  const edgeSummary = m_FiltersToString(FILTERDEFS.edges.filters);\n  let filtersSummary = '';\n  if (nodeSummary || edgeSummary)\n    filtersSummary = `${typeSummary} ${nodeSummary ? 'NODES: ' : ''}${nodeSummary} ${\n      edgeSummary ? 'EDGES: ' : ''\n    }${edgeSummary}`;\n  if (filtersSummary) filtersSummary += ' ' + statsSummary;\n\n  return { filtersSummary, graphStats };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_FiltersToString(filters) {\n  let summary = '';\n  filters.forEach(filter => {\n    if (\n      filter.operator === undefined ||\n      filter.value === undefined ||\n      filter.value === '' ||\n      (typeof filter.value === 'object' && filter.value.value === '') // hdate values are objects\n    )\n      return;\n    summary += filter.keylabel + ' ';\n    summary += m_OperatorToString(filter.operator) + ' ';\n    if (typeof filter.value === 'object') {\n      // hdate value\n      summary += '\"' + filter.value.value + '\"; ';\n    } else {\n      summary += '\"' + filter.value + '\"; ';\n    }\n  });\n  return summary;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_OperatorToString(operator) {\n  return FILTER.OPERATORS[operator].label;\n}\n\n/// UTILITY FUNCTIONS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction clean(str) {\n  return NCLOGIC.EscapeRegexChars(String(str).trim());\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n *  Match strings, allowing use of `&&` and `||`\n *  * Matches strings in a flat list of pairs, starting with ORs\n *  * Does not support grouping\n *  * Operator precedence: ORs are evaluated first, follwed by ANDs.\n *  * Extra spaces will be trimmed.\n *  @param {string} needle aka \"needle\" in the haystack\n *  @param {*} haystack\n *  @param {*} contains\n *  @returns booleean\n */\nfunction m_MatchString(needle, haystack, contains = true) {\n  const ANDNeedles = String(needle).split('&&');\n  const ORNeedleArrs = ANDNeedles.map(ands =>\n    String(ands)\n      .split(/\\|\\|/)\n      .map(str => String(str).trim())\n  );\n  // For each set of OR Array matches, evaluate the pair\n  const ResultsOR = ORNeedleArrs.map(pair =>\n    pair.reduce((a, b) => a || m_MatchStringSnippet(clean(b), haystack, true), false)\n  );\n  const ResultsAND = ResultsOR.reduce((a, b) => a && b, true);\n  return contains ? ResultsAND : !ResultsAND;\n}\nfunction m_MatchStringSnippet(needle, haystack, contains = true) {\n  // Normalize and strip diacritics\n\n  needle = UTILS.RemoveDiacriticMarks(needle);\n  haystack = UTILS.RemoveDiacriticMarks(haystack);\n\n  const regex = new RegExp(/*'^'+*/ needle, 'i');\n  let matches;\n  if (needle === '') {\n    // empty string matches everything\n    matches = true;\n  } else if (contains) {\n    matches = regex.test(haystack);\n  } else {\n    matches = !regex.test(haystack);\n  }\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_MatchNumber(operator, filterVal, objVal) {\n  let matches;\n  if (filterVal === '') {\n    matches = true;\n  } else {\n    switch (operator) {\n      case FILTER.OPERATORS.GT.key:\n        matches = objVal > filterVal;\n        break;\n      case FILTER.OPERATORS.GT_EQ.key:\n        matches = objVal >= filterVal;\n        break;\n      case FILTER.OPERATORS.LT.key:\n        matches = objVal < filterVal;\n        break;\n      case FILTER.OPERATORS.LT_EQ.key:\n        matches = objVal <= filterVal;\n        break;\n      case FILTER.OPERATORS.EQ.key:\n        matches = objVal === filterVal;\n        break;\n      case FILTER.OPERATORS.NOT_EQ.key:\n        matches = objVal !== filterVal;\n        break;\n      default:\n        console.error(`filter-mgr.js: Unknown operator ${operator}`);\n        break;\n    }\n  }\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_MatchHDate(operator, filterVal, objVal) {\n  // deconstruct the hdate\n  const { value, format, formattedString } = objVal;\n  const akey = HDATE.Parse(value); // parseResult\n  const bkey = HDATE.Parse(filterVal);\n  if (akey.length < 1 || bkey.length < 1) return false;\n  const da = akey[0].start.knownValues;\n  const db = bkey[0].start.knownValues;\n\n  // first make sure that the dates share common values\n  // if they do not share common values, then there's no match\n  const dakeys = Object.keys(da);\n  const dbkeys = Object.keys(db);\n  const commonKeys = dbkeys.filter(k => dakeys.includes(k));\n  if (commonKeys.length < 1) {\n    // no common keys, so there's nothing to match\n    return false;\n  }\n\n  let order;\n  if (commonKeys.includes('year') && da.year !== db.year) {\n    order = da.year - db.year;\n  } else if (commonKeys.includes('month') && da.month !== db.month) {\n    order = da.month - db.month;\n  } else if (commonKeys.includes('day') && da.day !== db.day) {\n    order = da.day - db.day;\n  } else if (commonKeys.includes('hour') && da.hour !== db.hour) {\n    order = da.hour - db.hour;\n  } else if (commonKeys.includes('minute') && da.minute !== db.minute) {\n    order = da.minute - db.minute;\n  } else if (commonKeys.includes('second') && da.second !== db.second) {\n    order = da.second - db.second;\n  } else {\n    // matched!\n    order = 0;\n  }\n\n  let matches;\n  if (filterVal === '') {\n    matches = true;\n  } else {\n    switch (operator) {\n      case FILTER.OPERATORS.GT.key:\n        matches = order > 0;\n        break;\n      case FILTER.OPERATORS.GT_EQ.key:\n        matches = order >= 0;\n        break;\n      case FILTER.OPERATORS.LT.key:\n        matches = order < 0;\n        break;\n      case FILTER.OPERATORS.LT_EQ.key:\n        matches = order <= 0;\n        break;\n      case FILTER.OPERATORS.EQ.key:\n        matches = order === 0;\n        break;\n      case FILTER.OPERATORS.NOT_EQ.key:\n        matches = order !== 0;\n        break;\n      default:\n        console.error(`filter-mgr.js: Unknown operator ${operator} for HDATE filter`);\n        break;\n    }\n  }\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * This uses the HDate Filter UI to construct a search string\n * But then converts the HDate filter definition to a timestamp\n * And then does a simple numeric comparison\n * @param {number} operator filter operator\n * @param {hdate} filterVal hdate\n * @param {number} objVal timestamp\n * @returns\n */\nfunction m_MatchTimestamp(operator, filterVal, objVal) {\n  const { value, format, formattedString } = filterVal;\n  const hdateValue = HDATE.Parse(value); // deconstruct the HDate filter into a timestamp\n\n  if (hdateValue.length < 1) return false;\n\n  const knownValues = hdateValue[0].start.knownValues;\n\n  // When filtering, use only as much precision as the HDate filter requests\n  // if a value is missing, assume it is 0\n  const filterTimestamp = new Date(\n    knownValues.year !== undefined ? knownValues.year : 0,\n    knownValues.month !== undefined ? knownValues.month - 1 : 0,\n    knownValues.day !== undefined ? knownValues.day : 1,\n    knownValues.hour !== undefined ? knownValues.hour : 0,\n    knownValues.minute !== undefined ? knownValues.minute : 0,\n    knownValues.second !== undefined ? knownValues.second : 0\n  );\n  const objValDate = new Date(objVal);\n  const objValTimestamp = new Date(\n    knownValues.year !== undefined ? objValDate.getFullYear() : 0,\n    knownValues.month !== undefined ? objValDate.getMonth() : 0,\n    knownValues.day !== undefined ? objValDate.getDate() : 1,\n    knownValues.hour !== undefined ? objValDate.getHours() : 0,\n    knownValues.minute !== undefined ? objValDate.getMinutes() : 0,\n    knownValues.second !== undefined ? objValDate.getSeconds() : 0\n  );\n\n  return m_MatchNumber(\n    operator,\n    filterTimestamp.getTime(),\n    objValTimestamp.getTime()\n  );\n}\n\n/// NODE FILTERS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Side effect: FILTEREDNCDATA.nodes are updated with a new `filterTransparency`. */\nfunction m_FiltersApplyToNodes(FILTERDEFS, FILTEREDNCDATA) {\n  RemovedNodes = [];\n\n  // if current filter is focus, calculate bacon_values\n  if (FILTERDEFS.filterAction === FILTER.ACTION.FOCUS)\n    m_FocusPrep(FILTERDEFS, FILTEREDNCDATA);\n\n  FILTEREDNCDATA.nodes = FILTEREDNCDATA.nodes.filter(node => {\n    return m_NodeIsFiltered(node, FILTERDEFS);\n  });\n}\n\nfunction m_NodeIsFiltered(node, FILTERDEFS) {\n  const { filterAction } = FILTERDEFS;\n  const { filters, transparency } = FILTERDEFS.nodes;\n  const { source, range } = FILTERDEFS.focus;\n\n  // let all_no_op = true;\n  let keepNode = true;\n\n  // 1. Look for matches\n  // implicit AND.  ALL filters must return true.\n  filters.forEach(filter => {\n    if (filter.operator === FILTER.OPERATORS.NO_OP.key) return; // skip no_op\n    // all_no_op = false;\n    if (!m_IsNodeMatchedByFilter(node, filter)) {\n      keepNode = false;\n    }\n  });\n\n  // 2. Decide based on filterAction\n  node.filteredTransparency = NODE_DEFAULT_TRANSPARENCY; // always reset if not HIGHLIGHT\n  if (filterAction === FILTER.ACTION.FILTER) {\n    // not using highlight, so restore transparency\n    if (keepNode) return true;\n    return false; // remove from array\n  } else if (filterAction === FILTER.ACTION.FADE) {\n    if (!keepNode) {\n      node.filteredTransparency = transparency; // set the transparency value ... right now it is inefficient to set this at the node / edge level, but that's more flexible\n    }\n    return true; // don't filter out\n  } else if (filterAction === FILTER.ACTION.REDUCE) {\n    if (keepNode) return true; // matched, so keep\n    // filter out (remove) and add to `RemovedNodes` for later removal of linked edge\n    RemovedNodes.push(node.id);\n    return false;\n  } else if (filterAction === FILTER.ACTION.FOCUS) {\n    // Remove nodes outside of range\n    if (\n      source !== undefined &&\n      (node.bacon_value === undefined || node.bacon_value > range)\n    ) {\n      RemovedNodes.push(node.id);\n      return false;\n    }\n    return true;\n  } else {\n    // no filter, keep the node!\n    return true;\n  }\n\n  // all_no_op\n  // This is currently redundant because matchesFilter will always\n  // be true if there are no filters.  If matchesFilter is true,\n  // then the node will not be removed/faded.\n  //\n  // if (all_no_op) {\n  //   // all filters are \"no_op\", so no filters defined, don't filter anything\n  //   node.filteredTransparency = 1.0; // opaque, not tranparent\n  // }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_IsNodeMatchedByFilter(node, filter) {\n  if (\n    filter.key === undefined ||\n    filter.operator === undefined ||\n    filter.value === undefined\n  ) {\n    return false; // nothing to filter\n  }\n\n  const nodeValue = ['created', 'updated'].includes(filter.key)\n    ? node.meta[filter.key] // timestamps are stored in loki meta object\n    : node[filter.key];\n\n  switch (filter.operator) {\n    case FILTER.OPERATORS.CONTAINS.key:\n      return m_MatchString(filter.value, nodeValue, true);\n    case FILTER.OPERATORS.NOT_CONTAINS.key:\n      return m_MatchString(filter.value, nodeValue, false);\n    case FILTER.OPERATORS.IS_EMPTY.key:\n      return nodeValue === undefined || nodeValue === '';\n    case FILTER.OPERATORS.IS_NOT_EMPTY.key:\n      return nodeValue !== undefined && nodeValue !== '';\n    default:\n      if (nodeValue === undefined) return false; // no value to match\n      if (filter.type === FILTER.TYPES.TIMESTAMP)\n        return m_MatchTimestamp(filter.operator, filter.value, nodeValue);\n      if (filter.type === FILTER.TYPES.HDATE)\n        return m_MatchHDate(filter.operator, filter.value, nodeValue);\n      // else assume it's a number\n      return m_MatchNumber(filter.operator, filter.value, nodeValue);\n  }\n}\n\n/// EDGE FILTERS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_FiltersApplyToEdges(FILTERDEFS, FILTEREDNCDATA) {\n  const { filterAction } = FILTERDEFS;\n  const { filters, transparency } = FILTERDEFS.edges;\n  if (!FILTEREDNCDATA.edges) return; // no data\n  FILTEREDNCDATA.edges = FILTEREDNCDATA.edges.filter(edge => {\n    return m_EdgeIsFiltered(\n      edge,\n      filters,\n      transparency,\n      filterAction,\n      FILTEREDNCDATA\n    );\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n *  Side effect: FILTEREDNCDATA.edges are updated with a new `filterTransparency`.\n */\nfunction m_EdgeIsFiltered(edge, filters, transparency, filterAction, FILTEREDNCDATA) {\n  // let all_no_op = true; // all filters are no_op\n  let keepEdge = true;\n  const source = FILTEREDNCDATA.nodes.find(e => {\n    if (edge.source === undefined) return false;\n    // on init, edge.source is just an id.  only with d3 processing does it\n    // get transformed into a node object.  so we have to check the type.\n    const sourceId = typeof edge.source === 'number' ? edge.source : edge.source.id;\n    return e.id === sourceId;\n  });\n  const target = FILTEREDNCDATA.nodes.find(e => {\n    if (edge.target === undefined) return false;\n    // on init, edge.target is just an id.  only with d3 processing does it\n    // get transformed into a node object.  so we have to check the type.\n    const targetId = typeof edge.target === 'number' ? edge.target : edge.target.id;\n    return e.id === targetId;\n  });\n\n  // 0. First set default transparency\n  // restore default transparency, otherwise it could remain faded out\n  edge.filteredTransparency = EDGE_DEFAULT_TRANSPARENCY; // opaque\n\n  // 1. If source or target are missing, then remove the edge\n  if (source === undefined || target === undefined) return false;\n\n  // 2. If source or target have been removed via collapse or focus, remove the edge\n  if (RemovedNodes.includes(source.id) || RemovedNodes.includes(target.id))\n    return false;\n  // 3. if source or target is transparent, then we are transparent too\n  if (source.filteredTransparency < 1.0 || target.filteredTransparency < 1.0) {\n    // regardless of filter definition...\n    // ...if filterAction is FILTER\n    // always hide edge if it's attached to a filtered node\n    if (filterAction === FILTER.ACTION.FILTER) return false;\n    // ...else if filterAction is HIGHLIGHT\n    // don't filter, just fade\n    edge.filteredTransparency = transparency; // set the transparency value ... right now it is inefficient to set this at the node / edge level, but that's more flexible\n    return true;\n  }\n\n  // 4. otherwise, look for matches\n  // implicit AND.  ALL filters must return true.\n  // edge is filtered out if it fails ANY filter tests\n  filters.forEach(filter => {\n    if (filter.operator === FILTER.OPERATORS.NO_OP.key) return; // skip no_op\n    // Found a filter!  Apply it!\n    // all_no_op = false;\n    if (!m_IsEdgeMatchedByFilter(edge, filter)) {\n      keepEdge = false;\n    }\n  });\n\n  // 3. Decide how to filter based on filterAction\n  if (filterAction === FILTER.ACTION.FILTER) {\n    // FILTER!\n    // not using highlight, so restore transparency\n    edge.filteredTransparency = EDGE_DEFAULT_TRANSPARENCY; // opaque\n    if (keepEdge) return true; // keep in array\n    return false; // remove from array\n  } else if (filterAction === FILTER.ACTION.FADE) {\n    if (!keepEdge) {\n      edge.filteredTransparency = transparency; // set the transparency value ... right now it is inefficient to set this at the node / edge level, but that's more flexible\n    }\n    return true; // always keep in array\n  } else if (filterAction === FILTER.ACTION.REDUCE) {\n    if (keepEdge) return true; // matched, so keep\n    // else filter out (remove)\n    return false;\n  } else {\n    // keep by default if no filter\n    return true;\n  }\n\n  // all_no_op\n  // This is currently redundant because matchesFilter will always\n  // be true if there are no filters.  If matchesFilter is true,\n  // then the node will not be removed/faded.\n  //\n  // if (all_no_op) {\n  //   // no filters defined, undo isFilteredOut\n  //   edge.filteredTransparency = 1.0;\n  // } else {\n  // }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_IsEdgeMatchedByFilter(edge, filter) {\n  if (\n    filter.key === undefined ||\n    filter.operator === undefined ||\n    filter.value === undefined\n  ) {\n    return false; // nothing to filter\n  }\n\n  let edgeValue;\n  if (filter.type === FILTER.TYPES.NODE) {\n    // edges fields that point to nodes require special handling because `source` and `target`\n    // point to node objects, not simple strings.\n    if (filter.key === 'source') edgeValue = edge.sourceLabel;\n    if (filter.key === 'target') edgeValue = edge.targetLabel;\n  } else {\n    edgeValue = ['created', 'updated'].includes(filter.key)\n      ? edge.meta[filter.key] // timestamps are stored in loki meta object\n      : edge[filter.key];\n  }\n\n  switch (filter.operator) {\n    case FILTER.OPERATORS.CONTAINS.key:\n      return m_MatchString(filter.value, edgeValue, true);\n    case FILTER.OPERATORS.NOT_CONTAINS.key:\n      return m_MatchString(filter.value, edgeValue, false);\n    case FILTER.OPERATORS.IS_EMPTY.key:\n      return edgeValue === undefined || edgeValue === '';\n    case FILTER.OPERATORS.IS_NOT_EMPTY.key:\n      return edgeValue !== undefined && edgeValue !== '';\n    default:\n      if (edgeValue === undefined) return false; // no value to match\n      if (filter.type === FILTER.TYPES.TIMESTAMP)\n        return m_MatchTimestamp(filter.operator, filter.value, edgeValue);\n      if (filter.type === FILTER.TYPES.HDATE)\n        return m_MatchHDate(filter.operator, filter.value, edgeValue);\n      // else assume it's a number\n      return m_MatchNumber(filter.operator, filter.value, edgeValue);\n  }\n}\n\n/// FOCUS FILTERS /////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns an Map of node ids that are directly connected to the passed `nodeId`\n *  Uses a Map so there are no redundancies.\n *  A more efficient search targeted on looking up nodes\n *  @param {object} puredata Raw/pure data from NCData\n *  @param {array} puredata.nodes\n *  @param {array} puredata.edges where edge.source and edge.target are numeric ids\n *  @param {string} nodeId The source nodeId to start the search from\n *  @returns {map} Map of matching nodeIds {number}\n */\nfunction m_FindConnectedNodeIds(puredata, nodeId) {\n  let returnMatches = new Map();\n  puredata.edges.forEach(edge => {\n    if (edge.source === nodeId) returnMatches.set(edge.target, nodeId); // nodeId in returnMatches is not necessary\n    if (edge.target === nodeId) returnMatches.set(edge.source, nodeId);\n  });\n  return returnMatches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Recursively walks down the network starting from the sourceNodes\n *  There can be more than one sourceNodes, e.g. this can set values starting with any number of nodes\n *  Modifies puredata by reference\n *  @param {object} puredata {nodes, edges}\n *  @param {array} sourceNodes {string}\n *  @param {number} range\n */\nfunction m_SetBaconValue(bacon_value, max_bacon_value, puredata, sourceNodes) {\n  if (bacon_value > max_bacon_value) return;\n  sourceNodes.forEach(source => {\n    const newNodes = []; // collect new nodes that we need to walk down\n    const connectedNodeIds = m_FindConnectedNodeIds(puredata, source); // map\n    puredata.nodes = puredata.nodes.map(node => {\n      if (node.bacon_value !== undefined) return node; // skip bacon_value if ready set\n\n      if (node.id === source) {\n        node.bacon_value = 0; // the focused node has a value of 0\n      } else if (connectedNodeIds.has(node.id)) {\n        node.bacon_value = bacon_value;\n        newNodes.push(node.id);\n      }\n      return node; // returns node with updated bacon_value\n    });\n\n    // recursive call\n    if (newNodes.length > 0 && bacon_value + 1 <= max_bacon_value)\n      m_SetBaconValue(bacon_value + 1, max_bacon_value, puredata, newNodes);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Prepares `puredata` (aka FILTEREDNCDATA) for filtering by\n *  seeding node data with \"degrees of separation\" (aka \"bacon_value\") from the selected node\n *  Uses FILTERDEFS specifications for the focus selection and range\n *  Modifies puredata by reference\n *  This should generally be called right before filtering is applied\n *  @param {*} FILTERDEFS\n *  @param {*} puredata\n */\nfunction m_FocusPrep(FILTERDEFS, puredata) {\n  const { source, range } = FILTERDEFS.focus;\n  // first clear bacon_value\n  puredata.nodes = puredata.nodes.map(node => {\n    node.bacon_value = undefined;\n    return node;\n  });\n  if (range < 1) {\n    return; // show all if range=0\n  }\n  // Then set bacon_value\n  // Initiate the crawl starting at 1 with the source node\n  m_SetBaconValue(1, range, puredata, [source]);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Called when SELECTION appState changes, e.g. user has clicked on a node\n *  while in FOCUS View.\n *  @param {object} data\n *  @param {array} data.nodes array of node objects\n */\nfunction m_SetFocus(data) {\n  const selectedNode = data.nodes[0];\n  const selectedNodeId = selectedNode ? selectedNode.id : undefined;\n  const selectedNodeLabel = selectedNode ? selectedNode.label : '';\n\n  // Set FILTERDEFS\n  const FILTERDEFS = UDATA.AppState('FILTERDEFS');\n  FILTERDEFS.focus = {\n    source: selectedNodeId,\n    sourceLabel: selectedNodeLabel,\n    range: FILTERDEFS.focus.range\n  };\n  UDATA.SetAppState('FILTERDEFS', FILTERDEFS);\n  // Actual filtering is done by m_FiltersApply call after FILTERDEFS change\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  HILITE MANAGER\n\n  hilite-mgr handles UI highlighting events like:\n  * mouse over graph node\n  * mouse over Node Table row\n  * highlighting found nodes via search\n  * Others TBD\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'hilite-mgr: ';\n\n/// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.Hook('INITIALIZE', () => {\n  UDATA.HandleMessage('USER_HILITE_NODE', m_UserHighlightNode);\n  UDATA.HandleMessage('AUTOSUGGEST_HILITE_NODE', m_AutoSuggestHiliteNode);\n  UDATA.HandleMessage('TABLE_HILITE_NODE', m_TableHiliteNode);\n}); // end UNISYS_INIT\n\n/// MODULE METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_UserHighlightNode(data) {\n  // console.log('mouseover', data.nodeId)\n  const HILITE = UDATA.AppState('HILITE');\n  HILITE.userHighlightNodeId = data.nodeId;\n  UDATA.SetAppState('HILITE', HILITE);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** AUTOSUGGEST_HILITE_NODE shows the current mouse-over node name in a list of\n *  autosuggested/autocompleted node names from AutoComplete.\n */\nfunction m_AutoSuggestHiliteNode(data) {\n  const HILITE = UDATA.AppState('HILITE');\n  HILITE.autosuggestHiliteNodeId = data.nodeId;\n  UDATA.SetAppState('HILITE', HILITE);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** User is hovering over a row in the NodeTable.\n *  The corresponding node in the graph will also highlighted.\n */\nfunction m_TableHiliteNode(data) {\n  const HILITE = UDATA.AppState('HILITE');\n  HILITE.tableHiliteNodeId = data.nodeId;\n  UDATA.SetAppState('HILITE', HILITE);\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  ## Import / Export Manager\n\n  See ImportExport.jsx for the UI.\n\n  #### Data Format\n\n  The import/export data format is '.csv'.\n\n  The first row should define the headers.\n  Each data row should be comma-delimited and ended with a CR/LF.\n\n  We support:\n  * CR/LF inside of double quotes\n  * Double quotes need to be escaped by repeating the quote, e.g. `\"\"quoted text\"\"\"\n  * Dates can be exported and imported as UTCStrings\n\n  In general, any valid '.csv' file exported by Excel ought to work.\n\n  #### Permissions\n\n  Everyone is allowed to EXPORT data.\n  * The data fields that are exported are defined in the project's template.\n    Any field that is NOT marked \"hidden\" is exported.\n\n  In general, only admins are allowed IMPORT data.\n  * If the `allowLoggedInUserToImport` flag is set in the template, then\n    logged-in users are also allowed to import data.\n  * When anyone on the net is importing data, \"Edit Lock\" is set and no\n    one else is allowed to import, edit a node or edge, or edit a template.\n    This is because each of those activities can potentially conflict with\n    each other.\n\n\n  #### How it works\n\n  Coordinating the selection of node and edge files for imports is a complex\n  dance of selection, validation, and reporting.  When an import file is\n  selected, we:\n\n  1. Make sure any headers required by the Template are present\n  2. Attempt to load the field data into memory\n  3. Validate the data, either adding new objects or replacing existing objects\n     For edges, we also check that the sources and targets point to valid nodes\n  4. Display the expected import -- kind of like a dry run output.\n  5. Wait fo the user to confirm and click Import.\n  6. After the user clicks import, erge the data into the database and\n  refresh global NCDATA.\n\n  If there is a failure at any point, we abort immediately and display an error\n  and clear the UI for the user to fix the import file and select a\n  replacement file.  Importing can be a complex process, so we want to provide\n  as much feedback as we can along the way so users know how to fix problems.\n\n  Node and edge import files can be selected separately and in any order.\n  The import data is temporarily stored in `IMPORT_NCDATA` for validation.\n\n  The DB is NOT updated until the user clicks \"Import\".\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\nconst DATASTORE = require('system/datastore');\nconst TOML = require('@iarna/toml');\nconst clone = require('rfdc')();\nconst UTILS = require('./nc-utils');\nconst ENUM = require('system/util/enum');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = true;\nconst PR = 'importexport-mgr: ';\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// CONSTANTS /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// For CSV Importing\n/// * new id keyword\nconst NEW_ID_KEYWORD = 'new'; // use id \"new\" to add a new record during import\n/// We need to match:\n/// * To split lines, we need to split on LF that is NOT wrapped in quotes\nconst REGEXMatchLFNotInQuotes = /\\n(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;\n/// * To read fields, we need to ignore commas that are between two double quotes\nconst REGEXMatchCommasNotInQuotes = /,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_formatDate(date) {\n  // wrap in quotes because time includes a comma\n  if (date) return `\"${new Date(date).toUTCString()}\"`;\n  return '';\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_encode(data) {\n  let res;\n  // double quotes need to be escaped\n  res = String(data).replace(/\"/g, '\"\"');\n  // Don't encode carriage returns, csv should support LF inside of quotes\n  // `REGEXMatchLFNotInQuotes` should work.\n  // // encode carriage returns\n  // res = String(res).replace(/\\n/g, 'nnn');\n  return res;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_decode(data) {\n  let res;\n  // double quotes need to be escaped\n  res = String(data).replace(/\"\"/g, '\"');\n  return res;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// DEPRECATED -- Used to flatten 'attributes'\n//    'attributes' have been removed, so this should not be needed anymore\n// Converts nested key definitions into a flat array, e.g.\n//     from ['id', { attributes: ['type', 'info'] } ]\n//     into ['id', 'attributes:type', 'attributes:info']\nfunction m_flattenKeys(keys, prefix) {\n  if (!Array.isArray(keys)) {\n    // Recurse\n    const pre = Object.keys(keys)[0];\n    return m_flattenKeys(keys[pre], pre);\n  } else {\n    const flattenedKeys = keys.map(k => {\n      if (typeof k !== 'string') return m_flattenKeys(k);\n      if (prefix) return `${prefix}:${k}`;\n      else return k;\n    });\n    return flattenedKeys.flat();\n  }\n}\n\n/// IMPORT/EXPORT HELPERS ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns an array of export values for a given node record\n *  Used during export.\n *  @param {array} nodes - array of source nodes to export\n *  @param {array} keys - node def keys, e.g. 'id' and 'label'\n *                        NOTE this is usually a subset of nodeDef keys\n *                        with `hidden` keys removed so they won't export\n *  @returns - array of node values, e.g. [1,'Tacitus','Person',...]\n */\nfunction m_renderNodeValues(node, keys) {\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n\n  const RESULT = [];\n  keys.forEach(key => {\n    // If the key is an object, recurse\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      const subKeys = Object.keys(key); // can have multiple subKeys\n      subKeys.forEach(k => {\n        RESULT.push(m_renderNodeValues(node[k], key[k]));\n      });\n    }\n    // Special Data Handling\n    // -- Number\n    if (['id'].includes(key)) {\n      // Export as a number\n      RESULT.push(node[key]);\n      return;\n    }\n    // -- Revision\n    if (['revision'].includes(key)) {\n      // Export as a number from meta\n      RESULT.push(node.meta[key]);\n      return;\n    }\n    // -- DATE\n    if (['created', 'updated'].includes(key)) {\n      RESULT.push(m_formatDate(node.meta[key]));\n      return;\n    }\n    // -- Special processing for custom fields\n    const nodeDef = TEMPLATE.nodeDefs[key];\n    if (nodeDef.type === 'infoOrigin') {\n      if (node[key]) RESULT.push(`\"${m_encode(node[key])}\"`);\n      else\n        RESULT.push(\n          `\"${UTILS.DeriveInfoOriginString(node.createdBy, node.meta.created)}\"`\n        );\n      return;\n    }\n    // -- Normal processing -- wrap in quotes\n    if (Object.prototype.hasOwnProperty.call(node, key)) {\n      RESULT.push(`\"${m_encode(node[key])}\"`); // enclose in quotes to support commas\n      return;\n    }\n    // -- Else, data missing/not defined, add empty string\n    RESULT.push('');\n  });\n  return RESULT;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns an array of node records\n *  Used during export.\n *  @param {array} nodes - array of source nodes to export\n *  @param {array} nodekeys - node def keys, e.g. 'id' and 'label'\n *                            NOTE this is usually a subset of nodeDef keys\n *                            with `hidden` keys removed so they won't export\n *  @returns - array of nodes, e.g. [[<tacitus>], [<marc antony>], ...]\n */\nfunction m_GenerateNodesArray(nodes, nodekeys) {\n  /// Define Node KEYS\n  const nodesArr = [];\n  nodes.forEach(n => nodesArr.push(m_renderNodeValues(n, nodekeys)));\n  return nodesArr;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns an array of export values for a given edge record\n *  Used during export.\n *  @param {array} edge - array of source nodes to export\n *  @param {array} keys - edge def keys, e.g. 'id' and 'label'\n *                       NOTE this is usually a subset of edgeDef keys\n *                       with `hidden` keys removed so they won't export\n *  @returns - array of edge values, e.g. [1,'is enemy of',2,...]\n */\nfunction m_renderEdgeValues(edge, keys) {\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n\n  const RESULT = [];\n  keys.forEach(key => {\n    // If the key is an object, recurse\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      const subKeys = Object.keys(key); // can have multiple subKeys\n      subKeys.forEach(k => {\n        RESULT.push(m_renderEdgeValues(edge[k], key[k]));\n      });\n    }\n    // Special Data Handling\n    // -- Number\n    if (['id'].includes(key)) {\n      // Export as a number\n      RESULT.push(edge[key]);\n      return;\n    }\n    // -- SOURCE / TARGET\n    if (['source', 'target'].includes(key)) {\n      // source/target is an id not an object\n      RESULT.push(edge[key]);\n      return;\n    }\n    // -- Revision\n    if (['revision'].includes(key)) {\n      // Export as a number from meta\n      RESULT.push(edge.meta[key]);\n      return;\n    }\n    // -- DATE\n    if (['created', 'updated'].includes(key)) {\n      RESULT.push(m_formatDate(edge.meta[key]));\n      return;\n    }\n    // -- Special processing for custom fields\n    const edgeDefs = TEMPLATE.edgeDefs[key];\n    if (edgeDefs.type === 'infoOrigin') {\n      if (edge[key]) RESULT.push(`\"${m_encode(edge[key])}\"`);\n      else\n        RESULT.push(\n          `\"${UTILS.DeriveInfoOriginString(edge.createdBy, edge.meta.created)}\"`\n        );\n      return;\n    }\n    // -- normal processing -- wrap in quotes\n    if (Object.prototype.hasOwnProperty.call(edge, key)) {\n      RESULT.push(`\"${m_encode(edge[key])}\"`); // enclose in quotes to support commas\n      return;\n    }\n    // -- Else, data missing/not defined, add empty string\n    RESULT.push('');\n  });\n  return RESULT;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns an array of edge records\n *  Used during export.\n *  @param {array} edges - array of source edges to export\n *  @param {array} edgekeys - edge def keys, e.g. 'id' and 'label'\n *                           NOTE this is usually a subset of edgeDef keys\n *                           with `hidden` keys removed so they won't export\n *  @returns - array of edges, e.g. [[<1:2>], [<1:4>], ...]\n */\nfunction m_GenerateEdgesArray(edges, edgekeys) {\n  /// Define Edge KEYS\n  const edgeArr = [];\n  edges.forEach(e => edgeArr.push(m_renderEdgeValues(e, edgekeys)));\n  return edgeArr;\n}\n\n/// EXPORT NODES //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Exports FILTERED data, not the full data set.\n */\nMOD.ExportNodes = () => {\n  const DATA = UDATA.AppState('FILTEREDNCDATA');\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const { nodes } = DATA;\n  let EXPORT = '';\n\n  /// 1. Export Nodes\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Define Node KEYS to export\n  /// Use nodekeys from TEMPLATE\n  /// Skip hidden fields that are not built-in fields\n  /// Built-in fields are ALWAYS exported\n  const nodekeys = Object.keys(TEMPLATE.nodeDefs).filter(k => {\n    return TEMPLATE.nodeDefs[k].hidden && !ENUM.BUILTIN_FIELDS_NODE.includes(k)\n      ? false\n      : k;\n  });\n\n  /// 2. Expand to CSV\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  ///    2.1. NODES\n  ///    2.1.1. Create headers\n  const nodeHeadersArr = [];\n  nodekeys.forEach(key => {\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      throw new Error(`Unexpected node type for ${JSON.stringify(key)}`);\n      // This shouldn't be called anymore as of 2/2022 because the data fields\n      // have been flattened. See #198.\n      // const subKeys = Object.keys(key); // can have multiple subKeys\n      // const internalkeys = subKeys.map(sk => key[sk].map(k => `${sk}:${k}`)).flat();\n      // return internalkeys.map(k => NODEKEY_LABELS[k]);\n    } else {\n      nodeHeadersArr.push(TEMPLATE.nodeDefs[key].exportLabel);\n    }\n  });\n  const nodeHeaders = nodeHeadersArr.flat();\n  ///    2.1.2 Export Nodes with filtered headers\n  const nodesArr = m_GenerateNodesArray(nodes, nodekeys);\n  ///    2.1.3 Attach headers to front of file\n  nodesArr.unshift(nodeHeaders); // add headers\n  ///    2.1.4 Expand Nodes to CSV\n  const commaDelimitedNodes = nodesArr.map(n => n.join(','));\n  EXPORT += commaDelimitedNodes.join('\\n');\n\n  /// 3. Save to File\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // const encodedURI = encodeURI(EXPORT);\n  const link = document.createElement('a');\n  const blob = new Blob(['\\ufeff', EXPORT]);\n  const url = URL.createObjectURL(blob);\n  link.href = url;\n  const DATASET = window.NC_CONFIG.dataset || 'netcreate';\n  link.download = `${DATASET}_nodes.csv`;\n  // link.setAttribute('href', encodedURI);\n  // link.setAttribute('download', 'netcreate_export.csv');\n  document.body.appendChild(link); // Required for FF\n  link.click();\n  document.body.removeChild(link);\n};\n\n/// EXPORT EDGES //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Exports FILTERED data, not the full data set.\n */\nMOD.ExportEdges = () => {\n  const DATA = UDATA.AppState('FILTEREDNCDATA');\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const { edges } = DATA;\n  let EXPORT = '';\n\n  /// 1. Export Edges\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  /// Define Edge KEYS\n\n  // Old attributes method\n  // const edgesArr = m_GenerateEdgesArray(edges, EDGEKEYS);\n\n  // New Template method\n  // Use edgekeys from TEMPLATE\n  // Skip hidden fields that are not built-in fields\n  // const edgekeys = Object.keys(TEMPLATE.edgeDefs);\n  const edgekeys = Object.keys(TEMPLATE.edgeDefs).filter(k => {\n    return TEMPLATE.edgeDefs[k].hidden && !ENUM.BUILTIN_FIELDS_EDGE.includes(k)\n      ? false\n      : k;\n  });\n\n  // const edgesArr = m_GenerateEdgesArray(edges, edgekeys);\n\n  /// 3. Expand to CSV\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  ///   3.1. EDGES\n  ///   3.1.1. Create headers\n  const edgeHeadersArr = [];\n  edgekeys.forEach(key => {\n    // eslint-disable-next-line prefer-reflect\n    if (Object.prototype.toString.call(key) === '[object Object]') {\n      // DEPRECATED -- 'attribute' handler.\n      throw new Error(`Unexpected edge type for ${JSON.stringify(key)}`);\n      // const subKeys = Object.keys(key); // can have multiple subKeys\n      // return subKeys.map(sk => key[sk].map(k => `${sk}:${k}`)).flat();\n    } else {\n      edgeHeadersArr.push(TEMPLATE.edgeDefs[key].exportLabel);\n    }\n  });\n  const edgeHeaders = edgeHeadersArr.flat();\n  ///    3.1.2 Export Nodes with filtered headers\n  const edgesArr = m_GenerateEdgesArray(edges, edgekeys);\n  ///    3.1.3 Attach headers to front of file\n  edgesArr.unshift(edgeHeaders);\n  ///    3.1.4 Expand Edges to CSV\n  const commaDelimitedEdges = edgesArr.map(e => e.join(','));\n  EXPORT += commaDelimitedEdges.join('\\n');\n\n  /// 4. Save to File\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  // const encodedURI = encodeURI(EXPORT);\n  const link = document.createElement('a');\n  const blob = new Blob(['\\ufeff', EXPORT]);\n  const url = URL.createObjectURL(blob);\n  link.href = url;\n  const DATASET = window.NC_CONFIG.dataset || 'netcreate';\n  link.download = `${DATASET}_edges.csv`;\n  // link.setAttribute('href', encodedURI);\n  // link.setAttribute('download', 'netcreate_export.csv');\n  document.body.appendChild(link); // Required for FF\n  link.click();\n  document.body.removeChild(link);\n};\n\n/// IMPORT METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet nodeFile;\nlet edgeFile;\nlet nodesToImport = [];\nlet edgesToImport = [];\nlet IMPORT_NCDATA;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Called by ImportExport when user clicks \"Clear File Selections\".\n *  Resets the loaded/validated data for a new set of data\n */\nMOD.ResetImportData = () => {\n  nodeFile = undefined;\n  edgeFile = undefined;\n  nodesToImport = [];\n  edgesToImport = [];\n  IMPORT_NCDATA = clone(UDATA.AppState('NCDATA'));\n};\n\n/// IMPORT HELPERS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// Make sure source and target have valid ids\n/// If not, add message to edgeImportErrors\n/// `row` is the line number in the import csv file\nfunction m_hasValidSourceTarget(edge, NCDATA, edgeImportErrors, row) {\n  const source = NCDATA.nodes.find(n => n.id === Number(edge.source));\n  const target = NCDATA.nodes.find(n => n.id === Number(edge.target));\n  if (source === undefined)\n    edgeImportErrors.push(\n      `Edge id ${edge.id}, row ${row} references unknown source node id ${edge.source}`\n    );\n  if (target === undefined)\n    edgeImportErrors.push(\n      `Edge id ${edge.id}, row ${row} references unknown target node id ${edge.target}`\n    );\n  return source && target;\n}\n\n/// IMPORT MODULE METHODS /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Called by ImportExport if the user Cancels selecting a node file\n */\nMOD.ResetNodeImportData = () => {\n  nodeFile = undefined;\n  nodesToImport = [];\n  if (IMPORT_NCDATA) IMPORT_NCDATA.nodes = clone(UDATA.AppState('NCDATA').nodes);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Called by IMportExport if the user Cancels selecting a node file\n */\nMOD.ResetEdgeImportData = () => {\n  edgeFile = undefined;\n  edgesToImport = [];\n  if (IMPORT_NCDATA) IMPORT_NCDATA.edges = clone(UDATA.AppState('NCDATA').edges);\n};\n\n/// NODE IMPORT ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Loads the file and checks the first row headers to make sure all the required\n *  headers have been defined.\n *  @param {Object} data\n *  @param {File} data.nodefile - https://developer.mozilla.org/en-US/docs/Web/API/File\n *  @returns {isValid:boolean, messageJsx:jsx, headers:[], lines:[]}\n */\nasync function m_NodefileCheckHeaders(data) {\n  let isValid = true;\n  let missingKeys = [];\n  let messageJsx = '';\n\n  // Retrieve import file node keys defined in template\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const NODEKEYS = Object.values(TEMPLATE.nodeDefs)\n    .filter(k => !k.hidden || ENUM.BUILTIN_FIELDS_NODE.includes(k)) // Ignore hidden keys but keep built-in fields, even if hidden\n    .map(k => k.exportLabel);\n\n  const { nodefile } = data;\n  if (nodefile === undefined) return { isValid: false, missingKeys, fileKeys: [] }; // User cancelled\n  let result = await nodefile.text();\n  // Validate Data\n  const lines = result.split(REGEXMatchLFNotInQuotes);\n  // First line should list the headers\n  // Remove headers, so 'lines' is just data\n  const headers = lines.shift().trim().split(',');\n  // get keys\n  const nodeKeys = m_flattenKeys(NODEKEYS);\n  const fileKeys = m_flattenKeys(headers);\n  // check that ALL nodeKeys are in the fileKeys\n  nodeKeys.forEach(k => {\n    if (!fileKeys.includes(k)) {\n      isValid = false;\n      missingKeys.push(`\"${k}\"`);\n    }\n  });\n  if (!isValid) {\n    // construct missing keys jsx\n    messageJsx = (\n      <div style={{ color: 'red' }}>\n        <div>Error trying to import {data.nodefile.name}!</div>\n        <div>Missing keys: {missingKeys.join(', ')}</div>\n        <div>Keys found in file: {fileKeys.join(', ')}</div>\n      </div>\n    );\n  }\n  return { isValid, messageJsx, headers, lines };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Reads each line, mapping data fields to internal representation fields\n *  @param {array} headers\n *  @param {array} lines\n *  @returns { isValid:boolean, messageJsx:jsx, nodes:[] }\n */\nfunction m_NodefileLoadNodes(headers, lines) {\n  // Map import fields (exportLabel) to internal representation fields, e.g. ID => id,\n  // essentially a reverse look up map\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const INTERNAL_FIELDS_MAP = new Map();\n  Object.entries(TEMPLATE.nodeDefs).map(e =>\n    INTERNAL_FIELDS_MAP.set(e[1].exportLabel, e[0])\n  );\n  // convert nodefileData to JSON\n  // Load JSON\n  let isValid = true;\n  let messageJsx = '';\n  const nodes = lines\n    .map(l => {\n      if (l === '') return undefined; // skip blank lines\n      const node = { meta: {} };\n      const subcategories = new Map();\n      const importFields = l.split(REGEXMatchCommasNotInQuotes); // ?=\" needed to match commas in strings\n      importFields.forEach((f, index) => {\n        const field = f.replace(/^\"/, '').replace(/\"$/, ''); // strip start and end quotes from strings\n        const key = headers[index];\n        const keysplit = String(key).split(':');\n        // Subcategory and subkey are DEPRECATED\n        const subcategory = keysplit[0]; // e.g. 'attributes' of 'attributes:Node_type'\n        const subkey = keysplit[1]; // e.g. 'Node_type'\n        if (subkey) {\n          isValid = false;\n          messageJsx = <div color=\"red\">`subkey ${subkey} is deprecated!`</div>;\n          console.error(PR, `subkey ${subkey} is deprecated!`);\n          // DEPRECATED: Review if we decide to use this again.\n          // // Using a sub category?  e.g. 'attributes:Node_type'\n          // const currSubfields = subcategories.get(subcategory) || {};\n          // console.log('...currSubfields', currSubfields, field)\n          // currSubfields[subkey] = field;\n          // subcategories.set(subcategory, currSubfields);\n          // console.log('adding subfields', key, currSubfields, subcategories)\n        } else {\n          // not using a subcategory, just a regular field\n          const exportLabel = headers[index];\n          if (exportLabel === undefined)\n            console.error(\n              PR,\n              'could not find exportLabel for index',\n              index,\n              'in',\n              headers\n            );\n          const internalLabel = INTERNAL_FIELDS_MAP.get(exportLabel);\n          // special handling for internal fields\n          if (['id'].includes(internalLabel)) {\n            // Note that Number(\"\") => 0\n            // We don't want empty ids to be converted to id 0\n            // so we explicitly replace it with NaN\n            node[internalLabel] = field === '' ? NaN : field; // ids are numbers\n          } else if (['created', 'updated'].includes(internalLabel)) {\n            // meta fields: date\n            node.meta[internalLabel] = new Date(field).getTime();\n          } else if (['revision'].includes(internalLabel)) {\n            // meta fields: revision\n            node.meta[internalLabel] = field;\n          } else {\n            node[internalLabel] = m_decode(field); // convert double quotes\n          }\n        }\n      });\n\n      // DEPRECATED\n      // collapse 'attributes' and 'meta' into objects\n      // subcategories.forEach((val, key) => {\n      //   node[key] = val\n      // });\n\n      // Add meta data if missing\n      if (isNaN(node.meta.created)) node.meta.created = new Date().getTime();\n      if (isNaN(node.meta.revision)) node.meta.revision = 0;\n\n      return node;\n    })\n    .filter(n => n !== undefined);\n  return { isValid, messageJsx, nodes };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Checks to make sure all nodes to import have a valid id or specify \"new\"\n *  At the end of this method, IMPORT_NCDATA will have imported nodes added\n *  EXCEPT for \"new\" id nodes\n *  @param {array} nodes\n *  @returns { isValid:boolean, messageJsx:jsx, nodes, IMPORT_NCDATA }\n */\nfunction m_NodefileValidateNodes(nodes) {\n  let isValid = true;\n  let messageJsx = '';\n  let nodesAdded = 0; // counter\n  let nodesReplaced = 0; // counter\n  const importMsgs = [];\n  const nodeImportErrors = [];\n  nodes.forEach((n, i) => {\n    const row = i + 2; // to account for header row\n    if (String(n.id).toLowerCase() === NEW_ID_KEYWORD) {\n      //  A1.1 \"new\" node\n      importMsgs.push(`New node \"${n.label}\" with auto-generated id will be added.`);\n      //  NOTE: \"new\" nodes are not added until after DB_MERGE since they do not have an id\n      //        Edge imports should not be referencing these new nodes.\n      nodesAdded++;\n    } else {\n      n.id = Number(n.id); // csv imports as string, so convert to Number\n      if (isNaN(n.id)) {\n        // A1.2 Invalid node id, usually a string\n        isValid = false;\n        nodeImportErrors.push(\n          `Node in row ${row} does not have a valid id.  Found: \"${n.id}\".`\n        );\n      } else {\n        const existingNodeIdx = IMPORT_NCDATA.nodes.findIndex(\n          node => node.id === n.id\n        );\n        if (existingNodeIdx > -1) {\n          // A1.3 Replace existing node\n          importMsgs.push(\n            `Existing node id ${n.id} \"${IMPORT_NCDATA.nodes[existingNodeIdx].label}\" will be replaced by node \"${n.label}\" in row ${row} with matching id.`\n          );\n          IMPORT_NCDATA.nodes.splice(existingNodeIdx, 1, n);\n          nodesReplaced++;\n        } else {\n          // A1.4 Referenced unknown id, add if valid\n          importMsgs.push(`New node id ${n.id} \"${n.label}\" will be added.`);\n          IMPORT_NCDATA.nodes.push(n);\n          nodesAdded++;\n        }\n      }\n    }\n  });\n  if (isValid) {\n    messageJsx = (\n      <ul>\n        {importMsgs.map((e, i) => (\n          <li key={i}>{e}</li>\n        ))}\n      </ul>\n    );\n  } else {\n    messageJsx = (\n      <ul style={{ color: 'red' }}>\n        {nodeImportErrors.map((e, i) => (\n          <li key={i}>{e}</li>\n        ))}\n      </ul>\n    );\n  }\n  return { isValid, messageJsx, nodes, IMPORT_NCDATA };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Walks down the checkers/validators one by one and aborts/returns an error message if an\n *  an error is encountered.  Data is stored temporarily in `IMPORT_NCDATA` so that we can\n *  process edges -- e.g. an edge might refer to a node that is currently being imported.\n *\n *  Data is not actually imported in the DB until the user clicks \"Import\"\n *\n *  Side effect: Updates `nodesToImport` with validated nodes\n *  @param {object} data\n *  @param {File} data.nodefile - https://developer.mozilla.org/en-US/docs/Web/API/File\n *  @return { isValid:boolean, messages:[], errors:[] }\n */\nMOD.NodefileValidate = async data => {\n  // No nodefile passed, user probably clicked cancel\n  if (!data.nodefile) return { isValid: false };\n\n  if (!IMPORT_NCDATA) IMPORT_NCDATA = clone(UDATA.AppState('NCDATA'));\n  const nodeFileName = data.nodefile.name;\n\n  const headerResults = await m_NodefileCheckHeaders(data);\n  if (!headerResults.isValid)\n    return Object.assign(headerResults, {\n      messageTitle: `Nodes import file \"${nodeFileName}\" will not be imported: Header Validation Failed!`\n    });\n\n  const importResults = m_NodefileLoadNodes(\n    headerResults.headers,\n    headerResults.lines\n  );\n  if (!importResults.isValid)\n    return Object.assign(importResults, {\n      messageTitle: `Nodes import file \"${nodeFileName}\" will not be imported: Load File Failed!`\n    });\n\n  const nodeResults = m_NodefileValidateNodes(importResults.nodes, IMPORT_NCDATA);\n  if (!nodeResults.isValid)\n    return Object.assign(nodeResults, {\n      messageTitle: `Nodes import file \"${nodeFileName}\" will not be imported: Data Validation Failed!`\n    });\n\n  // set module-wide vars\n  nodesToImport = nodeResults.nodes;\n  nodeFile = data.nodefile;\n  IMPORT_NCDATA.nodes = Object.assign(IMPORT_NCDATA.nodes, nodeResults.nodes);\n  return Object.assign(nodeResults, {\n    messageTitle: `Nodes import file \"${nodeFileName}\": Validated!`\n  });\n};\n\n/// EDGE IMPORT ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Loads the file and checks the first row headers to make sure all the\n *  required headers have been defined.\n *  See https://developer.mozilla.org/en-US/docs/Web/API/File for File\n *  @param {Object} data\n *  @param {File} data.edgefile\n *  @returns {isValid:boolean, messageJsx:jsx, headers:[], lines:[]}\n */\nasync function m_EdgefileCheckHeaders(data) {\n  let isValid = true;\n  let missingKeys = [];\n  let messageJsx = '';\n\n  // Retrieve import file node keys defined in template\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const EDGEKEYS = Object.values(TEMPLATE.edgeDefs)\n    .filter(k => !k.hidden || ENUM.BUILTIN_FIELDS_EDGE.includes(k)) // Ignore hidden keys but keep built-in fields, even if hidden\n    .map(k => k.exportLabel);\n\n  const { edgefile } = data;\n  if (edgefile === undefined) return { isValid: false, missingKeys, fileKeys: [] }; // User cancelled\n  let result = await edgefile.text();\n  // Validate Data\n  const lines = result.split(REGEXMatchLFNotInQuotes);\n  // First line should list the headers\n  // Remove headers, so 'lines' is just data\n  const headers = lines.shift().trim().split(',');\n  // get keys\n  const edgeKeys = m_flattenKeys(EDGEKEYS);\n  const fileKeys = m_flattenKeys(headers);\n  // check that ALL edgeKeys are in the fileKeys\n  edgeKeys.forEach(k => {\n    if (!fileKeys.includes(k)) {\n      isValid = false;\n      missingKeys.push(`\"${k}\"`);\n    }\n  });\n  if (!isValid) {\n    // construct missing keys jsx\n    messageJsx = (\n      <div style={{ color: 'red' }}>\n        <div>Error trying to import {data.edgefile.name}!</div>\n        <div>Missing keys: {missingKeys.join(', ')}</div>\n        <div>Keys found in file: {fileKeys.join(', ')}</div>\n      </div>\n    );\n  }\n  return { isValid, messageJsx, headers, lines };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Reads each line, mapping data fields to internal representation fields\n *  @param {array} headers\n *  @param {array} lines\n *  @returns { isValid:boolean, messageJsx:jsx, nodes:[] }\n */\nfunction m_EdgefileLoadEdges(headers, lines) {\n  // Map import fields (exportLabel) to internal representation fields, e.g. ID => id,\n  // essentially a reverse look up map\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const INTERNAL_FIELDS_MAP = new Map();\n  Object.entries(TEMPLATE.edgeDefs).map(e =>\n    INTERNAL_FIELDS_MAP.set(e[1].exportLabel, e[0])\n  );\n\n  // convert nodefileData to JSON\n  // Load JSON\n  let isValid = true;\n  let messageJsx = '';\n  const edges = lines\n    .map(l => {\n      if (l === '') return undefined; // skip blank lines\n      const edge = { meta: {} };\n      const subcategories = new Map();\n      const importFields = l.split(REGEXMatchCommasNotInQuotes); // ?=\" needed to match commas in strings\n      importFields.forEach((f, index) => {\n        const field = f.replace(/^\"/, '').replace(/\"$/, ''); // strip start and end quotes from strings\n        const key = headers[index];\n        const keysplit = String(key).split(':');\n        // Subcategory and subkey are DEPRECATED\n        const subcategory = keysplit[0]; // e.g. 'attributes' of 'attributes:Node_type'\n        const subkey = keysplit[1]; // e.g. 'Node_type'\n        if (subkey) {\n          isValid = false;\n          messageJsx = <div color=\"red\">`subkey ${subkey} is deprecated!`</div>;\n          console.error(PR, `subkey ${subkey} is deprecated!`);\n          // DEPRECATED: Review if we decide to use this again.\n          // // Using a sub category?  e.g. 'attributes:Node_type'\n          // const currSubfields = subcategories.get(subcategory) || {};\n          // console.log('...currSubfields', currSubfields, field)\n          // currSubfields[subkey] = field;\n          // subcategories.set(subcategory, currSubfields);\n          // console.log('adding subfields', key, currSubfields, subcategories)\n        } else {\n          // not using a subcategory, just a regular field\n          // meta field?\n          const exportLabel = headers[index];\n          if (exportLabel === undefined)\n            console.error(\n              PR,\n              'could not find exportLabel for index',\n              index,\n              'in',\n              headers\n            );\n          const internalLabel = INTERNAL_FIELDS_MAP.get(exportLabel);\n          // special handling for internal fields\n          if (['id', 'source', 'target'].includes(internalLabel)) {\n            // Note that Number(\"\") => 0\n            // We don't want empty ids to be converted to id 0\n            // so we explicitly replace it with NaN\n            edge[internalLabel] = field === '' ? NaN : field; // ids are numbers\n          } else if (['created', 'updated'].includes(internalLabel)) {\n            // meta fields: date\n            edge.meta[internalLabel] = new Date(field).getTime();\n          } else if (['revision'].includes(internalLabel)) {\n            // meta fields: revision\n            edge.meta[internalLabel] = field;\n          } else {\n            edge[internalLabel] = m_decode(field); // convert double quotes\n          }\n        }\n      });\n\n      // DEPRECATED\n      // collapse 'attributes' and 'meta' into objects\n      // subcategories.forEach((val, key) => {\n      //   node[key] = val\n      // });\n\n      // Add meta data if missing\n      if (isNaN(edge.meta.created)) edge.meta.created = new Date().getTime();\n      if (isNaN(edge.meta.revision)) edge.meta.revision = 0;\n\n      return edge;\n    })\n    .filter(e => e !== undefined);\n  return { isValid, messageJsx, edges };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Checks to make sure all edges to import have a valid id or specify \"new\"\n *  @param {array} edges\n *  @returns { isValid:boolean, messageJsx:jsx, nodes, IMPORT_NCDATA }\n *          At the end of this method, IMPORT_NCDATA will have imported edges added EXCEPT for \"new\" id edges\n */\nfunction m_EdgefileValidateEdges(edges) {\n  let isValid = true;\n  let messageJsx = '';\n  let edgesAdded = 0; // counter\n  let edgesReplaced = 0; // counter\n  const importMsgs = [];\n  const edgeImportErrors = [];\n  edges.forEach((e, i) => {\n    const row = i + 2; // to account for header row\n    e.size = 1; // Set default edge size\n\n    // Make sure each edge has a valid source and target\n    if (!m_hasValidSourceTarget(e, IMPORT_NCDATA, edgeImportErrors, row))\n      isValid = false;\n\n    if (String(e.id).toLowerCase() === NEW_ID_KEYWORD) {\n      //  A1.1 \"new\" edge\n      importMsgs.push(`New edge with auto-generated id will be added.`);\n      //  NOTE: \"new\" edges are not added until after DB_MERGE since they do not have an id\n      edgesAdded++;\n    } else {\n      e.id = Number(e.id); // csv imports as string, so convert to Number\n      if (isNaN(e.id)) {\n        // A1.2 Invalid edge id, usually a string\n        isValid = false;\n        edgeImportErrors.push(\n          `Edge in row ${row} does not have a valid id.  Found: \"${e.id}\".`\n        );\n      } else {\n        const existingEdgeIdx = IMPORT_NCDATA.edges.findIndex(\n          edge => edge.id === e.id\n        );\n        if (existingEdgeIdx > -1) {\n          // A1.3 Replace existing node\n          importMsgs.push(\n            `Existing edge id ${e.id} will be replaced by edge in row ${row} with matching id.`\n          );\n          IMPORT_NCDATA.edges.splice(existingEdgeIdx, 1, e);\n          edgesReplaced++;\n        } else {\n          // A1.4 Referenced unknown id, add if valid\n          importMsgs.push(`New edge id ${e.id} will be added.`);\n          IMPORT_NCDATA.edges.push(e);\n          edgesAdded++;\n        }\n      }\n    }\n  });\n  if (isValid) {\n    messageJsx = (\n      <ul>\n        {importMsgs.map((e, i) => (\n          <li key={i}>{e}</li>\n        ))}\n      </ul>\n    );\n  } else {\n    messageJsx = (\n      <ul style={{ color: 'red' }}>\n        {edgeImportErrors.map((e, i) => (\n          <li key={i}>{e}</li>\n        ))}\n      </ul>\n    );\n  }\n  return { isValid, messageJsx, edges, IMPORT_NCDATA };\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Walks down the checkers/validators one by one and aborts/returns an error\n *  message if an an error is encountered.  Data is stored temporarily in\n *  `IMPORT_NCDATA` so that we can process edges -- e.g. an edge might refer to\n *  a node that is currently being imported.\n *\n *  Data is not actually imported in the DB until the user clicks \"Import\"\n *\n *  Side effect: Updates `edgesToImport` with validated edges\n *  @param {object} data\n *  @param {File} data.edgefile - developer.mozilla.org/en-US/docs/Web/API/File\n *  @return { isValid:boolean, messages:[], errors:[] }\n */\nMOD.EdgefileValidate = async data => {\n  // No edgefile passed, user probably clicked cancel\n  if (!data.edgefile) return { isValid: false };\n\n  if (!IMPORT_NCDATA) IMPORT_NCDATA = clone(UDATA.AppState('NCDATA'));\n  const edgeFileName = data.edgefile.name;\n\n  const headerResults = await m_EdgefileCheckHeaders(data);\n  if (!headerResults.isValid)\n    return Object.assign(headerResults, {\n      messageTitle: `Edges import file \"${edgeFileName}\" will not be imported: Header Validation Failed!`\n    });\n\n  const importResults = m_EdgefileLoadEdges(\n    headerResults.headers,\n    headerResults.lines\n  );\n  if (!importResults.isValid)\n    return Object.assign(importResults, {\n      messageTitle: `Edges mport file \"${edgeFileName}\" will not be imported: Load File Failed!`\n    });\n\n  const edgeResults = m_EdgefileValidateEdges(importResults.edges, IMPORT_NCDATA);\n  if (!edgeResults.isValid)\n    return Object.assign(edgeResults, {\n      messageTitle: `Edges import file \"${edgeFileName}\" will not be imported: Data Validation Failed!`\n    });\n\n  // set module-wide vars\n  edgesToImport = edgeResults.edges; // set module-wide var\n  edgeFile = data.edgefile; // set module-wide var\n  return Object.assign(edgeResults, {\n    messageTitle: `Edges import file \"${edgeFileName}\": Validated!`\n  });\n};\n\n/// MAIN IMPORT ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  This is triggered when the user clicks the \"Import\" button.\n *  Forces a RELOAD_DB after the import data is merged into the database.\n *  `replace` is used to \"load\" a project with Turbo360\n *  @param {boolean} replace -- replace data instead of merge\n *  @returns {messageJsx} -- summary of file imported\n */\nMOD.Import = async replace => {\n  if (replace) {\n    // replace data (instead of merge?)\n    return new Promise((resolve, reject) => {\n      const d3data = { nodes: nodesToImport, edges: edgesToImport };\n      UDATA.Call('SRV_DBREPLACE', d3data).then(res => {\n        if (res.OK) {\n          console.log(PR, `database set OK`, res);\n          // Reload NCDATA from the DB to get new Node and Edge Ids created during the merge\n          UDATA.LocalCall('RELOAD_DB');\n          resolve(res);\n        } else {\n          reject(new Error(JSON.stringify(res)));\n        }\n      });\n    });\n  } else {\n    // Merge data\n    // Write to database!\n    const mergeData = { nodes: nodesToImport, edges: edgesToImport };\n    await UDATA.LocalCall('DB_MERGE', mergeData).then(res => {\n      // Reload NCDATA from the DB to get new Node and Edge Ids created during the merge\n      UDATA.LocalCall('RELOAD_DB');\n    });\n    const importedFiles = [];\n    if (nodeFile) importedFiles.push(nodeFile.name);\n    if (edgeFile) importedFiles.push(edgeFile.name);\n    const importedFileNames = importedFiles.join(', ');\n    return {\n      messageJsx: <div>{importedFileNames} Import Completed!</div>\n    };\n  }\n};\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  lock-mgr\n\n  lock-mgr maintains the LOCKMGR app state, which is used to track the\n  status of locks on nodes, edges, and comments.\n\n  When a lock is requested or released, LOCKMGR state is updated.\n  Any components that are subscribed to the state update will be notified.\n\n  Calls\n  - RequestLockNode\n  - RequestUnlockNode\n  - RequestLockEdge\n  - RequestUnlockEdge\n\n  How it works\n  - A component requests a lock, e.g. NCNode.LockNode\n    which calls LOCKMGR.RequestLockNode\n  - lock-mgr makes to request to the server\n  - server passes the call to server-database.GetEditStatus\n  - server-database returns the new value\n  - server sends EDIT_PERMISSIONS_UPDATE to all clients\n  - EDIT_PERMISSIONS_UPDATE tells lock-mgr to update the LOCKMGR state\n\n  Used by:\n  - NCNode\n  - NCEdge\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\nconst { EDITORTYPE } = require('system/util/enum');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'lock-mgr: ';\n\n/// MODULE INITIALIZATION /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst MOD = UNISYS.NewModule(module.id);\nconst UDATA = UNISYS.NewDataLink(MOD);\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n\n/// LIFECYCLE HANDLERS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ lifecycle INITIALIZE handler\n/*/\nMOD.Hook('INITIALIZE', () => {\n  m_Init();\n  UDATA.HandleMessage('EDIT_PERMISSIONS_UPDATE', m_UpdateLockState);\n  UDATA.HandleMessage('COMMENT_UPDATE_PERMISSIONS', m_UpdateLockState);\n}); // end UNISYS_INIT\n\n/// PRIVATE METHODS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_Init() {\n  const LOCKSTATE = {\n    templateBeingEdited: false,\n    importActive: false,\n    nodeOrEdgeBeingEdited: false,\n    // commentBeingEditedByMe: false, // NOT IMPLEMENTED\n    lockedNodes: [],\n    lockedEdges: [],\n    lockedComments: []\n  };\n  UDATA.SetAppState('LOCKSTATE', LOCKSTATE);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n *\n * @param {object} data\n * @param {boolean} data.templateBeingEdited\n * @param {boolean} data.importActive\n * @param {boolean} data.nodeOrEdgeBeingEdited\n//  * @param {boolean} data.commentBeingEditedByMe // NOT IMPLEMENTED\n * @param {Array} data.lockedNodes\n * @param {Array} data.lockedEdges\n * @param {Array} data.lockedComments\n */\nfunction m_UpdateLockState(data) {\n  const LOCKSTATE = UDATA.AppState('LOCKSTATE');\n  UDATA.SetAppState('LOCKSTATE', { ...LOCKSTATE, ...data });\n}\n\n/// PUBLIC METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RequestLockNode(nodeId, cb) {\n  UDATA.Call('SRV_DBLOCKNODE', { nodeID: nodeId }).then(data => {\n    if (typeof cb === 'function') cb(data.locked);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RequestUnlockNode(nodeId, cb) {\n  UDATA.Call('SRV_DBUNLOCKNODE', { nodeID: nodeId }).then(data => {\n    if (typeof cb === 'function') cb(data.locked);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RequestLockEdge(edgeId, cb) {\n  UDATA.Call('SRV_DBLOCKEDGE', { edgeID: edgeId }).then(data => {\n    if (typeof cb === 'function') cb(data.locked);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RequestUnlockEdge(edgeId, cb) {\n  UDATA.Call('SRV_DBUNLOCKEDGE', { edgeID: edgeId }).then(data => {\n    if (typeof cb === 'function') cb(data.locked);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RequestEditLock(editorType, cb) {\n  if (cb)\n    UDATA.NetCall('SRV_REQ_EDIT_LOCK', { editor: editorType }).then(data => {\n      if (typeof cb === 'function') cb(data);\n    });\n  else UDATA.NetSignal('SRV_REQ_EDIT_LOCK', { editor: editorType });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RequestEditUnlock(editorType, cb) {\n  if (cb)\n    UDATA.NetCall('SRV_RELEASE_EDIT_LOCK', { editor: editorType }).then(data => {\n      if (typeof cb === 'function') cb(data.locked);\n    });\n  else UDATA.NetSignal('SRV_RELEASE_EDIT_LOCK', { editor: editorType });\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = {\n  RequestLockNode,\n  RequestUnlockNode,\n  RequestLockEdge,\n  RequestUnlockEdge,\n  RequestEditLock,\n  RequestEditUnlock\n};\n","/* eslint-disable no-alert */\n/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  nc-logic\n\n  Net.Create application logic\n\n  * EVENTS: D3 Graph Updates\n\n    Mark Node/Edge          Nodes in the graph are marked via a stroke around\n                            the circle.  There are two types of marks:\n\n                            1. SEARCH -- when a node matches a search, its\n                            strokeColor is set to green.\n\n                            2. SELECTION -- when a node is selected by the\n                            user and shown in the NodeSelector either by\n                            directly clicking on it or by clicking on a\n                            item in the search suggestion list, the node\n                            data is marked `selected` and a blue strokeColor\n                            is applied.\n\n                            The two marks are orthogonal to each other: a\n                            node can be both searched and selected, though\n                            the selection mark will override the search\n                            mark.\n\n                            The rendering is handled by modifying the\n                            node data in NCDATA.  d3-simplenetgraph will\n                            then read any NCDATA updates and redraw\n                            the graph based on the updated data.\n\n    Add New Node/Edge       When the user adds a new edge or node, handlers in\n                            NetCreate will update its `this.state.data`\n                            with the new nodes/edges.  This is passed on to\n                            `NetGraph.jsx` and in turn to `D3SimpleNetGraph.js`\n                            which will display the new data during its update\n                            cycle.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst SETTINGS = require('settings');\nconst UNISYS = require('unisys/client');\nconst JSCLI = require('system/util/jscli');\nconst D3 = require('d3');\nconst UTILS = require('./nc-utils');\n\nconst NETWORK = require('unisys/client-network');\nconst DATASTORE = require('system/datastore');\nconst SESSION = require('unisys/common-session');\nconst PROMPTS = require('system/util/prompts');\nconst CMTMGR = require('./comment-mgr');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = PROMPTS.Pad('NCLOGIC');\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DESELECTED_COLOR = '';\n// For backwards compatability, if the template is not setting these\n// Ideally we want to centralize the backwards compatability at some point into one spot\n// OR just remove it, but this was easier to test and shouldn't impact performance substantively\nconst DEFAULT_SEARCH_COLOR = '#008800';\nconst DEFAULT_SOURCE_COLOR = '#FFa500';\nconst TARGET_COLOR = '#FF0000';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DATASET = window.NC_CONFIG.dataset || 'netcreate';\nconst TEMPLATE_URL = `templates/${DATASET}.toml`;\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// APP STATE/DATA STRUCTURES /////////////////////////////////////////////////\n/*/ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \\*\\\n\n  SELECTION\n\n  The SELECTION state maintains the list of nodes and edges that are\n  currently selected and loaded in the forms.\n\n  Set by      AutoComplete's call to SOURCE_SELECT\n              D3SimpleNetGraph's call to SOURCE_SELECT\n              EdgeEditor's call to EDGE_UPDATE\n  Handled by  NodeSelector to load the currently selected node\n              NodeSelector also sets the edges in EdgeEditor\n              EdgeEditor to select the target node when creating new edge\n\n  * nodes     An array of current selected nodes for editing.\n              This is the node the user clicked on in the graph or selected from\n              the suggestions list\n  * edges     An array of edge objects for editing\n              *REVIEW*: Should this be renamed \"selectedEdges\" to distinguish from\n              *NCDATA.edge\n\n\n\n  SEARCH\n\n  The SEARCH state keeps track of the text being searched for in the\n  main AutoComplete field.  It also provides a list of the nodes that match\n  the search string so that AutoComplete and D3 can display them.  (D3\n  doesn't actually process the SEARCH state change.  Instead it's processed\n  by nc-logic in response to SOURCE_SEARCH calls -- nc-logic\n  will set the node's `selected` or `stroke-color` state if a node\n  is currently selected or matches a search parameter, respectively.)\n\n  Set by      AutoComplete's call to SOURCE_SEARCH when its input changes.\n  Handled by  AutoComplete for its controlled input field\n              NodeSelector for validating when editing the form.\n\n  * searchLabel     A string that the user has typed into AutoComplete\n  * suggestedNodes  An array of nodes that match the searchLabel\n\n\n\n  ACTIVEAUTOCOMPLETE\n\n  The ACTIVEAUTOCOMPLETE state points to the id of the AutoComplete\n  field (either search, or NodeSElector, or EdgeEditor) that has the\n  current focus.  Search results and d3 clicks are routed to the\n  active AutComplete component.\n\n  Set by      Search's call to AUTOCOMPLETE_SELECT on startup\n              NodeSelector's call to AUTOCOMPLETE_SELECT when Edit Node is clicked\n              \" when changes are submitted\n              EdgeEditor's call to AUTOCOMPLETE_SELECT when a new Edge is created\n              \" an edge is selected externally for editing\n              \" an edge being editted is closed (hand back to search)\n              \" changes are submitted\n\n  Handled by  AutoComplete to enable/disable its mode active state,\n              know when and when not to handle SEARCH and SELECTION state updates.\n\n  Looked up   NodeSelector to check if it's the current activeAutoCompleteId\n\n  * activeAutoCompleteId\n              id of active <AutoComplete> field\n              of form: 'node-xx' or 'edge-source-xx' or 'edge-target-xx'\n              where xx = the id of the <AutoComplete> field that has input focus.\n              This is used to keep track of the currently active\n              AutoComplete field. Inactive fields and updates are determined by\n              the value of this property.\n\n\n  NCDATA\n\n  NCDATA is the core pristine network data of nodes and edges. It is read\n  directly from the database, or, when importing data, data is imported\n  into NCDATA.  It is an object consisting of two arrays:\n    `NCDATA = { nodes: [], edges: [] }`\n  See https://whimsical.com/network-data-flow-63qtRETqrfDVfp7EchUdzp\n  NCDATA is maintained as a application-wide AppState, though some modules\n  may keep a local copy.  (This needs to be reviewed and revised).\n  It includes:\n  * nodes: all nodes (not all may be actually changed)\n  * edges: all edges (not all may be actually changed)\n\n\n  FILTEREDNCDATA\n\n  FILTEREDNCDATA is the processed network data. It is derived from NCDATA.\n  It represents a subset of NCDATA with filtered items tagged (for highlight)\n  or removed. d3 will alter FILTEREDNCDATA, replacing edge source/targets\n  ids with node objects.\n  FILTEREDNCDATA is updated whenever NCDATA is updated.\n\n  There are three key differences between NCDATA and FILTEREDNCDATA:\n  1. edge.source and edge.target in NCDATA refer to node ids\n      whereas in FILTEREDNCDATA, edge.source and edge.target are node objects\n  2. Only FILTEREDNCDATA is passed to d3.  d3 never directly touches NCDATA.\n  3. FILTEREDNCDATA is directly derived from NCDATA, and can contain a subset\n      of the nodes or edges of NCDATA. In contrast, NCDATA contains ALL nodes\n      and edges.  When a filter is set, FILTEREDNCDATA is updated from\n      NCDATA, with nodes and edges removed or marked according to the filter.\n\n\\*\\ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -/*/\nvar NCDATA = null; // see above for description\nvar TEMPLATE = null; // template definition for prompts\n\n/// DB LOADER HELPERS /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Used by LOADASSETS and RELOAD_DB to reload NCDATA from the database.\n */\nfunction m_PromiseLoadDB() {\n  return DATASTORE.PromiseD3Data().then(data => {\n    if (DBG) console.log(PR, 'DATASTORE returned data', data);\n    m_MigrateData(data.d3data);\n    UTILS.RecalculateAllEdgeSizes(data.d3data);\n    UTILS.RecalculateAllNodeDegrees(data.d3data);\n    UDATA.SetAppState('NCDATA', data.d3data);\n    UDATA.SetAppState('TEMPLATE', data.template);\n    UDATA.LocalCall('LOAD_COMMENT_DATACORE', data);\n    // Save off local reference because we don't have NCDATA AppStateChange handler\n    NCDATA = data.d3data;\n    TEMPLATE = data.template;\n  });\n}\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** LOADASSETS fires before react components are loaded\n    see client-lifecycle.js for description\n */\nMOD.Hook('LOADASSETS', () => {\n  if (UNISYS.IsStandaloneMode()) {\n    // STANDALONE MODE\n    // Load read-only database from exported db file.\n\n    const USE_CACHE = false;\n    if (USE_CACHE) {\n      console.warn(PR, \"STANDALONE MODE: 'LOADASSETS' using browser cache\");\n      return new Promise((resolve, reject) => {\n        const lstore = window.localStorage;\n        let ld3 = lstore.getItem('NCDATA');\n        NCDATA = JSON.parse(ld3);\n        if (!NCDATA) reject(Error(\"couldn't get NCDATA from Local Store\"));\n        UDATA.SetAppState('NCDATA', NCDATA);\n        let tem = lstore.getItem('TEMPLATE');\n        TEMPLATE = JSON.parse(tem);\n        console.log(NCDATA, TEMPLATE);\n        if (!TEMPLATE) reject(Error(\"couldn't get TEMPLATE from Local Store\"));\n        UDATA.SetAppState('TEMPLATE', TEMPLATE);\n        console.warn('USE_CACHE does not support Comments!'); // See non cached version with LOAD_COMMENT_DATACORE\n        resolve();\n      });\n    }\n    // don't use cache, but instead try loading standalone files\n    console.warn(\n      PR,\n      \"STANDALONE MODE: 'LOADASSETS' is using files (USE_CACHE=false)\"\n    );\n    // added by Joshua to check for alternative datasets in the folder\n    let urlParams = new URLSearchParams(window.location.search);\n    let dataset = urlParams.get('dataset');\n    if (dataset === null) dataset = 'standalone';\n    return new Promise(resolve => {\n      (async () => {\n        let p1 = await DATASTORE.PromiseJSONFile('data/' + dataset + '-db.json').then(\n          d3data => {\n            m_MigrateData(d3data);\n            UTILS.RecalculateAllEdgeSizes(d3data);\n            UTILS.RecalculateAllNodeDegrees(d3data);\n            UDATA.SetAppState('NCDATA', d3data);\n            // Save off local reference because we don't have NCDATA AppStateChange handler\n            NCDATA = d3data;\n            // Load Comment Data\n            UDATA.LocalCall('LOAD_COMMENT_DATACORE', d3data);\n          }\n        );\n        // load template\n        let p2 = await DATASTORE.PromiseTOMLFile(\n          'data/' + dataset + '.template.toml'\n        ).then(data => {\n          TEMPLATE = data;\n          UDATA.SetAppState('TEMPLATE', TEMPLATE);\n        });\n        resolve();\n      })();\n    });\n  }\n  return Promise.all([m_PromiseLoadDB()]);\n}); // loadassets\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** CONFIGURE fires after LOADASSETS, so this is a good place to put TEMPLATE\n *  validation.\n */\nMOD.Hook('CONFIGURE', () => {\n  // Process Node, NodeColorMap and Edge options\n  m_UpdateColorMap();\n}); // end CONFIGURE HOOK\n\n/// UNISYS LIFECYCLE HOOKS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** DISCONNECT fires when NetMessage.GlobalOfflineMode()\n */\nMOD.Hook('DISCONNECT', () => {\n  console.log('DISCONNECT HOOK');\n  const lstore = window.localStorage;\n  lstore.setItem('NCDATA', JSON.stringify(NCDATA));\n  lstore.setItem('TEMPLATE', JSON.stringify(TEMPLATE));\n  console.log('saving d3data, template to localstore');\n});\n\n/// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** lifecycle INITIALIZE handler\n */\nMOD.Hook('INITIALIZE', () => {\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  UDATA.OnAppStateChange('SESSION', session => {\n    const { userId } = session;\n    // Push updates to sub modules\n    CMTMGR.SetCurrentUserId(userId);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** RELOAD_DB\n   *  Called by importexport-mgr.js.MOD.Import:818\n   *  During import, DB_MERGE will be called to merge the import data\n   *  into the DB.  Then it will call RELOAD_DB to re-read the updated\n   *  NCDATA from the database.  This is necessary because new ids will\n   *  have been generated during the merge.\n   */\n  UDATA.HandleMessage('RELOAD_DB', () => {\n    return Promise.all([m_PromiseLoadDB()]);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /// NCDATA\n  UDATA.OnAppStateChange('NCDATA', stateChange => {\n    if (DBG) console.log('nc-logic: Got NCDATA', stateChange);\n    NCDATA = stateChange;\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** Handle D3-related updates based on state changes. Subcomponents are\n   *  responsible for updating themselves.\n   */\n  UDATA.OnAppStateChange('SELECTION', stateChange => {\n    if (DBG) console.log('nc-logic: Got SELECTION', stateChange);\n    let { nodes, edges } = stateChange;\n    // NODE LIST UPDATE\n    if (nodes !== undefined) {\n      if (nodes.length > 0) {\n        let color = '#0000DD';\n        nodes.forEach(node => {\n          UNISYS.Log('select node', node.id, node.label);\n          let googlea = NC_CONFIG.googlea;\n\n          if (googlea != '0') {\n            ga('send', {\n              hitType: 'event',\n              eventCategory: 'Node',\n              eventAction: '' + node.label,\n              eventLabel: '' + window.location\n            });\n          }\n        });\n      }\n    }\n  }); // StateChange SELECTION\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /// Search field has been updated\n  UDATA.OnAppStateChange('SEARCH', stateChange => {\n    if (DBG) console.log('nc-logic: Got SEARCH', stateChange);\n    let { nodes, edges } = stateChange;\n    let { searchLabel } = stateChange;\n    let { activeAutoCompleteId } = stateChange;\n    // SEARCH LABEL UPDATE\n    if (NCDATA.nodes.length < 150) {\n      // JD to speedup processing for large sets\n      if (searchLabel === '') {\n        m_UnStrokeAllNodes();\n      } else if (searchLabel !== undefined) {\n        m_SetStrokeColorThatMatch(\n          searchLabel,\n          TEMPLATE.searchColor || DEFAULT_SEARCH_COLOR\n        );\n      }\n    }\n  }); // StateChange SELECTION\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** User has clicked on a suggestion from the AutoComplete suggestion list.\n   *  The source node should be loaded in NodeSelector.\n   *\n   *  OR, user has clicked on a node in the D3 graph.\n   *  SOURCE_SELECT select node by LABEL. There is only one selected node\n   *  in the app at any one time, though nodeLabels is passed as an array.\n   *  SEE ALSO: AutoComplete.onSuggestionSelected() and\n   *  D3SimpleNetGraph._UpdateGraph click handler\n   */\n  UDATA.HandleMessage('SOURCE_SELECT', m_sourceSelect);\n  function m_sourceSelect(data) {\n    if (DBG) console.log(PR, 'SOURCE_SELECT got data', data);\n\n    let { nodeLabels = [], nodeIDs = [] } = data;\n    let nodeLabel = nodeLabels.shift();\n    let nodeID = nodeIDs.shift();\n    let node, newSelection, newHilite;\n\n    if (nodeID) {\n      node = m_FindNodeById(nodeID); // Node IDs should be integers, not strings\n      if (DBG)\n        console.log(PR, 'SOURCE_SELECT found by nodeID', nodeID, 'node:', node);\n    } else if (nodeLabel) {\n      node = m_FindMatchingNodesByLabel(nodeLabel).shift();\n      if (DBG)\n        console.log(PR, 'SOURCE_SELECT found by nodeLabel', nodeLabel, 'node:', node);\n    } else {\n      // No node selected, so deselect\n      if (DBG) console.log(PR, 'SOURCE_SELECT found no node', node);\n    }\n\n    if (DBG) console.log(PR, 'SOURCE_SELECT found', node);\n\n    if (node === undefined) {\n      // Node not found, create a new state\n      newSelection = {\n        nodes: [],\n        edges: []\n      };\n      newHilite = {\n        autosuggestHiliteNodeId: undefined\n      };\n    } else {\n      // Load existing node and edges\n      let edges = [];\n      if (NCDATA.edges) {\n        // if no edges are defined, skip, otherwise chokes on NCDATA.edges.filter\n        if (nodeID) {\n          edges = edges.concat(\n            NCDATA.edges.filter(\n              edge => edge.source === nodeID || edge.target === nodeID\n            )\n          );\n        } else {\n          console.error(\n            PR,\n            `SOURCE_SELECT trying to match edge using \"label\" ${nodeLabel}.  This is deprecated!`\n          );\n          // REVIEW: are we actually matching label anymore?\n          // This should fail because source/target is no longer an object, just an id\n          // edges = edges.concat(\n          //   NCDATA.edges.filter(\n          //     edge => edge.source.label === nodeLabel || edge.target.label === nodeLabel\n          //   )\n          // );\n        }\n      }\n      // create state change object\n      newSelection = {\n        nodes: [node],\n        edges: edges\n      };\n      newHilite = {\n        autosuggestHiliteNodeId: undefined\n      };\n    }\n\n    // Set the SELECTION state so that listeners such as NodeSelectors update themselves\n    UDATA.SetAppState('SELECTION', newSelection);\n    UDATA.SetAppState('HILITE', newHilite);\n  }\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** SOURCE_SEARCH sets the current matching term as entered in an\n   *  AutoComplete field.\n   */\n  UDATA.HandleMessage('SOURCE_SEARCH', function (data) {\n    let { searchString } = data;\n    let matches = m_FindMatchingNodesByLabel(searchString);\n    let newState = {\n      suggestedNodes: matches.map(n => {\n        return { id: n.id, label: n.label };\n      }),\n      searchLabel: searchString\n    };\n    // let SELECTION state listeners handle display updates\n    UDATA.SetAppState('SEARCH', newState);\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** SOURCE_SEARCH_AND_SELECT first searches for an exact matching node\n   *  and if found, selects it.\n   *  This is called by AutoComplete onBlur in case we need to make an\n   *  implicit selection.\n   */\n  UDATA.HandleMessage('SOURCE_SEARCH_AND_SELECT', function (data) {\n    let { searchString } = data;\n    let node = m_FindMatchingNodesByLabel(searchString).shift();\n    if (node && node.label === searchString) {\n      console.log(\n        PR,\n        'SOURCE_SEARCH_AND_SELECT about to trigger SOURCE_SELECT data was',\n        data\n      );\n      m_sourceSelect({ nodeIDs: [node.id] });\n    }\n  });\n\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** SOURCE_UPDATE is called when the properties of a node has changed\n   *  Globally updates DATASTORE and working NCDATA objects with the new node data.\n   *  NOTE: SOURCE_UPDATE can be invoked remotely by the server on a DATABASE\n   *  update.\n   */\n  UDATA.HandleMessage('SOURCE_UPDATE', function (data) {\n    let { node } = data;\n    // REVIEW: NodeSelector should probably not be submitting data\n    //         directly to the database.  Instead, it should be notifying\n    //         nc-logic and we handle the degree insertion and db call.\n    // if degrees has not already been set (e.g. this is a new node), default to 0\n    node.degrees = node.degrees || 0;\n    // try updating existing nodes with this id?\n    let updatedNodes = m_SetMatchingNodesByProp({ id: node.id }, node);\n    if (DBG) console.log('SOURCE_UPDATE: updated', updatedNodes);\n    if (updatedNodes.length > 1) {\n      // if more than one matched, then there are duplicate ids\n      throw Error('SOURCE_UPDATE: found duplicate IDs');\n    } else if (updatedNodes.length === 1) {\n      // if one matched, update NCDATA with the refreshed node from the db\n      const index = NCDATA.nodes.findIndex(n => n.id === node.id);\n      NCDATA.nodes.splice(index, 1, node);\n    } else if (updatedNodes.length === 0) {\n      // if no nodes had matched, then add a new node!\n      NCDATA.nodes.push(node);\n    }\n    UDATA.SetAppState('NCDATA', NCDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  UDATA.HandleMessage('NODE_CREATE', data => {\n    // provenance\n    const session = UDATA.AppState('SESSION');\n    const timestamp = new Date().toLocaleString('en-US');\n    const provenance = [];\n    const createdBy = MOD.GetCurrentUserId();\n    const updatedBy = createdBy;\n\n    return DATASTORE.PromiseNewNodeID().then(newNodeID => {\n      const node = {\n        id: newNodeID,\n        label: data.label,\n        provenance,\n        createdBy,\n        updatedBy\n      };\n      return UDATA.LocalCall('DB_UPDATE', { node }).then(() => {\n        NCDATA.nodes.push(node);\n        UDATA.SetAppState('NCDATA', NCDATA);\n        return node;\n      });\n    });\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** NODE_DELETE is called by NodeSelector via datastore.js and\n   *  Server.js when an node should be removed\n   */\n  UDATA.HandleMessage('NODE_DELETE', function (data) {\n    let { nodeID, replacementNodeID } = data;\n\n    // Remove or replace edges\n    let edgesToProcess;\n    if (replacementNodeID !== -1) {\n      // replace source/target with replacement node ID\n      let replacementNode = m_FindNodeById(replacementNodeID);\n      edgesToProcess = NCDATA.edges.map(edge => {\n        if (edge.source === nodeID) edge.source = replacementNodeID;\n        if (edge.target === nodeID) edge.target = replacementNodeID;\n        return edge;\n      });\n    } else {\n      // delete edges\n      edgesToProcess = NCDATA.edges.filter(edge => {\n        let pass = false;\n        if (edge.source !== nodeID && edge.target !== nodeID) {\n          pass = true;\n        } else {\n          // filter out AND also remove comments\n          const cref = CMTMGR.GetEdgeCREF(edge.id);\n          CMTMGR.RemoveAllCommentsForCref(cref);\n        }\n        return pass;\n      });\n    }\n    NCDATA.edges = edgesToProcess;\n\n    // Remove Comments\n    const cref = CMTMGR.GetNodeCREF(nodeID);\n    CMTMGR.RemoveAllCommentsForCref(cref);\n\n    // Remove node\n    let updatedNodes = m_DeleteMatchingNodesByProp({ id: nodeID });\n    NCDATA.nodes = updatedNodes;\n    UDATA.SetAppState('NCDATA', NCDATA);\n\n    // Also update selection so nodes in EdgeEditor will update\n    UDATA.SetAppState('SELECTION', {\n      nodes: undefined,\n      edges: undefined\n    });\n    // FIXME: need to also update AutoUpdate!!!\n    // FIXME: Need to also trigger resize!\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** NODE_TYPES_UPDATE is called by template-editor-mgr after user has changed the\n   *  node type options.  This maps changed options to a new name,\n   *  and deleted type options to existing options.\n   *  This updates:\n   *  - The template file with new new node types\n   *  - NCDATA and the databse file with node type changes\n   *\n   *  @param {object} data\n   *  @param {object} data.nodeTypesChanges - { label, color, replacement, delete }\n   *  @param {string} data.nodeTypesChanges.label - orig label, used for matching to current node setting\n   *  @param {string} data.nodeTypesChanges.color\n   *  @param {string} data.nodeTypesChanges.replacement - text to replace label\n   *  @param {boolean} data.nodeTypesChanges.delete - option should be removed after mapping\n   */\n  UDATA.HandleMessage('NODE_TYPES_UPDATE', data => {\n    const { nodeTypesChanges } = data;\n    const changeMap = new Map();\n    nodeTypesChanges.forEach(c => {\n      changeMap.set(c.label, c);\n    });\n    NCDATA.nodes = NCDATA.nodes.map(n => {\n      const type = n.type;\n      const change = changeMap.get(n.type);\n      if (change && change.replacement) {\n        n.type = change.replacement;\n      }\n      return n;\n    });\n    // DEPRECATED\n    // As of 3/2022 edge source and target use ids, so there's no longer\n    // a need to convert them.\n    // // Convert D3 source/target nodes objects into ids\n    // NCDATA.edges = m_ConvertSourceTarget2ID(NCDATA.edges);\n\n    // Write to database!\n    // IMPORTANT: We have to update the db BEFORE calling SetAppState\n    // because SetAppseState will cause d3 to convert edge source/targets\n    // from ids back to node objects.\n    UDATA.LocalCall('DBUPDATE_ALL', NCDATA);\n    UDATA.SetAppState('NCDATA', NCDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  UDATA.HandleMessage('FIND_NODE_BY_PROP', data => {\n    const searchParameters = {};\n    searchParameters[data.key] = data.searchString;\n    return { nodes: m_FindMatchingNodeByProp(searchParameters) };\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  UDATA.HandleMessage('FIND_MATCHING_NODES', data => {\n    return { nodes: m_FindMatchingNodesByLabel(data.searchString) };\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** When creating a new edge, we first\n   *  1. Add a bare bones edge object with a new ID to the local state.edges\n   *  2. Pass it to render, so that a new EdgeEditor will be created.\n   *  3. In EdgeEditor, we create a dummy edge object\n   *  @param {Object} data\n   *  @param {string} data.nodeId\n   */\n  UDATA.HandleMessage('EDGE_CREATE', data => {\n    // provenance\n    const session = UDATA.AppState('SESSION');\n    const timestamp = new Date().toLocaleString('en-US');\n    const provenance = [];\n    const createdBy = MOD.GetCurrentUserId();\n    const updatedBy = createdBy;\n\n    // weight -- weight is a built in property, so always record it even it is not displayed\n    TEMPLATE = UDATA.AppState('TEMPLATE');\n    const DEFAULT_EDGE_WEIGHT = 1; // default to 1 in case `weight` is not defined in the template\n    const weight =\n      TEMPLATE.edgeDefs['weight'] && TEMPLATE.edgeDefs['weight'].defaultValue\n        ? TEMPLATE.edgeDefs['weight'].defaultValue\n        : DEFAULT_EDGE_WEIGHT;\n\n    // call server to retrieve an unused edge ID\n    return DATASTORE.PromiseNewEdgeID().then(newEdgeID => {\n      // Add it to local state for now\n      const edge = {\n        id: newEdgeID,\n        source: data.nodeId,\n        target: undefined,\n        attributes: {},\n        provenance,\n        weight,\n        createdBy,\n        updatedBy\n      };\n      return UDATA.LocalCall('DB_UPDATE', { edge }).then(() => {\n        console.log('...DB_UPDATE node is now', edge);\n        NCDATA.edges.push(edge);\n        UDATA.SetAppState('NCDATA', NCDATA);\n        return edge;\n      });\n    });\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** EDGE_TYPES_UPDATE is called by template-editor-mgr after user has changed the\n   *  edge type options.  This maps changed options to a new name,\n   *  and deleted type options to existing options.\n   *  This updates:\n   *  - The template file with new new edge types\n   *  - NCDATA and the databse file with edge type changes\n   *\n   *  @param {object} data\n   *  @param {object} data.nodeTypesChanges - { label, color, replacement, delete }\n   *  @param {string} data.nodeTypesChanges.label - orig label, used for matching to current edge setting\n   *  @param {string} data.nodeTypesChanges.color\n   *  @param {string} data.nodeTypesChanges.replacement - text to replace label\n   *  @param {boolean} data.nodeTypesChanges.delete - option should be removed after mapping\n   */\n  UDATA.HandleMessage('EDGE_TYPES_UPDATE', data => {\n    const { edgeTypesChanges } = data;\n    const changeMap = new Map();\n    edgeTypesChanges.forEach(c => {\n      changeMap.set(c.label, c);\n    });\n    NCDATA.edges = NCDATA.edges.map(e => {\n      const type = e.type;\n      const change = changeMap.get(e.type);\n      if (change && change.replacement) {\n        console.log('replacing', e.type, 'with', change.replacement);\n        e.type = change.replacement;\n      }\n      return e;\n    });\n    // Write to database!\n    // IMPORTANT: We have to update the db BEFORE calling SetAppState\n    // because SetAppState will cause d3 to convert edge source/targets\n    // from ids back to node objects.\n    UDATA.LocalCall('DBUPDATE_ALL', NCDATA);\n    UDATA.SetAppState('NCDATA', NCDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** EDGE_UPDATE is called when the properties of an edge has changed\n   *  NOTE: SOURCE_UPDATE can be invoked remotely by the server on a DATABASE\n   *  update.\n   */\n  UDATA.HandleMessage('EDGE_UPDATE', function (data) {\n    let { edge } = data;\n    if (DBG) console.log('nc-logic.EDGE_UPDATE: received edge', edge);\n    // set matching edges\n    let updatedEdges = m_SetMatchingEdgesByProp({ id: edge.id }, edge);\n    if (DBG) console.log('nc-logic.EDGE_UPDATE: updated', updatedEdges);\n\n    if (updatedEdges.length === 0) {\n      // if no edges had matched, then add a new edge!\n      if (DBG) console.log('nc-logic.EDGE_UPDATE: adding new edge', edge);\n      // created edges should have a default size\n      edge.size = 1;\n      NCDATA.edges.push(edge);\n    } else if (updatedEdges.length === 1) {\n      // if there was one edge, update it\n      const index = NCDATA.edges.findIndex(e => e.id === edge.id);\n      NCDATA.edges.splice(index, 1, edge);\n      if (DBG)\n        console.log('nc-logic.EDGE_UPDATE: updating existing edge', updatedEdges);\n    } else if (updatedEdges.length > 1) {\n      // if there were more edges than expected\n      throw Error('EdgeUpdate found duplicate IDs');\n    }\n\n    UTILS.RecalculateAllEdgeSizes(NCDATA);\n    UTILS.RecalculateAllNodeDegrees(NCDATA);\n    UDATA.SetAppState('NCDATA', NCDATA);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** EDGE_DELETE is called when an edge should be removed from...something?\n   */\n  UDATA.HandleMessage('EDGE_DELETE', function (data) {\n    let { edgeID } = data;\n    let edges = [];\n    // remove specified edge from edge list\n    NCDATA.edges = m_DeleteMatchingEdgeByProp({ id: edgeID });\n    UTILS.RecalculateAllEdgeSizes(NCDATA);\n    UTILS.RecalculateAllNodeDegrees(NCDATA);\n    UDATA.SetAppState('NCDATA', NCDATA);\n    // Also update selection so edges in EdgeEditor will update\n    let selection = UDATA.AppState('SELECTION');\n    if (\n      selection.nodes === undefined ||\n      selection.nodes.length < 1 ||\n      selection.nodes[0].id === undefined\n    ) {\n      if (DBG) console.log(PR, 'no selection:', selection);\n    } else {\n      if (DBG) console.log(PR, 'updating selection:', selection);\n      let nodeID = selection.nodes[0].id;\n      // Remove the deleted edge from the selection\n      if (selection.edges !== undefined && selection.edges.length > 0) {\n        edges = edges.concat(selection.edges.filter(edge => edge.id !== edgeID));\n      }\n    }\n    UDATA.SetAppState('SELECTION', {\n      nodes: selection.nodes,\n      edges: edges\n    });\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** AUTOCOMPLETE_SELECT is called by <AutoComplete> components to tell the\n   *  module which one has the current focus.\n   */\n  UDATA.HandleMessage('AUTOCOMPLETE_SELECT', function (data) {\n    m_HandleAutoCompleteSelect(data);\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - inside hook\n  /** TEMPLATE has been edited\n   *  This message is sent from server.js over the net.\n   *  This is the main handler for the local app.  It updates the appState.\n   */\n  UDATA.HandleMessage('NET_TEMPLATE_UPDATE', stateChange => {\n    if (DBG) console.log(PR, 'NET_TEMPLATE_UPDATE state change', stateChange);\n    TEMPLATE = stateChange;\n    UDATA.SetAppState('TEMPLATE', TEMPLATE);\n    m_UpdateColorMap();\n  });\n  /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n  UDATA.HandleMessage('EDIT_CURRENT_TEMPLATE', () => {\n    return { template: TEMPLATE };\n  });\n}); // end UNISYS_INIT\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** INIT HANDLERS\n */\nfunction m_HandleAutoCompleteSelect(data) {\n  if (DBG) console.log('ACL: Setting activeAutoCompleteId to', data.id);\n  UDATA.SetAppState('ACTIVEAUTOCOMPLETE', {\n    activeAutoCompleteId: data.id\n  });\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** lifecycle RESET handler\n */\nMOD.Hook('RESET', () => {\n  // Force an AppState update here so that the react components will load\n  // the data after they've been initialized.  The SetAppState call in\n  // LOADASSETS is broadcast before react components have been loaded.\n  UDATA.SetAppState('NCDATA', NCDATA);\n}); // end UNISYS_RESET\n\n/// APP_READY MESSAGE REGISTRATION ////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** The APP_READY hook is fired after all initialization phases have finished\n *  and may also fire at other times with a valid info packet\n */\nMOD.Hook('APP_READY', function (info) {\n  /// RETURN PROMISE to prevent phase from continuing until after registration\n  /// of messages is successful\n  return new Promise((resolve, reject) => {\n    if (DBG) console.log(`${PR}HOOK 'UNISYS_INIT' Registering Message Handlers...`);\n    // timeout for broken network registration\n    let timeout = setTimeout(() => {\n      reject(new Error('UNISYS REGISTER TIMEOUT'));\n    }, 5000);\n\n    // register ONLY messages we want to make public\n    UNISYS.RegisterMessagesPromise([\n      'SOURCE_UPDATE',\n      `NODE_DELETE`,\n      'EDGE_UPDATE',\n      'EDGE_DELETE',\n      'COMMENT_UPDATE',\n      'COMMENTS_UPDATE',\n      'READBY_UPDATE',\n      'EDIT_PERMISSIONS_UPDATE',\n      'NET_TEMPLATE_UPDATE'\n    ]).then(d => {\n      clearTimeout(timeout);\n      if (DBG)\n        console.log(\n          `${PR}HOOK 'UNISYS_INIT' Registered Message Handlers ${JSON.stringify(\n            d.registered\n          )}`\n        );\n      if (DBG)\n        console.log(\n          `INFO: %cMy socket address is ${UNISYS.SocketUADDR()}`,\n          'color:blue;font-weight:bold'\n        );\n      resolve();\n    });\n  });\n}); // end UNISYS_READY\n\n/// GLOBAL HELPERS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\nMOD.GetCurrentUserId = () => {\n  // always get the current session value because it might change at any time\n  const session = UDATA.AppState('SESSION');\n  const { userId } = session;\n  return userId;\n};\n\n/// OBJECT HELPERS ////////////////////////////////////////////////////////////\n/// these probably should go into a utility class\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return array of objects that match the match_me object keys/values\n *  NOTE: make sure that strings are compared with strings, etc\n */\nfunction m_FindMatchingObjsByProp(obj_list, match_me = {}) {\n  // operate on arrays only\n  if (!Array.isArray(obj_list))\n    throw Error('FindMatchingObjectsByProp arg1 must be array');\n  let matches = obj_list.filter(obj => {\n    let pass = true;\n    for (let key in match_me) {\n      if (match_me[key] !== obj[key]) pass = false;\n      break;\n    }\n    return pass;\n  });\n  // return array of matches (can be empty array)\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Set array of objects that match to key/values of yes/no respectively\n *  Returns array of matched objects\n */\nfunction m_SetMatchingObjsByProp(obj_list, match_me = {}, yes = {}, no = {}) {\n  // operate on arrays only\n  if (!Array.isArray(obj_list))\n    throw Error('SetMatchingObjsByPropp arg1 must be array');\n\n  let returnMatches = [];\n  obj_list.forEach(node => {\n    let matched = true;\n    for (let key in match_me) {\n      if (match_me[key] !== node[key]) matched = false;\n      break;\n    }\n    if (matched) {\n      for (let key in yes) node[key] = yes[key];\n      returnMatches.push(node);\n    } else {\n      for (let key in no) node[key] = no[key];\n    }\n  });\n  return returnMatches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Update props of everything in obj_list\n */\nfunction m_SetAllObjs(obj_list, all = {}) {\n  // operate on arrays only\n  if (!Array.isArray(obj_list)) throw Error('SetAllNodes arg1 must be array');\n  obj_list.forEach(obj => {\n    for (let key in all) obj[key] = all[key];\n  });\n}\nMOD.SetAllObjs = m_SetAllObjs; // Expose for filter-mgr.js\n\n/// NODE HELPERS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Update ColorMap\n */\nfunction m_UpdateColorMap() {\n  // REVIEW: Load ColorMap in d3?  or elsewhere?  does it need its own state?\n  // Joshua added Edges in here ... it should either be renamed or kept separate\n  // but this was a proof of concept. Probably they should be kept separate in case\n  // someone ever chooses to use the same label twice, but ...\n  try {\n    const nodeColorMap = {};\n    if (TEMPLATE.nodeDefs.type && TEMPLATE.nodeDefs.type.options) {\n      TEMPLATE.nodeDefs.type.options.forEach(o => {\n        nodeColorMap[o.label] = o.color;\n      });\n    }\n\n    const edgeColorMap = {};\n    let defaultEdgeColor = TEMPLATE.edgeDefs.color || '#999'; //for backwards compatability\n    if (TEMPLATE.edgeDefs.type && TEMPLATE.edgeDefs.type.options) {\n      TEMPLATE.edgeDefs.type.options.forEach(o => {\n        edgeColorMap[o.label] = o.color || defaultEdgeColor;\n      });\n    }\n\n    UDATA.SetAppState('COLORMAP', { nodeColorMap, edgeColorMap });\n  } catch (error) {\n    console.error(\n      PR,\n      'received bad TEMPLATE node options.  ERROR:',\n      error,\n      '. DATA:',\n      TEMPLATE\n    );\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return array of nodes that DON'T match del_me object keys/values\n */\nfunction m_DeleteMatchingNodesByProp(del_me = {}) {\n  let matches = NCDATA.nodes.filter(node => {\n    let pass = false;\n    for (let key in del_me) {\n      if (del_me[key] !== node[key]) {\n        pass = true;\n        break;\n      }\n    }\n    return pass;\n  });\n  // return array of matches (can be empty array)\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return array of nodes that match the match_me object keys/values\n *  NOTE: make sure that strings are compared with strings, etc\n */\nfunction m_FindMatchingNodeByProp(match_me = {}) {\n  return m_FindMatchingObjsByProp(NCDATA.nodes, match_me);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Convenience function to retrieve node by ID\n */ function m_FindNodeById(id) {\n  return m_FindMatchingNodeByProp({ id })[0];\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return array of nodes with labels that partially match str\n */\nMOD.FindMatchingNodesByLabel = label => {\n  return m_FindMatchingNodesByLabel(label);\n};\nfunction m_FindMatchingNodesByLabel(str = '') {\n  if (!str) return [];\n  // Normalize and remove diacritics from input\n  str = UTILS.RemoveDiacriticMarks(str);\n  str = u_EscapeRegexChars(str.trim());\n  if (str === '') return [];\n  const regex = new RegExp(/*'^'+*/ str, 'i');\n  return NCDATA.nodes.filter(node => {\n    // Normalize and remove diacritics from node label\n    const label = UTILS.RemoveDiacriticMarks(node.label);\n    return regex.test(label);\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Set nodes that PARTIALLY match 'str' to 'yes' props.\n *  All others nodes are set to 'no' props. Return matches\n *  Optionally resets all the NON matching nodes as well\n */\nfunction m_SetMatchingNodesByLabel(str = '', yes = {}, no = {}) {\n  let returnMatches = [];\n\n  // Escape special regex characters in the search string and remove diacritics\n  str = RemoveDiacriticMarks(str.trim());\n  str = u_EscapeRegexChars(str); // Escape special regex characters\n\n  if (str === '') return undefined;\n  const regex = new RegExp(/*'^'+*/ str, 'i');\n  NCDATA.nodes.forEach(node => {\n    if (regex.test(node.label)) {\n      for (let key in yes) node[key] = yes[key];\n      returnMatches.push(node);\n    } else {\n      for (let key in no) node[key] = no[key];\n    }\n  });\n  return returnMatches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Update props of exact matching nodes, returns matches\n *  Optionally resets all the NON matching nodes as well\n */\nfunction m_SetMatchingNodesByProp(match_me = {}, yes = {}, no = {}) {\n  return m_SetMatchingObjsByProp(NCDATA.nodes, match_me, yes, no);\n}\n\n/// EDGE HELPERS //////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Return array of edges that DON'T match del_me object keys/values\n */\nfunction m_DeleteMatchingEdgeByProp(del_me = {}) {\n  let matches = NCDATA.edges.filter(edge => {\n    let pass = false;\n    for (let key in del_me) {\n      if (del_me[key] !== edge[key]) {\n        pass = true;\n        break;\n      }\n    }\n    if (!pass) {\n      // filter out AND also remove comments\n      const cref = CMTMGR.GetEdgeCREF(edge.id);\n      CMTMGR.RemoveAllCommentsForCref(cref);\n    }\n    return pass;\n  });\n  // return array of matches (can be empty array)\n  return matches;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Update props of exact matching edges, returns matches\n */\nfunction m_SetMatchingEdgesByProp(match_me = {}, yes = {}, no = {}) {\n  return m_SetMatchingObjsByProp(NCDATA.edges, match_me, yes, no);\n}\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** REGEX: the chars in brackets are part of matching character set.\n *  Declaring this as a constant makes the RegEx run faster (I think).\n */\nconst REGEX_REGEXCHARS = /[.*+?^${}()|[\\]\\\\]/g;\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Adds a \\ in front of characters that have special RegEx meaning\n *  From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expression\n */\nfunction u_EscapeRegexChars(string) {\n  return string.replace(REGEX_REGEXCHARS, '\\\\$&'); // $& means the whole matched string\n}\nMOD.EscapeRegexChars = u_EscapeRegexChars; // Expose for filter-mgr.js\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Migrate Data from older formats\n *\n *  1. Convert all IDs to integers\n *      Node and Edge IDs should be integers.\n *      This isn't a problem with newly created datasets as the network-generated IDs\n *      are integers.  However, with older data sets, the IDs may have been strings.\n *      e.g. exports from Gephi will have string IDs.\n *      This mismatch is a problem when looking up nodes by ID.\n *        `data` is passed by reference\n *        This modifies `data`\n *        data = { nodes: [], edges: [] }\n *  2. Convert 'attributes' from pre v1.4 datasets\n *      NODES\n *        attributes.Node_type => type\n *        attributes[Extra Info] => info\n *        attributes.Notes => notes\n *      EDGES\n *        attributes.Relationship => type\n *        attributes.Info => info\n *        attributes.Citations = citation\n *        attributes.Notes => notes\n *  3. Remove the old `attributes` key\n *  4. Clean built-in fields\n */\nfunction m_MigrateData(data) {\n  data.nodes.forEach(node => {\n    node.id = parseInt(node.id);\n    if (node.attributes) {\n      // don't clobber if value is already set\n      node.type = node.type || node.attributes.Node_Type;\n      node.info = node.info || node.attributes['Extra Info'];\n      node.notes = node.notes || node.attributes.Notes;\n      // clear it\n      Reflect.deleteProperty(node, 'attributes');\n    }\n    // clean built-in fields\n    // NOTE: This just cleans up the data, but does not SAVE the fix!\n    node.meta = node.meta || {};\n    node.meta.revision = parseInt(node.meta.revision) || 1;\n  });\n  data.edges.forEach(edge => {\n    edge.id = parseInt(edge.id);\n    // before D3 processing, edge.source and edge.target are ids\n    edge.source = parseInt(edge.source);\n    edge.target = parseInt(edge.target);\n    if (edge.attributes) {\n      // don't clobber if value is already set\n      edge.type = edge.type || edge.attributes.Relationship;\n      edge.info = edge.info || edge.attributes.Info;\n      edge.citation = edge.citation || edge.attributes.Citations;\n      edge.notes = edge.notes || edge.attributes.Notes;\n      edge.category = edge.category || edge.attributes.Category;\n      // clear it\n      Reflect.deleteProperty(edge, 'attributes');\n    }\n    // clean built-in fields\n    // NOTE: This just cleans up the data, but does not SAVE the fix!\n    edge.meta = edge.meta || {};\n    edge.meta.revision = parseInt(edge.meta.revision) || 1;\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// DEPRECATED\n// As of 3/2022 edge source and target use ids, so there's no longer\n// a need to convert them.\n//\n// /** Converts edge.source and edge.target from objects to ids\n//     d3 converts edge.source and edget.target from ids to node objects\n//     when it renders NCDATA.  When getting ready to save edges to the database\n//     we need to convert them back to ids.\n//  */\n// function m_ConvertSourceTarget2ID(edges) {\n//   return edges.map(e => {\n//     e.source = e.source && e.source.id;\n//     e.target = e.target && e.target.id;\n//     return e;\n//   });\n// }\n\n/// NODE MARKING METHODS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Visually change all nodes to the deselected color\n */\nfunction m_UnMarkAllNodes() {\n  let props = { selected: DESELECTED_COLOR };\n  m_SetAllObjs(NCDATA.nodes, props);\n  UDATA.SetAppState('NCDATA', NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Remove the stroke color.  Used to unmark search matches.\n */\nfunction m_UnStrokeAllNodes() {\n  let props = { strokeColor: undefined };\n  m_SetAllObjs(NCDATA.nodes, props);\n  UDATA.SetAppState('NCDATA', NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Sets matching node labels to the passed selection color\n */\nfunction m_MarkNodesThatMatch(searchString, color) {\n  if (searchString === '') {\n    m_UnMarkAllNodes();\n    return;\n  }\n  let select = { selected: color };\n  let deselect = { selected: DESELECTED_COLOR };\n  m_SetMatchingNodesByLabel(searchString, select, deselect);\n  UDATA.SetAppState('NCDATA', NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Sets matching node labels to the passed selection color\n *  This sets the stroke color, which is used to display\n *  the matching nodes during a search.  If the node is\n *  also selected, the selected color will override this color.\n */\nfunction m_SetStrokeColorThatMatch(searchString, color) {\n  let matched = { strokeColor: color };\n  let notmatched = { strokeColor: undefined };\n  m_SetMatchingNodesByLabel(searchString, matched, notmatched);\n  UDATA.SetAppState('NCDATA', NCDATA);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/* Sets the 'selected' state of edges that are attached to the node\n */\nfunction m_MarkSelectedEdges(edges, node) {\n  // Delesect all edges first\n  edges.forEach(edge => {\n    edge.selected = false;\n  });\n  // Find connected edges\n  let id = node.id;\n  NCDATA.edges.forEach(edge => {\n    if (edge.source === id || edge.target === id) {\n      edge.selected = true;\n    } else {\n      edge.selected = false;\n    }\n  });\n  UDATA.SetAppState('NCDATA', NCDATA);\n}\n\n/// COMMAND LINE UTILITIES ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Command: REGENERATE DEFAULT TEMPLATE\n *  This will regenerate the `_default.template.toml` file from\n *  the current `template-schema.js` spec.  This is only necessary to do\n *  if you've edited the `template.schema.js`` file.\n */\nJSCLI.AddFunction(function ncRegenerateDefaultTemplate() {\n  UDATA.Call('SRV_TEMPLATE_REGENERATE_DEFAULT');\n  console.log('_default.template.toml regenerated from `template-schema.js`');\n});\n/** Command: RESET THE DATABASE from default data\n */\nJSCLI.AddFunction(function ncPushDatabase(jsonFile) {\n  jsonFile = jsonFile || 'data.reducedlinks.json';\n  DATASTORE.PromiseJSONFile(jsonFile)\n    .then(data => {\n      // data is { nodes, edges }\n      console.log(PR, `Sending data from ${jsonFile} to Server`, data);\n      // UDATA.Call() returns a promise, so return it to\n      // continue the asynchronous chain\n      return UDATA.Call('SRV_DBSET', data);\n    })\n    .then(d => {\n      if (d.OK) {\n        window.alert(\n          `assets/data/${jsonFile} was pushed to Server.\\nPress OK to refresh this page and MANUALLY REFRESH other clients.\\n\\n(note: if data hasn't changed, try command again)`\n        );\n        console.log(\n          `${PR} %cServer Database has been overwritten with ${jsonFile}`,\n          'color:blue'\n        );\n        console.log(`${PR} Reload apps to see new data`);\n        setTimeout(UNISYS.IsReloadRequired, 1000);\n      } else {\n        console.error(PR, 'Server Error', d);\n        window.alert(`Error ${JSON.stringify(d)}`);\n      }\n    });\n  // return syntax help\n  return 'FYI: ncPushDatabase(jsonFile) can load file in assets/data';\n});\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Command: EMPTY THE DATABASE from default data\n */\nJSCLI.AddFunction(function ncEmptyDatabase() {\n  window.ncPushDatabase('_nclogic_resetdb.json');\n  return 'FYI: pushing empty database from assets/data/_nclogic_resetdb...reloading';\n});\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Command: Unlock the database.  Used to recover from error conditions where\n *  a node or edge is inadvertently left locked.\n */\nJSCLI.AddFunction(function ncUnlockAll() {\n  UDATA.NetCall('SRV_DBUNLOCKALL', {});\n  return 'Unlocking all nodes and edges in the database, and enabling template edits.';\n});\nJSCLI.AddFunction(function ncUnlockAllNodes() {\n  UDATA.NetCall('SRV_DBUNLOCKALLNODES', {});\n  return 'Unlocking all nodes in the database.';\n});\nJSCLI.AddFunction(function ncUnlockAllEdges() {\n  UDATA.NetCall('SRV_DBUNLOCKALLEDGES', {});\n  return 'Unlocking all edges in the database.';\n});\nJSCLI.AddFunction(function ncNodeColorMap() {\n  console.log(UDATA.AppState('COLORMAP'));\n  return 'ncNodeColorMap.';\n});\nJSCLI.AddFunction(function ncDumpData() {\n  console.log('NCDATA', NCDATA);\n  return `ncDumpData: ${JSON.stringify(NCDATA)}`;\n});\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Command: Token Generator\n */\n/// ncMakeSharedTokens is a variant on ncMakeTokens\n/// This command skips `dataset` so tokens can be shared across graphs.\n/// Use ncMakeSharedTokens instead of ncMakeTokens to create shared tokens\nJSCLI.AddFunction(function ncMakeSharedTokens(clsId, projId, numGroups) {\n  return ncMakeTokens(clsId, projId, undefined, numGroups);\n});\n/// `datatset` is not being used but is retained for backwards compatibility\nJSCLI.AddFunction(function ncMakeTokens(clsId, projId, dataset, numGroups) {\n  // type checking\n  if (typeof clsId !== 'string')\n    return 'args: str classId, str projId, str dataset, int numGroups';\n  if (typeof projId !== 'string')\n    return 'args: str classId, str projId, str dataset, int numGroups';\n\n  // 2024/08 Make 'dataset' optional so tokens can be shared across graphs\n  // `dataset` can still be defined, but it is now optional and does not return an error\n  // if (typeof dataset !== 'string')\n  //   return 'args: str classId, str projId, str dataset, int numGroups';\n\n  if (clsId.length > 12) return 'classId arg1 should be 12 chars or less';\n  if (projId.length > 12) return 'classId arg1 should be 12 chars or less';\n  if (!Number.isInteger(numGroups)) return 'numGroups arg3 must be integer';\n  if (numGroups < 1) return 'numGroups arg3 must be positive integer';\n  // let's do this!\n  let out = `\\nTOKEN LIST for class '${clsId}' project '${projId}'\\n\\n`;\n  let pad = String(numGroups).length;\n  for (let i = 1; i <= numGroups; i++) {\n    let id = String(i);\n    id = id.padStart(pad, '0');\n    out += `group ${id}\\t${SESSION.MakeToken(clsId, projId, i, dataset)}\\n`;\n  }\n  if (window && window.location) {\n    let ubits = new URL(window.location);\n    let hash = ubits.hash.split('/')[0];\n    let url = `${ubits.protocol}//${ubits.host}/${hash}`;\n    out += `\\nexample url: ${SETTINGS.ServerAppURL()}/edit/${SESSION.MakeToken(\n      clsId,\n      projId,\n      1\n    )}\\n`;\n  }\n  console.log(out);\n  return '';\n});\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  nc-ui\n\n  General purpose re-usable UI components and snippets.\n\n  Used by:\n  * NCNode\n  * NCEdge\n\n  Supported Field Types\n  - number\n  - string\n  - markdown\n  - hdate\n  - select\n  - infoOrigin\n\n\n  Custom Fields Handling\n\n    The `infoOrigin` field requires special handling.\n\n    Ideally, when a node is created, we would process any special fields and\n    derive and save any derived info.  But\n    a) we don't want to have server-database handle any custom fields -- that\n       it should just blindly save data.\n    b) when nc-logic creates a new field via `NODE_CREATE`, again, only built-in\n       fields are created and stored.  Custom fields are created by the UI as\n       needed when they are rendered.\n    This means that the `infoOrigin` field remains blank until the user\n    decides to change the data.\n\n    To handle this, then we need to make sure `infoOrigin` appears to have data\n    whenever it is viewed.  This requires:\n    - nc-ui renders a non-built-in field, e.g. an `attribute` field\n    - nc-ui renders a `provenance` field\n    - importexport-mgr exports node or edge data\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst React = require('react');\nconst UNISYS = require('unisys/client');\nconst UTILS = require('./nc-utils');\nconst MD = require('markdown-it')();\nconst MDEMOJI = require('markdown-it-emoji');\nMD.use(MDEMOJI);\nconst MDPARSE = require('html-react-parser').default;\nconst NCDialogInsertImageURL = require('./components/NCDialogInsertImageURL');\nimport URDateField from './components/URDateField';\nimport TEMPLATE_MGR from './template-mgr';\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst VIEWMODE = {\n  EDIT: 'edit',\n  VIEW: 'view'\n};\n\n/// MODULE INITIALIZATION /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst MOD = UNISYS.NewModule(module.id);\nconst UDATA = UNISYS.NewDataLink(MOD);\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction DateFormatted() {\n  var today = new Date();\n  var year = String(today.getFullYear());\n  var date =\n    today.getMonth() + 1 + '/' + today.getDate() + '/' + year.substring(2, 4);\n  var time = today.toTimeString().substring(0, 5);\n  var dateTime = time + ' on ' + date;\n  return dateTime;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Converts a markdown string to HTML\n *  And does extra HACK processing as needed:\n *  -- Supports emojis\n *  -- add `_blank` to `a` tags.\n */\nfunction Markdownify(str = '') {\n  const htmlString = MD.render(str);\n  // HACK!!! MDPARSE does not give us direct access to the dom elements, so just\n  // hack it by adding to the parsed html string\n  const hackedHtmlString = htmlString.replace(/<a href/g, `<a target=\"_blank\" href`);\n  return MDPARSE(hackedHtmlString);\n}\n/// INPUT FORM CHANGE HANDLERS ////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** This processes the form data before passing it on to the parent handler.\n *  The callback function is generally an input state update method in\n *  NCNode or NCEdge\n *  Emulates m_UIStringInputUpdate but adds error checking on markdown text.\n *  @param {Object} event\n *  @param {function} cb Callback function\n */\nfunction m_UIMarkdownInputUpdate(event, cb) {\n  console.warn(\n    'WARNNIG: Markdown text is not being error checked!  Use with caution!'\n  );\n  const key = event.target.id;\n  const value = event.target.value;\n  if (typeof cb === 'function') cb(key, value);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** This processes the form data before passing it on to the parent handler.\n *  The callback function is generally an input state update method in\n *  NCNode or NCEdge\n *  @param {Object} event\n *  @param {function} cb Callback function\n */\nfunction m_UIStringInputUpdate(event, cb) {\n  const key = event.target.id;\n  const value = event.target.value;\n  if (typeof cb === 'function') cb(key, value);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** This processes the form data before passing it on to the parent handler.\n *  The callback function is generally an input state update method in\n *  NCNode or NCEdge\n *  @param {Object} event\n *  @param {function} cb Callback function\n */\nfunction m_UINumberInputUpdate(event, cb) {\n  const key = event.target.id;\n  const value = Number(event.target.value);\n  if (typeof cb === 'function') cb(key, value);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** This processes the form data before passing it on to the parent handler.\n *  The callback function is generally an input state update method in\n *  NCNode or NCEdge\n *  @param {Object} event\n *  @param {function} cb Callback function\n */\nfunction m_UISelectInputUpdate(event, cb) {\n  const key = event.target.id;\n  const value = event.target.value;\n  if (typeof cb === 'function') cb(key, value);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** This processes the form data before passing it on to the parent handler.\n *  The callback function is generally an input state update method in\n *  NCNode or NCEdge\n *  @param {Object} event\n *  @param {function} cb Callback function\n */\nfunction m_UIDateInputUpdate(event, cb) {\n  const key = event.target.id;\n  const value = event.target.value;\n  if (typeof cb === 'function') cb(key, value);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Insert a URL into the current input\n *  This processes the form data before passing it on to the parent handler.\n *  The callback function is generally an input state update method in\n *  NCNode or NCEdge\n *  @param {Object} event\n *  @param {function} cb Callback function\n */\nfunction m_UIInsertImageURL(url, parentId, cb) {\n  const inputEl = document.getElementById(parentId);\n  const selectionStart = inputEl.selectionStart;\n  const currentValue = String(inputEl.value);\n  // fake an event to emulate m_UIStringInputUpdate so markdown is treated as string\n  const event = {\n    target: {\n      id: parentId,\n      value:\n        currentValue.substring(0, selectionStart) +\n        `![image](${url})` +\n        currentValue.substring(selectionStart)\n    }\n  };\n  m_UIMarkdownInputUpdate(event, cb);\n}\nfunction m_UICancelInsertImageURL() {\n  // FUTURE ENHANCEMENT: Allow removing URL???\n}\n\n/// LAYOUT RENDERERS //////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderTabSelectors(TABS, state, onclick) {\n  const { uSelectedTab, uViewMode, degrees } = state;\n  const columnsDef = `repeat(${Object.keys(TABS).length}, 1fr)`;\n  const icn = {\n    ATTRIBUTES: 'icn_attributes.svg',\n    EDGES: 'icn_edges.svg',\n    PROVENANCE: 'icn_provenance.svg'\n  };\n  return (\n    <div\n      className=\"tabselectors\"\n      style={{ color: 'red', gridTemplateColumns: columnsDef }}\n      role=\"tablist\"\n    >\n      {Object.keys(TABS).map(k => {\n        return (\n          <button\n            id={k}\n            key={k}\n            className={uSelectedTab === TABS[k] ? 'selected' : ''}\n            onClick={onclick}\n            value={TABS[k]}\n            disabled={uViewMode === VIEWMODE.EDIT}\n            role=\"tab\"\n            type=\"button\"\n            aria-selected={uSelectedTab === TABS[k]}\n            aria-controls={TABS[k]}\n          >\n            {TABS[k] === 'EDGES' ? `${TABS[k]} (${degrees})` : TABS[k]}\n            <img src={`images/${icn[k]}`} />\n          </button>\n        );\n      })}\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderAttributesTabView(state, defs, BUILTIN_FIELDS) {\n  const { attributes, degrees, weight, size } = state;\n  const items = [];\n  const attributeDefKeys = TEMPLATE_MGR.GetAttributeDefKeys(defs, BUILTIN_FIELDS);\n  attributeDefKeys.forEach(k => {\n    const def = defs[k];\n    items.push(RenderLabel(k, def.displayLabel, def.help));\n    const type = def.type;\n    switch (type) {\n      case 'markdown':\n        items.push(RenderMarkdownValue(k, attributes[k]));\n        break;\n      case 'hdate':\n        items.push(\n          RenderDateValue(k, attributes[k], def.format, def.allowFormatSelection)\n        );\n        break;\n      case 'infoOrigin':\n        items.push(RenderInfoOriginValue(k, attributes[k], state, defs));\n        break;\n      case 'string':\n      default:\n        items.push(RenderStringValue(k, attributes[k]));\n        break;\n    }\n  });\n\n  // degrees hack -- `degrees` is a built-in field, but is displayed in attributes\n  if (defs['degrees']) {\n    // only if defined, e.g. for nodeDefs\n    items.push(RenderLabel('degrees', defs['degrees'].displayLabel));\n    items.push(RenderStringValue('degrees', degrees));\n  }\n  // weight hack -- `weight` is a built-in field, but is displayed in attributes\n  if (defs['weight'] && !defs['weight'].hidden) {\n    // only if defined, e.g. for nodeDefs\n    items.push(RenderLabel('weight', defs['weight'].displayLabel));\n    items.push(RenderStringValue('weight', `${weight} (${size})`));\n  }\n\n  return <div className=\"formview\">{items}</div>;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderAttributesTabEdit(state, defs, onchange, BUILTIN_FIELDS) {\n  const { attributes, degrees, weight } = state;\n  const items = [];\n  const attributeDefKeys = TEMPLATE_MGR.GetAttributeDefKeys(defs, BUILTIN_FIELDS);\n  attributeDefKeys.forEach(k => {\n    const def = defs[k];\n    items.push(RenderLabel(k, def.displayLabel));\n    const type = def.type;\n    const value = attributes[k] || ''; // catch `undefined` or React will complain about changing from uncontrolled to controlled\n    const helpText = def.help;\n    switch (type) {\n      case 'markdown':\n        items.push(RenderMarkdownInput(k, value, onchange, helpText));\n        break;\n      case 'hdate':\n        items.push(\n          RenderDateInput(\n            k,\n            value,\n            def.format,\n            def.allowFormatSelection,\n            onchange,\n            helpText\n          )\n        );\n        break;\n      case 'string':\n        items.push(RenderStringInput(k, value, onchange, helpText));\n        break;\n      case 'infoOrigin':\n        items.push(RenderInfoOriginInput(k, value, onchange, helpText, state));\n        break;\n      case 'number':\n        items.push(m_RenderNumberInput(k, value, onchange, helpText));\n        break;\n      case 'select':\n        items.push(RenderOptionsInput(k, value, defs, onchange, helpText));\n        break;\n      default:\n        items.push(RenderStringValue(k, value, onchange)); // display unsupported type\n    }\n  });\n\n  // degrees hack -- `degrees` is a built-in field, but is displayed in attributes\n  if (defs['degrees']) {\n    // only if defined, e.g. for nodeDefs\n    items.push(RenderLabel('degrees', defs['degrees'].displayLabel));\n    items.push(RenderStringValue('degrees', degrees));\n  }\n  // weight hack -- `weight` is a built-in field, but is displayed in attributes\n  if (defs['weight'] && !defs['weight'].hidden) {\n    // only if defined, e.g. for nodeDefs\n    items.push(RenderLabel('weight', defs['weight'].displayLabel));\n    items.push(m_RenderNumberInput('weight', weight, onchange, defs['weight'].help));\n  }\n\n  return <div className=\"formview\">{items}</div>;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderProvenanceItemsView(state, defs, BUILTIN_FIELDS) {\n  const { provenance } = state;\n  const items = [];\n  const provenanceDefKeys = TEMPLATE_MGR.GetProvenanceDefKeys(defs, BUILTIN_FIELDS);\n  provenanceDefKeys.forEach(k => {\n    const def = defs[k];\n    items.push(RenderLabel(k, def.displayLabel, def.help));\n    const type = def.type;\n    switch (type) {\n      case 'markdown':\n        items.push(RenderMarkdownValue(k, provenance[k]));\n        break;\n      case 'hdate':\n        items.push(\n          RenderDateValue(k, provenance[k], defs.format, defs.allowFormatSelection)\n        );\n        break;\n      case 'infoOrigin':\n        items.push(RenderInfoOriginValue(k, provenance[k], state, defs));\n        break;\n      case 'string':\n      case 'number':\n      default:\n        items.push(RenderStringValue(k, provenance[k]));\n        break;\n    }\n  });\n  return items;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderProvenanceItemsEdit(state, defs, onchange, BUILTIN_FIELDS) {\n  const { provenance, degrees } = state;\n  const items = [];\n  const provenanceDefKeys = TEMPLATE_MGR.GetProvenanceDefKeys(defs, BUILTIN_FIELDS);\n  provenanceDefKeys.forEach(k => {\n    const def = defs[k];\n    items.push(RenderLabel(k, def.displayLabel));\n    const type = def.type;\n    const value = provenance[k] || ''; // catch `undefined` or React will complain about changing from uncontrolled to controlled\n    const helpText = def.help;\n    switch (type) {\n      case 'markdown':\n        items.push(RenderMarkdownInput(k, value, onchange, helpText));\n        break;\n      case 'hdate':\n        items.push(\n          RenderDateInput(\n            k,\n            value,\n            def.format,\n            def.allowFormatSelection,\n            onchange,\n            helpText\n          )\n        );\n        break;\n      case 'string':\n        items.push(RenderStringInput(k, value, onchange, helpText));\n        break;\n      case 'infoOrigin':\n        items.push(RenderInfoOriginInput(k, value, onchange, helpText, state));\n        break;\n      case 'weight':\n      case 'number':\n        items.push(m_RenderNumberInput(k, value, onchange, helpText));\n        break;\n      case 'select':\n        items.push(RenderOptionsInput(k, value, defs, onchange, helpText));\n        break;\n      default:\n        items.push(RenderStringValue(k, value, onchange)); // display unsupported type\n    }\n  });\n  return items;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderProvenanceTabView(state, defs, BUILTIN_FIELDS) {\n  const { provenance, degrees, created, createdBy, updated, updatedBy, revision } =\n    state;\n  return (\n    <div className=\"provenance formview\">\n      <div className=\"category\">PROVENANCE</div>\n      {RenderProvenanceItemsView(state, defs, BUILTIN_FIELDS)}\n      <div className=\"category\">HISTORY</div>\n      {defs.created &&\n        !defs.created.hidden &&\n        RenderLabel('createdlabel', defs.created.displayLabel)}\n      {defs.created &&\n        !defs.created.hidden &&\n        RenderProvenanceByline(created, createdBy, defs.createdBy)}\n      {defs.updated &&\n        !defs.updated.hidden &&\n        RenderLabel('updatedlabel', defs.updated.displayLabel)}\n      {defs.updated &&\n        !defs.updated.hidden &&\n        RenderProvenanceByline(updated, updatedBy, defs.updatedBy)}\n      {defs.revision &&\n        !defs.revision.hidden &&\n        RenderLabel('revisionlabel', defs.revision.displayLabel)}\n      {defs.revision &&\n        !defs.revision.hidden &&\n        RenderStringValue('revisionlabel', revision)}\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderProvenanceTabEdit(state, defs, onchange, BUILTIN_FIELDS) {\n  const { provenance, degrees, created, createdBy, updated, updatedBy, revision } =\n    state;\n  return (\n    <div className=\"provenance formview\">\n      <div className=\"category\">PROVENANCE</div>\n      {RenderProvenanceItemsEdit(state, defs, onchange, BUILTIN_FIELDS)}\n      <div className=\"category\">HISTORY</div>\n      {defs.created &&\n        !defs.created.hidden &&\n        RenderLabel('createdlabel', defs.created.displayLabel)}\n      {defs.created &&\n        !defs.created.hidden &&\n        RenderProvenanceByline(created, createdBy, defs.createdBy)}\n      {defs.updated &&\n        !defs.updated.hidden &&\n        RenderLabel('updatedlabel', defs.updated.displayLabel)}\n      {defs.updated &&\n        !defs.updated.hidden &&\n        RenderProvenanceByline(updated, updatedBy, defs.updatedBy)}\n      {defs.revision &&\n        !defs.revision.hidden &&\n        RenderLabel('revisionlabel', defs.revision.displayLabel)}\n      {defs.revision &&\n        !defs.revision.hidden &&\n        RenderStringValue('revisionlabel', revision)}\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderProvenanceByline(date, author, defAuthor) {\n  let result = '';\n  if (defAuthor && defAuthor.hidden) result = date;\n  else {\n    const by = author ? `${author}` : `(not recorded)`; // leave author blank for older templates\n    result = `${by}, ${date}`;\n  }\n  return <div className=\"viewvalue\">{result}</div>;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/// FORM RENDERERS\n///\nfunction RenderLabel(key, label, helpText) {\n  return (\n    <label htmlFor={key} key={`${key}label`} title={helpText}>\n      {label}\n    </label>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderMarkdownValue(key, value = '') {\n  const val = String(value);\n  return (\n    <div id={key} key={`${key}value`} className=\"viewvalue\">\n      {Markdownify(val)}\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderInfoOriginValue(key, value, state) {\n  const newValue =\n    value === undefined || value === ''\n      ? UTILS.DeriveInfoOriginString(state.createdBy, state.created)\n      : value;\n  return (\n    <div id={key} key={`${key}value`} className=\"viewvalue\">\n      {newValue}\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderStringValue(key, value) {\n  return (\n    <div id={key} key={`${key}value`} className=\"viewvalue\">\n      {value}\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderDateValue(key, value, dateFormat, allowFormatSelection) {\n  return (\n    <URDateField\n      id={key}\n      key={`${key}value`}\n      value={value}\n      dateFormat={dateFormat}\n      allowFormatSelection={allowFormatSelection}\n      readOnly\n    />\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Markdown String Input\n * There are two levels of callbacks necessary here.\n * 1. The `onChange` handler (in this module) processes the input's onChange event, and...\n * 2. ...then passes the resulting value to the `cb` function in the parent module.\n * @param {string} key\n * @param {string} value\n * @param {function} cb\n * @returns\n */\nfunction RenderMarkdownInput(key, value, cb, helpText) {\n  const rows = String(value).length > 35 ? 3 : 1;\n  return (\n    <div key={`${key}div`}>\n      <div className=\"help\">{helpText}</div>\n      <button\n        className=\"stylebutton\"\n        onClick={() => UDATA.LocalCall('IMAGE_URL_DIALOG_OPEN', { id: key })}\n      >\n        Insert Image URL...\n      </button>\n      <textarea\n        id={key}\n        key={`${key}input`}\n        type=\"string\"\n        value={value}\n        onChange={event => m_UIMarkdownInputUpdate(event, cb)}\n        autoComplete=\"off\" // turn off Chrome's default autocomplete, which conflicts\n        className={rows > 1 ? `long` : ''}\n        rows={rows}\n      />\n      <NCDialogInsertImageURL\n        id={key}\n        message=\"Paste image URL:\"\n        okmessage=\"Insert\"\n        onOK={url => m_UIInsertImageURL(url, key, cb)}\n        cancelmessage=\"Cancel\"\n        onCancel={m_UICancelInsertImageURL}\n      />\n    </div>\n  );\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * Injects `Created by <createdBy> on <created>` if nothing is defined\n * Otherwise it's treated as a string field\n */\nfunction RenderInfoOriginInput(key, value, cb, helpText, state, onFocus, onBlur) {\n  const newValue =\n    value === undefined || value === ''\n      ? UTILS.DeriveInfoOriginString(state.createdBy, state.created)\n      : value;\n  return RenderStringInput(key, newValue, cb, helpText, onFocus, onBlur);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/**\n * There are two levels of callbacks necessary here.\n * 1. The `onChange` handler (in this module) processes the input's onChange event, and...\n * 2. ...then passes the resulting value to the `cb` function in the parent module.\n * @param {string} key\n * @param {string} value\n * @param {function} cb\n * @param {string} helpText\n * @param {function} onFocus Handles showing autosuggest matchlist\n * @param {function} onBlur Handles hiding autosuggest matchlist\n * @returns\n */\nfunction RenderStringInput(key, value, cb, helpText, onFocus, onBlur) {\n  const rows = String(value).length > 35 ? 3 : 1;\n  return (\n    <div key={`${key}div`}>\n      <div className=\"help\">{helpText}</div>\n      <textarea\n        id={key}\n        key={`${key}input`}\n        type=\"string\"\n        value={value}\n        onChange={event => m_UIStringInputUpdate(event, cb)}\n        onFocus={() => typeof onFocus === 'function' && onFocus()}\n        onBlur={() => typeof onBlur === 'function' && onBlur()}\n        autoComplete=\"off\" // turn off Chrome's default autocomplete, which conflicts\n        className={rows > 1 ? `long` : ''}\n        rows={rows}\n      />\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** There are two levels of callbacks necessary here.\n *  1. The `onChange` handler (in this module) processes the input's onChange event, and...\n *  2. ...then passes the resulting value to the `cb` function in the parent module.\n *  @param {string} key\n *  @param {string} value will be converted to a Number()\n *  @param {function} cb\n *  @returns\n */\nfunction m_RenderNumberInput(key, value, cb, helpText) {\n  return (\n    <div key={`${key}div`}>\n      <div className=\"help\">{helpText}</div>\n      <input\n        id={key}\n        key={`${key}input`}\n        value={value ? value : 0}\n        type=\"number\"\n        onChange={event => m_UINumberInputUpdate(event, cb)}\n      />\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** There are two levels of callbacks necessary here.\n *  1. The `onChange` handler (in this module) processes the input's onChange event, and...\n *  2. ...then passes the resulting value to the `cb` function in the parent module.\n *  @param {string} key\n *  @param {string} value\n *  @param {function} cb\n *  @returns\n */\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction RenderOptionsInput(key, value, defs, cb, helpText) {\n  const options = defs[key].options;\n  return (\n    <div key={`${key}div`}>\n      <div className=\"help\">{helpText}</div>\n      <select\n        id={key}\n        key={`${key}select`}\n        value={value}\n        onChange={event => m_UISelectInputUpdate(event, cb)}\n      >\n        {options.map(o => (\n          <option key={o.label} value={o.label}>\n            {o.label}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** There are two levels of callbacks necessary here.\n *  1. The `onChange` handler (in this module) processes the input's onChange event, and...\n *  2. ...then passes the resulting value to the `cb` function in the parent module.\n *  @param {string} key\n *  @param {string} value Can be string or {value, format} object\n *  @param {string} dateFormat Format that the input string will be converted to\n *  @param {boolean} allowFormatSelection When true, user can select date format\n *                                        otherwise, the format is fixed.\n *  @param {function} cb Callback function\n *  @param {string} helpText\n *  @returns\n */\nfunction RenderDateInput(key, value, dateFormat, allowFormatSelection, cb, helpText) {\n  return (\n    <URDateField\n      id={key}\n      key={`${key}value`}\n      value={value}\n      dateFormat={dateFormat}\n      allowFormatSelection={allowFormatSelection}\n      onChange={event => m_UIDateInputUpdate(event, cb)}\n      helpText={helpText}\n    />\n  );\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = {\n  VIEWMODE,\n  DateFormatted,\n  Markdownify,\n  RenderTabSelectors,\n  RenderAttributesTabView,\n  RenderAttributesTabEdit,\n  RenderProvenanceTabView,\n  RenderProvenanceTabEdit,\n  RenderLabel,\n  RenderMarkdownValue,\n  RenderStringValue,\n  RenderMarkdownInput,\n  RenderStringInput,\n  RenderOptionsInput\n};\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  nc-utils\n\n  General purpose utilities for manipulating NCDATA.\n  Used by:\n  * nc-logic\n  * filter-mgr\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Generates a universal unique identifer for use with\n *  - comment ids\n *  This is a placeholder method.\n *  @return string\n */\nfunction GenerateUUID() {\n  // TODO generate actual unique id\n  return String(Math.random() * 128);\n}\n/** API METHOD\n *  Calculates and sets `degrees` for all nodes\n *  `degrees` is the number of edges connected to a node\n *  degrees needs to be recalculated whenever an edge is changed\n *  This modifies `data`\n *  @param {object} data\n *  @param {array} data.nodes\n *  @param {array} data.edges\n */\nfunction RecalculateAllNodeDegrees(data) {\n  const degrees = new Map();\n  function inc(nodeId) {\n    const val = degrees.get(nodeId) || 0;\n    degrees.set(nodeId, val + 1);\n  }\n  // Count edges efficiently\n  data.edges.forEach(e => {\n    inc(e.source);\n    inc(e.target);\n  });\n  // Apply the sums\n  data.nodes.forEach(n => {\n    n.degrees = degrees.get(n.id) || 0;\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Calculates and sets `size` for all edges\n *  `size` is the sum of all edge weights that have the same source/targets\n *  By default `weight` is 1.\n *  @param {object} data\n *  @param {array} data.nodes\n *  @param {array} data.edges\n */\nfunction RecalculateAllEdgeSizes(data) {\n  const size = new Map();\n  function getKey(sourceId, targetId) {\n    // key always starts with the smaller value\n    return sourceId < targetId\n      ? `${sourceId}-${targetId}`\n      : `${targetId}-${sourceId}`;\n  }\n  function inc(weight, sourceId, targetId) {\n    const w = weight || 1;\n    const key = getKey(sourceId, targetId);\n    const val = size.get(key) || 0;\n    size.set(key, val + w);\n  }\n  // Count edges efficiently\n  data.edges.forEach(e => {\n    inc(e.weight, e.source, e.target);\n  });\n  // Apply the sums\n  data.edges.forEach(e => {\n    const key = getKey(e.source, e.target);\n    e.size = size.get(key) || 1;\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Generates the \"InfoOrigin\" string:\n *     \"Created by <createdBy> on <creeated>\"\n *  @param {string} author\n *  @param {date} ms\n */\nfunction DeriveInfoOriginString(author, ms) {\n  return `Created by ${author} on ${new Date(ms).toLocaleString()}`;\n}\n\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Removes diacritic marks for comparison purposes\n *  @param {string} stringToProcess\n */\nfunction RemoveDiacriticMarks(stringToProcess) {\n  return stringToProcess.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n}\n\n/// MODULE EXPORTS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = {\n  GenerateUUID,\n  RecalculateAllNodeDegrees,\n  RecalculateAllEdgeSizes,\n  DeriveInfoOriginString,\n  RemoveDiacriticMarks\n};\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  panel-mgr\n\n  panel-mgr maintains the PANELSTATE app state, which is used to track the\n  status of panel components, including:\n  - NCVocabulary\n  - NCHelp\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'panel-mgr: ';\n\n/// MODULE INITIALIZATION /////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst MOD = UNISYS.NewModule(module.id);\nconst UDATA = UNISYS.NewDataLink(MOD);\n\n/// UTILITIES /////////////////////////////////////////////////////////////////\n\n/// LIFECYCLE HANDLERS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ lifecycle INITIALIZE handler\n/*/\nMOD.Hook('INITIALIZE', () => {\n  m_Init();\n}); // end UNISYS_INIT\n\n/// PRIVATE METHODS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_Init() {\n  const PANELSTATE = {\n    advancedIsOpen: false,\n    helpIsOpen: false,\n    vocabIsOpen: false\n  };\n  UDATA.SetAppState('PANELSTATE', PANELSTATE);\n}\n\n/// PUBLIC METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction AdvancedIsOpen() {\n  return UDATA.AppState('PANELSTATE').advancedIsOpen;\n}\nfunction HelpIsOpen() {\n  return UDATA.AppState('PANELSTATE').helpIsOpen;\n}\nfunction VocabIsOpen() {\n  return UDATA.AppState('PANELSTATE').vocabIsOpen;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction ToggleAdvanced() {\n  const PANELSTATE = UDATA.AppState('PANELSTATE');\n  UDATA.SetAppState('PANELSTATE', {\n    ...PANELSTATE,\n    advancedIsOpen: !PANELSTATE.advancedIsOpen\n  });\n}\nfunction ToggleHelp() {\n  const PANELSTATE = UDATA.AppState('PANELSTATE');\n  UDATA.SetAppState('PANELSTATE', {\n    ...PANELSTATE,\n    helpIsOpen: !PANELSTATE.helpIsOpen\n  });\n}\nfunction ToggleVocabulary() {\n  const PANELSTATE = UDATA.AppState('PANELSTATE');\n  UDATA.SetAppState('PANELSTATE', {\n    ...PANELSTATE,\n    vocabIsOpen: !PANELSTATE.vocabIsOpen\n  });\n}\n\n/// EXPORT REACT COMPONENT ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = {\n  AdvancedIsOpen,\n  HelpIsOpen,\n  VocabIsOpen,\n  ToggleAdvanced,\n  ToggleHelp,\n  ToggleVocabulary\n};\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  RENDER MANAGER\n\n  render-mgr handles the transformation of NCDATA (and it's subvariants\n  FILTEREDNCDATA and VDATA) into `VDATA` format that can be\n  rendered by NCGraphRenderer.\n\n  It is loaded directly by NCGraph for processing.  In this way,\n  multiple renderers can be supported via separate  NCGraph components.\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'render-mgr: ';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet VDATA = {};\n\n/// LIFECYCLE HANDLERS ////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ lifecycle INITIALIZE handler\n/*/\nMOD.Hook('INITIALIZE', () => {\n  // Register any handlers?\n  // Probably not needed as NCGraph handles most events and uses this\n  // module as utility methods.\n}); // end UNISYS_INIT\n\n/// MODULE PUBLIC METHODS //////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Interprets VDATA into a simplified form for the renderer\n *  @param {*} data NCDATA { nodes, edges }\n *  @returns {Object} {\n *                     nodes: [ ...{id, label, selected, selectedSecondary,\n *                                  size, color, opacity, strokeColor, strokeWidth,\n *                                  help}],\n *                     edges: [ ...{id, sourceId, targetId, size, color, opacity}]\n *                   }\n */\nMOD.ProcessNCData = data => {\n  if (DBG) console.log('ProcessNCData');\n  const nodes = m_UpdateNodes(data.nodes);\n  const edges = m_UpdateEdges(data.edges);\n  VDATA.nodes = nodes;\n  VDATA.edges = edges;\n  return VDATA;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.SetNCData = data => {\n  VDATA = data;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.UpdateSelection = data => {\n  const nodes = m_UpdateNodes(VDATA.nodes);\n  const edges = m_UpdateEdges(VDATA.edges);\n  VDATA.nodes = nodes;\n  VDATA.edges = edges;\n  return VDATA;\n};\n\n/// MODULE PRIVATE METHODS ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_UpdateNodes(nodes) {\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const SELECTION = UDATA.AppState('SELECTION');\n  const HILITE = UDATA.AppState('HILITE');\n  const SEARCH = UDATA.AppState('SEARCH');\n  const selectedNodes = SELECTION.nodes ? SELECTION.nodes.map(n => n.id) : [];\n  const autosuggestHiliteNodeId = HILITE.autosuggestHiliteNodeId;\n  const tableHiliteNodeId = HILITE.tableHiliteNodeId;\n  const foundNodes = SEARCH.suggestedNodes\n    ? SEARCH.suggestedNodes.map(n => n.id)\n    : [];\n  const highlightStrokeColor = TEMPLATE.sourceColor;\n  const foundStrokeColor = TEMPLATE.searchColor;\n\n  const COLORMAP = UDATA.AppState('COLORMAP');\n  return nodes.map(n => {\n    const isAutosuggestHilited = autosuggestHiliteNodeId === n.id;\n    const isTabletHilited = tableHiliteNodeId === n.id;\n    const isSelected = selectedNodes.includes(n.id);\n    const isSecondarySelected = SELECTION.selectedSecondary === n.id;\n    const isFound = foundNodes.includes(n.id);\n    // FIXME: Just copy over relevant attributes, don't copy the whole object!!!!\n    n.color = COLORMAP.nodeColorMap[n.type];\n    n.opacity = n.filteredTransparency;\n    n.size = Math.min(TEMPLATE.nodeSizeDefault + n.degrees, TEMPLATE.nodeSizeMax);\n    n.selected = false;\n    n.selectedSecondary = false;\n    if (isAutosuggestHilited) {\n      n.textColor = '#ccc';\n      n.strokeColor = '#ccc';\n      n.strokeWidth = '8px';\n    } else if (isTabletHilited) {\n      n.textColor = '#ccc';\n      n.strokeColor = '#ccc';\n      n.strokeWidth = '8px';\n    } else if (isSelected) {\n      // n.shape = 'rectangle';\n      n.textColor = highlightStrokeColor;\n      n.strokeColor = highlightStrokeColor;\n      n.strokeWidth = '5px';\n    } else if (isFound) {\n      n.textColor = foundStrokeColor;\n      n.strokeColor = foundStrokeColor;\n      n.strokeWidth = '5px';\n    } else {\n      n.textColor = '#333';\n      n.strokeColor = '#fff'; // default to white border\n      n.strokeWidth = '3px';\n    }\n    if (isSelected) {\n      n.selected = true; // selection state can be displayed simultaneously with hilite\n    }\n    if (isSecondarySelected) {\n      n.selectedSecondary = true; // edge source/target is selected\n    }\n    n.help = m_GetHelp(n);\n    return n;\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_UpdateEdges(edges) {\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const edgeSizeMax = TEMPLATE.edgeSizeMax;\n  const HILITE = UDATA.AppState('HILITE');\n  const { userHighlightNodeId } = HILITE;\n  return edges.map(e => {\n    // FIXME: Just copy over relevant attributes, don't copy the whole object!!!!\n    // width -- show full width unless mouse is over a node, in which case, do not show weight\n    //          size and max size checking was completed in edge-mgr\n    const sourceId = typeof e.source === 'number' ? e.source : e.source.id;\n    const targetId = typeof e.target === 'number' ? e.target : e.target.id;\n    if (\n      e.selected ||\n      userHighlightNodeId === undefined || // no mouseover\n      sourceId === userHighlightNodeId || // mouseover the source\n      targetId === userHighlightNodeId // or target\n    ) {\n      // leave size alone, max size checking is in edge-mgr\n      e.width = edgeSizeMax > 0 ? Math.min(edgeSizeMax, e.size) : e.size;\n      e.opacity = e.filteredTransparency;\n    } else {\n      e.width = TEMPLATE.edgeSizeDefault; // mouse over a node, so just show thin line\n      e.opacity = TEMPLATE.edgeDefaultTransparency; // lighten\n    }\n    // opacity\n    return e;\n  });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Returns the tooltip help text for the node, using labels defined in the template\n *  @param {*} node\n *  @returns {string}\n */\nfunction m_GetHelp(node) {\n  const TEMPLATE = UDATA.AppState('TEMPLATE');\n  const nodeDefs = TEMPLATE.nodeDefs;\n  let titleText = '';\n  Object.entries(nodeDefs).forEach(([key, def]) => {\n    if (def.includeInGraphTooltip && node[key] !== undefined) {\n      if (titleText) titleText += '\\n';\n      titleText += def.displayLabel + ': ' + node[key];\n    }\n  });\n  return titleText;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nfunction m_GetUpdatedDateText(nodeEdge) {\n  // console.warn('skipping m_GetUpdateDateText for now...revise after provenance/meta.revision is removed')\n  // const d = new Date(nodeEdge.meta.revision > 0 ? nodeEdge.meta.updated : nodeEdge.meta.created);\n  // const year = String(d.getFullYear());\n  // const date = (d.getMonth() + 1) + \"/\" + d.getDate() + \"/\" + year.substr(2, 4);\n  // const time = d.toTimeString().substr(0, 5);\n  // const author = nodeEdge._nlog ? nodeEdge._nlog[nodeEdge._nlog.length - 1] : 'unknown';\n  // const dateTime = date + ' at ' + time + \" by \" + author;\n  // return dateTime;\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  SELECTION MANAGER\n\n  selection-mgr handles UI selection events like:\n  * mouse over graph node\n  * Others TBD as selection is rewritten.\n\n  SELECTION data is\n    { nodes: [], edges: [], selectedSecondary: undefined };\n\n  In general\n  * `nodes[0]` will be the selected graph node (using the animated 3 arrow\n                        cursor) with an open Node editor\n  * `edges[]` are the edges linked to `nodes[0]`\n  * `selectedSecondary` is the node id of the source or target node\n                        that are highlighted in the graph (using the\n                        animated single arrow cursor)\n\n  As of 2023-07 this is a WIP.  There are remnants of v1.x SELECTION management\n  in nc-logic.  A lot of the more complex logic has been cleaned up and\n  deprecated:\n    * AutoComplete\n    * NodeSelector\n    * EdgeEditor\n    * d3-simplenetgraph\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'selection-mgr: ';\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst SELECTION_MODE = {\n  NORMAL: 'normal', // graph is selectable\n  EDGE_EDIT: 'edge_edit', // edge is being edited\n  // NODE_EDIT is not necessary b/c the transparent screen prevents clicks\n  SOURCETARGET: 'sourcetarget', // waiting for a source or target\n  COMMENT_EDIT: 'comment_edit' // disable node selection during comment edit\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nlet m_SelectionMode = SELECTION_MODE.NORMAL; // default\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** lifecycle INITIALIZE handler\n */\nMOD.Hook('INITIALIZE', () => {\n  UDATA.HandleMessage('SELECTMGR_SET_MODE', m_SetMode);\n  UDATA.HandleMessage('D3_SELECT_NODE', m_D3SelectNode);\n  UDATA.HandleMessage('SELECTMGR_SELECT_SECONDARY', m_SelectSecondary);\n  UDATA.HandleMessage('SELECTMGR_DESELECT_SECONDARY', m_DeselectSecondary);\n  // NODETABLE_SELECT_NODE\n  // AUTOSUGGEST_SELECT_NODE?\n}); // end UNISYS_INIT\n\n/// MODULE METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Set Selection Mode via SELECTMGR_SET_MODE\n *  @param {Object} data\n *  @param {Object} data.mode NORMAL || EDGE_EDIT || SOURCETARGET\n */\nfunction m_SetMode(data) {\n  let newmode = SELECTION_MODE.NORMAL; // default\n  if (Object.values(SELECTION_MODE).includes(data.mode)) newmode = data.mode;\n  m_SelectionMode = newmode;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** User clicked on d3 graph node\n *  --  Normal mode, clicking on a node selects it\n *  --  SourceTarget mode is for selecting a source or target node while editing an edge\n *  @param {Object} data\n *  @param {array:string} data.nodeLabels\n *  @param {array:number} data.nodeIDs\n */\nfunction m_D3SelectNode(data) {\n  const node = m_GetNode(data);\n  if (m_SelectionMode === SELECTION_MODE.NORMAL) {\n    m_SendSelectionUpdate(node);\n  } else if (m_SelectionMode === SELECTION_MODE.EDGE_EDIT) {\n    // ignore selection during EDGE_EDIT if SOURCE/TARGET has not been selected yet\n    if (DBG)\n      console.log(PR, 'm_D3SelectNode: ignoring selection during edge edit mode');\n  } else if (m_SelectionMode === SELECTION_MODE.SOURCETARGET) {\n    m_SendSourceTargetSelectionUpdate(node);\n  } else if (m_SelectionMode === SELECTION_MODE.COMMENT_EDIT) {\n    // ignore selection during COMMENT edit so that selecting\n    // another node closes the comment\n  } else {\n    throw `Unknown SELECTION Mode ${m_SelectionMode}`;\n  }\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Get the node that was passed via the search string\n *  either nodeIDs or nodeLabels\n *  @param {Object} searchdata\n *  @param {array} searchdata.nodeLabels strings\n *  @param {array} searchdata.nodeIDs numbers\n *  @returns {Object} single node\n */\nfunction m_GetNode(searchdata) {\n  const NCDATA = UDATA.AppState('NCDATA');\n  const { nodeLabels = [], nodeIDs = [] } = searchdata;\n  const nodeLabel = nodeLabels[0];\n  const nodeId = nodeIDs[0];\n  let node;\n  if (nodeId) {\n    node = NCDATA.nodes.find(n => n.id === nodeId);\n  } else if (nodeLabel) {\n    node = NCDATA.nodes.find(n => n.label === nodeLabel);\n  } else {\n    // No node selected, so deselect\n  }\n  return node;\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Broadcast SELECTION and HILITE updates for selecting a single node\n *  @param {Object} node\n */\nfunction m_SendSelectionUpdate(node) {\n  const NCDATA = UDATA.AppState('NCDATA');\n  let newSelection, newHilite;\n  if (node === undefined) {\n    // Node not found, clear selection state\n    newSelection = { nodes: [], edges: [], selectedSecondary: undefined };\n    newHilite = { autosuggestHiliteNodeId: undefined };\n  } else {\n    // Load existing node and edges\n    const nid = node.id;\n    let edges = [];\n    if (NCDATA.edges)\n      edges = edges.concat(\n        NCDATA.edges.filter(edge => edge.source === nid || edge.target === nid)\n      );\n    // create select state object\n    newSelection = { nodes: [node], edges, selectedSecondary: undefined };\n    newHilite = { autosuggestHiliteNodeId: undefined };\n  }\n  // Broadcast selection/hilite updates\n  UDATA.SetAppState('SELECTION', newSelection);\n  UDATA.SetAppState('HILITE', newHilite);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Broadcast SELECT_SOURCETARGET updates for selecting a source or target\n *  @param {Object} node\n */\nfunction m_SendSourceTargetSelectionUpdate(node) {\n  if (node === undefined) return; // skip update\n  UDATA.LocalCall('SELECT_SOURCETARGET', { node });\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** During Edge editing, show animated cursor after user selects a source\n *  or target node.  (For secondary selections)\n *  Broadcast SELECTMGR_SELECT_SECONDARY updates for selecting a source or target\n *  @param {Object} data\n *  @param {Object} data.node\n */\nfunction m_SelectSecondary(data) {\n  const SELECTION = UDATA.AppState('SELECTION');\n  SELECTION.selectedSecondary = data.node.id;\n  UDATA.SetAppState('SELECTION', SELECTION);\n}\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Deselect the secondary selection\n *  During Edge editing, after the user has selected the source or target\n *  node, we turn off the secondary select (so the single blue rotating arrow\n *  is cleared from the graph)\n */\nfunction m_DeselectSecondary() {\n  // Broadcast secondary deselection -- remove animated arrow\n  const SELECTION = UDATA.AppState('SELECTION');\n  SELECTION.selectedSecondary = undefined;\n  UDATA.SetAppState('SELECTION', SELECTION);\n}\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Template Editor Manager\n\n  Client-side\n\n  This handles the UI logic for the \"Edit Template\" subpanel on the \"More...\"\n  tab.\n\n  The actual template loading is handled by `server-database.js`.\n\n  The internal template representation is JSON.\n  The template definition itself is stored as a TOML file, which is then\n  converted to JSON when loaded.\n\n  The default json-editor schema is defined in `template-schema.js`\n\n\n  ##  BACKGROUND\n\n  Template data is loaded by `server-database` DB.InitializeDatabase call.\n\n  With Version 1.4 of NetCreate, we introduce a new TOML template format that\n  is easier to work with directly.\n  * If you open a project that does not have a TOML template, the app will\n    try to load the old JSON version and convert it.  See\n    server-database.m_LoadJSONTemplate() and m_MigrateJSONtoTOML().\n  * If you try to load a TOML template that is missing some key fields\n    (e.g. error message definitions), then the app will fall back on\n    fields defined in the schema.  See server-database.m_LoadTOMLTemplate()).\n\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\nconst TOML = require('@iarna/toml');\nconst DATASTORE = require('system/datastore');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n/// MODULE METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Used when importing a TOML file\n *  Makes sure TOML file is readable. Returns JSON\n */\nMOD.ValidateTOMLFile = async data => {\n  const { tomlfile } = data;\n  try {\n    let tomlText = await tomlfile.text();\n    const json = TOML.parse(tomlText);\n    const isValid = true;\n    return { isValid, templateJSON: json };\n  } catch (err) {\n    return { isValid: false, error: err };\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Update TEMPLATE AppState\n    Called by Template.jsx to update the template data with the info from the form.\n    Mostly used to process whether the form is:\n    a) updating the whole template data, or\n    b) updating only node types, or\n    c) updateing only edge types\n\n    IMPORTANT: Does NOT save the template or SetAppState!  Use SaveTemplateFile!\n      SaveTemplateFile will trigger a TEMPLATE state update.\n      Generally you won't call UpdateTemplate without a followup call to\n      SaveTemplateFile.\n\n    MAJOR SIDE EFFECT: Updates NCDATA with changes!\n    `templateSnippet` can be the whole template object, or just the node types or\n    edge types.\n */\nMOD.UpdateTemplate = (templateSnippet, editScope) => {\n  let TEMPLATE = UDATA.AppState('TEMPLATE');\n\n  // a) Replace whole template?\n  if (editScope === 'root') TEMPLATE = templateSnippet;\n\n  // b) Replace NODE type options?\n  if (editScope === 'nodeTypeOptions') {\n    // 1. Clean/validate -- Remove any extra empty labels\n    //    Added Rows will have a blank 'label' but a non-blank 'replacement'\n    let numOfEmptyLabels = 0;\n    TEMPLATE.nodeDefs.type.options = templateSnippet.options.filter(o => {\n      // if there's a replacement, always add it\n      if (o.replacement !== '') return true;\n      // if the label is blank...\n      if (o.label === '') {\n        if (numOfEmptyLabels < 1) {\n          // ... and there has only been one, add it\n          numOfEmptyLabels++;\n          return true;\n        } else {\n          // ... otherwise, remove extras\n          return false;\n        }\n      }\n      // keep all other adjustments\n      return true;\n    });\n    // 2. Update NCDATA with new types\n    UDATA.LocalCall('NODE_TYPES_UPDATE', {\n      nodeTypesChanges: templateSnippet.options\n    });\n    // 3. Remove Types marked for deletion\n    TEMPLATE.nodeDefs.type.options = TEMPLATE.nodeDefs.type.options.filter(\n      o => !o.delete\n    );\n    // 4. Update types with replacement labels\n    TEMPLATE.nodeDefs.type.options = TEMPLATE.nodeDefs.type.options.map(o => {\n      if (o.replacement) {\n        o.label = o.replacement;\n        o.replacement = '';\n      }\n      return o;\n    });\n  }\n\n  // c) Replace EDGE type options?\n  if (editScope === 'edgeTypeOptions') {\n    // 1. Clean/validate -- Remove any extra empty labels\n    //    Added Rows will have a blank 'label' but a non-blank 'replacement'\n    let numOfEmptyLabels = 0;\n    TEMPLATE.edgeDefs.type.options = templateSnippet.options.filter(o => {\n      // if there's a replacement, always add it\n      if (o.replacement !== '') return true;\n      // if the label is blank...\n      if (o.label === '') {\n        if (numOfEmptyLabels < 1) {\n          // ... and there has only been one, add it\n          numOfEmptyLabels++;\n          return true;\n        } else {\n          // ... otherwise, remove extras\n          return false;\n        }\n      }\n      // keep all other adjustments\n      return true;\n    });\n    // 2. Update NCDATA with new types\n    UDATA.LocalCall('EDGE_TYPES_UPDATE', {\n      edgeTypesChanges: templateSnippet.options\n    });\n    // 3. Remove Types marked for deletion\n    TEMPLATE.edgeDefs.type.options = TEMPLATE.edgeDefs.type.options.filter(\n      o => !o.delete\n    );\n    // 4. Update types with replacements\n    TEMPLATE.edgeDefs.type.options = TEMPLATE.edgeDefs.type.options.map(o => {\n      if (o.replacement) {\n        o.label = o.replacement;\n        o.replacement = '';\n      }\n      return o;\n    });\n  }\n  // This call is redundant.  SaveTemplateToFile will trigger a state update.\n  // UDATA.SetAppState(\"TEMPLATE\", TEMPLATE);\n  return TEMPLATE;\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Save template file to disk\n    in case we do not necessarily want to autosave template data\n    This calls: datastore > server > server-database\n */\nMOD.SaveTemplateToFile = template => {\n  return DATASTORE.SaveTemplateFile(template);\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Download template to local file\n */\nMOD.DownloadTemplate = () => {\n  DATASTORE.GetTemplateTOMLFileName() // datastore > server > server-database\n    .then(data => {\n      const filename = data.filename;\n      const TEMPLATE = UDATA.AppState('TEMPLATE');\n      const toml = TOML.stringify(TEMPLATE);\n      const link = document.createElement('a');\n      const blob = new Blob(['\\ufeff', toml]);\n      const url = URL.createObjectURL(blob);\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link); // Required for FF\n      link.click();\n      document.body.removeChild(link);\n    });\n};\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Template Manager\n\n  Client-side\n\n  This is a work in progress module that will handle all template management.\n  Eventually `template-editor-mgr` will probably be folded into this module.\n\n\n  ## NOTES\n\n  * Node/Edge Data is retained\n    The template definitions can be used essentially to show/hide particular fields.\n    This allows users to switch from one template to another without losing data.\n\n\n  ## BACKGROUND\n\n  Template data is loaded by `server-database` DB.InitializeDatabase call.\n\n  With Version 1.4 of Net.Create, we introduce a new TOML template format that\n  is easier to work with directly.\n  * If you open a project that does not have a TOML template, the app will\n    try to load the old JSON version and convert it.  See\n    server-database.m_LoadJSONTemplate() and m_MigrateJSONtoTOML().\n  * If you try to load a TOML template that is missing some key fields\n    (e.g. error message definitions), then the app will fall back on\n    fields defined in the schema.  See server-database.m_LoadTOMLTemplate()).\n\n  With Version 2.0 of Net.Create, we want to centralize all of the template\n  management logic in this module.\n\n  Used by:\n  * nc-ui\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\n/// API METHODS ///////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  Returns an array of attribute keys defined in the template definitions\n *  Attributes are:\n *  - Not built-in fields\n *  - Not provenance fields\n *  - Not hidden fields\n *  ...in other words, every other field that has been defined in the template.\n */\nfunction GetAttributeDefKeys(defs, BUILTIN_FIELDS) {\n  return Object.keys(defs).filter(\n    k => !BUILTIN_FIELDS.includes(k) && !defs[k].isProvenance && !defs[k].hidden\n  );\n}\n/** API METHOD\n *  Returns an array of provenance keys defined in the template definitions\n *  Provenance fields are:\n *  - Designated as `isProvenance` field\n *  - Not built-in fields\n *  - Not hidden fields\n */\nfunction GetProvenanceDefKeys(defs, BUILTIN_FIELDS) {\n  return Object.keys(defs).filter(\n    k => defs[k].isProvenance && !BUILTIN_FIELDS.includes(k) && !defs[k].hidden\n  );\n}\n\n/// MODULE EXPORTS ///////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = {\n  GetAttributeDefKeys,\n  GetProvenanceDefKeys\n};\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  Template Schema\n\n  The Template Schema defines a spec for\n  `[json-editor](https://github.com/json-editor/json-editor)`\n  to generate a UI for editing the template.  It identifies the objects that\n  the json-editor needs to support and provides meta data about how to\n  display and handle the edits.\n\n  `template-editor-mgr.js` handles initialization client-side.\n\n  NOTE: This schema is NOT the same as the `toml` template file schema.  This\n  schema is used by `json-editor` to know how to display a UI for editing the\n  template itself.\n\n  IMPORTANT: If you modify the schema, generate a new template by\n\n    1. Start NetCreate\n    2. In web browser developer console, run:\n\n        `ncRegenerateDefaultTemplate()`\n    3. This will create a new `_default.template.toml` file.\n\n  Alternatively the default template's JSON can be generated from this schema spec by\n  by calling MOD.ParseTemplateSchema() directly. This is the rough equivalent of doing this:\n  1. Start NetCreate with a new db, e.g. `./nc.js --dataset=newdefault`\n  2. Clicking \"New Template\" on the \"More... > Edit Template\" tab.\n  3. Clicking \"Save Changes\"\n  4. Copy the file to `netcreate-2018/build/app/assets/templates/`\n  FIXME: rename filepath\n  5. Renaming the saved template to `_default.template.toml`\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst clone = require('rfdc')();\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'template-schema';\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst MOD = {};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Node Type Schema\n *  This is a subset of the full template schema.\n *\n *  We pull it out separately so that Node Types can be edited by themselves\n *  without having to scroll through the whole template.\n *\n *  When editing the main Template, this is loaded as a subset of the main schema.\n *  When editing node types, this is loaded by MOD.GetTypeEditorSchema to\n *  provide additional UI elements to manage deleting and renaming\n *  existing field types\n *\n *  Default \"No Type Selected\" has a label of \"\"\n *  Templates should always have one default.\n */\nMOD.NODETYPEOPTIONS = {\n  type: 'array',\n  title: 'Node Types',\n  format: 'table',\n  options: {\n    disable_collapse: true,\n    disable_array_add: false,\n    disable_array_delete: false,\n    disable_array_delete_all_rows: true,\n    disable_array_delete_last_row: true,\n    disable_array_reorder: false\n  }, // not editable\n  items: {\n    type: 'object',\n    properties: {\n      'color': {\n        type: 'string',\n        title: 'Color',\n        format: 'color',\n        default: '#eeeeee' // for \"No Type Selected\", must be in form '#nnnnnn' -- alpha or short '#nnn' do not work\n      },\n      'label': {\n        type: 'string',\n        title: 'Label',\n        default: '' // leave '' for \"No Type Selected\"\n      }\n    }\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Edge Type Schema\n *  This is a subset of the full template schema.\n *\n *  We pull it out separately so that Edge Types can be edited by themselves\n *  without having to scroll through the whole template.\n *\n *  When editing the main Template, this is loaded as a subset of the main schema.\n *  When editing edge types, this is loaded by MOD.GetTypeEditorSchema to\n *  provide additional UI elements to manage deleting and renaming\n *  existing field types\n */\nMOD.EDGETYPEOPTIONS = {\n  type: 'array',\n  title: 'Edge Types',\n  format: 'table',\n  options: {\n    disable_collapse: true,\n    disable_array_add: false,\n    disable_array_delete: false,\n    disable_array_delete_all_rows: true,\n    disable_array_delete_last_row: true,\n    disable_array_reorder: false\n  }, // not editable\n  items: {\n    type: 'object',\n    properties: {\n      'color': {\n        // currently unused\n        type: 'string',\n        title: 'Color',\n        format: 'color',\n        default: '#eeeeee' // for \"No Type Selected\", must be in form '#nnnnnn' -- alpha or short '#nnn' do not work\n      },\n      'label': {\n        type: 'string',\n        title: 'Label',\n        default: '' // leave '' for \"No Type Selected\"\n      }\n    }\n  }\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** Main NetCreate Schema Template\n *  This references the NODETYPEOPTIONS and EGETYPEOPTIONS above to define\n *  options.\n *  Be sure to update `server-database.m_MigrateTemplate()` with any additions to\n *  the schema to maintain backward compatibility.\n */\nMOD.TEMPLATE = {\n  title: 'NetCreate Template',\n  version: 2.0, // match github Release number\n  type: 'object',\n  properties: {\n    'name': {\n      type: 'string',\n      description:\n        'A short descriptive title for the project.  This is displayed on the graph view.  It can contain spaces.  e.g. \"Alexander the Great\"',\n      default: 'Untitled Project'\n    },\n    'description': {\n      type: 'string',\n      description:\n        'Short description of the project, e.g. \"This is based on the Secret Histories of Prokopios\"',\n      default: 'No Description'\n    },\n    'citation': {\n      type: 'object',\n      description: 'Citation meta data',\n      properties: {\n        'text': {\n          type: 'string',\n          description: 'Bibliographic reference',\n          default: 'No citation set',\n          options: {\n            inputAttributes: { placeholder: 'Untitled Network' }\n          }\n        },\n        'hidden': {\n          type: 'boolean',\n          format: 'checkbox',\n          description: 'Hides the \"Cite Node\" and \"Cite Edge\" buttons.',\n          default: false\n        }\n      }\n    },\n    'requireLogin': {\n      type: 'boolean',\n      format: 'checkbox',\n      description: 'Users are required to log in to view the graph.',\n      default: false\n    },\n    'hideDeleteNodeButton': {\n      // Normally, only admins can delete nodes.  You're an admin if:\n      // -- is localhost (e.g. IP is 127.0.0.71)\n      // -- or has `?admin=true` GET parameter\n      // This will force hide the delete button even if you're an admin.\n      type: 'boolean',\n      format: 'checkbox',\n      description: 'Always hide Node delete button, even for admins.',\n      default: false\n    },\n    'allowLoggedInUserToImport': {\n      // Normally, only admins can import data.  You're an admin if:\n      // -- is localhost (e.g. IP is 127.0.0.71)\n      // -- or has `?admin=true` GET parameter\n      // This will allow any logged in user to import data.\n      type: 'boolean',\n      format: 'checkbox',\n      description:\n        'Allow any logged in user to import data.  Admins can always import data.',\n      default: false\n    },\n    'nodeSizeDefault': {\n      type: 'number',\n      description: 'Default size (radius) of nodes.',\n      default: 5\n    },\n    'nodeSizeMax': {\n      type: 'number',\n      description: 'Maximum size (radius) of nodes.',\n      default: 50\n    },\n    'edgeSizeDefault': {\n      type: 'number',\n      description: 'Default size (width) of edges.',\n      default: 1 // Was 0.175 to be barely visible, but edge weights now override this default to 1\n    },\n    'edgeSizeMax': {\n      type: 'number',\n      description:\n        'Maximum size (width) of edges.  Set to 0 to turn off maximum size limit.',\n      default: 25\n    },\n    'filterFade': {\n      type: 'string',\n      description:\n        'Display name of the filter function that shows matching items and fades others.',\n      default: 'Fade'\n    },\n    'filterFadeHelp': {\n      type: 'string',\n      description: 'Help text for the Fade filter, displayed on the VIEWS panel.',\n      default: 'Show matches, Fade others'\n    },\n    'filterReduce': {\n      type: 'string',\n      description:\n        'Display name of the filter function that shows matching items and reduces (removes) others.',\n      default: 'Reduce'\n    },\n    'filterReduceHelp': {\n      type: 'string',\n      description: 'Help text for the Reduce filter, displayed on the VIEWS panel.',\n      default: 'Show matches, Reduce (remove) others & recalculate sizes'\n    },\n    'filterFocus': {\n      type: 'string',\n      description:\n        'Display name of the filter fucntion that shows nodes connected to a selected node within a specified range.',\n      default: 'Focus'\n    },\n    'filterFocusHelp': {\n      type: 'string',\n      description: 'Help text for the Focus filter, displayed on the VIEWS panel.',\n      default: 'Show only nodes connected to the selected node within range'\n    },\n    'duplicateWarning': {\n      type: 'string',\n      description:\n        'Warning message to display if user is trying to create a node that already exists.',\n      default:\n        'NOTE: At least one other node has the same name. Use search or the node table to check the others.'\n    },\n    'nodeIsLockedMessage': {\n      type: 'string',\n      description:\n        'Warning message to display if user is trying to edit a node that someone is already editing.',\n      default:\n        'This node is currently being edited by someone else, please try again later.'\n    },\n    'edgeIsLockedMessage': {\n      type: 'string',\n      description:\n        'Warning message to display if user is trying to edit an edge that someone is already editing.',\n      default:\n        'This edge is currently being edited by someone else, please try again later.'\n    },\n    'templateIsLockedMessage': {\n      type: 'string',\n      description:\n        'Warning message to display if user is trying to edit a node or edge or import while the template is being edited.',\n      default: 'The template is currently being edited, please try again later.'\n    },\n    'importIsLockedMessage': {\n      type: 'string',\n      description:\n        'Warning message to display if user is trying to edit a node, edge, or template import is active.',\n      default: 'Data is currently being imported, please try again later.'\n    },\n    'nodeDefaultTransparency': {\n      type: 'number',\n      description: 'Default transparency for nodes (0 - 1).',\n      default: 1.0\n    },\n    'edgeDefaultTransparency': {\n      type: 'number',\n      description: 'Default transparency for edges (0 - 1).',\n      default: 0.7\n    },\n    'searchColor': {\n      type: 'string',\n      description: 'Outline color of nodes highlighted via search (hex).',\n      default: '#008800',\n      format: 'color'\n    },\n    'sourceColor': {\n      type: 'string',\n      description: 'Outline color of node selected to view / edit (hex).',\n      default: '#FFa500',\n      format: 'color'\n    },\n    'nodeDefs': {\n      properties: {\n        'id': {\n          type: 'object',\n          description: 'System-generated unique id number',\n          properties: {\n            'type': {\n              type: 'number',\n              options: { hidden: true }, // not editable\n              description: '\"id\" data type',\n              default: 'number'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Id'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'ID'\n            },\n            'help': {\n              type: 'string',\n              options: { hidden: true }, // not editable\n              description: 'Help text to display on the Node Editor form',\n              default: 'System-generated unique id number'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"id\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"id\" is always hidden.',\n              default: false\n            }\n          }\n        },\n        'label': {\n          type: 'object',\n          description: 'Display name of the node',\n          properties: {\n            'type': {\n              type: 'string',\n              options: { hidden: true }, // not editable\n              description: '\"label\" data type',\n              default: 'string'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'label'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Label'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Display name of the node'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"label\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"label\" is always shown.',\n              format: 'checkbox',\n              default: false\n            }\n          }\n        },\n        'type': {\n          type: 'object',\n          description: 'Enumerated node types',\n          properties: {\n            'type': {\n              type: 'string',\n              options: { hidden: true }, // not editable\n              description: 'node \"type\" data type',\n              default: 'select'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Type'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'NodeType' // matches Gephi\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Select a category'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"type\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"type\" from Node Editor, Nodes Table, and exports',\n              default: false\n            },\n            'options': Object.assign({}, MOD.NODETYPEOPTIONS, {\n              description:\n                'NOTE: We recommend using the \"Edit Node Types\" feature to edit Node Types.  It provides additional dataset migration tools.'\n            })\n          }\n        },\n        'notes': {\n          // was \"Significance\"\n          type: 'object',\n          description: 'General purpose notes text field',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"notes\" data type',\n              default: 'string'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Notes'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Notes'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'General purpose notes text field'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"notes\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"notes\" from Node Editor, Nodes Table, and exports',\n              default: false\n            }\n          }\n        },\n        'info': {\n          // Info/Number\n          type: 'object',\n          description: 'General purpose numeric text field',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"info\" data type',\n              default: 'number'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Number'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Info'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Some number comparison'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"info\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"info\" from Node Editor, Nodes Table, and exports',\n              default: false\n            }\n          }\n        },\n        'infoSource': {\n          type: 'object',\n          description: 'Who created the node',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"infoSource\" data type',\n              default: 'string'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Info Source'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'InfoSource'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Who created this?  (aka Source)'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"infoSource\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description:\n                'Hides \"infoSource\" from Node Editor, Nodes Table, and exports',\n              default: false\n            }\n          }\n        },\n        'degrees': {\n          type: 'object',\n          description: 'Number of edges connected to this node (auto-calculated)',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"degrees\" data type',\n              default: 'number'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Degrees'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Degrees'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Number of edges connected to this node'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"degrees\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description:\n                'Hides \"degrees\" from Node Editor, Nodes Table, and exports',\n              default: false\n            }\n          }\n        },\n        'created': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Created'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Created'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Date and time node was created'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"created\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"created\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'createdBy': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Created By'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Author who created the node'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Created By'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"created by\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"created by\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'updated': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Updated'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Updated'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Date and time node was last modified'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"updated\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"updated\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'updatedBy': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Updated By'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Updated By'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Author who updated the node'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"updated by\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"updated by\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'revision': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated data.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Revision'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Revision'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Number of times this node has been revised'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"revision\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"revision\" for exports and imports',\n              default: true\n            }\n          }\n        }\n      }\n    },\n    'edgeDefs': {\n      properties: {\n        'id': {\n          type: 'object',\n          description: 'System-generated unique id number',\n          properties: {\n            'type': {\n              type: 'number',\n              options: { hidden: true }, // not editable\n              description: '\"id\" data type',\n              default: 'number'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Id'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'ID'\n            },\n            'help': {\n              type: 'string',\n              options: { hidden: true }, // not editable\n              description: 'Help text to display on the Edge Editor form',\n              default: 'System-generated unique id number'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"id\" is always hidden.',\n              default: false\n            }\n          }\n        },\n        'source': {\n          type: 'object',\n          description: 'Node the edge is connected to',\n          properties: {\n            'type': {\n              type: 'string',\n              options: { hidden: true }, // not editable\n              description: '\"source\" data type',\n              default: 'number'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Source'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Source'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Edge source node'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"source\" is always shown.',\n              default: false\n            }\n          }\n        },\n        'target': {\n          type: 'object',\n          description: 'Node the edge is connected to',\n          properties: {\n            'type': {\n              type: 'string',\n              options: { hidden: true }, // not editable\n              description: '\"target\" data type',\n              default: 'number'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Target'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Target'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Edge target node'\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              options: { hidden: true }, // not end-user editable, always hidden from Template Editor\n              description: 'Not used.  \"target\" is always shown.',\n              default: false\n            }\n          }\n        },\n        'type': {\n          type: 'object',\n          description: 'Enumerated edge types',\n          properties: {\n            'type': {\n              type: 'string',\n              options: { hidden: true }, // not editable\n              description: 'edge \"type\" data type',\n              default: 'select'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Type'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'EdgeType' // matches Gephi?\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Type of edge connection'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"type\" from Edge Editor, Edges Table, and exports',\n              default: false\n            },\n            'options': Object.assign({}, MOD.EDGETYPEOPTIONS, {\n              description:\n                'NOTE: We recommend using the \"Edit Edge Types\" feature to edit Edge Types.  It provides additional dataset migration tools.'\n            })\n          }\n        },\n        'notes': {\n          // was \"Signficance\"\n          type: 'object',\n          description: 'General purpose notes text field',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"notes\" data type',\n              default: 'string'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Notes'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Notes'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Significance of the connection'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"notes\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        'info': {\n          // Info/Number/Date\n          type: 'object',\n          description: 'General purpose numeric text field',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"info\" data type',\n              default: 'number'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Date'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Date'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: '\"YYYY-MM-DD\" format\"'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Hides \"info\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        'weight': {\n          // Weight/Number\n          type: 'object',\n          description: 'Weight of this edge',\n          properties: {\n            'type': {\n              type: 'number',\n              description: '\"weight\" data type',\n              default: 'number'\n            },\n            'defaultValue': {\n              type: 'number',\n              description: 'The default \"weight\" of new edges',\n              default: 1\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Weight'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Weight'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Weight of edge'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"weight\" value in tooltip on graph',\n              default: true\n            },\n            'isRequired': {\n              type: 'boolean',\n              format: 'checkbox',\n              description:\n                'Make \"weight\" a required value.  When \"true\", \"weight\" will be set to `defaultValue` for all edges if \"weight\" was not previously defined.  Be sure to define `defaultValue`',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description:\n                'Hides \"weight\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        'infoSource': {\n          type: 'object',\n          description: 'Who created the edge',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"infoSource\" data type',\n              default: 'string'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Info Source'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'InfoSource'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Who created this?  (aka Source)'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"infoSource\" value in tooltip on graph',\n              default: true\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description:\n                'Hides \"infoSource\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        'citation': {\n          type: 'object',\n          description: 'Source of the edge',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"citation\" data type',\n              default: 'string'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Citation'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Citation'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Source Book.Chapter (e.g. \"Part 2 06.03\")'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description:\n                'Hides \"citation\" from Edge Editor, Edges Table, and exports',\n              default: false\n            }\n          }\n        },\n        'category': {\n          type: 'object',\n          description: 'General purpose string text field (deprecated)',\n          properties: {\n            'type': {\n              type: 'string',\n              description: '\"category\" data type',\n              default: 'string'\n            },\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Category'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Category'\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Node Editor form',\n              default: 'Category (deprecated)'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: false\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description:\n                'Hides \"category\" from Edge Editor, Edges Table, and exports',\n              default: true\n            }\n          }\n        },\n        'created': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Created'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Created'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"created\" value in tooltip on graph',\n              default: true\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Date and time edge was created'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"created\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'createdBy': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Created By'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Created By'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"created by\" value in tooltip on graph',\n              default: true\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Author who created the edge'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"created by\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'updated': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Updated'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Updated'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"updated\" value in tooltip on graph',\n              default: true\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Date and time edge was last modified'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"updated\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'updatedBy': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated date.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Updated By'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Updated By'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"updated by\" value in tooltip on graph',\n              default: true\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Author who updated the nodedgee'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"updated by\" for exports and imports',\n              default: false\n            }\n          }\n        },\n        'revision': {\n          // Built-in data DO NOT MODIFY!\n          type: 'object',\n          description:\n            'System-generated data.  This setting used to show/hide tooltip in graph and import/export',\n          properties: {\n            'displayLabel': {\n              type: 'string',\n              description: 'Label to use for system display',\n              default: 'Revision'\n            },\n            'exportLabel': {\n              type: 'string',\n              description: 'Label to use for exported csv file field name',\n              default: 'Revision'\n            },\n            'includeInGraphTooltip': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show \"revision\" value in tooltip on graph',\n              default: true\n            },\n            'help': {\n              type: 'string',\n              description: 'Help text to display on the Edge Editor form',\n              default: 'Number of times this edge has been revised'\n            },\n            'isProvenance': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Show in Provenance tab',\n              default: true\n            },\n            'hidden': {\n              type: 'boolean',\n              format: 'checkbox',\n              description: 'Requires \"revision\" for exports and imports',\n              default: true\n            }\n          }\n        }\n      }\n    }\n  }\n};\n\n/// SCHEMA METHODS ////////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/*/ API METHOD for Extra schema definition for the Type Editor UI\n *  This introduces a wrapper around the Node or Edge Type Schema to provide\n *  extra UI elements for managing Type changes that the normal Template\n *  editor does not have:\n *  - Adds a checkbox to mark a type for deletion\n *  - Adds a field to map a deleted type to another type\n *\n *  Used by the \"Edit Node Types\" and \"Edit Edge Types\" buttons.\n/*/\nMOD.GetTypeEditorSchema = schemaTypeOptions => {\n  const typeOptions = clone(schemaTypeOptions);\n  try {\n    typeOptions.options.disable_array_delete = true;\n    typeOptions.items.properties.label.options = {\n      // For some reason inputAttribute 'disabled' does not work here\n      // so we use a className to mark the field\n      // then in Template.onEditNodeTypes we set the\n      // disabled property via js\n      inputAttributes: { class: 'disabledField' }\n    };\n    typeOptions.items.properties.replacement = {\n      type: 'string',\n      title: 'Change To'\n    };\n    typeOptions.items.properties.delete = {\n      type: 'boolean',\n      title: 'Delete?',\n      format: 'checkbox'\n    };\n  } catch (err) {\n    console.error('GetTypeEditorSchema Error:', err);\n  }\n  return {\n    title: 'Edit Type Options',\n    type: 'object',\n    description:\n      'NOTE that labels are case-sensitive, so \"Person\" is different from \"person\"',\n    options: {\n      disable_array_add: true,\n      disable_array_delete: true,\n      disable_array_delete_all_rows: true,\n      disable_array_delete_last_row: true,\n      disable_array_reorder: true,\n      disable_collapse: true,\n      disable_properties: true\n    }, // not editable\n    properties: {\n      'options': typeOptions\n    }\n  };\n};\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n/** API METHOD\n *  ParseTemplateSchema generates and resturns the default template json\n *  Use this to create a pristine defaul template json\n/*/\nMOD.ParseTemplateSchema = () => {\n  let currNodeOrEdge;\n  // optionsDefinition is eithert MOD.NODETYPEOPTIONS or MOD.EDGETYPEOPTIONS\n  function u_ParseOptions(optionsDefinition) {\n    const json = {};\n    const options = optionsDefinition.items.properties;\n    Object.keys(options).forEach(key => {\n      json[key] = options[key].default;\n    });\n    return [json];\n  }\n  function u_ParseProperty(prop) {\n    if (prop.type === 'string') return prop.default || ''; // fall back to '' if default is not defined\n    if (prop.type === 'number') return prop.default || 0; // fall back to 0 if no default\n    if (prop.type === 'boolean') return prop.default || false; // fall back to false if no default\n    return '';\n  }\n  function u_ParseProperties(properties, currJson) {\n    Object.keys(properties).forEach(templatePropertyKey => {\n      if (templatePropertyKey === 'nodeDefs') currNodeOrEdge = 'nodes';\n      if (templatePropertyKey === 'edgeDefs') currNodeOrEdge = 'edges';\n      // REVIEW logic assumes that `edgeDefs` is the last category that has `options`\n      // if we add a new category, we may need to clear `currNodeOrEdge`\n\n      const prop = properties[templatePropertyKey];\n      if (prop.properties) {\n        currJson[templatePropertyKey] = u_ParseProperties(prop.properties, {});\n      } else if (templatePropertyKey === 'options') {\n        // Special handling for nodeDef and edgeDef `type` options as these are not defined in the main\n        // schema, but are instead separated\n        if (currNodeOrEdge === 'nodes') {\n          currJson.options = u_ParseOptions(MOD.NODETYPEOPTIONS);\n        } else if (currNodeOrEdge === 'edges') {\n          currJson.options = u_ParseOptions(MOD.EDGETYPEOPTIONS);\n        } else {\n          throw `${PR}.ParseTemplateSchema encountered unknown 'options' in ${JSON.stringify(\n            properties\n          )} at ${templatePropertyKey}`;\n        }\n      } else {\n        currJson[templatePropertyKey] = u_ParseProperty(prop);\n      }\n    });\n    return currJson;\n  }\n  let json = { version: MOD.TEMPLATE.version }; // Insert template version\n  u_ParseProperties(MOD.TEMPLATE.properties, json);\n  return json;\n};\n\n/// RUNTIME INITIALIZATION ////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nMOD.ParseTemplateSchema();\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n","/*//////////////////////////////// ABOUT \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\*\\\n\n  UI MANAGER\n\n  ui-mgr handles the custom definition of a UI\n\n  It maps the template-schema variables to\n  the visual display of components.\n\n  What does it take care of?\n  * order of display items?\n  * visible status?\n\n  Available Field Types\n  * string\n  * number\n  * datetime\n  * date\n  * time\n  * enum\n  * color\n\n\\*\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ * //////////////////////////////////////*/\n\nconst UNISYS = require('unisys/client');\n\n/// CONSTANTS & DECLARATIONS //////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nconst DBG = false;\nconst PR = 'ui-mgr: ';\n\n/// INITIALIZE MODULE /////////////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nvar MOD = UNISYS.NewModule(module.id);\nvar UDATA = UNISYS.NewDataLink(MOD);\n\n// /// UNISYS HANDLERS ///////////////////////////////////////////////////////////\n// /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// /** lifecycle INITIALIZE handler\n//  */\n// MOD.Hook(\"INITIALIZE\", () => {\n//   UDATA.HandleMessage('USER_HILITE_NODE', m_UserHighlightNode);\n//   UDATA.HandleMessage('AUTOSUGGEST_HILITE_NODE', m_AutoSuggestHiliteNode);\n//   UDATA.HandleMessage('TABLE_HILITE_NODE', m_TableHiliteNode);\n// }); // end UNISYS_INIT\n\n// /// MODULE METHODS ////////////////////////////////////////////////////////////\n// /// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n// function m_UserHighlightNode(data) {\n//   // console.log('mouseover', data.nodeId)\n//   const HILITE = UDATA.AppState('HILITE');\n//   HILITE.userHighlightNodeId = data.nodeId;\n//   UDATA.SetAppState('HILITE', HILITE);\n// }\n\n/// EXPORT CLASS DEFINITION ///////////////////////////////////////////////////\n/// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nmodule.exports = MOD;\n"]}